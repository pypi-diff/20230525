# Comparing `tmp/plumed-2.8.2.2.tar.gz` & `tmp/plumed-2.9.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "plumed-2.8.2.2.tar", last modified: Tue Apr  4 00:09:50 2023, max compression
+gzip compressed data, was "plumed-2.9.0.tar", last modified: Thu May 25 09:43:07 2023, max compression
```

## Comparing `plumed-2.8.2.2.tar` & `plumed-2.9.0.tar`

### file list

```diff
@@ -1,25 +1,25 @@
-drwxr-xr-x   0 bussi      (503) staff       (20)        0 2023-04-04 00:09:50.940769 plumed-2.8.2.2/
--rw-r--r--   0 bussi      (503) staff       (20)      124 2023-04-04 00:08:58.000000 plumed-2.8.2.2/MANIFEST.in
--rw-r--r--   0 bussi      (503) staff       (20)     1878 2023-04-04 00:09:50.940413 plumed-2.8.2.2/PKG-INFO
--rw-r--r--   0 bussi      (503) staff       (20)      324 2023-04-04 00:09:40.000000 plumed-2.8.2.2/PLUMED_VERSION
--rw-r--r--   0 bussi      (503) staff       (20)     1163 2023-04-04 00:08:58.000000 plumed-2.8.2.2/README.rst
--rw-r--r--   0 bussi      (503) staff       (20)     2346 2023-04-04 00:08:58.000000 plumed-2.8.2.2/cplumed.pxd
-drwxr-xr-x   0 bussi      (503) staff       (20)        0 2023-04-04 00:09:50.936857 plumed-2.8.2.2/include/
--rw-r--r--   0 bussi      (503) staff       (20)   142821 2023-04-04 00:08:58.000000 plumed-2.8.2.2/include/Plumed.h
--rw-r--r--   0 bussi      (503) staff       (20)     1625 2023-04-04 00:08:58.000000 plumed-2.8.2.2/include/exceptions_handler.h
--rw-r--r--   0 bussi      (503) staff       (20)  1928783 2023-04-04 00:05:33.000000 plumed-2.8.2.2/plumed.cpp
-drwxr-xr-x   0 bussi      (503) staff       (20)        0 2023-04-04 00:09:50.938330 plumed-2.8.2.2/plumed.egg-info/
--rw-r--r--   0 bussi      (503) staff       (20)     1878 2023-04-04 00:09:48.000000 plumed-2.8.2.2/plumed.egg-info/PKG-INFO
--rw-r--r--   0 bussi      (503) staff       (20)      375 2023-04-04 00:09:50.000000 plumed-2.8.2.2/plumed.egg-info/SOURCES.txt
--rw-r--r--   0 bussi      (503) staff       (20)        1 2023-04-04 00:09:48.000000 plumed-2.8.2.2/plumed.egg-info/dependency_links.txt
--rw-r--r--   0 bussi      (503) staff       (20)        1 2023-04-04 00:05:34.000000 plumed-2.8.2.2/plumed.egg-info/not-zip-safe
--rw-r--r--   0 bussi      (503) staff       (20)        7 2023-04-04 00:09:48.000000 plumed-2.8.2.2/plumed.egg-info/top_level.txt
--rw-r--r--   0 bussi      (503) staff       (20)    40697 2023-04-04 00:08:58.000000 plumed-2.8.2.2/plumed.pyx
--rw-r--r--   0 bussi      (503) staff       (20)       38 2023-04-04 00:09:50.940913 plumed-2.8.2.2/setup.cfg
--rw-r--r--   0 bussi      (503) staff       (20)     5451 2023-04-04 00:08:58.000000 plumed-2.8.2.2/setup.py
-drwxr-xr-x   0 bussi      (503) staff       (20)        0 2023-04-04 00:09:50.939998 plumed-2.8.2.2/test/
--rw-r--r--   0 bussi      (503) staff       (20)     1162 2023-04-04 00:08:58.000000 plumed-2.8.2.2/test/test_array.py
--rw-r--r--   0 bussi      (503) staff       (20)     5836 2023-04-04 00:08:58.000000 plumed-2.8.2.2/test/test_input_builder.py
--rw-r--r--   0 bussi      (503) staff       (20)      460 2023-04-04 00:08:58.000000 plumed-2.8.2.2/test/test_mpi.py
--rw-r--r--   0 bussi      (503) staff       (20)     2641 2023-04-04 00:08:58.000000 plumed-2.8.2.2/test/test_pandas.py
--rw-r--r--   0 bussi      (503) staff       (20)     6371 2023-04-04 00:08:58.000000 plumed-2.8.2.2/test/test_run.py
+drwxr-xr-x   0 bussi      (503) staff       (20)        0 2023-05-25 09:43:07.321870 plumed-2.9.0/
+-rw-r--r--   0 bussi      (503) staff       (20)       87 2023-05-25 09:42:44.000000 plumed-2.9.0/MANIFEST.in
+-rw-r--r--   0 bussi      (503) staff       (20)     1876 2023-05-25 09:43:07.321522 plumed-2.9.0/PKG-INFO
+-rw-r--r--   0 bussi      (503) staff       (20)      322 2023-05-25 09:42:44.000000 plumed-2.9.0/PLUMED_VERSION
+-rw-r--r--   0 bussi      (503) staff       (20)     1163 2023-05-25 09:42:44.000000 plumed-2.9.0/README.rst
+-rw-r--r--   0 bussi      (503) staff       (20)     2058 2023-05-25 09:42:44.000000 plumed-2.9.0/cplumed.pxd
+drwxr-xr-x   0 bussi      (503) staff       (20)        0 2023-05-25 09:43:07.313537 plumed-2.9.0/include/
+-rw-r--r--   0 bussi      (503) staff       (20)   153046 2023-05-25 09:42:44.000000 plumed-2.9.0/include/Plumed.h
+-rw-r--r--   0 bussi      (503) staff       (20)  2043620 2023-05-25 09:43:04.000000 plumed-2.9.0/plumed.c
+drwxr-xr-x   0 bussi      (503) staff       (20)        0 2023-05-25 09:43:07.317096 plumed-2.9.0/plumed.egg-info/
+-rw-r--r--   0 bussi      (503) staff       (20)     1876 2023-05-25 09:43:04.000000 plumed-2.9.0/plumed.egg-info/PKG-INFO
+-rw-r--r--   0 bussi      (503) staff       (20)      371 2023-05-25 09:43:07.000000 plumed-2.9.0/plumed.egg-info/SOURCES.txt
+-rw-r--r--   0 bussi      (503) staff       (20)        1 2023-05-25 09:43:04.000000 plumed-2.9.0/plumed.egg-info/dependency_links.txt
+-rw-r--r--   0 bussi      (503) staff       (20)        1 2023-05-25 09:43:04.000000 plumed-2.9.0/plumed.egg-info/not-zip-safe
+-rw-r--r--   0 bussi      (503) staff       (20)        7 2023-05-25 09:43:04.000000 plumed-2.9.0/plumed.egg-info/top_level.txt
+-rw-r--r--   0 bussi      (503) staff       (20)    48431 2023-05-25 09:42:44.000000 plumed-2.9.0/plumed.pyx
+-rw-r--r--   0 bussi      (503) staff       (20)       38 2023-05-25 09:43:07.321998 plumed-2.9.0/setup.cfg
+-rw-r--r--   0 bussi      (503) staff       (20)     5368 2023-05-25 09:42:44.000000 plumed-2.9.0/setup.py
+drwxr-xr-x   0 bussi      (503) staff       (20)        0 2023-05-25 09:43:07.320832 plumed-2.9.0/test/
+-rw-r--r--   0 bussi      (503) staff       (20)     1283 2023-05-25 09:42:44.000000 plumed-2.9.0/test/test_array.py
+-rw-r--r--   0 bussi      (503) staff       (20)     1356 2023-05-25 09:42:44.000000 plumed-2.9.0/test/test_hills_average.py
+-rw-r--r--   0 bussi      (503) staff       (20)     6190 2023-05-25 09:42:44.000000 plumed-2.9.0/test/test_input_builder.py
+-rw-r--r--   0 bussi      (503) staff       (20)      460 2023-05-25 09:42:44.000000 plumed-2.9.0/test/test_mpi.py
+-rw-r--r--   0 bussi      (503) staff       (20)     2957 2023-05-25 09:42:44.000000 plumed-2.9.0/test/test_pandas.py
+-rw-r--r--   0 bussi      (503) staff       (20)     6535 2023-05-25 09:42:44.000000 plumed-2.9.0/test/test_run.py
```

### Comparing `plumed-2.8.2.2/PKG-INFO` & `plumed-2.9.0/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: plumed
-Version: 2.8.2.2
+Version: 2.9.0
 Summary: Python interface to PLUMED
 Home-page: http://www.plumed.org
 Author: Gareth A. Tribello
 Author-email: plumed-users@googlegroups.com
 Classifier: Development Status :: 4 - Beta
 Classifier: Intended Audience :: Science/Research
 Classifier: Topic :: Scientific/Engineering :: Bio-Informatics
```

### Comparing `plumed-2.8.2.2/README.rst` & `plumed-2.9.0/README.rst`

 * *Files identical despite different names*

### Comparing `plumed-2.8.2.2/include/Plumed.h` & `plumed-2.9.0/include/Plumed.h`

 * *Files 3% similar despite different names*

```diff
@@ -94,14 +94,17 @@
   for a better control of plumed initializations and deallocations.
   This is particularly useful for the C++ interface that now
   behaves similarly to a primitive shared pointer and can be thus copied.
   In other languages, to use the reference counter correctly it is sufficient to
   remember the following rule: for any `plumed_create*` call, there should be a corresponding
   `plumed_finalize` call. More examples can be found below.
 
+  Notice that up to PLUMED 2.8 the reference counter was not thread safe. This is fixed
+  when using PLUMED>=2.9 wrappers with a PLUMED>=2.9 kernel.
+
   The basic method to send a message to plumed is
 \verbatim
   (C) plumed_cmd
   (C++) PLMD::Plumed::cmd
   (FORTRAN)  PLUMED_F_CMD
 \endverbatim
 
@@ -524,14 +527,27 @@
   Only used in declarations, but affects the scope of the C interface also in definitions.
 */
 
 #ifndef __PLUMED_WRAPPER_CXX_ANONYMOUS_NAMESPACE
 #define __PLUMED_WRAPPER_CXX_ANONYMOUS_NAMESPACE 0
 #endif
 
+
+/*
+  1: throw exceptions such as PLMD::Exception
+  0: throw exceptions such as PLMD::Plumed::Exception (default)
+
+  This is useful when including Plumed.h within the plumed library
+  in anonymous mode, to make sure that the exception types from the
+  library are used.
+*/
+#ifndef __PLUMED_WRAPPER_CXX_ANONYMOUS_NAMESPACE_PLMD_EXCEPTIONS
+#define __PLUMED_WRAPPER_CXX_ANONYMOUS_NAMESPACE_PLMD_EXCEPTIONS 0
+#endif
+
 /*
   1: make PLMD::Plumed class polymorphic (default)
   0: make PLMD::Plumed class non-polymorphic
 
   Only used in declarations.
 */
 
@@ -593,14 +609,28 @@
   PLMD::Plumed::cmd, so that it should be in practice irrelevant.
 */
 #ifndef __PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER
 #define __PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER 512
 #endif
 
 /*
+  1: enable nested exceptions (only with C++11) (default)
+  0: disable nested exceptions
+
+  For internal testing, used to mimic pre C++11 behavior on
+  nested exception.
+
+  Only used in declarations.
+*/
+
+#ifndef __PLUMED_WRAPPER_CXX_ENABLE_NESTED_EXCEPTIONS
+#define __PLUMED_WRAPPER_CXX_ENABLE_NESTED_EXCEPTIONS 1
+#endif
+
+/*
  By default, assume C++11 compliant library is not available.
 */
 
 #ifndef __PLUMED_WRAPPER_LIBCXX11
 #define __PLUMED_WRAPPER_LIBCXX11 0
 #endif
 
@@ -692,24 +722,47 @@
 #define __PLUMED_WRAPPER_GLOBAL 0
 
 #endif /*}*/
 
 #if __PLUMED_WRAPPER_CXX_STD
 #include <cstddef> /* size_t */
 #include <cstring> /* memcpy */
-#include <cstdlib> /* malloc free */
+#include <cstdio> /* fprintf */
+#include <cstdlib> /* abort */
+#include <cassert> /* assert */
 #else
 #include <stddef.h>
 #include <string.h>
-#include <stdlib.h>
-#include <stdio.h> /* FILE */
+#include <stdio.h> /* FILE and fprintf */
+#include <stdlib.h> /* abort */
 #include <limits.h> /* CHAR_MIN */
+#include <assert.h> /* assert */
 #endif
 
 /**
+  This is an internal tool, to make sure that all malloc calls inside the
+  plumed library refer to the same implementation. When compiling with
+  __PLUMED_WRAPPER_DEBUG_REFCOUNT=1 it is possible to log
+  allocations and deallocations, so as to debug the wrappers.
+*/
+__PLUMED_WRAPPER_C_BEGIN
+void* plumed_malloc(__PLUMED_WRAPPER_STD size_t size);
+__PLUMED_WRAPPER_C_END
+
+/**
+  This is an internal tool, to make sure that all free calls inside the
+  plumed library refer to the same implementation. When compiling with
+  __PLUMED_WRAPPER_DEBUG_REFCOUNT=1 it is possible to log
+  allocations and deallocations, so as to debug the wrappers.
+*/
+__PLUMED_WRAPPER_C_BEGIN
+void plumed_free(void* ptr);
+__PLUMED_WRAPPER_C_END
+
+/**
   \brief Main plumed object
 
   This is an object containing a Plumed instance, which should be used in
   the MD engine. It should first be initialized with plumed_create(),
   then it communicates with the MD engine using plumed_cmd(). Finally,
   before the termination, it should be deallocated with plumed_finalize().
   Its interface is very simple and general, and is expected
@@ -795,71 +848,197 @@
   plumed_cmd(p,"init",&error);
   if(error.code) {
     fprintf(errors,"%d\n",error.code);
     plumed_error_finalize(error); // make sure the error object is finalized!
   }
 \endverbatim
 
-  The layout of this structure is subject to change, and functions manipulating it
-  are defined as inline/static functions.
+  The layout of this structure is subject to change, thus all the functions manipulating it
+  are defined as inline/static functions. In the future, we might reach some form
+  of ABI stability, and these functions might be moved below to the implementation
+  file.
+
+  Notice that there is a macro plumed_error() defined in the PLUMED source code
+  (at tools/Exception.h). There is no conflict with this type since C preprocessor
+  distinguishes macros and function-like macros.
 */
-typedef struct {
+typedef struct plumed_error {
   /** code used for translating messages */
   int code;
-  /** message */
-  const char* what;
   /** error code for system_error */
   int error_code;
+  /** message */
+  const char* what;
   /** the buffer containing the message to be deallocated */
   char* what_buffer;
+  /** pointer to nested exception */
+  struct plumed_error* nested;
 } plumed_error;
 
 /** Initialize error (for internal usage) */
 __PLUMED_WRAPPER_STATIC_INLINE void plumed_error_init(plumed_error* error) __PLUMED_WRAPPER_CXX_NOEXCEPT {
-  if(!error) return;
+  assert(error);
   error->code=0;
-  error->what=__PLUMED_WRAPPER_CXX_NULLPTR;
   error->error_code=0;
+  error->what=__PLUMED_WRAPPER_CXX_NULLPTR;
   error->what_buffer=__PLUMED_WRAPPER_CXX_NULLPTR;
+  error->nested=__PLUMED_WRAPPER_CXX_NULLPTR;
 }
 
 /** Finalize error - should be called when an error is raised to avoid leaks */
 __PLUMED_WRAPPER_STATIC_INLINE void plumed_error_finalize(plumed_error error) __PLUMED_WRAPPER_CXX_NOEXCEPT {
+  if(!error.code) return;
+  if(error.nested) {
+    plumed_error_finalize(*error.nested);
+    plumed_free(error.nested);
+  }
   if(error.what_buffer) {
-    __PLUMED_WRAPPER_STD free(error.what_buffer);
+    plumed_free(error.what_buffer);
+  }
+}
+
+/** Access message - more robust than directly accessing what ptr, for future extensibility */
+__PLUMED_WRAPPER_STATIC_INLINE const char* plumed_error_what(plumed_error error) __PLUMED_WRAPPER_CXX_NOEXCEPT {
+  return error.what;
+}
+
+/** Set error to bad_alloc (for internal usage).
+    At variance with plumed_error_init, it also finalizes the error, possibly
+    deallocating any buffer.
+*/
+__PLUMED_WRAPPER_STATIC_INLINE void plumed_error_set_bad_alloc(plumed_error*error) {
+  assert(error);
+  plumed_error_finalize(*error);
+  plumed_error_init(error);
+  error->what="[msg erased due to allocation failure]";
+  error->code=11400;
+}
+
+/** Recursive merge (for internal usage) */
+__PLUMED_WRAPPER_STATIC_INLINE void plumed_error_recursive_merge(plumed_error* error,char*buffer,const char*join,__PLUMED_WRAPPER_STD size_t*len) __PLUMED_WRAPPER_CXX_NOEXCEPT {
+  if(error->nested) plumed_error_recursive_merge(error->nested,buffer,join,len);
+  __PLUMED_WRAPPER_STD strncat(buffer,plumed_error_what(*error),*len);
+  *len -= __PLUMED_WRAPPER_STD strlen(plumed_error_what(*error));
+  __PLUMED_WRAPPER_STD strncat(buffer,join,*len);
+  *len -= __PLUMED_WRAPPER_STD strlen(join);
+}
+
+/** Merge with nested exceptions */
+__PLUMED_WRAPPER_STATIC_INLINE void plumed_error_merge_with_nested(plumed_error* error) __PLUMED_WRAPPER_CXX_NOEXCEPT {
+  __PLUMED_WRAPPER_STD size_t len;
+  __PLUMED_WRAPPER_STD size_t len_join;
+  /* The is temporarily holding the new message */
+  char* new_buffer;
+  /* This is the string used to concatenate messages */
+  const char* join="\n\nThe above exception was the direct cause of the following exception:\n";
+  /* This is used to iterate over the linked list of nested exceptions */
+  plumed_error*e;
+
+  /* If exception is not nested, nothing to do */
+  if(!error->nested) return;
+
+  /* Accumulate the total length of the concatenated message */
+  len_join=__PLUMED_WRAPPER_STD strlen(join);
+  e=error;
+  len=__PLUMED_WRAPPER_STD strlen(plumed_error_what(*e));
+  while(e->nested) {
+    e=e->nested;
+    len+=len_join+__PLUMED_WRAPPER_STD strlen(plumed_error_what(*e));
+  }
+
+  /* Allocate the new message */
+  new_buffer=(char*)plumed_malloc(len+1);
+  if(new_buffer) {
+    /* If allocation was successful, merge the messages */
+    new_buffer[0]='\0';
+    /* Notice that we have a forward linked list but we need to go through that in backward order
+       (inner to outer). To do that without allocating an additional array, we use a recursive
+       function.
+    */
+    assert(error->nested);
+    plumed_error_recursive_merge(error->nested,new_buffer,join,&len);
+    __PLUMED_WRAPPER_STD strncat(new_buffer,plumed_error_what(*error),len);
+    len -= __PLUMED_WRAPPER_STD strlen(plumed_error_what(*error));
+    /* we keep track of length of buffer for safety */
+    assert(len==0);
+  }
+  error->what=new_buffer;
+
+  /* Deallocate the previous message */
+  if(error->what_buffer) plumed_free(error->what_buffer);
+  error->what_buffer=new_buffer;
+
+  /* Finalize the chain of nested exceptions */
+  plumed_error_finalize(*error->nested);
+  plumed_free(error->nested);
+  error->nested=__PLUMED_WRAPPER_CXX_NULLPTR;
+
+  if(!error->what) {
+    /* If allocation was not successful, reset to bad_alloc */
+    plumed_error_set_bad_alloc(error);
   }
 }
 
+/** Rethrow error (calling abort) */
+__PLUMED_WRAPPER_CXX_NORETURN __PLUMED_WRAPPER_STATIC_INLINE void plumed_error_rethrow(plumed_error h) {
+  if(h.nested) plumed_error_merge_with_nested(&h);
+  __PLUMED_WRAPPER_STD fprintf(stderr,"Terminate due to exception. Code: %d\n%s\n",h.code,plumed_error_what(h));
+  __PLUMED_WRAPPER_STD abort();
+}
+
 /** Callback (for internal usage) */
 __PLUMED_WRAPPER_STATIC_INLINE void plumed_error_set(void*ptr,int code,const char*what,const void* opt) __PLUMED_WRAPPER_CXX_NOEXCEPT {
   plumed_error* error;
   __PLUMED_WRAPPER_STD size_t len;
-  const void*const* options;
+  void*const* options;
 
   error=(plumed_error*) ptr;
 
   error->code=code;
   error->error_code=0;
   len=__PLUMED_WRAPPER_STD strlen(what);
-  error->what_buffer=(char*) __PLUMED_WRAPPER_STD malloc(len+1);
+  error->what_buffer=(char*) plumed_malloc(len+1);
   if(!error->what_buffer) {
-    error->what="cannot allocate error object";
-    error->code=11400;
+    plumed_error_set_bad_alloc(error);
     return;
   }
-  __PLUMED_WRAPPER_STD strncpy(error->what_buffer,what,len+1);
 
+  __PLUMED_WRAPPER_STD strncpy(error->what_buffer,what,len+1);
   error->what=error->what_buffer;
 
   /* interpret optional arguments */
-  options=(const void*const*)opt;
-  if(options) while(*options) {
-      if(*((const char*)*options)=='c') error->error_code=*((const int*)*(options+1));
+  if(opt) {
+    options=(void*const*)opt;
+    while(*options) {
+      /* c: error code */
+      if(*((const char*)*options)=='c' && *(options+1)) {
+        error->error_code=*((const int*)*(options+1));
+        break;
+      }
+      options+=2;
+    }
+    options=(void*const*)opt;
+    while(*options) {
+      /* n: nested exception */
+      if(*((const char*)*options)=='n' && *(options+1)) {
+        /* notice that once this is allocated it is guaranteed to be deallocated by the recursive destructor */
+        error->nested=(plumed_error*) plumed_malloc(sizeof(plumed_error));
+        /* this is if malloc fails */
+        if(!error->nested) {
+          plumed_error_set_bad_alloc(error);
+          break;
+        }
+        plumed_error_init((plumed_error*)error->nested);
+        /* plumed will make sure to only use this if it is not null */
+        *(void**)*(options+1)=error->nested;
+        break;
+      }
       options+=2;
     }
+  }
 }
 
 /** \relates plumed
     \brief Constructor
 
     Constructs a plumed object.
 
@@ -1470,22 +1649,20 @@
 
 #if defined( __cplusplus) && __PLUMED_WRAPPER_CXX /*{*/
 
 #if __PLUMED_WRAPPER_CXX_STD
 #include <cstdlib> /* NULL getenv */
 #include <cstddef> /* nullptr_t */
 #include <cstring> /* strncat strlen */
-#include <cstdio> /* fprintf */
 #include <cassert> /* assert */
 #include <climits> /* CHAR_MIN */
 #else
 #include <stddef.h>
 #include <stdlib.h>
 #include <string.h>
-#include <stdio.h>
 #include <assert.h>
 #include <limits.h>
 #endif
 
 #include <exception> /* exception bad_exception */
 #include <stdexcept> /* runtime_error logic_error invalid_argument domain_error length_error out_of_range range_error overflow_error underflow_error */
 #include <string> /* string */
@@ -1534,174 +1711,213 @@
 
 class Plumed {
   /**
     C structure.
   */
   plumed main;
 
-  /**
-    Error handler used to rethrow exceptions.
-  */
-
-  struct NothrowHandler {
-    /** code used for translating messages */
-    int code;
-    /** short message buffer for non-throwing exceptions */
-    char exception_buffer[__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER];
-    /** if exception_buffer='\0', message stored as an allocatable string */
-    ::std::string what;
-    /** error code for system_error */
-    int error_code;
-  };
-
-  /**
-    Callback function that sets the error handler.
-
-    opt argument is interpreted as the pointer to a null terminated array of void*.
-    The number of non-null element is expected to be even, and there should be a null element
-    that follows. Every pair of pointers should point
-    to a char, identifying the type of argument passed, and an arbitrary object.
-    Currently used to (optionally) pass error_code.
-  */
-  static void nothrow_handler(void*ptr,int code,const char*what,const void* opt) __PLUMED_WRAPPER_CXX_NOEXCEPT {
-    NothrowHandler* h=static_cast<NothrowHandler*>(ptr);
-    h->code=code;
-    h->exception_buffer[0]='\0';
-    h->what.clear();
-    h->error_code=0;
-    /*
-       These codes correspond to exceptions that should not allocate a separate buffer but use the fixed one.
-       Notice that a mismatch between the exceptions using the stack buffer here and those implementing
-       the stack buffer would be in practice harmless. However, it makes sense to be consistent.
-    */
-    if(code==10000 || (code>=11000 && code<12000)) {
-      __PLUMED_WRAPPER_STD strncat(h->exception_buffer,what,__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1);
-    } else {
-      try {
-        h->what=what; // could throw
-      } catch(...) {
-        __PLUMED_WRAPPER_STD strncat(h->exception_buffer,"cannot allocate error object",__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1);
-        h->code=11400; // bad_alloc
-      }
-    }
-
-    /* interpret optional arguments */
-    const void*const* options=(const void*const*)opt;
-    if(options) while(*options) {
-        if(*((const char*)*options)=='c') h->error_code=*((const int*)*(options+1));
-        options+=2;
-      }
-
-    if(PlumedGetenvExceptionsDebug()) {
-      __PLUMED_WRAPPER_STD fprintf(stderr,"+++ PLUMED_EXCEPTIONS_DEBUG\n");
-      __PLUMED_WRAPPER_STD fprintf(stderr,"+++ code: %d error_code: %d message:\n%s\n",h->code,h->error_code,what);
-      if(__PLUMED_WRAPPER_STD strlen(what) > __PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1) __PLUMED_WRAPPER_STD fprintf(stderr,"+++ WARNING: message will be truncated\n");
-      __PLUMED_WRAPPER_STD fprintf(stderr,"+++ END PLUMED_EXCEPTIONS_DEBUG\n");
-    }
-
-  }
+private:
 
   /**
-    Rethrow the exception based on the information saved in the NothrowHandler.
-  */
+    This is an internal utility to dispatch exceptions based on the plumed_error object.
 
-  __PLUMED_WRAPPER_CXX_NORETURN static void rethrow(const NothrowHandler&h) {
-    /* The interpretation of the codes should be kept in sync with core/PlumedMainInitializer.cpp */
-    /* check if we are using a full string or a fixes size buffer */
-    const char* msg=(h.exception_buffer[0]?h.exception_buffer:h.what.c_str());
-    if(h.code==1) throw Plumed::Invalid(msg);
+    It takes information about the exception to be thrown by the passed h object
+    and use it to call function f() on the resulting exception. Notice that:
+    - this function does not consider if the error is nested.
+    - f should be a callable object, so that it can store information
+    - f operator() should be a template function so as to act based on the
+      type of its argument
+
+    New exceptions added here should be kept in sync with core/PlumedMainInitializer.cpp
+
+    Notice that this function also finalizes in place plumed_error h, so as to avoid
+    memory leaks.
+  */
+  template<typename F>
+  __PLUMED_WRAPPER_CXX_NORETURN static void exception_dispatch(plumed_error&h,F f) {
+    /* this is required to make sure h is finalized when leaving this function */
+    finalize_plumed_error finalize(h);
+    /* grab the message */
+    const char* msg=plumed_error_what(h);
+    if(h.code==1) f(Plumed::Invalid(msg));
     /* logic errors */
     if(h.code>=10100 && h.code<10200) {
-      if(h.code>=10105 && h.code<10110) throw ::std::invalid_argument(msg);
-      if(h.code>=10110 && h.code<10115) throw ::std::domain_error(msg);
-      if(h.code>=10115 && h.code<10120) throw ::std::length_error(msg);
-      if(h.code>=10120 && h.code<10125) throw ::std::out_of_range(msg);
-      throw ::std::logic_error(msg);
+      if(h.code>=10105 && h.code<10110) f(::std::invalid_argument(msg));
+      if(h.code>=10110 && h.code<10115) f(::std::domain_error(msg));
+      if(h.code>=10115 && h.code<10120) f(::std::length_error(msg));
+      if(h.code>=10120 && h.code<10125) f(::std::out_of_range(msg));
+      f(::std::logic_error(msg));
     }
     /* runtime errors */
     if(h.code>=10200 && h.code<10300) {
-      if(h.code>=10205 && h.code<10210) throw ::std::range_error(msg);
-      if(h.code>=10210 && h.code<10215) throw ::std::overflow_error(msg);
-      if(h.code>=10215 && h.code<10220) throw ::std::underflow_error(msg);
+      if(h.code>=10205 && h.code<10210) f(::std::range_error(msg));
+      if(h.code>=10210 && h.code<10215) f(::std::overflow_error(msg));
+      if(h.code>=10215 && h.code<10220) f(::std::underflow_error(msg));
 #if __cplusplus > 199711L && __PLUMED_WRAPPER_LIBCXX11
-      if(h.code==10220) throw ::std::system_error(h.error_code,::std::generic_category(),msg);
-      if(h.code==10221) throw ::std::system_error(h.error_code,::std::system_category(),msg);
-      if(h.code==10222) throw ::std::system_error(h.error_code,::std::iostream_category(),msg);
-      if(h.code==10223) throw ::std::system_error(h.error_code,::std::future_category(),msg);
+      if(h.code==10220) f(::std::system_error(h.error_code,::std::generic_category(),msg));
+      if(h.code==10221) f(::std::system_error(h.error_code,::std::system_category(),msg));
+      if(h.code==10222) f(::std::system_error(h.error_code,::std::iostream_category(),msg));
+      if(h.code==10223) f(::std::system_error(h.error_code,::std::future_category(),msg));
 #endif
       if(h.code>=10230 && h.code<10240) {
 #if __cplusplus > 199711L && __PLUMED_WRAPPER_LIBCXX11
 // These cases are probably useless as it looks like this should always be std::iostream_category
-        if(h.code==10230) throw ::std::ios_base::failure(msg,::std::error_code(h.error_code,::std::generic_category()));
-        if(h.code==10231) throw ::std::ios_base::failure(msg,::std::error_code(h.error_code,::std::system_category()));
-        if(h.code==10232) throw ::std::ios_base::failure(msg,::std::error_code(h.error_code,::std::iostream_category()));
-        if(h.code==10233) throw ::std::ios_base::failure(msg,::std::error_code(h.error_code,::std::future_category()));
+        if(h.code==10230) f(::std::ios_base::failure(msg,::std::error_code(h.error_code,::std::generic_category())));
+        if(h.code==10231) f(::std::ios_base::failure(msg,::std::error_code(h.error_code,::std::system_category())));
+        if(h.code==10232) f(::std::ios_base::failure(msg,::std::error_code(h.error_code,::std::iostream_category())));
+        if(h.code==10233) f(::std::ios_base::failure(msg,::std::error_code(h.error_code,::std::future_category())));
 #endif
-        throw ::std::ios_base::failure(msg);
+        f(::std::ios_base::failure(msg));
       }
-      throw ::std::runtime_error(msg);
+      f(::std::runtime_error(msg));
     }
     /* "bad" errors */
-    if(h.code>=11000 && h.code<11100) throw Plumed::std_bad_typeid(msg);
-    if(h.code>=11100 && h.code<11200) throw Plumed::std_bad_cast(msg);
+    /* "< ::" space required in C++ < 11 */
+    if(h.code>=11000 && h.code<11100) f(add_buffer_to< ::std::bad_typeid>(msg));
+    if(h.code>=11100 && h.code<11200) f(add_buffer_to< ::std::bad_cast>(msg));
 #if __cplusplus > 199711L && __PLUMED_WRAPPER_LIBCXX11
-    if(h.code>=11200 && h.code<11300) throw Plumed::std_bad_weak_ptr(msg);
-    if(h.code>=11300 && h.code<11400) throw Plumed::std_bad_function_call(msg);
+    if(h.code>=11200 && h.code<11300) f(add_buffer_to< ::std::bad_weak_ptr>(msg));
+    if(h.code>=11300 && h.code<11400) f(add_buffer_to< ::std::bad_function_call>(msg));
 #endif
     if(h.code>=11400 && h.code<11500) {
 #if __cplusplus > 199711L && __PLUMED_WRAPPER_LIBCXX11
-      if(h.code>=11410 && h.code<11420) throw Plumed::std_bad_array_new_length(msg);
+      if(h.code>=11410 && h.code<11420) f(add_buffer_to< ::std::bad_array_new_length>(msg));
 #endif
-      throw Plumed::std_bad_alloc(msg);
+      f(add_buffer_to< ::std::bad_alloc>(msg));
     }
-    if(h.code>=11500 && h.code<11600) throw Plumed::std_bad_exception(msg);
+    if(h.code>=11500 && h.code<11600) f(add_buffer_to< ::std::bad_exception>(msg));
     /* lepton error */
-    if(h.code>=19900 && h.code<20000) throw Plumed::LeptonException(msg);
+    if(h.code>=19900 && h.code<20000) f(Plumed::LeptonException(msg));
     /* plumed exceptions */
     if(h.code>=20000 && h.code<30000) {
       /* debug - only raised with debug options */
-      if(h.code>=20100 && h.code<20200) throw Plumed::ExceptionDebug(msg);
+      if(h.code>=20100 && h.code<20200) f(Plumed::ExceptionDebug(msg));
       /* error - runtime check */
-      if(h.code>=20200 && h.code<20300) throw Plumed::ExceptionError(msg);
+      if(h.code>=20200 && h.code<20300) f(Plumed::ExceptionError(msg));
       /* error - type error */
-      if(h.code>=20300 && h.code<20400) throw Plumed::ExceptionTypeError(msg);
-      throw Plumed::Exception(msg);
+      if(h.code>=20300 && h.code<20400) f(Plumed::ExceptionTypeError(msg));
+      f(Plumed::Exception(msg));
     }
     /* fallback for any other exception */
-    throw Plumed::std_exception(msg);
+    f(add_buffer_to< ::std::exception>(msg));
   }
 
+#if __cplusplus > 199711L && __PLUMED_WRAPPER_CXX_ENABLE_NESTED_EXCEPTIONS
+  /** Internal class used by exception_dispatch. */
+  class rethrow_nested {
+  public:
+    template<typename E>
+    __PLUMED_WRAPPER_CXX_NORETURN void operator()(const E&e) {
+      std::throw_with_nested(e);
+    }
+  };
+#endif
+
+  /** Internal class used by exception_dispatch. */
+  class rethrow_not_nested {
+  public:
+    template<typename E>
+    __PLUMED_WRAPPER_CXX_NORETURN void operator()(const E&e) {
+      throw e;
+    }
+  };
+
+  /** Internal class to simplify plumed_error finalization */
+  class finalize_plumed_error {
+    plumed_error&e;
+    finalize_plumed_error(const finalize_plumed_error&); //not implemented
+  public:
+    __PLUMED_WRAPPER_CXX_EXPLICIT finalize_plumed_error(plumed_error&e):
+      e(e)
+    {}
+    ~finalize_plumed_error() {
+      plumed_error_finalize(e);
+      e.code=0; // make sure it's not finalized again
+    }
+  };
+
+  /**
+    Recursive function that rethrows an exception with all the nested ones.
+
+    In order to do so, we start throwing from the first exception that was originally thrown
+    and recursively throw the others using throw_with_nested.
+
+    plumed_error h is finalized at exit by the exception_dispatch function, to avoid memory leaks
+  */
+  __PLUMED_WRAPPER_CXX_NORETURN static void rethrow(plumed_error&h) {
+#if __cplusplus > 199711L && __PLUMED_WRAPPER_CXX_ENABLE_NESTED_EXCEPTIONS
+    /*
+      When using C++11 nested exceptions, we need to rethrow recursively
+    */
+    try {
+      if(h.nested) rethrow(*h.nested); /* recursive throw */
+    } catch(...) {
+      exception_dispatch(h,rethrow_nested());
+    }
+    exception_dispatch(h,rethrow_not_nested());
+#else
+    /*
+      When using C++<11 exceptions, we merge the message and then throw the resulting exception
+    */
+    if(h.nested) plumed_error_merge_with_nested(&h);
+    exception_dispatch(h,rethrow_not_nested());
+#endif
+  }
+
+public:
+  /**
+    This is a tool to rethrow an error as an exception and finalize the error.
+
+    In practice, this makes it possible to write a code like this:
+    ```
+    Plumed p;
+    plumed_error e;
+    // store error in e if something wrong happes
+    // notice that Plumed (C++) is implicitly converted to plumed (C) when calling plumed_cmd
+    plumed_cmd(p,"init",&e);
+    // do other things here
+    // then throw the exception
+    if(e.code) plumed_error_rethrow(e);
+
+    It should be used through the macro plumed_error_rethrow.
+    ```
+  */
+  __PLUMED_WRAPPER_CXX_NORETURN static void plumed_error_rethrow_cxx(plumed_error h) {
+    rethrow(h);
+  }
+
+private:
   /**
     Rethrow the current exception.
 
     This is useful in order to handle an exception thrown by a kernel <=2.4.
     Only std exceptions are handled, though some of them are thrown as special
     Plumed exceptions in order to be attached a message.
   */
   __PLUMED_WRAPPER_CXX_NORETURN static void rethrow() {
     try {
       throw;
     } catch(const ::std::bad_exception & e) {
-      throw Plumed::std_bad_exception(e.what());
+      throw add_buffer_to< ::std::bad_exception>(e.what());
 #if __cplusplus > 199711L && __PLUMED_WRAPPER_LIBCXX11
     } catch(const ::std::bad_array_new_length & e) {
-      throw Plumed::std_bad_array_new_length(e.what());
+      throw add_buffer_to< ::std::bad_array_new_length>(e.what());
 #endif
     } catch(const ::std::bad_alloc & e) {
-      throw Plumed::std_bad_alloc(e.what());
+      throw add_buffer_to< ::std::bad_alloc>(e.what());
 #if __cplusplus > 199711L && __PLUMED_WRAPPER_LIBCXX11
     } catch(const ::std::bad_function_call & e) {
-      throw Plumed::std_bad_function_call(e.what());
+      throw add_buffer_to< ::std::bad_function_call>(e.what());
     } catch(const ::std::bad_weak_ptr & e) {
-      throw Plumed::std_bad_weak_ptr(e.what());
+      throw add_buffer_to< ::std::bad_weak_ptr>(e.what());
 #endif
     } catch(const ::std::bad_cast & e) {
-      throw Plumed::std_bad_cast(e.what());
+      throw add_buffer_to< ::std::bad_cast>(e.what());
     } catch(const ::std::bad_typeid & e) {
-      throw Plumed::std_bad_typeid(e.what());
+      throw add_buffer_to< ::std::bad_typeid>(e.what());
       // not implemented yet: std::regex_error
       // we do not allow regex yet due to portability problems with gcc 4.8
       // as soon as we transition to using <regex> it should be straightforward to add
     } catch(const ::std::ios_base::failure & e) {
 #if __cplusplus > 199711L && __PLUMED_WRAPPER_LIBCXX11
       throw ::std::ios_base::failure(e.what(),e.code());
 #else
@@ -1728,69 +1944,78 @@
     } catch(const ::std::domain_error & e) {
       throw ::std::domain_error(e.what());
     } catch(const ::std::invalid_argument & e) {
       throw ::std::invalid_argument(e.what());
     } catch(const ::std::logic_error & e) {
       throw ::std::logic_error(e.what());
     } catch(const ::std::exception & e) {
-      throw Plumed::std_exception(e.what());
+      throw add_buffer_to< ::std::exception>(e.what());
     } catch(...) {
-      throw Plumed::std_bad_exception("plumed could not translate exception");
+      throw add_buffer_to< ::std::bad_exception>("plumed could not translate exception");
     }
   }
 
 public:
 
+#if __PLUMED_WRAPPER_CXX_ANONYMOUS_NAMESPACE_PLMD_EXCEPTIONS
+  using Exception = PLMD::Exception;
+#else
   /**
     Base class used to rethrow PLUMED exceptions.
   */
-
   class Exception :
     public ::std::exception
   {
     ::std::string msg;
   public:
     __PLUMED_WRAPPER_CXX_EXPLICIT Exception(const char* msg): msg(msg) {}
     const char* what() const __PLUMED_WRAPPER_CXX_NOEXCEPT __PLUMED_WRAPPER_CXX_OVERRIDE {return msg.c_str();}
 #if ! (__cplusplus > 199711L)
     /* Destructor should be declared in order to have the correct throw() before C++11 */
     /* see https://stackoverflow.com/questions/50025862/why-is-the-stdexception-destructor-not-noexcept */
     ~Exception() throw() {}
 #endif
   };
+#endif
 
+#if __PLUMED_WRAPPER_CXX_ANONYMOUS_NAMESPACE_PLMD_EXCEPTIONS
+  using ExceptionError = PLMD::ExceptionError;
+#else
   /**
     Used to rethrow a PLMD::ExceptionError
   */
-
   class ExceptionError :
     public Exception {
   public:
     __PLUMED_WRAPPER_CXX_EXPLICIT ExceptionError(const char* msg): Exception(msg) {}
 #if ! (__cplusplus > 199711L)
     /* Destructor should be declared in order to have the correct throw() before C++11 */
     /* see https://stackoverflow.com/questions/50025862/why-is-the-stdexception-destructor-not-noexcept */
     ~ExceptionError() throw() {}
 #endif
   };
+#endif
 
+#if __PLUMED_WRAPPER_CXX_ANONYMOUS_NAMESPACE_PLMD_EXCEPTIONS
+  using ExceptionDebug = PLMD::ExceptionDebug;
+#else
   /**
     Used to rethrow a PLMD::ExceptionDebug
   */
-
   class ExceptionDebug :
     public Exception {
   public:
     __PLUMED_WRAPPER_CXX_EXPLICIT ExceptionDebug(const char* msg): Exception(msg) {}
 #if ! (__cplusplus > 199711L)
     /* Destructor should be declared in order to have the correct throw() before C++11 */
     /* see https://stackoverflow.com/questions/50025862/why-is-the-stdexception-destructor-not-noexcept */
     ~ExceptionDebug() throw() {}
 #endif
   };
+#endif
 
   /**
     Thrown when trying to access an invalid plumed object
   */
 
   class Invalid :
     public Exception {
@@ -1799,28 +2024,35 @@
 #if ! (__cplusplus > 199711L)
     /* Destructor should be declared in order to have the correct throw() before C++11 */
     /* see https://stackoverflow.com/questions/50025862/why-is-the-stdexception-destructor-not-noexcept */
     ~Invalid() throw() {}
 #endif
   };
 
+#if __PLUMED_WRAPPER_CXX_ANONYMOUS_NAMESPACE_PLMD_EXCEPTIONS
+  using ExceptionTypeError = PLMD::ExceptionTypeError;
+#else
   /**
     Thrown when a wrong pointer is passed to the PLUMED interface.
   */
   class ExceptionTypeError:
     public Exception {
   public:
     __PLUMED_WRAPPER_CXX_EXPLICIT ExceptionTypeError(const char* msg): Exception(msg) {}
 #if ! (__cplusplus > 199711L)
     /* Destructor should be declared in order to have the correct throw() before C++11 */
     /* see https://stackoverflow.com/questions/50025862/why-is-the-stdexception-destructor-not-noexcept */
     ~ExceptionTypeError() throw() {}
 #endif
   };
+#endif
 
+#if __PLUMED_WRAPPER_CXX_ANONYMOUS_NAMESPACE_PLMD_EXCEPTIONS
+  using LeptonException = PLMD::lepton::Exception;
+#else
   /**
     Class used to rethrow Lepton exceptions.
   */
 
   class LeptonException :
     public ::std::exception
   {
@@ -1830,85 +2062,84 @@
     const char* what() const __PLUMED_WRAPPER_CXX_NOEXCEPT __PLUMED_WRAPPER_CXX_OVERRIDE {return msg.c_str();}
 #if ! (__cplusplus > 199711L)
     /* Destructor should be declared in order to have the correct throw() before C++11 */
     /* see https://stackoverflow.com/questions/50025862/why-is-the-stdexception-destructor-not-noexcept */
     ~LeptonException() throw() {}
 #endif
   };
+#endif
 
 private:
   /*
     These exceptions are declared as private as they are not supposed to be
     catched by value. they only exist to allow a buffer to be attached to
     the std::exceptions that do not contain it already.
     Notice that these exceptions are those whose constructor should never throw, and as
     such they use a fixed size buffer.
   */
 
-#define __PLUMED_WRAPPER_NOSTRING_EXCEPTION(name) \
-  class std_ ## name : \
-    public ::std::name \
-  { \
+  template<typename T>
+  class add_buffer_to:
+    public T
+  {
     char msg[__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER]; \
-  public: \
-    __PLUMED_WRAPPER_CXX_EXPLICIT std_ ## name(const char * msg) __PLUMED_WRAPPER_CXX_NOEXCEPT { \
-      this->msg[0]='\0'; \
-      __PLUMED_WRAPPER_STD strncat(this->msg,msg,__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1); \
-      if(PlumedGetenvExceptionsDebug() && __PLUMED_WRAPPER_STD strlen(msg) > __PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1) __PLUMED_WRAPPER_STD fprintf(stderr,"+++ WARNING: message will be truncated\n"); \
-    } \
-    std_ ## name(const std_ ## name & other) __PLUMED_WRAPPER_CXX_NOEXCEPT { \
-      msg[0]='\0'; \
-      __PLUMED_WRAPPER_STD strncat(msg,other.msg,__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1); \
-    } \
-    std_ ## name & operator=(const std_ ## name & other) __PLUMED_WRAPPER_CXX_NOEXCEPT { \
-      if(this==&other) return *this;\
-      msg[0]='\0'; \
-      __PLUMED_WRAPPER_STD strncat(msg,other.msg,__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1); \
-      return *this; \
-    } \
-    const char* what() const __PLUMED_WRAPPER_CXX_NOEXCEPT __PLUMED_WRAPPER_CXX_OVERRIDE {return msg;} \
-    ~std_ ## name() __PLUMED_WRAPPER_CXX_NOEXCEPT __PLUMED_WRAPPER_CXX_OVERRIDE {} \
-  };
-
-  __PLUMED_WRAPPER_NOSTRING_EXCEPTION(bad_typeid)
-  __PLUMED_WRAPPER_NOSTRING_EXCEPTION(bad_cast)
-#if __cplusplus > 199711L && __PLUMED_WRAPPER_LIBCXX11
-  __PLUMED_WRAPPER_NOSTRING_EXCEPTION(bad_weak_ptr)
-  __PLUMED_WRAPPER_NOSTRING_EXCEPTION(bad_function_call)
-#endif
-  __PLUMED_WRAPPER_NOSTRING_EXCEPTION(bad_alloc)
-#if __cplusplus > 199711L && __PLUMED_WRAPPER_LIBCXX11
-  __PLUMED_WRAPPER_NOSTRING_EXCEPTION(bad_array_new_length)
+  public:
+    __PLUMED_WRAPPER_CXX_EXPLICIT add_buffer_to(const char * msg) __PLUMED_WRAPPER_CXX_NOEXCEPT {
+      this->msg[0]='\0';
+      __PLUMED_WRAPPER_STD strncat(this->msg,msg,__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1);
+      this->msg[__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1]='\0';
+      if(PlumedGetenvExceptionsDebug() && __PLUMED_WRAPPER_STD strlen(msg) > __PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER-1) __PLUMED_WRAPPER_STD fprintf(stderr,"+++ WARNING: message will be truncated\n");
+    }
+    add_buffer_to(const add_buffer_to & other) __PLUMED_WRAPPER_CXX_NOEXCEPT {
+      msg[0]='\0';
+      __PLUMED_WRAPPER_STD memcpy(msg,other.msg,__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER);
+    }
+    add_buffer_to & operator=(const add_buffer_to & other) __PLUMED_WRAPPER_CXX_NOEXCEPT {
+      if(this==&other) return *this;
+      msg[0]='\0';
+      __PLUMED_WRAPPER_STD memcpy(msg,other.msg,__PLUMED_WRAPPER_CXX_EXCEPTION_BUFFER);
+      return *this;
+    }
+    const char* what() const __PLUMED_WRAPPER_CXX_NOEXCEPT __PLUMED_WRAPPER_CXX_OVERRIDE {return msg;}
+#if ! (__cplusplus > 199711L)
+    /* Destructor should be declared in order to have the correct throw() before C++11 */
+    /* see https://stackoverflow.com/questions/50025862/why-is-the-stdexception-destructor-not-noexcept */
+    ~add_buffer_to() throw() {}
 #endif
-  __PLUMED_WRAPPER_NOSTRING_EXCEPTION(bad_exception)
-  __PLUMED_WRAPPER_NOSTRING_EXCEPTION(exception)
+  };
 
 private:
   /// Small class that wraps plumed_safeptr in order to make its initialization easier
   class SafePtr {
     /// non copyable (copy would require managing buffer, could be added in the future if needed)
     SafePtr(const SafePtr&);
     /// non assignable (assignment would require managing buffer, could be added in the future if needed)
     SafePtr& operator=(SafePtr const&);
   public:
     plumed_safeptr safe;
     /// This buffer holds a copy of the data when they are passed by value.
     /// The size is sufficient to hold any primitive type.
+    /// Notice that the buffer is required to enable conversions (e.g., passing a class that can be converted to int)
+    /// and, at the same time, allow the object to exist after SafePtr constructor has completed.
+    /// A perhaps cleaner implementation would require a base class containing
+    /// the plumed_safeptr object, derived classes depending on the
+    /// argument type as a template parameter, and overloaded functions
+    /// returning this derived class.
     char buffer[32];
     /// Default constructor, nullptr
     SafePtr() __PLUMED_WRAPPER_CXX_NOEXCEPT {
       safe.ptr=__PLUMED_WRAPPER_CXX_NULLPTR;
       safe.nelem=0;
       safe.shape=__PLUMED_WRAPPER_CXX_NULLPTR;
       safe.flags=0x10000*2;
       safe.opt=__PLUMED_WRAPPER_CXX_NULLPTR;
       buffer[0]='\0';
     }
 
-    SafePtr(const plumed_safeptr & safe,__PLUMED_WRAPPER_STD size_t nelem=0, const __PLUMED_WRAPPER_STD size_t* shape=__PLUMED_WRAPPER_CXX_NULLPTR) __PLUMED_WRAPPER_CXX_NOEXCEPT {
+    __PLUMED_WRAPPER_CXX_EXPLICIT SafePtr(const plumed_safeptr & safe,__PLUMED_WRAPPER_STD size_t nelem=0, const __PLUMED_WRAPPER_STD size_t* shape=__PLUMED_WRAPPER_CXX_NULLPTR) __PLUMED_WRAPPER_CXX_NOEXCEPT {
       this->safe=safe;
       buffer[0]='\0';
       if(nelem>0) this->safe.nelem=nelem;
       if(shape) this->safe.shape=const_cast<__PLUMED_WRAPPER_STD size_t*>(shape);
     }
 
 #if __cplusplus > 199711L
@@ -2212,15 +2443,15 @@
   /** Assignment operator. Available as of PLUMED 2.5.
 
     Takes a reference,incrementing the reference counter of the corresponding object.
   */
   Plumed&operator=(const Plumed&p) __PLUMED_WRAPPER_CXX_NOEXCEPT {
     if(this != &p) {
 // the check is needed to avoid calling plumed_finalize on moved objects
-      if(main.p) decref();
+      if(main.p) plumed_finalize(main);
       main=plumed_create_reference(p.main);
     }
     return *this;
   }
 
   /*
     PLUMED >= 2.4 requires a C++11 compiler.
@@ -2239,15 +2470,15 @@
   }
   /** Move assignment. Available as of PLUMED 2.5.
     Only if move semantics is enabled.
   */
   Plumed& operator=(Plumed&&p)__PLUMED_WRAPPER_CXX_NOEXCEPT  {
     if(this != &p) {
 // the check is needed to avoid calling plumed_finalize on moved objects
-      if(main.p) decref();
+      if(main.p) plumed_finalize(main);
       main=p.main;
       p.main.p=nullptr;
     }
     return *this;
   }
 #endif
   /**
@@ -2264,36 +2495,42 @@
     or, equivalently, as
   \verbatim
     auto p = PLMD::Plumed::dlopen("/path/to/libplumedKernel.so");
     p.cmd("init");
   \endverbatim
   */
   static Plumed dlopen(const char* path)__PLUMED_WRAPPER_CXX_NOEXCEPT  {
-// use decref to remove the extra reference
-    return Plumed(plumed_create_dlopen(path)).decref();
+    plumed p=plumed_create_dlopen(path);
+    Plumed pp(p);
+    plumed_finalize(p);
+    return pp;
   }
 
   /**
     Create a PLUMED object loading a specific kernel. Available as of PLUMED 2.5.
 
     Same as \ref dlopen(const char* path), but allows a dlopen mode to be chosen explicitly.
   */
   static Plumed dlopen(const char* path,int mode)__PLUMED_WRAPPER_CXX_NOEXCEPT  {
-// use decref to remove the extra reference
-    return Plumed(plumed_create_dlopen2(path,mode)).decref();
+    plumed p=plumed_create_dlopen2(path,mode);
+    Plumed pp(p);
+    plumed_finalize(p);
+    return pp;
   }
   /**
     Create a PLUMED object loading from an already opened shared library. Available as of PLUMED 2.8.
 
     Same as \ref dlopen(const char* path), but searches functions in an already loaded library.
     See \ref plumed_create_dlsym.
   */
   static Plumed dlsym(void* dlhandle)__PLUMED_WRAPPER_CXX_NOEXCEPT  {
-// use decref to remove the extra reference
-    return Plumed(plumed_create_dlsym(dlhandle)).decref();
+    plumed p=plumed_create_dlsym(dlhandle);
+    Plumed pp(p);
+    plumed_finalize(p);
+    return pp;
   }
 
   /** Invalid constructor. Available as of PLUMED 2.5.
 
     Can be used to initialize an invalid object. It might be useful to postpone
     the initialization of a Plumed object. Consider the following case
   \verbatim
@@ -2316,28 +2553,32 @@
     Plumed p(Plumed::makeInvalid());
     setenv("PLUMED_KERNEL","/path/to/kernel/libplumedKernel.so",1);
     p=Plumed();
     p.cmd("init")
   \endverbatim
   */
   static Plumed makeInvalid() __PLUMED_WRAPPER_CXX_NOEXCEPT  {
-// use decref to remove the extra reference
-    return Plumed(plumed_create_invalid()).decref();
+    plumed p=plumed_create_invalid();
+    Plumed pp(p);
+    plumed_finalize(p);
+    return pp;
   }
 
   /**
     Create a valid PLMD::Plumed object.
 
     Can be used to create a valid object e.g. when Plumed.h was compiled with
     `-D__PLUMED_WRAPPER_CXX_DEFAULT_INVALID`. For internal usage.
   */
 
   static Plumed makeValid()__PLUMED_WRAPPER_CXX_NOEXCEPT  {
-// use decref to remove the extra reference
-    return Plumed(plumed_create()).decref();
+    plumed p=plumed_create();
+    Plumed pp(p);
+    plumed_finalize(p);
+    return pp;
   }
 
 
   /**
      Retrieve the C plumed structure for this object.
 
      Notice that the resulting plumed structure is a weak reference and
@@ -2414,40 +2655,44 @@
 
 private:
 
   /**
     Private version of cmd. It is used here to avoid duplication of code between typesafe and not-typesafe versions
   */
   static void cmd_priv(plumed main,const char*key, SafePtr*safe=__PLUMED_WRAPPER_CXX_NULLPTR, const void* unsafe=__PLUMED_WRAPPER_CXX_NULLPTR,plumed_error*error=__PLUMED_WRAPPER_CXX_NULLPTR) {
-    NothrowHandler h;
+
+    plumed_error error_cxx;
+    plumed_error_init(&error_cxx);
+
     plumed_nothrow_handler nothrow;
     if(error) {
       plumed_error_init(error);
       nothrow.ptr=error;
-      nothrow.handler=plumed_error_set;
     } else {
-      h.code=0;
-      nothrow.ptr=&h;
-      nothrow.handler=nothrow_handler;
+      nothrow.ptr=&error_cxx;
     }
+    nothrow.handler=plumed_error_set;
+
     try {
       if(safe) {
         plumed_cmd_safe_nothrow(main,key,safe->get_safeptr(),nothrow);
       } else {
         plumed_cmd_nothrow(main,key,unsafe,nothrow);
       }
     } catch (...) {
+      assert(error_cxx.code==0); /* no need to plumed_error_finalize here */
       /*
         When loading a kernel <=2.4, plumed_cmd_nothrow could throw an exception.
         If the exception is transmitted through the C interface and arrives here,
         we translate it so as to free the virtual tables of the loaded kernel.
       */
       rethrow();
     }
-    if(!error && h.code!=0) rethrow(h);
+    /* plumed_error_rethrow is finalizing */
+    if(!error && error_cxx.code!=0) plumed_error_rethrow_cxx(error_cxx);
   }
 
 public:
 
   /**
      Send a command to this plumed object
       \param key The name of the command to be executed
@@ -2540,15 +2785,15 @@
      Destructor is virtual so as to allow correct inheritance from Plumed object.
   */
 #if __PLUMED_WRAPPER_CXX_POLYMORPHIC
   virtual
 #endif
   ~Plumed() __PLUMED_WRAPPER_CXX_NOEXCEPT {
 // the check is needed to avoid calling plumed_finalize on moved objects
-    if(main.p) decref();
+    if(main.p) plumed_finalize(main);
   }
 
   /**
     These functions can be used to make plumed_cmd behave as the C++ wrapper PLMD::Plumed::cmd,
     namely implement typechecks and rethrowing exception.
     To be used through the macro plumed_cmd (defined when __PLUMED_WRAPPER_CXX_BIND_C==1).
     They are also used by the Plumed::cmd functions to avoid code duplication.
@@ -2694,14 +2939,16 @@
 
 #define __PLUMED_WRAPPER_REDEFINE_CMD ::PLMD::Plumed::plumed_cmd_cxx
 
 #if __PLUMED_WRAPPER_GLOBAL /*{*/
 #define __PLUMED_WRAPPER_REDEFINE_GCMD ::PLMD::Plumed::plumed_gcmd_cxx
 #endif /*}*/
 
+#define __PLUMED_WRAPPER_REDEFINE_ERROR_RETHROW ::PLMD::Plumed::plumed_error_rethrow_cxx
+
 #endif /*}*/
 
 };
 
 /**
   \related Plumed
   Comparison operator. Available as of PLUMED 2.5.
@@ -2860,15 +3107,15 @@
 #include <dlfcn.h> /* dlopen dlerror dlsym */
 #endif
 
 #if __PLUMED_WRAPPER_CXX_STD
 #include <cstdio>  /* fprintf */
 #include <cstring> /* memcpy strlen strncpy memcmp memmove strcmp memcpy */
 #include <cassert> /* assert */
-#include <cstdlib> /* getenv malloc free abort exit */
+#include <cstdlib> /* getenv malloc free abort */
 #include <climits> /* CHAR_BIT */
 #else
 #include <stdio.h>
 #include <string.h>
 #include <assert.h>
 #include <stdlib.h>
 #include <limits.h>
@@ -2915,14 +3162,19 @@
   So, it looks like this is the only possibility.
 
   version=3, cmd_safe and cmd_safe_nothrow
 
   These are functions that accept a plumed_safeptr object, which can carry information about the passed type and size.
   Since new information should be passed at every cmd call, this can only be obtained by adding new cmd calls.
 
+  version=4, thread-safe reference counter
+
+  These functions allow to access a thread-safe reference counter that is stored within the PlumedMain object.
+  This allows avoiding to enable atomic access also the C compiler used build Plumed.c. It's added here and not as a new
+  cmd since this is a very low-level functionality.
 */
 typedef struct {
   /**
     Version number.
 
     Minimum value is 1.
   */
@@ -2949,23 +3201,39 @@
   /**
     Pointer to a cmd function guaranteed not to throw exceptions and that accepts typeinfos.
 
     Available with version>=3.
   */
   void (*cmd_safe_nothrow)(void*plumed,const char*key,plumed_safeptr,plumed_nothrow_handler);
 
+  /**
+    Pointer to a function that increments the internal reference counter.
+
+    Available with version>=4.
+  */
+  unsigned (*create_reference)(void*);
+  /**
+    Pointer to a function that decrements the internal reference counter.
+
+    Available with version>=4.
+  */
+  unsigned (*delete_reference)(void*);
+  /**
+    Pointer to a function that returns the internal reference counter.
+
+    Available with version>=4.
+  */
+  unsigned (*use_count)(void*);
 } plumed_symbol_table_type;
 
 /* Utility to convert function pointers to pointers, just for the sake of printing them */
 #define __PLUMED_CONVERT_FPTR(ptr,fptr) { ptr=__PLUMED_WRAPPER_CXX_NULLPTR; __PLUMED_WRAPPER_STD memcpy(&ptr,&fptr,(sizeof(fptr)>sizeof(ptr)?sizeof(ptr):sizeof(fptr))); }
 
 #define __PLUMED_GETENV __PLUMED_WRAPPER_STD getenv
 #define __PLUMED_FPRINTF __PLUMED_WRAPPER_STD fprintf
-#define __PLUMED_MALLOC __PLUMED_WRAPPER_STD malloc
-#define __PLUMED_FREE __PLUMED_WRAPPER_STD free
 
 /**
   Historically (PLUMED<=2.4) register for plumedmain function pointers.
   As of PLUMED>=2.5, this function does not do anything except for reporting the attempt to register
   something. It always returns NULL. The function should be here anyway to allow an incomplete
   libplumedKernel (<=2.4), expecting this function to be present, to be loaded correctly.
 */
@@ -3025,38 +3293,38 @@
       and load directly the shared library. Notice that this particular path is only expected
       to be necessary when using PLUMED<=2.4 and the symbols in the main executable are
       not visible. All the other cases (either PLUMED>=2.5 or symbols in the main executable visible)
       should work correctly without entering here.
     */
     __PLUMED_FPRINTF(stderr,"+++ An error occurred. Message from dlopen(): %s +++\n",dlerror());
     strlenpath=__PLUMED_WRAPPER_STD strlen(path);
-    pathcopy=(char*) __PLUMED_MALLOC(strlenpath+1);
+    pathcopy=(char*) plumed_malloc(strlenpath+1);
     if(!pathcopy) {
       __PLUMED_FPRINTF(stderr,"+++ Allocation error +++\n");
       __PLUMED_WRAPPER_STD abort();
     }
     __PLUMED_WRAPPER_STD strncpy(pathcopy,path,strlenpath+1);
     pc=pathcopy+strlenpath-6;
     while(pc>=pathcopy && __PLUMED_WRAPPER_STD memcmp(pc,"Kernel",6)) pc--;
     if(pc>=pathcopy) {
       __PLUMED_WRAPPER_STD memmove(pc, pc+6, __PLUMED_WRAPPER_STD strlen(pc)-5);
       __PLUMED_FPRINTF(stderr,"+++ This error is expected if you are trying to load a kernel <=2.4\n");
       __PLUMED_FPRINTF(stderr,"+++ Trying %s +++\n",pathcopy);
       fp=__PLUMED_WRAPPER_STD fopen(path,"r");
       if(!fp) {
         __PLUMED_FPRINTF(stderr,"+++ File %s does not exist or cannot be read\n",pathcopy);
-        __PLUMED_FREE(pathcopy);
+        plumed_free(pathcopy);
         return __PLUMED_WRAPPER_CXX_NULLPTR;
       }
       __PLUMED_WRAPPER_STD fclose(fp);
       dlerror();
       p=dlopen(pathcopy,mode);
       if(!p) __PLUMED_FPRINTF(stderr,"+++ An error occurred. Message from dlopen(): %s +++\n",dlerror());
     }
-    __PLUMED_FREE(pathcopy);
+    plumed_free(pathcopy);
   }
   return p;
 }
 __PLUMED_WRAPPER_INTERNALS_END
 
 /**
   Utility to search for a function.
@@ -3275,15 +3543,15 @@
   Small object used to store pointers directly into the plumed object defined in Plumed.h.
   This allows avoiding the extra function call to plumed_retrieve_functions at every cmd,
   at the cost of an extra indirection.
 */
 typedef struct {
   /* allows errors with pointers to be found when debugging */
   char magic[6];
-  /* reference count */
+  /* reference count. this is only used with PLUMED<=2.8. Later versions have an internal thread-safe reference counter. */
   int refcount;
   /* handler to dlopened library. NULL if there was no library opened */
   void* dlhandle;
   /* non zero if, upon destruction, the library should be dlclosed */
   int dlclose;
   /* 1 if path to kernel was taken from PLUMED_KERNEL var, 0 otherwise */
   int used_plumed_kernel;
@@ -3295,15 +3563,15 @@
   void* p;
 } plumed_implementation;
 
 __PLUMED_WRAPPER_INTERNALS_BEGIN
 plumed_implementation* plumed_malloc_pimpl() {
   plumed_implementation* pimpl;
   /* allocate space for implementation object. this is free-ed in plumed_finalize(). */
-  pimpl=(plumed_implementation*) __PLUMED_MALLOC(sizeof(plumed_implementation));
+  pimpl=(plumed_implementation*) plumed_malloc(sizeof(plumed_implementation));
   if(!pimpl) {
     __PLUMED_FPRINTF(stderr,"+++ Allocation error +++\n");
     __PLUMED_WRAPPER_STD abort();
   }
   __PLUMED_WRAPPER_STD memcpy(pimpl->magic,"pLuMEd",6);
   pimpl->refcount=1;
 #if __PLUMED_WRAPPER_DEBUG_REFCOUNT
@@ -3445,15 +3713,20 @@
 __PLUMED_WRAPPER_C_BEGIN
 plumed plumed_create_reference(plumed p) {
   plumed_implementation* pimpl;
   /* obtain pimpl */
   pimpl=(plumed_implementation*) p.p;
   assert(plumed_check_pimpl(pimpl));
   /* increase reference count */
-  pimpl->refcount++;
+  /* with PLUMED > 2.8, we can use an internal reference counter which is thread safe */
+  if(pimpl->p && pimpl->table && pimpl->table->version>3) {
+    pimpl->table->create_reference(pimpl->p);
+  } else {
+    pimpl->refcount++;
+  }
 #if __PLUMED_WRAPPER_DEBUG_REFCOUNT
   __PLUMED_FPRINTF(stderr,"refcount: increase at %p\n",(void*)pimpl);
 #endif
   return p;
 }
 __PLUMED_WRAPPER_C_END
 
@@ -3484,15 +3757,15 @@
   plumed_implementation* pimpl;
   /* obtain pimpl */
   pimpl=(plumed_implementation*) p.p;
   assert(plumed_check_pimpl(pimpl));
   if(!pimpl->p) {
     __PLUMED_FPRINTF(stderr,"+++ ERROR: You are trying to use an invalid plumed object. +++\n");
     if(pimpl->used_plumed_kernel) __PLUMED_FPRINTF(stderr,"+++ Check your PLUMED_KERNEL environment variable. +++\n");
-    __PLUMED_WRAPPER_STD exit(1);
+    __PLUMED_WRAPPER_STD abort();
   }
   assert(pimpl->functions.create);
   assert(pimpl->functions.cmd);
   assert(pimpl->functions.finalize);
   /* execute */
   (*(pimpl->functions.cmd))(pimpl->p,key,val);
 }
@@ -3544,15 +3817,15 @@
   plumed_implementation* pimpl;
   /* obtain pimpl */
   pimpl=(plumed_implementation*) p.p;
   assert(plumed_check_pimpl(pimpl));
   if(!pimpl->p) {
     __PLUMED_FPRINTF(stderr,"+++ ERROR: You are trying to use an invalid plumed object. +++\n");
     if(pimpl->used_plumed_kernel) __PLUMED_FPRINTF(stderr,"+++ Check your PLUMED_KERNEL environment variable. +++\n");
-    __PLUMED_WRAPPER_STD exit(1);
+    __PLUMED_WRAPPER_STD abort();
   }
   assert(pimpl->functions.create);
   assert(pimpl->functions.cmd);
   assert(pimpl->functions.finalize);
   /* execute */
   if(pimpl->table && pimpl->table->version>2) (*(pimpl->table->cmd_safe))(pimpl->p,key,safe);
   else (*(pimpl->functions.cmd))(pimpl->p,key,safe.ptr);
@@ -3562,20 +3835,23 @@
 
 __PLUMED_WRAPPER_C_BEGIN
 void plumed_finalize(plumed p) {
   plumed_implementation* pimpl;
   /* obtain pimpl */
   pimpl=(plumed_implementation*) p.p;
   assert(plumed_check_pimpl(pimpl));
-  /* decrease reference count */
-  pimpl->refcount--;
 #if __PLUMED_WRAPPER_DEBUG_REFCOUNT
   __PLUMED_FPRINTF(stderr,"refcount: decrease at %p\n",(void*)pimpl);
 #endif
-  if(pimpl->refcount>0) return;
+  /* with PLUMED > 2.8, we can use an internal reference counter which is thread safe */
+  if(pimpl->p && pimpl->table && pimpl->table->version>3) {
+    if(pimpl->table->delete_reference(pimpl->p)>0) return;
+  } else {
+    if(--pimpl->refcount>0) return;
+  }
   /* to allow finalizing an invalid plumed object, we only call
      finalize if the object is valid */
   if(pimpl->p) {
     assert(pimpl->functions.create);
     assert(pimpl->functions.cmd);
     assert(pimpl->functions.finalize);
     /* finalize */
@@ -3588,15 +3864,15 @@
     dlclose(pimpl->dlhandle);
   }
 #endif
 #if __PLUMED_WRAPPER_DEBUG_REFCOUNT
   __PLUMED_FPRINTF(stderr,"refcount: delete at %p\n",(void*)pimpl);
 #endif
   /* free pimpl space */
-  __PLUMED_FREE(pimpl);
+  plumed_free(pimpl);
 }
 __PLUMED_WRAPPER_C_END
 
 __PLUMED_WRAPPER_C_BEGIN
 int plumed_valid(plumed p) {
   plumed_implementation* pimpl;
   /* obtain pimpl */
@@ -3609,29 +3885,54 @@
 
 __PLUMED_WRAPPER_C_BEGIN
 int plumed_use_count(plumed p) {
   plumed_implementation* pimpl;
   /* obtain pimpl */
   pimpl=(plumed_implementation*) p.p;
   assert(plumed_check_pimpl(pimpl));
-  return pimpl->refcount;
+  /* with PLUMED > 2.8, we can use an internal reference counter which is thread safe */
+  if(pimpl->p && pimpl->table && pimpl->table->version>3) {
+    return pimpl->table->use_count(pimpl->p);
+  } else {
+    return pimpl->refcount;
+  }
 }
 __PLUMED_WRAPPER_C_END
 
 __PLUMED_WRAPPER_C_BEGIN
 int plumed_installed(void) {
   plumed p;
   int result;
   p=plumed_create();
   result=plumed_valid(p);
   plumed_finalize(p);
   return result;
 }
 __PLUMED_WRAPPER_C_END
 
+__PLUMED_WRAPPER_C_BEGIN
+void* plumed_malloc(__PLUMED_WRAPPER_STD size_t size) {
+  void* ptr;
+  ptr=__PLUMED_WRAPPER_STD malloc(size);
+#if __PLUMED_WRAPPER_DEBUG_REFCOUNT
+  if(ptr) fprintf(stderr,"plumed_malloc: %p\n",ptr);
+#endif
+  return ptr;
+}
+__PLUMED_WRAPPER_C_END
+
+__PLUMED_WRAPPER_C_BEGIN
+void plumed_free(void* ptr) {
+  __PLUMED_WRAPPER_STD free(ptr);
+#if __PLUMED_WRAPPER_DEBUG_REFCOUNT
+  fprintf(stderr,"plumed_free: %p\n",ptr);
+#endif
+}
+__PLUMED_WRAPPER_C_END
+
 #if __PLUMED_WRAPPER_GLOBAL /*{*/
 
 __PLUMED_WRAPPER_EXTERN_C_BEGIN
 
 /* we declare a Plumed_g_main object here, in such a way that it is always available */
 
 static plumed plumed_gmain= {__PLUMED_WRAPPER_CXX_NULLPTR};
@@ -3688,17 +3989,15 @@
 
   assert(c);
   cc=(unsigned char*)&p.p;
   for(i=0; i<sizeof(p.p); i++) {
     /*
       characters will range between '0' (ASCII 48) and 'o' (ASCII 111=48+63)
     */
-    /* cppcheck-suppress objectIndex */
     c[2*i]=cc[i]/64+48;
-    /* cppcheck-suppress objectIndex */
     c[2*i+1]=cc[i]%64+48;
   }
   for(; i<16; i++) {
     c[2*i]=' ';
     c[2*i+1]=' ';
   }
 }
@@ -3722,15 +4021,14 @@
   cc=(unsigned char*)&p.p;
   for(i=0; i<sizeof(p.p); i++) {
     assert(c[2*i]>=48 && c[2*i]<48+64);
     assert(c[2*i+1]>=48 && c[2*i+1]<48+64);
     /*
       perform the reversed transform
     */
-    /* cppcheck-suppress objectIndex */
     cc[i]=(c[2*i]-48)*64 + (c[2*i+1]-48);
   }
   for(; i<16; i++) {
     assert(c[2*i]==' ');
     assert(c[2*i+1]==' ');
   }
   return p;
@@ -3830,15 +4128,15 @@
 
 #define __PLUMED_IMPLEMENT_F_SAFEPTR_INNER(type,type_,size,code,suffix) \
 plumed_safeptr plumed_f_safeptr_ ## type_ ## suffix(void*val,__PLUMED_WRAPPER_STD size_t nelem,__PLUMED_WRAPPER_STD size_t*shape,__PLUMED_WRAPPER_STD size_t flags,void*opt) {\
   plumed_safeptr safe; \
   safe.ptr=val; \
   safe.nelem=nelem; \
   safe.shape=shape; \
-  safe.flags= (flags & (~0x1ffffff)) + 0x10000*code + size; \
+  safe.flags= (flags & (~0x1ffffffu)) + 0x10000*code + size; \
   safe.opt=opt; \
   return safe; \
 }
 
 #define __PLUMED_IMPLEMENT_F_SAFEPTR(type,type_,size,code) \
   __PLUMED_IMPLEMENT_F_SAFEPTR_INNER(type,type_,size,code,) \
   __PLUMED_IMPLEMENT_F_SAFEPTR_INNER(type,type_,size,code,_scalar)
@@ -3914,7 +4212,15 @@
 /* this macro is set in declarations */
 #ifdef __PLUMED_WRAPPER_REDEFINE_GCMD
 #if defined(plumed_gcmd)
 #undef plumed_gcmd
 #endif
 #define plumed_gcmd __PLUMED_WRAPPER_REDEFINE_GCMD
 #endif
+
+/* this macro is set in declarations */
+#ifdef __PLUMED_WRAPPER_REDEFINE_ERROR_RETHROW
+#if defined(plumed_error_rethrow)
+#undef plumed_error_rethrow
+#endif
+#define plumed_error_rethrow __PLUMED_WRAPPER_REDEFINE_ERROR_RETHROW
+#endif
```

### Comparing `plumed-2.8.2.2/plumed.cpp` & `plumed-2.9.0/plumed.c`

 * *Files 1% similar despite different names*

```diff
@@ -1,27 +1,25 @@
-/* Generated by Cython 0.29.33 */
+/* Generated by Cython 0.29.34 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
             "include/Plumed.h"
         ],
         "extra_compile_args": [
             "-D__PLUMED_HAS_DLOPEN",
             "-D__PLUMED_WRAPPER_LINK_RUNTIME=1",
-            "-D__PLUMED_WRAPPER_CXX=1",
             "-D__PLUMED_WRAPPER_IMPLEMENTATION=1",
-            "-D__PLUMED_WRAPPER_EXTERN=0",
-            "-D__PLUMED_WRAPPER_CXX_DEFAULT_INVALID=1"
+            "-D__PLUMED_WRAPPER_EXTERN=0"
         ],
         "include_dirs": [
             "./include"
         ],
-        "language": "c++",
+        "language": "c",
         "name": "plumed",
         "sources": [
             "plumed.pyx"
         ]
     },
     "module_name": "plumed"
 }
@@ -32,16 +30,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_33"
-#define CYTHON_HEX_VERSION 0x001D21F0
+#define CYTHON_ABI "0_29_34"
+#define CYTHON_HEX_VERSION 0x001D22F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -226,15 +224,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -265,15 +263,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -374,41 +372,27 @@
     #if __apple_build_version__ < 7000000
       #undef  CYTHON_FALLTHROUGH
       #define CYTHON_FALLTHROUGH
     #endif
   #endif
 #endif
 
-#ifndef __cplusplus
-  #error "Cython files generated with the C++ option must be compiled with a C++ compiler."
-#endif
 #ifndef CYTHON_INLINE
   #if defined(__clang__)
     #define CYTHON_INLINE __inline__ __attribute__ ((__unused__))
-  #else
+  #elif defined(__GNUC__)
+    #define CYTHON_INLINE __inline__
+  #elif defined(_MSC_VER)
+    #define CYTHON_INLINE __inline
+  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
     #define CYTHON_INLINE inline
+  #else
+    #define CYTHON_INLINE
   #endif
 #endif
-template<typename T>
-void __Pyx_call_destructor(T& x) {
-    x.~T();
-}
-template<typename T>
-class __Pyx_FakeReference {
-  public:
-    __Pyx_FakeReference() : ptr(NULL) { }
-    __Pyx_FakeReference(const T& ref) : ptr(const_cast<T*>(&ref)) { }
-    T *operator->() { return ptr; }
-    T *operator&() { return ptr; }
-    operator T&() { return *ptr; }
-    template<typename U> bool operator ==(U other) { return *ptr == other; }
-    template<typename U> bool operator !=(U other) { return *ptr != other; }
-  private:
-    T *ptr;
-};
 
 #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
   #define Py_OptimizeFlag 0
 #endif
 #define __PYX_BUILD_PY_SSIZE_T "n"
 #define CYTHON_FORMAT_SSIZE_T "z"
 #if PY_MAJOR_VERSION < 3
@@ -778,19 +762,14 @@
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
 #define __PYX_HAVE__plumed
 #define __PYX_HAVE_API__plumed
 /* Early includes */
-#include "exceptions_handler.h"
-#include "ios"
-#include "new"
-#include "stdexcept"
-#include "typeinfo"
 #include "Plumed.h"
 #include "pythread.h"
 #include <string.h>
 #include <stdlib.h>
 #include <stdio.h>
 #include "pystate.h"
 #ifdef _OPENMP
@@ -1115,42 +1094,43 @@
 struct __pyx_obj_6plumed___pyx_scope_struct___build_convert_function;
 struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas;
 struct __pyx_array_obj;
 struct __pyx_MemviewEnum_obj;
 struct __pyx_memoryview_obj;
 struct __pyx_memoryviewslice_obj;
 
-/* "plumed.pyx":50
- *      HAS_NUMPY=False
+/* "plumed.pyx":68
+ *   pass
  * 
  * cdef class Plumed:             # <<<<<<<<<<<<<<
- *      cdef cplumed.Plumed c_plumed
- *      def __cinit__(self,kernel=None):
+ *      cdef cplumed.plumed c_plumed
+ *      cdef int initialized
  */
 struct __pyx_obj_6plumed_Plumed {
   PyObject_HEAD
   struct __pyx_vtabstruct_6plumed_Plumed *__pyx_vtab;
-  PLMD::Plumed c_plumed;
+  plumed c_plumed;
+  int initialized;
 };
 
 
-/* "plumed.pyx":198
+/* "plumed.pyx":291
  *     return file
  * 
  * def _build_convert_function(kernel=None):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a function that can be used for conversions.
  * 
  */
 struct __pyx_obj_6plumed___pyx_scope_struct___build_convert_function {
   PyObject_HEAD
   PyObject *__pyx_v_convert_func;
 };
 
 
-/* "plumed.pyx":260
+/* "plumed.pyx":353
  *                raise ValueError("plumed.Constants should be initialized with a list of 2- or 3-plets")
  * 
  * def read_as_pandas(file_or_path,enable_constants=True,enable_conversion=True,kernel=None,chunksize=None,usecols=None,skiprows=None,nrows=None,index_col=None):             # <<<<<<<<<<<<<<
  *     """Import a plumed data file as a pandas dataset.
  * 
  */
 struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas {
@@ -1235,23 +1215,25 @@
   PyObject *from_object;
   PyObject *(*to_object_func)(char *);
   int (*to_dtype_func)(char *, PyObject *);
 };
 
 
 
-/* "plumed.pyx":50
- *      HAS_NUMPY=False
+/* "plumed.pyx":68
+ *   pass
  * 
  * cdef class Plumed:             # <<<<<<<<<<<<<<
- *      cdef cplumed.Plumed c_plumed
- *      def __cinit__(self,kernel=None):
+ *      cdef cplumed.plumed c_plumed
+ *      cdef int initialized
  */
 
 struct __pyx_vtabstruct_6plumed_Plumed {
+  PyObject *(*raise_exception)(struct __pyx_obj_6plumed_Plumed *, plumed_error);
+  PyObject *(*cmd_low_level)(struct __pyx_obj_6plumed_Plumed *, char const *, void const *, size_t, size_t *, size_t);
   PyObject *(*cmd_ndarray_double)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *);
   PyObject *(*cmd_ndarray_int)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *);
   PyObject *(*cmd_ndarray_long)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *);
   PyObject *(*cmd_array_double)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *);
   PyObject *(*cmd_array_int)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *);
   PyObject *(*cmd_array_long)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *);
   PyObject *(*cmd_float)(struct __pyx_obj_6plumed_Plumed *, PyObject *, double);
@@ -1378,26 +1360,29 @@
 #else
 #define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
 #endif
 
 /* GetBuiltinName.proto */
 static PyObject *__Pyx_GetBuiltinName(PyObject *name);
 
+/* RaiseArgTupleInvalid.proto */
+static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
+    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
+
+/* KeywordStringCheck.proto */
+static int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name, int kw_allowed);
+
 /* RaiseDoubleKeywords.proto */
 static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
 
 /* ParseKeywords.proto */
 static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],\
     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,\
     const char* function_name);
 
-/* RaiseArgTupleInvalid.proto */
-static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
-    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
-
 /* PyObjectCall.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
 #else
 #define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
 #endif
 
@@ -1489,71 +1474,14 @@
 #else
 #define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
 #endif
 
 /* PyObjectCallOneArg.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
 
-/* GetItemInt.proto */
-#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
-    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
-               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
-#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
-    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
-                                                              int wraparound, int boundscheck);
-#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
-    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
-                                                              int wraparound, int boundscheck);
-static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
-                                                     int is_list, int wraparound, int boundscheck);
-
-/* BufferIndexError.proto */
-static void __Pyx_RaiseBufferIndexError(int axis);
-
-/* MemviewSliceInit.proto */
-#define __Pyx_BUF_MAX_NDIMS %(BUF_MAX_NDIMS)d
-#define __Pyx_MEMVIEW_DIRECT   1
-#define __Pyx_MEMVIEW_PTR      2
-#define __Pyx_MEMVIEW_FULL     4
-#define __Pyx_MEMVIEW_CONTIG   8
-#define __Pyx_MEMVIEW_STRIDED  16
-#define __Pyx_MEMVIEW_FOLLOW   32
-#define __Pyx_IS_C_CONTIG 1
-#define __Pyx_IS_F_CONTIG 2
-static int __Pyx_init_memviewslice(
-                struct __pyx_memoryview_obj *memview,
-                int ndim,
-                __Pyx_memviewslice *memviewslice,
-                int memview_is_new_reference);
-static CYTHON_INLINE int __pyx_add_acquisition_count_locked(
-    __pyx_atomic_int *acquisition_count, PyThread_type_lock lock);
-static CYTHON_INLINE int __pyx_sub_acquisition_count_locked(
-    __pyx_atomic_int *acquisition_count, PyThread_type_lock lock);
-#define __pyx_get_slice_count_pointer(memview) (memview->acquisition_count_aligned_p)
-#define __pyx_get_slice_count(memview) (*__pyx_get_slice_count_pointer(memview))
-#define __PYX_INC_MEMVIEW(slice, have_gil) __Pyx_INC_MEMVIEW(slice, have_gil, __LINE__)
-#define __PYX_XDEC_MEMVIEW(slice, have_gil) __Pyx_XDEC_MEMVIEW(slice, have_gil, __LINE__)
-static CYTHON_INLINE void __Pyx_INC_MEMVIEW(__Pyx_memviewslice *, int, int);
-static CYTHON_INLINE void __Pyx_XDEC_MEMVIEW(__Pyx_memviewslice *, int, int);
-
-/* Import.proto */
-static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);
-
-/* PyObjectCall2Args.proto */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
-
 /* PyDictVersioning.proto */
 #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
 #define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
 #define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
     (version_var) = __PYX_GET_DICT_VERSION(dict);\
     (cache_var) = (value);
@@ -1593,34 +1521,35 @@
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
-/* IncludeStringH.proto */
-#include <string.h>
-
-/* BytesEquals.proto */
-static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);
-
-/* UnicodeEquals.proto */
-static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);
-
-/* PyIntCompare.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
-
-/* PySequenceContains.proto */
-static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
-    int result = PySequence_Contains(seq, item);
-    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
-}
-
-/* None.proto */
-static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname);
+/* GetItemInt.proto */
+#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
+    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
+    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
+    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
+               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
+#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
+    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
+    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
+    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
+                                                              int wraparound, int boundscheck);
+#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
+    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
+    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
+    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
+                                                              int wraparound, int boundscheck);
+static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
+                                                     int is_list, int wraparound, int boundscheck);
 
 /* GetTopmostException.proto */
 #if CYTHON_USE_EXC_INFO_STACK
 static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
 #endif
 
 /* SaveResetException.proto */
@@ -1646,14 +1575,101 @@
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
 static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
 #else
 static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
 #endif
 
+/* IncludeStringH.proto */
+#include <string.h>
+
+/* decode_c_string_utf16.proto */
+static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16(const char *s, Py_ssize_t size, const char *errors) {
+    int byteorder = 0;
+    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
+}
+static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16LE(const char *s, Py_ssize_t size, const char *errors) {
+    int byteorder = -1;
+    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
+}
+static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16BE(const char *s, Py_ssize_t size, const char *errors) {
+    int byteorder = 1;
+    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
+}
+
+/* decode_c_string.proto */
+static CYTHON_INLINE PyObject* __Pyx_decode_c_string(
+         const char* cstring, Py_ssize_t start, Py_ssize_t stop,
+         const char* encoding, const char* errors,
+         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors));
+
+/* None.proto */
+static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname);
+
+/* PyObjectCall2Args.proto */
+static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
+
+/* SwapException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#else
+static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
+#endif
+
+/* BufferIndexError.proto */
+static void __Pyx_RaiseBufferIndexError(int axis);
+
+/* MemviewSliceInit.proto */
+#define __Pyx_BUF_MAX_NDIMS %(BUF_MAX_NDIMS)d
+#define __Pyx_MEMVIEW_DIRECT   1
+#define __Pyx_MEMVIEW_PTR      2
+#define __Pyx_MEMVIEW_FULL     4
+#define __Pyx_MEMVIEW_CONTIG   8
+#define __Pyx_MEMVIEW_STRIDED  16
+#define __Pyx_MEMVIEW_FOLLOW   32
+#define __Pyx_IS_C_CONTIG 1
+#define __Pyx_IS_F_CONTIG 2
+static int __Pyx_init_memviewslice(
+                struct __pyx_memoryview_obj *memview,
+                int ndim,
+                __Pyx_memviewslice *memviewslice,
+                int memview_is_new_reference);
+static CYTHON_INLINE int __pyx_add_acquisition_count_locked(
+    __pyx_atomic_int *acquisition_count, PyThread_type_lock lock);
+static CYTHON_INLINE int __pyx_sub_acquisition_count_locked(
+    __pyx_atomic_int *acquisition_count, PyThread_type_lock lock);
+#define __pyx_get_slice_count_pointer(memview) (memview->acquisition_count_aligned_p)
+#define __pyx_get_slice_count(memview) (*__pyx_get_slice_count_pointer(memview))
+#define __PYX_INC_MEMVIEW(slice, have_gil) __Pyx_INC_MEMVIEW(slice, have_gil, __LINE__)
+#define __PYX_XDEC_MEMVIEW(slice, have_gil) __Pyx_XDEC_MEMVIEW(slice, have_gil, __LINE__)
+static CYTHON_INLINE void __Pyx_INC_MEMVIEW(__Pyx_memviewslice *, int, int);
+static CYTHON_INLINE void __Pyx_XDEC_MEMVIEW(__Pyx_memviewslice *, int, int);
+
+/* Import.proto */
+static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);
+
+/* BytesEquals.proto */
+static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);
+
+/* UnicodeEquals.proto */
+static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);
+
+/* PyIntCompare.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
+
+/* PySequenceContains.proto */
+static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
+    int result = PySequence_Contains(seq, item);
+    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
+}
+
+/* None.proto */
+static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname);
+
 /* FetchCommonType.proto */
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
 
 /* CythonFunctionShared.proto */
 #define __Pyx_CyFunction_USED 1
 #define __Pyx_CYFUNCTION_STATICMETHOD  0x01
 #define __Pyx_CYFUNCTION_CLASSMETHOD   0x02
@@ -1903,48 +1919,20 @@
 
 /* UnaryNegOverflows.proto */
 #define UNARY_NEG_WOULD_OVERFLOW(x)\
         (((x) < 0) & ((unsigned long)(x) == 0-(unsigned long)(x)))
 
 static CYTHON_UNUSED int __pyx_array_getbuffer(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /*proto*/
 static PyObject *__pyx_array_get_memview(struct __pyx_array_obj *); /*proto*/
-/* decode_c_string_utf16.proto */
-static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16(const char *s, Py_ssize_t size, const char *errors) {
-    int byteorder = 0;
-    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
-}
-static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16LE(const char *s, Py_ssize_t size, const char *errors) {
-    int byteorder = -1;
-    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
-}
-static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16BE(const char *s, Py_ssize_t size, const char *errors) {
-    int byteorder = 1;
-    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
-}
-
-/* decode_c_string.proto */
-static CYTHON_INLINE PyObject* __Pyx_decode_c_string(
-         const char* cstring, Py_ssize_t start, Py_ssize_t stop,
-         const char* encoding, const char* errors,
-         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors));
-
 /* GetAttr3.proto */
 static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *, PyObject *, PyObject *);
 
 /* ExtTypeTest.proto */
 static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);
 
-/* SwapException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#else
-static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
-#endif
-
 /* FastTypeChecks.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 #define __Pyx_TypeCheck(obj, type) __Pyx_IsSubtype(Py_TYPE(obj), (PyTypeObject *)type)
 static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b);
 static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject *type);
 static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *type1, PyObject *type2);
 #else
@@ -1981,17 +1969,14 @@
     Py_DECREF(none);
     return 0;
 #else
     return PyList_SetSlice(L, PY_SSIZE_T_MAX, PY_SSIZE_T_MAX, v);
 #endif
 }
 
-/* None.proto */
-static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname);
-
 /* DivInt[long].proto */
 static CYTHON_INLINE long __Pyx_div_long(long, long);
 
 /* ImportFrom.proto */
 static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name);
 
 /* PyObject_GenericGetAttrNoDict.proto */
@@ -2039,17 +2024,14 @@
 static PyCodeObject *__pyx_find_code_object(int code_line);
 static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);
 
 /* AddTraceback.proto */
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename);
 
-/* None.proto */
-#include <new>
-
 #if PY_MAJOR_VERSION < 3
     static int __Pyx_GetBuffer(PyObject *obj, Py_buffer *view, int flags);
     static void __Pyx_ReleaseBuffer(Py_buffer *view);
 #else
     #define __Pyx_GetBuffer PyObject_GetBuffer
     #define __Pyx_ReleaseBuffer PyBuffer_Release
 #endif
@@ -2076,14 +2058,19 @@
 static int __pyx_slices_overlap(__Pyx_memviewslice *slice1,
                                 __Pyx_memviewslice *slice2,
                                 int ndim, size_t itemsize);
 
 /* Capsule.proto */
 static CYTHON_INLINE PyObject *__pyx_capsule_create(void *p, const char *sig);
 
+/* GCCDiagnostics.proto */
+#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
+#define __Pyx_HAS_GCC_DIAGNOSTIC
+#endif
+
 /* IsLittleEndian.proto */
 static CYTHON_INLINE int __Pyx_Is_Little_Endian(void);
 
 /* BufferFormatCheck.proto */
 static const char* __Pyx_BufFmt_CheckString(__Pyx_BufFmt_Context* ctx, const char* ts);
 static void __Pyx_BufFmt_Init(__Pyx_BufFmt_Context* ctx,
                               __Pyx_BufFmt_StackElem* stack,
@@ -2102,19 +2089,14 @@
                 __Pyx_BufFmt_StackElem stack[],
                 __Pyx_memviewslice *memviewslice,
                 PyObject *original_obj);
 
 /* ObjectToMemviewSlice.proto */
 static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_double(PyObject *, int writable_flag);
 
-/* GCCDiagnostics.proto */
-#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
-#define __Pyx_HAS_GCC_DIAGNOSTIC
-#endif
-
 /* ObjectToMemviewSlice.proto */
 static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_int(PyObject *, int writable_flag);
 
 /* ObjectToMemviewSlice.proto */
 static CYTHON_INLINE __Pyx_memviewslice __Pyx_PyObject_to_MemoryviewSlice_ds_long(PyObject *, int writable_flag);
 
 /* MemviewDtypeToObject.proto */
@@ -2132,38 +2114,40 @@
 /* MemviewSliceCopyTemplate.proto */
 static __Pyx_memviewslice
 __pyx_memoryview_copy_new_contig(const __Pyx_memviewslice *from_mvs,
                                  const char *mode, int ndim,
                                  size_t sizeof_dtype, int contig_flag,
                                  int dtype_is_object);
 
+/* CIntToPy.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
+
 /* CIntFromPy.proto */
 static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *);
 
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);
 
-/* CIntToPy.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
-
 /* CIntFromPy.proto */
 static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE char __Pyx_PyInt_As_char(PyObject *);
 
 /* CheckBinaryVersion.proto */
 static int __Pyx_check_binary_version(void);
 
 /* InitStrings.proto */
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 
+static PyObject *__pyx_f_6plumed_6Plumed_raise_exception(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, plumed_error __pyx_v_error); /* proto*/
+static PyObject *__pyx_f_6plumed_6Plumed_cmd_low_level(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, char const *__pyx_v_ckey, void const *__pyx_v_val, CYTHON_UNUSED size_t __pyx_v_nelem, size_t *__pyx_v_shape, size_t __pyx_v_flags); /* proto*/
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_ndarray_double(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val); /* proto*/
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_ndarray_int(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val); /* proto*/
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_ndarray_long(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val); /* proto*/
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_array_double(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val); /* proto*/
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_array_int(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val); /* proto*/
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_array_long(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val); /* proto*/
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_float(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, double __pyx_v_val); /* proto*/
@@ -2176,16 +2160,14 @@
 static PyObject *__pyx_memoryview_setitem_slice_assign_scalar(struct __pyx_memoryview_obj *__pyx_v_self, struct __pyx_memoryview_obj *__pyx_v_dst, PyObject *__pyx_v_value); /* proto*/
 static PyObject *__pyx_memoryview_setitem_indexed(struct __pyx_memoryview_obj *__pyx_v_self, PyObject *__pyx_v_index, PyObject *__pyx_v_value); /* proto*/
 static PyObject *__pyx_memoryview_convert_item_to_object(struct __pyx_memoryview_obj *__pyx_v_self, char *__pyx_v_itemp); /* proto*/
 static PyObject *__pyx_memoryview_assign_item_from_object(struct __pyx_memoryview_obj *__pyx_v_self, char *__pyx_v_itemp, PyObject *__pyx_v_value); /* proto*/
 static PyObject *__pyx_memoryviewslice_convert_item_to_object(struct __pyx_memoryviewslice_obj *__pyx_v_self, char *__pyx_v_itemp); /* proto*/
 static PyObject *__pyx_memoryviewslice_assign_item_from_object(struct __pyx_memoryviewslice_obj *__pyx_v_self, char *__pyx_v_itemp, PyObject *__pyx_v_value); /* proto*/
 
-/* Module declarations from 'libcpp' */
-
 /* Module declarations from 'cplumed' */
 
 /* Module declarations from 'plumed' */
 static PyTypeObject *__pyx_ptype_6plumed_Plumed = 0;
 static PyTypeObject *__pyx_ptype_6plumed___pyx_scope_struct___build_convert_function = 0;
 static PyTypeObject *__pyx_ptype_6plumed___pyx_scope_struct_1_read_as_pandas = 0;
 static PyTypeObject *__pyx_array_type = 0;
@@ -2238,26 +2220,29 @@
 #define __Pyx_MODULE_NAME "plumed"
 extern int __pyx_module_is_main_plumed;
 int __pyx_module_is_main_plumed = 0;
 
 /* Implementation of 'plumed' */
 static PyObject *__pyx_builtin_ImportError;
 static PyObject *__pyx_builtin_RuntimeError;
-static PyObject *__pyx_builtin_range;
-static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_TypeError;
+static PyObject *__pyx_builtin_MemoryError;
+static PyObject *__pyx_builtin_ValueError;
+static PyObject *__pyx_builtin_IOError;
+static PyObject *__pyx_builtin_IndexError;
+static PyObject *__pyx_builtin_OverflowError;
+static PyObject *__pyx_builtin_ArithmeticError;
+static PyObject *__pyx_builtin_range;
 static PyObject *__pyx_builtin_open;
 static PyObject *__pyx_builtin_property;
 static PyObject *__pyx_builtin_print;
 static PyObject *__pyx_builtin_AttributeError;
-static PyObject *__pyx_builtin_MemoryError;
 static PyObject *__pyx_builtin_enumerate;
 static PyObject *__pyx_builtin_Ellipsis;
 static PyObject *__pyx_builtin_id;
-static PyObject *__pyx_builtin_IndexError;
 static const char __pyx_k_I[] = "I";
 static const char __pyx_k_L[] = "L";
 static const char __pyx_k_O[] = "O";
 static const char __pyx_k_a[] = "a";
 static const char __pyx_k_c[] = "c";
 static const char __pyx_k_d[] = "d";
 static const char __pyx_k_f[] = "f";
@@ -2268,81 +2253,87 @@
 static const char __pyx_k_n[] = "n";
 static const char __pyx_k_p[] = "p";
 static const char __pyx_k_r[] = "r";
 static const char __pyx_k_t[] = "t";
 static const char __pyx_k_v[] = "v";
 static const char __pyx_k_w[] = "w";
 static const char __pyx_k_x[] = "x";
-static const char __pyx_k__2[] = "*";
+static const char __pyx_k__4[] = "*";
 static const char __pyx_k_at[] = "_at";
 static const char __pyx_k_df[] = "df";
 static const char __pyx_k_go[] = "go";
 static const char __pyx_k_gz[] = ".*\\.gz";
+static const char __pyx_k_i0[] = "i0";
+static const char __pyx_k_i1[] = "i1";
 static const char __pyx_k_id[] = "id";
 static const char __pyx_k_no[] = "no";
 static const char __pyx_k_np[] = "np";
 static const char __pyx_k_pd[] = "pd";
 static const char __pyx_k_pi[] = "pi";
 static const char __pyx_k_re[] = "re";
 static const char __pyx_k_rt[] = "rt";
+static const char __pyx_k_t0[] = "t0";
+static const char __pyx_k_t1[] = "t1";
 static const char __pyx_k_v0[] = "v0";
 static const char __pyx_k_v1[] = "v1";
 static const char __pyx_k_v2[] = "v2";
 static const char __pyx_k_v3[] = "v3";
 static const char __pyx_k_v4[] = "v4";
 static const char __pyx_k_wt[] = "wt";
 static const char __pyx_k_MPI[] = "MPI";
 static const char __pyx_k_SET[] = "SET";
-static const char __pyx_k__21[] = "#!";
-static const char __pyx_k__22[] = " ";
-static const char __pyx_k__24[] = "#";
-static const char __pyx_k__30[] = "\n";
-static const char __pyx_k__32[] = "";
-static const char __pyx_k__33[] = "/";
-static const char __pyx_k__34[] = "****************************************";
-static const char __pyx_k__36[] = "\\";
-static const char __pyx_k__38[] = "=$";
-static const char __pyx_k__39[] = ".*-.*";
-static const char __pyx_k__40[] = "__";
-static const char __pyx_k__41[] = ",*";
-static const char __pyx_k__42[] = ",";
-static const char __pyx_k__43[] = "\"\n";
-static const char __pyx_k__44[] = "\",";
-static const char __pyx_k__45[] = "))\n";
-static const char __pyx_k__46[] = "\")\n";
-static const char __pyx_k__47[] = "\"\"\"\n";
-static const char __pyx_k__50[] = "_";
-static const char __pyx_k__51[] = "@";
-static const char __pyx_k__52[] = "-";
-static const char __pyx_k__53[] = "=\"@";
-static const char __pyx_k__54[] = "\"";
-static const char __pyx_k__55[] = "{[^{}]*}";
-static const char __pyx_k__56[] = ".*[{}]";
-static const char __pyx_k__57[] = ".*[ {}]";
-static const char __pyx_k__58[] = ".*[ {},]";
-static const char __pyx_k__59[] = "{";
-static const char __pyx_k__60[] = "}";
-static const char __pyx_k__61[] = "[\n\t]";
-static const char __pyx_k__66[] = ": ";
-static const char __pyx_k__68[] = "=";
-static const char __pyx_k__74[] = ".*__$";
-static const char __pyx_k__75[] = "__$";
-static const char __pyx_k__81[] = ".*[^_]__$";
+static const char __pyx_k__23[] = "#!";
+static const char __pyx_k__24[] = " ";
+static const char __pyx_k__26[] = "#";
+static const char __pyx_k__32[] = "\n";
+static const char __pyx_k__35[] = "";
+static const char __pyx_k__36[] = "/";
+static const char __pyx_k__37[] = "****************************************";
+static const char __pyx_k__39[] = "\\";
+static const char __pyx_k__41[] = "=$";
+static const char __pyx_k__42[] = ".*-.*";
+static const char __pyx_k__43[] = "__";
+static const char __pyx_k__44[] = ",*";
+static const char __pyx_k__45[] = ",";
+static const char __pyx_k__46[] = "\"\n";
+static const char __pyx_k__47[] = "\",";
+static const char __pyx_k__48[] = "))\n";
+static const char __pyx_k__49[] = "\")\n";
+static const char __pyx_k__50[] = "\"\"\"\n";
+static const char __pyx_k__53[] = "_";
+static const char __pyx_k__54[] = "@";
+static const char __pyx_k__55[] = "-";
+static const char __pyx_k__56[] = "=\"@";
+static const char __pyx_k__57[] = "\"";
+static const char __pyx_k__58[] = "{[^{}]*}";
+static const char __pyx_k__59[] = ".*[{}]";
+static const char __pyx_k__60[] = ".*[ {}]";
+static const char __pyx_k__61[] = ".*[ {},]";
+static const char __pyx_k__62[] = "{";
+static const char __pyx_k__63[] = "}";
+static const char __pyx_k__64[] = "[\n\t]";
+static const char __pyx_k__69[] = ": ";
+static const char __pyx_k__71[] = "=";
+static const char __pyx_k__77[] = ".*__$";
+static const char __pyx_k__78[] = "__$";
+static const char __pyx_k__84[] = ".*[^_]__$";
 static const char __pyx_k_all[] = "all";
 static const char __pyx_k_arg[] = "arg";
 static const char __pyx_k_chi[] = "chi";
 static const char __pyx_k_cmd[] = "cmd";
 static const char __pyx_k_def[] = "def ";
 static const char __pyx_k_doc[] = "__doc__";
 static const char __pyx_k_f_2[] = "\\f$";
 static const char __pyx_k_fin[] = "fin";
 static const char __pyx_k_int[] = "int_";
 static const char __pyx_k_key[] = "key";
 static const char __pyx_k_lcs[] = "lcs";
 static const char __pyx_k_log[] = "log";
+static const char __pyx_k_max[] = "max";
+static const char __pyx_k_min[] = "min";
 static const char __pyx_k_nan[] = "nan";
 static const char __pyx_k_new[] = "__new__";
 static const char __pyx_k_obj[] = "obj";
 static const char __pyx_k_opt[] = "opt";
 static const char __pyx_k_phi[] = "phi";
 static const char __pyx_k_pos[] = "pos";
 static const char __pyx_k_psi[] = "psi";
@@ -2360,14 +2351,16 @@
 static const char __pyx_k_at_2[] = "at";
 static const char __pyx_k_back[] = "back";
 static const char __pyx_k_base[] = "base";
 static const char __pyx_k_beta[] = "beta";
 static const char __pyx_k_call[] = "__call__";
 static const char __pyx_k_chi1[] = "chi1";
 static const char __pyx_k_ckey[] = "ckey";
+static const char __pyx_k_clip[] = "clip";
+static const char __pyx_k_copy[] = "copy";
 static const char __pyx_k_core[] = "core";
 static const char __pyx_k_cval[] = "cval";
 static const char __pyx_k_dict[] = "__dict__";
 static const char __pyx_k_exit[] = "__exit__";
 static const char __pyx_k_file[] = "file";
 static const char __pyx_k_flag[] = "(flag)";
 static const char __pyx_k_func[] = "func";
@@ -2382,26 +2375,28 @@
 static const char __pyx_k_main[] = "__main__";
 static const char __pyx_k_math[] = "math";
 static const char __pyx_k_menu[] = "menu";
 static const char __pyx_k_mode[] = "mode";
 static const char __pyx_k_name[] = "name";
 static const char __pyx_k_ndim[] = "ndim";
 static const char __pyx_k_next[] = "__next__";
+static const char __pyx_k_ones[] = "ones";
 static const char __pyx_k_open[] = "open";
 static const char __pyx_k_pack[] = "pack";
 static const char __pyx_k_root[] = "--root";
 static const char __pyx_k_seek[] = "seek";
 static const char __pyx_k_self[] = "self";
 static const char __pyx_k_sets[] = "sets";
 static const char __pyx_k_size[] = "size";
 static const char __pyx_k_step[] = "step";
 static const char __pyx_k_stop[] = "stop";
 static const char __pyx_k_subn[] = "subn";
 static const char __pyx_k_tell[] = "tell";
 static const char __pyx_k_test[] = "__test__";
+static const char __pyx_k_time[] = "time";
 static const char __pyx_k_type[] = "type";
 static const char __pyx_k_warn[] = "warn";
 static const char __pyx_k_word[] = "word";
 static const char __pyx_k_zeta[] = "zeta";
 static const char __pyx_k_ASCII[] = "ASCII";
 static const char __pyx_k_False[] = "=False";
 static const char __pyx_k_LABEL[] = "LABEL";
@@ -2417,15 +2412,18 @@
 static const char __pyx_k_doc_3[] = ".__doc__ = \"\"\"\n";
 static const char __pyx_k_doc_4[] = "_doc";
 static const char __pyx_k_dtype[] = "dtype";
 static const char __pyx_k_enter[] = "__enter__";
 static const char __pyx_k_error[] = "error";
 static const char __pyx_k_flags[] = "flags";
 static const char __pyx_k_fname[] = "fname";
+static const char __pyx_k_frac0[] = "frac0";
+static const char __pyx_k_frac1[] = "frac1";
 static const char __pyx_k_gamma[] = "gamma";
+static const char __pyx_k_hills[] = "hills";
 static const char __pyx_k_index[] = "index";
 static const char __pyx_k_isnan[] = "isnan";
 static const char __pyx_k_label[] = "(label)";
 static const char __pyx_k_ldict[] = "ldict";
 static const char __pyx_k_let_b[] = "^let b:";
 static const char __pyx_k_level[] = "level";
 static const char __pyx_k_match[] = "match";
@@ -2444,30 +2442,32 @@
 static const char __pyx_k_start[] = "start";
 static const char __pyx_k_sugar[] = "sugar";
 static const char __pyx_k_types[] = "types";
 static const char __pyx_k_utf_8[] = "utf-8";
 static const char __pyx_k_value[] = "value";
 static const char __pyx_k_water[] = "water";
 static const char __pyx_k_write[] = "write";
+static const char __pyx_k_zeros[] = "zeros";
 static const char __pyx_k_FIELDS[] = "FIELDS";
 static const char __pyx_k_Number[] = "Number";
 static const char __pyx_k_Plumed[] = "Plumed";
 static const char __pyx_k_Series[] = "Series";
 static const char __pyx_k_action[] = "action";
 static const char __pyx_k_always[] = "always";
 static const char __pyx_k_append[] = "append";
 static const char __pyx_k_callme[] = "_callme";
-static const char __pyx_k_ctypes[] = "ctypes";
 static const char __pyx_k_decode[] = "decode";
 static const char __pyx_k_double[] = "double";
 static const char __pyx_k_encode[] = "encode";
 static const char __pyx_k_extend[] = "extend";
 static const char __pyx_k_format[] = "format";
 static const char __pyx_k_groups[] = "groups";
 static const char __pyx_k_header[] = "header";
+static const char __pyx_k_height[] = "height";
+static const char __pyx_k_hstack[] = "hstack";
 static const char __pyx_k_import[] = "__import__";
 static const char __pyx_k_init_2[] = "init";
 static const char __pyx_k_kernel[] = "kernel";
 static const char __pyx_k_kwargs[] = ",**kwargs):\n";
 static const char __pyx_k_module[] = "__module__";
 static const char __pyx_k_mpi4py[] = "mpi4py";
 static const char __pyx_k_name_2[] = "_name";
@@ -2483,29 +2483,31 @@
 static const char __pyx_k_root_2[] = "root";
 static const char __pyx_k_rstrip[] = "rstrip";
 static const char __pyx_k_self_2[] = "self.";
 static const char __pyx_k_self_3[] = "'],self)";
 static const char __pyx_k_stdout[] = "stdout";
 static const char __pyx_k_string[] = "string";
 static const char __pyx_k_struct[] = "struct";
-static const char __pyx_k_tofile[] = "_tofile";
+static const char __pyx_k_tofile[] = "tofile";
 static const char __pyx_k_unpack[] = "unpack";
 static const char __pyx_k_update[] = "update";
 static const char __pyx_k_Columns[] = ". Columns: ";
+static const char __pyx_k_IOError[] = "IOError";
 static const char __pyx_k_allowed[] = "      allowed=[]\n";
 static const char __pyx_k_builder[] = "builder";
 static const char __pyx_k_columns[] = "columns";
 static const char __pyx_k_comment[] = "comment";
 static const char __pyx_k_compile[] = "compile";
 static const char __pyx_k_convert[] = "convert ";
 static const char __pyx_k_epsilon[] = "epsilon";
 static const char __pyx_k_fortran[] = "fortran";
 static const char __pyx_k_getattr[] = "__getattr__";
 static const char __pyx_k_history[] = "history";
 static const char __pyx_k_indices[] = "indices";
+static const char __pyx_k_inplace[] = "inplace";
 static const char __pyx_k_isdigit[] = "isdigit";
 static const char __pyx_k_label_2[] = "label";
 static const char __pyx_k_mdatoms[] = "mdatoms";
 static const char __pyx_k_memview[] = "memview";
 static const char __pyx_k_mkstemp[] = "mkstemp";
 static const char __pyx_k_modules[] = "modules";
 static const char __pyx_k_ndarray[] = "ndarray";
@@ -2529,30 +2531,32 @@
 static const char __pyx_k_finalize[] = "finalize";
 static const char __pyx_k_fix_file[] = "_fix_file";
 static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_has_dict[] = "_has_dict";
 static const char __pyx_k_help_dir[] = "help_dir";
 static const char __pyx_k_itemsize[] = "itemsize";
 static const char __pyx_k_kwargs_2[] = "kwargs";
+static const char __pyx_k_linspace[] = "linspace";
 static const char __pyx_k_metadata[] = "metadata";
 static const char __pyx_k_numbered[] = "(numbered)";
 static const char __pyx_k_option_2[] = "option \"";
 static const char __pyx_k_property[] = "property";
 static const char __pyx_k_py_bytes[] = "py_bytes";
 static const char __pyx_k_pyx_type[] = "__pyx_type";
 static const char __pyx_k_qualname[] = "__qualname__";
 static const char __pyx_k_read_csv[] = "read_csv";
 static const char __pyx_k_readline[] = "readline";
 static const char __pyx_k_replicas[] = "@replicas:";
 static const char __pyx_k_setstate[] = "__setstate__";
 static const char __pyx_k_skiprows[] = "skiprows";
 static const char __pyx_k_tempfile[] = "tempfile";
-static const char __pyx_k_tofile_2[] = "tofile";
+static const char __pyx_k_tofile_2[] = "_tofile";
 static const char __pyx_k_toplumed[] = "_toplumed";
 static const char __pyx_k_typecode[] = "typecode";
+static const char __pyx_k_use_time[] = "use_time";
 static const char __pyx_k_verbatim[] = "verbatim";
 static const char __pyx_k_vim_help[] = "/vim/help";
 static const char __pyx_k_warnings[] = "warnings";
 static const char __pyx_k_AtomGroup[] = "AtomGroup";
 static const char __pyx_k_Constants[] = "Constants";
 static const char __pyx_k_DataFrame[] = "DataFrame";
 static const char __pyx_k_HAS_NUMPY[] = "HAS_NUMPY";
@@ -2576,14 +2580,15 @@
 static const char __pyx_k_load_dict[] = "load_dict";
 static const char __pyx_k_metaclass[] = "__metaclass__";
 static const char __pyx_k_pyx_state[] = "__pyx_state";
 static const char __pyx_k_reduce_ex[] = "__reduce_ex__";
 static const char __pyx_k_retlist_2[] = "retlist";
 static const char __pyx_k_separator[] = "_separator";
 static const char __pyx_k_traceback[] = "traceback";
+static const char __pyx_k_use_index[] = "use_index";
 static const char __pyx_k_IndexError[] = "IndexError";
 static const char __pyx_k_MDAnalysis[] = "MDAnalysis";
 static const char __pyx_k_Plumed_cmd[] = "Plumed.cmd";
 static const char __pyx_k_ValueError[] = "ValueError";
 static const char __pyx_k_at_residue[] = "_at_residue";
 static const char __pyx_k_dictionary[] = "dictionary";
 static const char __pyx_k_fix_braces[] = "_fix_braces";
@@ -2602,17 +2607,19 @@
 static const char __pyx_k_replicas_2[] = "_replicas";
 static const char __pyx_k_replicas_3[] = "replicas";
 static const char __pyx_k_setLogFile[] = "setLogFile";
 static const char __pyx_k_subprocess[] = "subprocess";
 static const char __pyx_k_toplumed_2[] = "toplumed";
 static const char __pyx_k_FormatError[] = "FormatError";
 static const char __pyx_k_ImportError[] = "ImportError";
+static const char __pyx_k_LeptonError[] = "LeptonError";
 static const char __pyx_k_MemoryError[] = "MemoryError";
 static const char __pyx_k_PLUMED_Root[] = "PLUMED: Root: ";
 static const char __pyx_k_PickleError[] = "PickleError";
+static const char __pyx_k_PlumedError[] = "PlumedError";
 static const char __pyx_k_constructor[] = "_constructor";
 static const char __pyx_k_convert_all[] = "convert_all";
 static const char __pyx_k_format_flag[] = "_format_flag";
 static const char __pyx_k_functions_2[] = "functions";
 static const char __pyx_k_post_format[] = "_post_format";
 static const char __pyx_k_readvimdict[] = "_readvimdict";
 static const char __pyx_k_syntax_file[] = "syntax_file";
@@ -2629,28 +2636,31 @@
 static const char __pyx_k_pre_format_2[] = "pre_format";
 static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
 static const char __pyx_k_retlist_sort[] = "  retlist.sort()\n";
 static const char __pyx_k_stringsource[] = "stringsource";
 static const char __pyx_k_version_info[] = "version_info";
 static const char __pyx_k_write_pandas[] = "write_pandas";
 static const char __pyx_k_Create_action[] = "Create action ";
+static const char __pyx_k_OverflowError[] = "OverflowError";
 static const char __pyx_k_Plumed___exit[] = "Plumed.__exit__";
 static const char __pyx_k_format_return[] = "_format_return";
 static const char __pyx_k_format_single[] = "_format_single";
+static const char __pyx_k_getApiVersion[] = "getApiVersion";
 static const char __pyx_k_post_format_2[] = "post_format";
 static const char __pyx_k_pyx_getbuffer[] = "__pyx_getbuffer";
 static const char __pyx_k_readInputLine[] = "readInputLine";
 static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
 static const char __pyx_k_residue_chain[] = "\",residue,chain)\n";
 static const char __pyx_k_AttributeError[] = "AttributeError";
 static const char __pyx_k_Plumed___enter[] = "Plumed.__enter__";
 static const char __pyx_k_TextFileReader[] = "TextFileReader";
 static const char __pyx_k_allowed_append[] = "      allowed.append(\"";
 static const char __pyx_k_read_as_pandas[] = "read_as_pandas";
 static const char __pyx_k_unknown_method[] = "unknown method ";
+static const char __pyx_k_ArithmeticError[] = "ArithmeticError";
 static const char __pyx_k_PlumedDataFrame[] = "PlumedDataFrame";
 static const char __pyx_k_Plumed_finalize[] = "Plumed.finalize";
 static const char __pyx_k_View_MemoryView[] = "View.MemoryView";
 static const char __pyx_k_allocate_buffer[] = "allocate_buffer";
 static const char __pyx_k_comma_separator[] = "comma_separator";
 static const char __pyx_k_dtype_is_object[] = "dtype_is_object";
 static const char __pyx_k_format_anything[] = "_format_anything";
@@ -2665,31 +2675,34 @@
 static const char __pyx_k_Constants___init[] = "Constants.__init__";
 static const char __pyx_k_create_functions[] = "_create_functions";
 static const char __pyx_k_delim_whitespace[] = "delim_whitespace";
 static const char __pyx_k_enable_constants[] = "enable_constants";
 static const char __pyx_k_for_x_in_retlist[] = "  for x in retlist:\n";
 static const char __pyx_k_plumedDictionary[] = "plumedDictionary";
 static const char __pyx_k_plumed_constants[] = "plumed_constants";
+static const char __pyx_k_setRealPrecision[] = "setRealPrecision";
 static const char __pyx_k_enable_conversion[] = "enable_conversion";
 static const char __pyx_k_enable_mda_groups[] = "_enable_mda_groups";
 static const char __pyx_k_for_arg_in_kwargs[] = "  for arg in kwargs:\n";
 static const char __pyx_k_minimize_braces_2[] = "minimize_braces";
 static const char __pyx_k_process_dataframe[] = "process_dataframe";
 static const char __pyx_k_pyx_unpickle_Enum[] = "__pyx_unpickle_Enum";
 static const char __pyx_k_ERROR_interpreting[] = "ERROR interpreting ";
 static const char __pyx_k_Not_enough_columns[] = ". Not enough columns";
 static const char __pyx_k_Unknown_value_type[] = "Unknown value type ({})";
 static const char __pyx_k_append_underscores[] = "append_underscores";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_constructor_sliced[] = "_constructor_sliced";
+static const char __pyx_k_hills_time_average[] = "hills_time_average";
 static const char __pyx_k_strided_and_direct[] = "<strided and direct>";
 static const char __pyx_k_InputBuilder___call[] = "InputBuilder.__call__";
 static const char __pyx_k_InputBuilder___init[] = "InputBuilder.__init__";
 static const char __pyx_k_enable_mda_groups_2[] = "enable_mda_groups";
 static const char __pyx_k_format_at_one_chain[] = "_format_at_one_chain";
+static const char __pyx_k_setNestedExceptions[] = "setNestedExceptions";
 static const char __pyx_k_append_underscores_2[] = "_append_underscores";
 static const char __pyx_k_strided_and_indirect[] = "<strided and indirect>";
 static const char __pyx_k_InputBuilder_numbered[] = "InputBuilder.numbered";
 static const char __pyx_k_InputBuilder_replicas[] = "InputBuilder.replicas";
 static const char __pyx_k_InputBuilder_verbatim[] = "InputBuilder.verbatim";
 static const char __pyx_k_constructor_expanddim[] = "_constructor_expanddim";
 static const char __pyx_k_contiguous_and_direct[] = "<contiguous and direct>";
@@ -2718,15 +2731,15 @@
 static const char __pyx_k_ret__format_label_self_LABEL[] = "  ret+=_format_label(self,LABEL)\n";
 static const char __pyx_k_unable_to_allocate_array_data[] = "unable to allocate array data.";
 static const char __pyx_k_options_cannot_be_a_dictionary[] = "options cannot be a dictionary";
 static const char __pyx_k_return__format_return_self_ret[] = "  return _format_return(self,ret)\n";
 static const char __pyx_k_strided_and_direct_or_indirect[] = "<strided and direct or indirect>";
 static const char __pyx_k_InputBuilder___getattr___locals[] = "InputBuilder.__getattr__.<locals>._callme";
 static const char __pyx_k_Object_used_to_construct_plumed[] = "Object used to construct plumed input files.\n\n       An instance of this object can be used to construct plumed input files.\n       Check the constructor to see all the available options.\n    ";
-static const char __pyx_k_PLUMED_2_6_only_supports_Python[] = "PLUMED 2.6 only supports Python 3";
+static const char __pyx_k_PLUMED_2_6_only_supports_Python[] = "PLUMED >=2.6 only supports Python 3";
 static const char __pyx_k_PLUMED_instance_seems_to_have_a[] = "PLUMED instance seems to have a non-working convert cmd, conversions do not work and will be disabled";
 static const char __pyx_k_PLUMED_not_available_check_your[] = "PLUMED not available, check your PLUMED_KERNEL environment variable";
 static const char __pyx_k_build_convert_function_locals_c[] = "_build_convert_function.<locals>.convert_func";
 static const char __pyx_k_if_not_re_sub_0_9_arg_in_allowe[] = "      if not re.sub(\"[0-9]*$\",\"\",arg) in allowed:\n";
 static const char __pyx_k_options_should_be_string_number[] = "options should be string, number or iterable";
 static const char __pyx_k_raise_TypeError_unknown_arg_arg[] = "         raise TypeError(\"unknown arg \" + arg)\n";
 static const char __pyx_k_replica_syntax_only_allowed_for[] = "@replica syntax only allowed for scalar or rank 1 vectors";
@@ -2748,19 +2761,20 @@
 static const char __pyx_k_Indirect_dimensions_not_supporte[] = "Indirect dimensions not supported";
 static const char __pyx_k_Invalid_mode_expected_c_or_fortr[] = "Invalid mode, expected 'c' or 'fortran', got %s";
 static const char __pyx_k_Out_of_bounds_on_buffer_access_a[] = "Out of bounds on buffer access (axis %d)";
 static const char __pyx_k_PLUMED_instance_is_too_old_conve[] = "PLUMED instance is too old, conversions do not work and will be disabled";
 static const char __pyx_k_Subclass_of_pandas_io_TestFileRe[] = "Subclass of pandas.io.TestFileReader, needed for storing constants";
 static const char __pyx_k_Unable_to_convert_item_to_object[] = "Unable to convert item to object";
 static const char __pyx_k_Writing_dataframes_with_MultiInd[] = "Writing dataframes with MultiIndexes is not supported at this time";
+static const char __pyx_k_arrays_should_be_type_double_siz[] = "arrays should be type double (size=8), int, or long";
 static const char __pyx_k_cannot_load_PLUMED_instance_conv[] = "cannot load PLUMED instance, conversions will not be available";
+static const char __pyx_k_cannot_use_simultaneously_time_a[] = "cannot use simultaneously time and fraction";
 static const char __pyx_k_error_parsing_dictionary_unknown[] = "error parsing dictionary, unknown type ";
 static const char __pyx_k_got_differing_extents_in_dimensi[] = "got differing extents in dimension %d (got %d and %d)";
-static const char __pyx_k_ndarrays_should_be_double_size_8[] = "ndarrays should be double (size=8), int, or long";
-static const char __pyx_k_ndarrys_should_be_np_double_np_i[] = "ndarrys should be np.double, np.intc, or np.int_";
+static const char __pyx_k_ndarrays_should_be_type_np_doubl[] = "ndarrays should be type np.double, np.intc, or np.int_";
 static const char __pyx_k_no_default___reduce___due_to_non[] = "no default __reduce__ due to non-trivial __cinit__";
 static const char __pyx_k_numbered_types_should_have_integ[] = "numbered types should have integer keys";
 static const char __pyx_k_plumed_Constants_should_be_initi[] = "plumed.Constants should be initialized with a list of 2- or 3-plets";
 static const char __pyx_k_read_as_pandas_locals_PlumedData[] = "read_as_pandas.<locals>.PlumedDataFrame";
 static const char __pyx_k_read_as_pandas_locals_PlumedSeri[] = "read_as_pandas.<locals>.PlumedSeries";
 static const char __pyx_k_read_as_pandas_locals_TextFileRe[] = "read_as_pandas.<locals>.TextFileReader";
 static const char __pyx_k_read_as_pandas_locals_process_da[] = "read_as_pandas.<locals>.process_dataframe";
@@ -2772,14 +2786,15 @@
 static const char __pyx_k_read_as_pandas_locals_PlumedData_2[] = "read_as_pandas.<locals>.PlumedDataFrame._constructor";
 static const char __pyx_k_read_as_pandas_locals_PlumedData_3[] = "read_as_pandas.<locals>.PlumedDataFrame._constructor_sliced";
 static const char __pyx_k_read_as_pandas_locals_PlumedSeri_2[] = "read_as_pandas.<locals>.PlumedSeries._constructor";
 static const char __pyx_k_read_as_pandas_locals_PlumedSeri_3[] = "read_as_pandas.<locals>.PlumedSeries._constructor_expanddim";
 static const char __pyx_k_read_as_pandas_locals_TextFileRe_2[] = "read_as_pandas.<locals>.TextFileReader.__init__";
 static const char __pyx_k_read_as_pandas_locals_TextFileRe_3[] = "read_as_pandas.<locals>.TextFileReader.__next__";
 static PyObject *__pyx_n_s_ASCII;
+static PyObject *__pyx_n_s_ArithmeticError;
 static PyObject *__pyx_n_s_AtomGroup;
 static PyObject *__pyx_n_s_AttributeError;
 static PyObject *__pyx_kp_s_Buffer_view_does_not_expose_stri;
 static PyObject *__pyx_kp_s_Can_only_create_a_buffer_that_is;
 static PyObject *__pyx_kp_s_Cannot_assign_to_read_only_memor;
 static PyObject *__pyx_kp_s_Cannot_create_writable_memory_vi;
 static PyObject *__pyx_kp_s_Cannot_index_with_type_s;
@@ -2799,14 +2814,15 @@
 static PyObject *__pyx_kp_u_Error_reading_PLUMED_file_2;
 static PyObject *__pyx_n_u_FIELDS;
 static PyObject *__pyx_kp_u_FIELDS_2;
 static PyObject *__pyx_kp_u_False;
 static PyObject *__pyx_n_s_FormatError;
 static PyObject *__pyx_n_s_HAS_NUMPY;
 static PyObject *__pyx_n_u_I;
+static PyObject *__pyx_n_s_IOError;
 static PyObject *__pyx_n_s_ImportError;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0;
 static PyObject *__pyx_n_s_IndexError;
 static PyObject *__pyx_kp_s_Indirect_dimensions_not_supporte;
 static PyObject *__pyx_n_s_InputBuilder;
 static PyObject *__pyx_n_s_InputBuilder___call;
 static PyObject *__pyx_n_s_InputBuilder___getattr;
@@ -2817,34 +2833,37 @@
 static PyObject *__pyx_n_s_InputBuilder_numbered;
 static PyObject *__pyx_n_s_InputBuilder_replicas;
 static PyObject *__pyx_n_s_InputBuilder_verbatim;
 static PyObject *__pyx_kp_s_Invalid_mode_expected_c_or_fortr;
 static PyObject *__pyx_kp_s_Invalid_shape_in_axis_d_d;
 static PyObject *__pyx_n_u_L;
 static PyObject *__pyx_n_s_LABEL;
+static PyObject *__pyx_n_s_LeptonError;
 static PyObject *__pyx_n_s_MDAnalysis;
 static PyObject *__pyx_n_u_MDAnalysis;
 static PyObject *__pyx_n_s_MPI;
 static PyObject *__pyx_n_s_MemoryError;
 static PyObject *__pyx_kp_s_MemoryView_of_r_at_0x_x;
 static PyObject *__pyx_kp_s_MemoryView_of_r_object;
 static PyObject *__pyx_kp_u_None;
 static PyObject *__pyx_kp_u_Not_enough_columns;
 static PyObject *__pyx_n_s_Number;
 static PyObject *__pyx_n_b_O;
 static PyObject *__pyx_kp_s_Object_used_to_construct_plumed;
 static PyObject *__pyx_kp_s_Out_of_bounds_on_buffer_access_a;
+static PyObject *__pyx_n_s_OverflowError;
 static PyObject *__pyx_kp_u_PLUMED_2_6_only_supports_Python;
 static PyObject *__pyx_kp_u_PLUMED_Root;
 static PyObject *__pyx_kp_u_PLUMED_instance_is_too_old_conve;
 static PyObject *__pyx_kp_u_PLUMED_instance_seems_to_have_a;
 static PyObject *__pyx_kp_u_PLUMED_not_available_check_your;
 static PyObject *__pyx_n_s_PickleError;
 static PyObject *__pyx_n_s_Plumed;
 static PyObject *__pyx_n_s_PlumedDataFrame;
+static PyObject *__pyx_n_s_PlumedError;
 static PyObject *__pyx_n_s_PlumedSeries;
 static PyObject *__pyx_n_s_Plumed___enter;
 static PyObject *__pyx_n_s_Plumed___exit;
 static PyObject *__pyx_n_s_Plumed___reduce_cython;
 static PyObject *__pyx_n_s_Plumed___setstate_cython;
 static PyObject *__pyx_n_s_Plumed_cmd;
 static PyObject *__pyx_n_s_Plumed_finalize;
@@ -2856,50 +2875,50 @@
 static PyObject *__pyx_n_s_TextFileReader;
 static PyObject *__pyx_n_s_TypeError;
 static PyObject *__pyx_kp_s_Unable_to_convert_item_to_object;
 static PyObject *__pyx_kp_u_Unknown_value_type;
 static PyObject *__pyx_n_s_ValueError;
 static PyObject *__pyx_n_s_View_MemoryView;
 static PyObject *__pyx_kp_u_Writing_dataframes_with_MultiInd;
-static PyObject *__pyx_n_s__2;
-static PyObject *__pyx_kp_u__21;
-static PyObject *__pyx_kp_u__22;
+static PyObject *__pyx_kp_u__23;
 static PyObject *__pyx_kp_u__24;
-static PyObject *__pyx_kp_u__30;
+static PyObject *__pyx_kp_u__26;
 static PyObject *__pyx_kp_u__32;
-static PyObject *__pyx_kp_u__33;
-static PyObject *__pyx_kp_u__34;
+static PyObject *__pyx_kp_u__35;
 static PyObject *__pyx_kp_u__36;
-static PyObject *__pyx_kp_u__38;
+static PyObject *__pyx_kp_u__37;
 static PyObject *__pyx_kp_u__39;
-static PyObject *__pyx_n_u__40;
+static PyObject *__pyx_n_s__4;
 static PyObject *__pyx_kp_u__41;
 static PyObject *__pyx_kp_u__42;
-static PyObject *__pyx_kp_u__43;
+static PyObject *__pyx_n_u__43;
 static PyObject *__pyx_kp_u__44;
 static PyObject *__pyx_kp_u__45;
 static PyObject *__pyx_kp_u__46;
 static PyObject *__pyx_kp_u__47;
-static PyObject *__pyx_n_u__50;
-static PyObject *__pyx_kp_u__51;
-static PyObject *__pyx_kp_u__52;
-static PyObject *__pyx_kp_u__53;
+static PyObject *__pyx_kp_u__48;
+static PyObject *__pyx_kp_u__49;
+static PyObject *__pyx_kp_u__50;
+static PyObject *__pyx_n_u__53;
 static PyObject *__pyx_kp_u__54;
 static PyObject *__pyx_kp_u__55;
 static PyObject *__pyx_kp_u__56;
 static PyObject *__pyx_kp_u__57;
 static PyObject *__pyx_kp_u__58;
 static PyObject *__pyx_kp_u__59;
 static PyObject *__pyx_kp_u__60;
 static PyObject *__pyx_kp_u__61;
-static PyObject *__pyx_kp_u__66;
-static PyObject *__pyx_kp_u__68;
-static PyObject *__pyx_kp_u__74;
-static PyObject *__pyx_kp_u__75;
-static PyObject *__pyx_kp_u__81;
+static PyObject *__pyx_kp_u__62;
+static PyObject *__pyx_kp_u__63;
+static PyObject *__pyx_kp_u__64;
+static PyObject *__pyx_kp_u__69;
+static PyObject *__pyx_kp_u__71;
+static PyObject *__pyx_kp_u__77;
+static PyObject *__pyx_kp_u__78;
+static PyObject *__pyx_kp_u__84;
 static PyObject *__pyx_n_s_a;
 static PyObject *__pyx_n_s_action;
 static PyObject *__pyx_n_s_addressof;
 static PyObject *__pyx_n_u_all;
 static PyObject *__pyx_n_u_allatoms;
 static PyObject *__pyx_n_s_allocate_buffer;
 static PyObject *__pyx_kp_u_allowed;
@@ -2909,14 +2928,15 @@
 static PyObject *__pyx_n_s_append;
 static PyObject *__pyx_n_s_append_underscores;
 static PyObject *__pyx_n_s_append_underscores_2;
 static PyObject *__pyx_n_s_applymap;
 static PyObject *__pyx_n_s_arg;
 static PyObject *__pyx_n_s_args;
 static PyObject *__pyx_n_s_array;
+static PyObject *__pyx_kp_u_arrays_should_be_type_double_siz;
 static PyObject *__pyx_n_s_at;
 static PyObject *__pyx_n_s_at_2;
 static PyObject *__pyx_n_s_at___call;
 static PyObject *__pyx_n_s_at___init;
 static PyObject *__pyx_n_s_at_global;
 static PyObject *__pyx_n_s_at_residue;
 static PyObject *__pyx_n_u_back;
@@ -2930,22 +2950,24 @@
 static PyObject *__pyx_n_s_builtins;
 static PyObject *__pyx_n_u_builtins;
 static PyObject *__pyx_n_s_c;
 static PyObject *__pyx_n_u_c;
 static PyObject *__pyx_n_s_call;
 static PyObject *__pyx_n_s_callme;
 static PyObject *__pyx_kp_u_cannot_load_PLUMED_instance_conv;
+static PyObject *__pyx_kp_u_cannot_use_simultaneously_time_a;
 static PyObject *__pyx_n_s_chain;
 static PyObject *__pyx_n_s_check_output;
 static PyObject *__pyx_n_u_chi;
 static PyObject *__pyx_n_u_chi1;
 static PyObject *__pyx_n_s_chunksize;
 static PyObject *__pyx_n_s_ckey;
 static PyObject *__pyx_n_s_class;
 static PyObject *__pyx_n_s_cline_in_traceback;
+static PyObject *__pyx_n_s_clip;
 static PyObject *__pyx_n_s_cmd;
 static PyObject *__pyx_n_s_columns;
 static PyObject *__pyx_n_u_columns;
 static PyObject *__pyx_n_s_comma;
 static PyObject *__pyx_n_s_comma_separator;
 static PyObject *__pyx_n_s_comment;
 static PyObject *__pyx_n_s_compile;
@@ -2957,17 +2979,17 @@
 static PyObject *__pyx_kp_u_contains_nonmatching_braces;
 static PyObject *__pyx_kp_s_contiguous_and_direct;
 static PyObject *__pyx_kp_s_contiguous_and_indirect;
 static PyObject *__pyx_kp_u_convert;
 static PyObject *__pyx_n_s_convert_2;
 static PyObject *__pyx_n_s_convert_all;
 static PyObject *__pyx_n_s_convert_func;
+static PyObject *__pyx_n_s_copy;
 static PyObject *__pyx_n_s_core;
 static PyObject *__pyx_n_s_create_functions;
-static PyObject *__pyx_n_s_ctypes;
 static PyObject *__pyx_n_s_cval;
 static PyObject *__pyx_n_u_d;
 static PyObject *__pyx_n_s_decode;
 static PyObject *__pyx_kp_u_def;
 static PyObject *__pyx_n_s_delim_whitespace;
 static PyObject *__pyx_n_u_delta;
 static PyObject *__pyx_n_s_df;
@@ -3028,46 +3050,56 @@
 static PyObject *__pyx_n_u_format_return;
 static PyObject *__pyx_n_s_format_single;
 static PyObject *__pyx_n_s_format_tools;
 static PyObject *__pyx_n_s_format_verbatim;
 static PyObject *__pyx_n_u_format_verbatim;
 static PyObject *__pyx_n_s_fortran;
 static PyObject *__pyx_n_u_fortran;
+static PyObject *__pyx_n_s_frac0;
+static PyObject *__pyx_n_s_frac1;
 static PyObject *__pyx_n_s_func;
 static PyObject *__pyx_n_s_functions;
 static PyObject *__pyx_n_s_functions_2;
 static PyObject *__pyx_n_u_gamma;
+static PyObject *__pyx_n_u_getApiVersion;
 static PyObject *__pyx_n_s_getattr;
 static PyObject *__pyx_n_s_getstate;
 static PyObject *__pyx_n_s_go;
 static PyObject *__pyx_kp_s_got_differing_extents_in_dimensi;
 static PyObject *__pyx_n_s_groups;
 static PyObject *__pyx_n_s_guessplumedroot;
 static PyObject *__pyx_kp_u_gz;
 static PyObject *__pyx_n_s_gzip;
 static PyObject *__pyx_n_s_has_dict;
 static PyObject *__pyx_n_s_has_index;
 static PyObject *__pyx_n_s_has_mindex;
 static PyObject *__pyx_n_s_header;
+static PyObject *__pyx_n_s_height;
 static PyObject *__pyx_n_s_help_dir;
+static PyObject *__pyx_n_s_hills;
+static PyObject *__pyx_n_s_hills_time_average;
 static PyObject *__pyx_n_s_history;
+static PyObject *__pyx_n_s_hstack;
 static PyObject *__pyx_n_u_hydrogens;
 static PyObject *__pyx_n_s_i;
 static PyObject *__pyx_n_u_i;
+static PyObject *__pyx_n_s_i0;
+static PyObject *__pyx_n_s_i1;
 static PyObject *__pyx_n_s_id;
 static PyObject *__pyx_kp_u_if_len_x_0;
 static PyObject *__pyx_kp_u_if_not_re_sub_0_9_arg_in_allowe;
 static PyObject *__pyx_n_s_import;
 static PyObject *__pyx_kp_u_import_re;
 static PyObject *__pyx_n_s_index;
 static PyObject *__pyx_n_s_index_col;
 static PyObject *__pyx_n_s_indices;
 static PyObject *__pyx_n_u_info;
 static PyObject *__pyx_n_s_init;
 static PyObject *__pyx_n_u_init_2;
+static PyObject *__pyx_n_s_inplace;
 static PyObject *__pyx_n_s_int;
 static PyObject *__pyx_n_s_intc;
 static PyObject *__pyx_n_u_ions;
 static PyObject *__pyx_n_s_isdigit;
 static PyObject *__pyx_n_s_isnan;
 static PyObject *__pyx_n_s_itemsize;
 static PyObject *__pyx_kp_s_itemsize_0_for_cython_array;
@@ -3088,25 +3120,28 @@
 static PyObject *__pyx_n_u_lcs;
 static PyObject *__pyx_n_s_ldict;
 static PyObject *__pyx_n_u_ldict;
 static PyObject *__pyx_kp_u_let_b;
 static PyObject *__pyx_kp_u_let_b_plumedDictionary;
 static PyObject *__pyx_n_s_level;
 static PyObject *__pyx_n_s_line;
+static PyObject *__pyx_n_s_linspace;
 static PyObject *__pyx_n_s_load_dict;
 static PyObject *__pyx_n_s_log;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_match;
 static PyObject *__pyx_n_s_math;
+static PyObject *__pyx_n_s_max;
 static PyObject *__pyx_n_u_mdatoms;
 static PyObject *__pyx_n_s_memview;
 static PyObject *__pyx_n_u_menu;
 static PyObject *__pyx_n_s_metaclass;
 static PyObject *__pyx_n_u_metadata;
 static PyObject *__pyx_n_s_metadata_2;
+static PyObject *__pyx_n_s_min;
 static PyObject *__pyx_n_s_minimize_braces;
 static PyObject *__pyx_n_s_minimize_braces_2;
 static PyObject *__pyx_n_s_mkstemp;
 static PyObject *__pyx_n_s_mode;
 static PyObject *__pyx_n_s_module;
 static PyObject *__pyx_n_s_modules;
 static PyObject *__pyx_n_u_mpi4py;
@@ -3117,16 +3152,15 @@
 static PyObject *__pyx_n_s_name_2;
 static PyObject *__pyx_n_s_name_3;
 static PyObject *__pyx_n_s_name_4;
 static PyObject *__pyx_n_s_names;
 static PyObject *__pyx_n_u_names;
 static PyObject *__pyx_n_u_nan;
 static PyObject *__pyx_n_s_ndarray;
-static PyObject *__pyx_kp_u_ndarrays_should_be_double_size_8;
-static PyObject *__pyx_kp_u_ndarrys_should_be_np_double_np_i;
+static PyObject *__pyx_kp_u_ndarrays_should_be_type_np_doubl;
 static PyObject *__pyx_n_s_ndim;
 static PyObject *__pyx_n_s_new;
 static PyObject *__pyx_n_s_next;
 static PyObject *__pyx_n_u_no;
 static PyObject *__pyx_kp_s_no_default___reduce___due_to_non;
 static PyObject *__pyx_kp_u_no_mpi;
 static PyObject *__pyx_n_u_nonhydrogens;
@@ -3138,14 +3172,15 @@
 static PyObject *__pyx_n_s_numbered_3;
 static PyObject *__pyx_n_s_numbered___init;
 static PyObject *__pyx_kp_u_numbered_types_should_have_integ;
 static PyObject *__pyx_n_s_numbers;
 static PyObject *__pyx_n_s_numpy;
 static PyObject *__pyx_n_s_obj;
 static PyObject *__pyx_n_u_omega;
+static PyObject *__pyx_n_s_ones;
 static PyObject *__pyx_n_s_open;
 static PyObject *__pyx_n_s_opt;
 static PyObject *__pyx_kp_u_option;
 static PyObject *__pyx_kp_u_option_2;
 static PyObject *__pyx_kp_u_options_cannot_be_a_dictionary;
 static PyObject *__pyx_kp_u_options_should_be_string_number;
 static PyObject *__pyx_n_s_p;
@@ -3243,14 +3278,16 @@
 static PyObject *__pyx_n_u_self;
 static PyObject *__pyx_kp_u_self_2;
 static PyObject *__pyx_kp_u_self_3;
 static PyObject *__pyx_kp_u_self_LABEL_verbatim_None;
 static PyObject *__pyx_kp_u_self_residue_chain_return__form;
 static PyObject *__pyx_n_s_separator;
 static PyObject *__pyx_n_u_setLogFile;
+static PyObject *__pyx_n_u_setNestedExceptions;
+static PyObject *__pyx_n_u_setRealPrecision;
 static PyObject *__pyx_n_s_sets;
 static PyObject *__pyx_n_s_setstate;
 static PyObject *__pyx_n_s_setstate_cython;
 static PyObject *__pyx_n_s_shape;
 static PyObject *__pyx_kp_u_should_be_of_bool_type;
 static PyObject *__pyx_n_s_size;
 static PyObject *__pyx_n_s_skiprows;
@@ -3268,18 +3305,21 @@
 static PyObject *__pyx_n_s_sub;
 static PyObject *__pyx_n_s_subn;
 static PyObject *__pyx_n_s_subprocess;
 static PyObject *__pyx_n_u_sugar;
 static PyObject *__pyx_n_s_syntax_file;
 static PyObject *__pyx_n_s_sys;
 static PyObject *__pyx_n_s_t;
+static PyObject *__pyx_n_s_t0;
+static PyObject *__pyx_n_s_t1;
 static PyObject *__pyx_n_s_tell;
 static PyObject *__pyx_n_s_tempfile;
 static PyObject *__pyx_n_s_test;
 static PyObject *__pyx_n_s_thisdoc;
+static PyObject *__pyx_n_s_time;
 static PyObject *__pyx_n_s_tmp;
 static PyObject *__pyx_n_s_tofile;
 static PyObject *__pyx_n_s_tofile_2;
 static PyObject *__pyx_n_s_toplumed;
 static PyObject *__pyx_n_s_toplumed_2;
 static PyObject *__pyx_n_s_traceback;
 static PyObject *__pyx_kp_u_txt;
@@ -3289,14 +3329,16 @@
 static PyObject *__pyx_n_u_types;
 static PyObject *__pyx_kp_u_types_MethodType_ldict;
 static PyObject *__pyx_kp_s_unable_to_allocate_array_data;
 static PyObject *__pyx_kp_s_unable_to_allocate_shape_and_str;
 static PyObject *__pyx_kp_u_unknown_method;
 static PyObject *__pyx_n_s_unpack;
 static PyObject *__pyx_n_s_update;
+static PyObject *__pyx_n_s_use_index;
+static PyObject *__pyx_n_s_use_time;
 static PyObject *__pyx_n_s_usecols;
 static PyObject *__pyx_kp_u_utf_8;
 static PyObject *__pyx_n_s_v;
 static PyObject *__pyx_n_u_v0;
 static PyObject *__pyx_n_u_v1;
 static PyObject *__pyx_n_u_v2;
 static PyObject *__pyx_n_u_v3;
@@ -3317,54 +3359,58 @@
 static PyObject *__pyx_kp_u_when_calling_numbered_with_1_arg;
 static PyObject *__pyx_kp_u_when_calling_replicas_with_1_arg;
 static PyObject *__pyx_n_u_word;
 static PyObject *__pyx_n_s_write;
 static PyObject *__pyx_n_s_write_pandas;
 static PyObject *__pyx_n_u_wt;
 static PyObject *__pyx_n_s_x;
+static PyObject *__pyx_n_s_zeros;
 static PyObject *__pyx_n_u_zeta;
-static int __pyx_pf_6plumed_6Plumed___cinit__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_kernel); /* proto */
-static PyObject *__pyx_pf_6plumed_6Plumed_2finalize(struct __pyx_obj_6plumed_Plumed *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_6plumed_6Plumed_4__enter__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_6plumed_6Plumed_6__exit__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_type, CYTHON_UNUSED PyObject *__pyx_v_value, CYTHON_UNUSED PyObject *__pyx_v_traceback); /* proto */
-static PyObject *__pyx_pf_6plumed_6Plumed_8cmd(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_key, PyObject *__pyx_v_val); /* proto */
-static PyObject *__pyx_pf_6plumed_6Plumed_10__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_6plumed_Plumed *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_6plumed_6Plumed_12__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_6plumed_Plumed *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
+static int __pyx_pf_6plumed_6Plumed___cinit__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self); /* proto */
+static void __pyx_pf_6plumed_6Plumed_2__dealloc__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self); /* proto */
+static int __pyx_pf_6plumed_6Plumed_4__init__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_kernel); /* proto */
+static PyObject *__pyx_pf_6plumed_6Plumed_6finalize(struct __pyx_obj_6plumed_Plumed *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_6plumed_6Plumed_8__enter__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_6plumed_6Plumed_10__exit__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_type, CYTHON_UNUSED PyObject *__pyx_v_value, CYTHON_UNUSED PyObject *__pyx_v_traceback); /* proto */
+static PyObject *__pyx_pf_6plumed_6Plumed_12cmd(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_key, PyObject *__pyx_v_val); /* proto */
+static PyObject *__pyx_pf_6plumed_6Plumed_14__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_6plumed_Plumed *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_6plumed_6Plumed_16__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_6plumed_Plumed *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
 static PyObject *__pyx_pf_6plumed__fix_file(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_file, PyObject *__pyx_v_mode); /* proto */
 static PyObject *__pyx_pf_6plumed_23_build_convert_function_convert_func(PyObject *__pyx_self, PyObject *__pyx_v_a); /* proto */
 static PyObject *__pyx_pf_6plumed_2_build_convert_function(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_kernel); /* proto */
 static PyObject *__pyx_pf_6plumed_9Constants___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_l, PyObject *__pyx_v_kernel, PyObject *__pyx_v_convert); /* proto */
 static PyObject *__pyx_pf_6plumed_14read_as_pandas_12PlumedSeries__constructor(PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6plumed_14read_as_pandas_12PlumedSeries_2_constructor_expanddim(PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6plumed_14read_as_pandas_15PlumedDataFrame__constructor(PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6plumed_14read_as_pandas_15PlumedDataFrame_2_constructor_sliced(PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6plumed_14read_as_pandas_process_dataframe(PyObject *__pyx_self, PyObject *__pyx_v_df, PyObject *__pyx_v_enable_constants, PyObject *__pyx_v_constants, PyObject *__pyx_v_convert_all); /* proto */
 static PyObject *__pyx_pf_6plumed_14read_as_pandas_14TextFileReader___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_reader, PyObject *__pyx_v_enable_constants, PyObject *__pyx_v_constants, PyObject *__pyx_v_convert_all); /* proto */
 static PyObject *__pyx_pf_6plumed_14read_as_pandas_14TextFileReader_2__next__(PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6plumed_4read_as_pandas(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_file_or_path, PyObject *__pyx_v_enable_constants, PyObject *__pyx_v_enable_conversion, PyObject *__pyx_v_kernel, PyObject *__pyx_v_chunksize, PyObject *__pyx_v_usecols, PyObject *__pyx_v_skiprows, PyObject *__pyx_v_nrows, PyObject *__pyx_v_index_col); /* proto */
 static PyObject *__pyx_pf_6plumed_6write_pandas(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_df, PyObject *__pyx_v_file_or_path); /* proto */
-static PyObject *__pyx_pf_6plumed_8_guessplumedroot(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_kernel); /* proto */
-static PyObject *__pyx_pf_6plumed_10_readvimdict(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_plumedroot, PyObject *__pyx_v_kernel); /* proto */
-static PyObject *__pyx_pf_6plumed_12_create_functions(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_dictionary, PyObject *__pyx_v_doc, PyObject *__pyx_v_append_underscores); /* proto */
+static PyObject *__pyx_pf_6plumed_8hills_time_average(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_hills, PyObject *__pyx_v_tofile, PyObject *__pyx_v_t0, PyObject *__pyx_v_t1, PyObject *__pyx_v_frac0, PyObject *__pyx_v_frac1, PyObject *__pyx_v_inplace); /* proto */
+static PyObject *__pyx_pf_6plumed_10_guessplumedroot(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_kernel); /* proto */
+static PyObject *__pyx_pf_6plumed_12_readvimdict(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_plumedroot, PyObject *__pyx_v_kernel); /* proto */
+static PyObject *__pyx_pf_6plumed_14_create_functions(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_dictionary, PyObject *__pyx_v_doc, PyObject *__pyx_v_append_underscores); /* proto */
 static PyObject *__pyx_pf_6plumed_9_numbered___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_args); /* proto */
 static PyObject *__pyx_pf_6plumed_9_replicas___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_args); /* proto */
-static PyObject *__pyx_pf_6plumed_14_format_at_one_residue(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain); /* proto */
-static PyObject *__pyx_pf_6plumed_16_format_at_one_chain(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain); /* proto */
-static PyObject *__pyx_pf_6plumed_18_format_at(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain); /* proto */
+static PyObject *__pyx_pf_6plumed_16_format_at_one_residue(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain); /* proto */
+static PyObject *__pyx_pf_6plumed_18_format_at_one_chain(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain); /* proto */
+static PyObject *__pyx_pf_6plumed_20_format_at(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain); /* proto */
 static PyObject *__pyx_pf_6plumed_3_at___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_builder); /* proto */
 static PyObject *__pyx_pf_6plumed_3_at_2__call__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain); /* proto */
-static PyObject *__pyx_pf_6plumed_20_fix_braces(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_arg, PyObject *__pyx_v_comma); /* proto */
-static PyObject *__pyx_pf_6plumed_22_format_single(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_arg, PyObject *__pyx_v_level); /* proto */
-static PyObject *__pyx_pf_6plumed_24_format_numbered(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg); /* proto */
-static PyObject *__pyx_pf_6plumed_26_format_flag(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg); /* proto */
-static PyObject *__pyx_pf_6plumed_28_format_label(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_label); /* proto */
-static PyObject *__pyx_pf_6plumed_30_format_opt(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg); /* proto */
-static PyObject *__pyx_pf_6plumed_32_format_return(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_ret); /* proto */
-static PyObject *__pyx_pf_6plumed_34_format_verbatim(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_verbatim); /* proto */
-static PyObject *__pyx_pf_6plumed_36_format_anything(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg); /* proto */
+static PyObject *__pyx_pf_6plumed_22_fix_braces(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_arg, PyObject *__pyx_v_comma); /* proto */
+static PyObject *__pyx_pf_6plumed_24_format_single(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_arg, PyObject *__pyx_v_level); /* proto */
+static PyObject *__pyx_pf_6plumed_26_format_numbered(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg); /* proto */
+static PyObject *__pyx_pf_6plumed_28_format_flag(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg); /* proto */
+static PyObject *__pyx_pf_6plumed_30_format_label(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_label); /* proto */
+static PyObject *__pyx_pf_6plumed_32_format_opt(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg); /* proto */
+static PyObject *__pyx_pf_6plumed_34_format_return(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_ret); /* proto */
+static PyObject *__pyx_pf_6plumed_36_format_verbatim(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_verbatim); /* proto */
+static PyObject *__pyx_pf_6plumed_38_format_anything(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg); /* proto */
 static PyObject *__pyx_pf_6plumed_12InputBuilder___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tofile, PyObject *__pyx_v_toplumed, PyObject *__pyx_v_kernel, PyObject *__pyx_v_append_underscores, PyObject *__pyx_v_comma_separator, PyObject *__pyx_v_minimize_braces, PyObject *__pyx_v_enable_at, PyObject *__pyx_v_load_dict, PyObject *__pyx_v_enable_mda_groups, PyObject *__pyx_v_post_format, PyObject *__pyx_v_pre_format); /* proto */
 static PyObject *__pyx_pf_6plumed_12InputBuilder_2__call__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_action, PyObject *__pyx_v_LABEL, PyObject *__pyx_v_verbatim, PyObject *__pyx_v_kwargs); /* proto */
 static PyObject *__pyx_pf_6plumed_12InputBuilder_11__getattr___7_callme___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name); /* proto */
 static PyObject *__pyx_pf_6plumed_12InputBuilder_11__getattr___7_callme_2__call__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_LABEL, PyObject *__pyx_v_verbatim, PyObject *__pyx_v_kwargs); /* proto */
 static PyObject *__pyx_pf_6plumed_12InputBuilder_11__getattr___7_callme_4__init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name); /* proto */
 static PyObject *__pyx_pf_6plumed_12InputBuilder_11__getattr___7_callme_6__call__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_LABEL, PyObject *__pyx_v_verbatim, PyObject *__pyx_v_kwargs); /* proto */
 static PyObject *__pyx_pf_6plumed_12InputBuilder_4__getattr__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_name); /* proto */
@@ -3416,200 +3462,307 @@
 static PyObject *__pyx_tp_new_6plumed_Plumed(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_6plumed___pyx_scope_struct___build_convert_function(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_6plumed___pyx_scope_struct_1_read_as_pandas(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_array(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_float_0_0;
+static PyObject *__pyx_float_1_0;
 static PyObject *__pyx_int_0;
 static PyObject *__pyx_int_1;
 static PyObject *__pyx_int_2;
 static PyObject *__pyx_int_3;
 static PyObject *__pyx_int_8;
+static PyObject *__pyx_int_10;
 static PyObject *__pyx_int_112105877;
 static PyObject *__pyx_int_136983863;
 static PyObject *__pyx_int_184977713;
 static PyObject *__pyx_int_neg_1;
 static PyObject *__pyx_int_neg_2;
 static PyObject *__pyx_tuple_;
+static PyObject *__pyx_tuple__2;
 static PyObject *__pyx_tuple__3;
-static PyObject *__pyx_tuple__4;
 static PyObject *__pyx_tuple__5;
 static PyObject *__pyx_tuple__6;
 static PyObject *__pyx_tuple__7;
+static PyObject *__pyx_tuple__8;
 static PyObject *__pyx_tuple__9;
-static PyObject *__pyx_slice__23;
-static PyObject *__pyx_slice__82;
-static PyObject *__pyx_slice__97;
-static PyObject *__pyx_tuple__10;
+static PyObject *__pyx_slice__25;
+static PyObject *__pyx_slice__85;
+static PyObject *__pyx_tuple__11;
 static PyObject *__pyx_tuple__12;
 static PyObject *__pyx_tuple__14;
 static PyObject *__pyx_tuple__16;
 static PyObject *__pyx_tuple__18;
 static PyObject *__pyx_tuple__20;
-static PyObject *__pyx_tuple__25;
+static PyObject *__pyx_tuple__22;
 static PyObject *__pyx_tuple__27;
 static PyObject *__pyx_tuple__29;
 static PyObject *__pyx_tuple__31;
-static PyObject *__pyx_tuple__35;
-static PyObject *__pyx_tuple__37;
-static PyObject *__pyx_tuple__48;
-static PyObject *__pyx_tuple__49;
-static PyObject *__pyx_tuple__62;
-static PyObject *__pyx_tuple__63;
-static PyObject *__pyx_tuple__64;
+static PyObject *__pyx_tuple__33;
+static PyObject *__pyx_tuple__34;
+static PyObject *__pyx_tuple__38;
+static PyObject *__pyx_tuple__40;
+static PyObject *__pyx_tuple__51;
+static PyObject *__pyx_tuple__52;
 static PyObject *__pyx_tuple__65;
+static PyObject *__pyx_tuple__66;
 static PyObject *__pyx_tuple__67;
-static PyObject *__pyx_tuple__69;
-static PyObject *__pyx_tuple__71;
-static PyObject *__pyx_tuple__73;
+static PyObject *__pyx_tuple__68;
+static PyObject *__pyx_tuple__70;
+static PyObject *__pyx_tuple__72;
+static PyObject *__pyx_tuple__74;
 static PyObject *__pyx_tuple__76;
-static PyObject *__pyx_tuple__78;
-static PyObject *__pyx_tuple__80;
+static PyObject *__pyx_tuple__79;
+static PyObject *__pyx_tuple__81;
 static PyObject *__pyx_tuple__83;
-static PyObject *__pyx_tuple__84;
-static PyObject *__pyx_tuple__85;
 static PyObject *__pyx_tuple__86;
 static PyObject *__pyx_tuple__87;
 static PyObject *__pyx_tuple__88;
 static PyObject *__pyx_tuple__89;
 static PyObject *__pyx_tuple__90;
 static PyObject *__pyx_tuple__91;
 static PyObject *__pyx_tuple__92;
 static PyObject *__pyx_tuple__93;
 static PyObject *__pyx_tuple__94;
 static PyObject *__pyx_tuple__95;
 static PyObject *__pyx_tuple__96;
+static PyObject *__pyx_tuple__97;
 static PyObject *__pyx_tuple__98;
 static PyObject *__pyx_tuple__99;
-static PyObject *__pyx_codeobj__8;
-static PyObject *__pyx_tuple__100;
+static PyObject *__pyx_slice__100;
 static PyObject *__pyx_tuple__101;
 static PyObject *__pyx_tuple__102;
 static PyObject *__pyx_tuple__103;
 static PyObject *__pyx_tuple__104;
+static PyObject *__pyx_tuple__105;
 static PyObject *__pyx_tuple__106;
+static PyObject *__pyx_tuple__107;
 static PyObject *__pyx_tuple__108;
-static PyObject *__pyx_tuple__110;
-static PyObject *__pyx_tuple__112;
-static PyObject *__pyx_tuple__114;
-static PyObject *__pyx_tuple__116;
-static PyObject *__pyx_tuple__118;
-static PyObject *__pyx_tuple__120;
+static PyObject *__pyx_tuple__109;
+static PyObject *__pyx_tuple__111;
+static PyObject *__pyx_tuple__113;
+static PyObject *__pyx_tuple__115;
+static PyObject *__pyx_tuple__117;
+static PyObject *__pyx_tuple__119;
 static PyObject *__pyx_tuple__121;
 static PyObject *__pyx_tuple__123;
-static PyObject *__pyx_tuple__124;
+static PyObject *__pyx_tuple__125;
 static PyObject *__pyx_tuple__126;
-static PyObject *__pyx_tuple__127;
+static PyObject *__pyx_tuple__128;
 static PyObject *__pyx_tuple__129;
-static PyObject *__pyx_tuple__130;
+static PyObject *__pyx_tuple__131;
 static PyObject *__pyx_tuple__132;
-static PyObject *__pyx_tuple__133;
+static PyObject *__pyx_tuple__134;
 static PyObject *__pyx_tuple__135;
-static PyObject *__pyx_tuple__136;
+static PyObject *__pyx_tuple__137;
 static PyObject *__pyx_tuple__138;
 static PyObject *__pyx_tuple__140;
-static PyObject *__pyx_tuple__142;
+static PyObject *__pyx_tuple__141;
+static PyObject *__pyx_tuple__143;
 static PyObject *__pyx_tuple__144;
 static PyObject *__pyx_tuple__146;
 static PyObject *__pyx_tuple__148;
-static PyObject *__pyx_tuple__149;
-static PyObject *__pyx_tuple__151;
-static PyObject *__pyx_tuple__153;
+static PyObject *__pyx_tuple__150;
+static PyObject *__pyx_tuple__152;
 static PyObject *__pyx_tuple__154;
 static PyObject *__pyx_tuple__156;
-static PyObject *__pyx_tuple__158;
+static PyObject *__pyx_tuple__157;
 static PyObject *__pyx_tuple__159;
 static PyObject *__pyx_tuple__161;
-static PyObject *__pyx_tuple__163;
-static PyObject *__pyx_tuple__165;
+static PyObject *__pyx_tuple__162;
+static PyObject *__pyx_tuple__164;
+static PyObject *__pyx_tuple__166;
 static PyObject *__pyx_tuple__167;
 static PyObject *__pyx_tuple__169;
 static PyObject *__pyx_tuple__171;
 static PyObject *__pyx_tuple__173;
 static PyObject *__pyx_tuple__175;
 static PyObject *__pyx_tuple__177;
-static PyObject *__pyx_tuple__178;
-static PyObject *__pyx_tuple__180;
-static PyObject *__pyx_tuple__182;
-static PyObject *__pyx_tuple__184;
+static PyObject *__pyx_tuple__179;
+static PyObject *__pyx_tuple__181;
+static PyObject *__pyx_tuple__183;
+static PyObject *__pyx_tuple__185;
 static PyObject *__pyx_tuple__186;
-static PyObject *__pyx_tuple__187;
 static PyObject *__pyx_tuple__188;
-static PyObject *__pyx_tuple__189;
 static PyObject *__pyx_tuple__190;
-static PyObject *__pyx_tuple__191;
-static PyObject *__pyx_codeobj__11;
+static PyObject *__pyx_tuple__192;
+static PyObject *__pyx_tuple__194;
+static PyObject *__pyx_tuple__195;
+static PyObject *__pyx_tuple__196;
+static PyObject *__pyx_tuple__197;
+static PyObject *__pyx_tuple__198;
+static PyObject *__pyx_tuple__199;
+static PyObject *__pyx_codeobj__10;
 static PyObject *__pyx_codeobj__13;
 static PyObject *__pyx_codeobj__15;
 static PyObject *__pyx_codeobj__17;
 static PyObject *__pyx_codeobj__19;
-static PyObject *__pyx_codeobj__26;
+static PyObject *__pyx_codeobj__21;
 static PyObject *__pyx_codeobj__28;
-static PyObject *__pyx_codeobj__70;
-static PyObject *__pyx_codeobj__72;
-static PyObject *__pyx_codeobj__77;
-static PyObject *__pyx_codeobj__79;
-static PyObject *__pyx_codeobj__105;
-static PyObject *__pyx_codeobj__107;
-static PyObject *__pyx_codeobj__109;
-static PyObject *__pyx_codeobj__111;
-static PyObject *__pyx_codeobj__113;
-static PyObject *__pyx_codeobj__115;
-static PyObject *__pyx_codeobj__117;
-static PyObject *__pyx_codeobj__119;
+static PyObject *__pyx_codeobj__30;
+static PyObject *__pyx_codeobj__73;
+static PyObject *__pyx_codeobj__75;
+static PyObject *__pyx_codeobj__80;
+static PyObject *__pyx_codeobj__82;
+static PyObject *__pyx_codeobj__110;
+static PyObject *__pyx_codeobj__112;
+static PyObject *__pyx_codeobj__114;
+static PyObject *__pyx_codeobj__116;
+static PyObject *__pyx_codeobj__118;
+static PyObject *__pyx_codeobj__120;
 static PyObject *__pyx_codeobj__122;
-static PyObject *__pyx_codeobj__125;
-static PyObject *__pyx_codeobj__128;
-static PyObject *__pyx_codeobj__131;
-static PyObject *__pyx_codeobj__134;
-static PyObject *__pyx_codeobj__137;
+static PyObject *__pyx_codeobj__124;
+static PyObject *__pyx_codeobj__127;
+static PyObject *__pyx_codeobj__130;
+static PyObject *__pyx_codeobj__133;
+static PyObject *__pyx_codeobj__136;
 static PyObject *__pyx_codeobj__139;
-static PyObject *__pyx_codeobj__141;
-static PyObject *__pyx_codeobj__143;
+static PyObject *__pyx_codeobj__142;
 static PyObject *__pyx_codeobj__145;
 static PyObject *__pyx_codeobj__147;
-static PyObject *__pyx_codeobj__150;
-static PyObject *__pyx_codeobj__152;
+static PyObject *__pyx_codeobj__149;
+static PyObject *__pyx_codeobj__151;
+static PyObject *__pyx_codeobj__153;
 static PyObject *__pyx_codeobj__155;
-static PyObject *__pyx_codeobj__157;
+static PyObject *__pyx_codeobj__158;
 static PyObject *__pyx_codeobj__160;
-static PyObject *__pyx_codeobj__162;
-static PyObject *__pyx_codeobj__164;
-static PyObject *__pyx_codeobj__166;
+static PyObject *__pyx_codeobj__163;
+static PyObject *__pyx_codeobj__165;
 static PyObject *__pyx_codeobj__168;
 static PyObject *__pyx_codeobj__170;
 static PyObject *__pyx_codeobj__172;
 static PyObject *__pyx_codeobj__174;
 static PyObject *__pyx_codeobj__176;
-static PyObject *__pyx_codeobj__179;
-static PyObject *__pyx_codeobj__181;
-static PyObject *__pyx_codeobj__183;
-static PyObject *__pyx_codeobj__185;
-static PyObject *__pyx_codeobj__192;
+static PyObject *__pyx_codeobj__178;
+static PyObject *__pyx_codeobj__180;
+static PyObject *__pyx_codeobj__182;
+static PyObject *__pyx_codeobj__184;
+static PyObject *__pyx_codeobj__187;
+static PyObject *__pyx_codeobj__189;
+static PyObject *__pyx_codeobj__191;
+static PyObject *__pyx_codeobj__193;
+static PyObject *__pyx_codeobj__200;
 /* Late includes */
 
-/* "plumed.pyx":52
- * cdef class Plumed:
- *      cdef cplumed.Plumed c_plumed
- *      def __cinit__(self,kernel=None):             # <<<<<<<<<<<<<<
- *          cdef bytes py_kernel
- *          cdef char* ckernel
+/* "plumed.pyx":71
+ *      cdef cplumed.plumed c_plumed
+ *      cdef int initialized
+ *      def __cinit__(self):             # <<<<<<<<<<<<<<
+ *          # this is guaranteed to be called once
+ *          # we use it to make sure c_plumed is initialized correctly
  */
 
 /* Python wrapper */
 static int __pyx_pw_6plumed_6Plumed_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static int __pyx_pw_6plumed_6Plumed_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__cinit__ (wrapper)", 0);
+  if (unlikely(PyTuple_GET_SIZE(__pyx_args) > 0)) {
+    __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 0, 0, PyTuple_GET_SIZE(__pyx_args)); return -1;}
+  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__cinit__", 0))) return -1;
+  __pyx_r = __pyx_pf_6plumed_6Plumed___cinit__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static int __pyx_pf_6plumed_6Plumed___cinit__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__cinit__", 0);
+
+  /* "plumed.pyx":75
+ *          # we use it to make sure c_plumed is initialized correctly
+ *          # in all other places we always finalize before resetting
+ *          self.c_plumed=cplumed.plumed_create_invalid()             # <<<<<<<<<<<<<<
+ *      def __dealloc__(self):
+ *          # this is guaranteed to be called once
+ */
+  __pyx_v_self->c_plumed = plumed_create_invalid();
+
+  /* "plumed.pyx":71
+ *      cdef cplumed.plumed c_plumed
+ *      cdef int initialized
+ *      def __cinit__(self):             # <<<<<<<<<<<<<<
+ *          # this is guaranteed to be called once
+ *          # we use it to make sure c_plumed is initialized correctly
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "plumed.pyx":76
+ *          # in all other places we always finalize before resetting
+ *          self.c_plumed=cplumed.plumed_create_invalid()
+ *      def __dealloc__(self):             # <<<<<<<<<<<<<<
+ *          # this is guaranteed to be called once
+ *          # we use it to make sure c_plumed is finalized correctly
+ */
+
+/* Python wrapper */
+static void __pyx_pw_6plumed_6Plumed_3__dealloc__(PyObject *__pyx_v_self); /*proto*/
+static void __pyx_pw_6plumed_6Plumed_3__dealloc__(PyObject *__pyx_v_self) {
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
+  __pyx_pf_6plumed_6Plumed_2__dealloc__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+}
+
+static void __pyx_pf_6plumed_6Plumed_2__dealloc__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self) {
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__dealloc__", 0);
+
+  /* "plumed.pyx":79
+ *          # this is guaranteed to be called once
+ *          # we use it to make sure c_plumed is finalized correctly
+ *         cplumed.plumed_finalize(self.c_plumed)             # <<<<<<<<<<<<<<
+ *      def __init__(self,kernel=None):
+ *          cdef bytes py_kernel
+ */
+  plumed_finalize(__pyx_v_self->c_plumed);
+
+  /* "plumed.pyx":76
+ *          # in all other places we always finalize before resetting
+ *          self.c_plumed=cplumed.plumed_create_invalid()
+ *      def __dealloc__(self):             # <<<<<<<<<<<<<<
+ *          # this is guaranteed to be called once
+ *          # we use it to make sure c_plumed is finalized correctly
+ */
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+}
+
+/* "plumed.pyx":80
+ *          # we use it to make sure c_plumed is finalized correctly
+ *         cplumed.plumed_finalize(self.c_plumed)
+ *      def __init__(self,kernel=None):             # <<<<<<<<<<<<<<
+ *          cdef bytes py_kernel
+ *          cdef char* ckernel
+ */
+
+/* Python wrapper */
+static int __pyx_pw_6plumed_6Plumed_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pw_6plumed_6Plumed_5__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_kernel = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("__cinit__ (wrapper)", 0);
+  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_kernel,0};
     PyObject* values[1] = {0};
     values[0] = ((PyObject *)Py_None);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
@@ -3624,414 +3777,558 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kernel);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 52, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 80, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_kernel = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 52, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 80, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("plumed.Plumed.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("plumed.Plumed.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_6Plumed___cinit__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self), __pyx_v_kernel);
+  __pyx_r = __pyx_pf_6plumed_6Plumed_4__init__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self), __pyx_v_kernel);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_6plumed_6Plumed___cinit__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_kernel) {
+static int __pyx_pf_6plumed_6Plumed_4__init__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_kernel) {
   PyObject *__pyx_v_py_kernel = 0;
   char *__pyx_v_ckernel;
-  int __pyx_v_pres;
+  PyObject *__pyx_v_api = NULL;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
-  PLMD::Plumed __pyx_t_3;
-  bool __pyx_t_4;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
+  char *__pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
-  char *__pyx_t_8;
+  int __pyx_t_8;
+  PyObject *__pyx_t_9 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__cinit__", 0);
+  __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "plumed.pyx":55
+  /* "plumed.pyx":83
  *          cdef bytes py_kernel
  *          cdef char* ckernel
  *          if kernel is None:             # <<<<<<<<<<<<<<
- *             self.c_plumed=cplumed.Plumed.makeValid()
- *             if not self.c_plumed.valid():
+ *             cplumed.plumed_finalize(self.c_plumed)
+ *             self.c_plumed=cplumed.plumed_create()
  */
   __pyx_t_1 = (__pyx_v_kernel == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":56
+    /* "plumed.pyx":84
  *          cdef char* ckernel
  *          if kernel is None:
- *             self.c_plumed=cplumed.Plumed.makeValid()             # <<<<<<<<<<<<<<
- *             if not self.c_plumed.valid():
- *                  raise RuntimeError("PLUMED not available, check your PLUMED_KERNEL environment variable")
+ *             cplumed.plumed_finalize(self.c_plumed)             # <<<<<<<<<<<<<<
+ *             self.c_plumed=cplumed.plumed_create()
+ *             if not cplumed.plumed_valid(self.c_plumed):
  */
-    try {
-      __pyx_t_3 = PLMD::Plumed::makeValid();
-    } catch(...) {
-      exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-      __PYX_ERR(0, 56, __pyx_L1_error)
-    }
-    __pyx_v_self->c_plumed = __pyx_t_3;
+    plumed_finalize(__pyx_v_self->c_plumed);
 
-    /* "plumed.pyx":57
+    /* "plumed.pyx":85
  *          if kernel is None:
- *             self.c_plumed=cplumed.Plumed.makeValid()
- *             if not self.c_plumed.valid():             # <<<<<<<<<<<<<<
+ *             cplumed.plumed_finalize(self.c_plumed)
+ *             self.c_plumed=cplumed.plumed_create()             # <<<<<<<<<<<<<<
+ *             if not cplumed.plumed_valid(self.c_plumed):
+ *                  raise RuntimeError("PLUMED not available, check your PLUMED_KERNEL environment variable")
+ */
+    __pyx_v_self->c_plumed = plumed_create();
+
+    /* "plumed.pyx":86
+ *             cplumed.plumed_finalize(self.c_plumed)
+ *             self.c_plumed=cplumed.plumed_create()
+ *             if not cplumed.plumed_valid(self.c_plumed):             # <<<<<<<<<<<<<<
  *                  raise RuntimeError("PLUMED not available, check your PLUMED_KERNEL environment variable")
  *          else:
  */
-    try {
-      __pyx_t_4 = __pyx_v_self->c_plumed.valid();
-    } catch(...) {
-      exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-      __PYX_ERR(0, 57, __pyx_L1_error)
-    }
-    __pyx_t_2 = ((!(__pyx_t_4 != 0)) != 0);
+    __pyx_t_2 = ((!(plumed_valid(__pyx_v_self->c_plumed) != 0)) != 0);
     if (unlikely(__pyx_t_2)) {
 
-      /* "plumed.pyx":58
- *             self.c_plumed=cplumed.Plumed.makeValid()
- *             if not self.c_plumed.valid():
+      /* "plumed.pyx":87
+ *             self.c_plumed=cplumed.plumed_create()
+ *             if not cplumed.plumed_valid(self.c_plumed):
  *                  raise RuntimeError("PLUMED not available, check your PLUMED_KERNEL environment variable")             # <<<<<<<<<<<<<<
  *          else:
  *             py_kernel= kernel.encode()
  */
-      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 58, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_Raise(__pyx_t_5, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __PYX_ERR(0, 58, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 87, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_Raise(__pyx_t_3, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __PYX_ERR(0, 87, __pyx_L1_error)
 
-      /* "plumed.pyx":57
- *          if kernel is None:
- *             self.c_plumed=cplumed.Plumed.makeValid()
- *             if not self.c_plumed.valid():             # <<<<<<<<<<<<<<
+      /* "plumed.pyx":86
+ *             cplumed.plumed_finalize(self.c_plumed)
+ *             self.c_plumed=cplumed.plumed_create()
+ *             if not cplumed.plumed_valid(self.c_plumed):             # <<<<<<<<<<<<<<
  *                  raise RuntimeError("PLUMED not available, check your PLUMED_KERNEL environment variable")
  *          else:
  */
     }
 
-    /* "plumed.pyx":55
+    /* "plumed.pyx":83
  *          cdef bytes py_kernel
  *          cdef char* ckernel
  *          if kernel is None:             # <<<<<<<<<<<<<<
- *             self.c_plumed=cplumed.Plumed.makeValid()
- *             if not self.c_plumed.valid():
+ *             cplumed.plumed_finalize(self.c_plumed)
+ *             self.c_plumed=cplumed.plumed_create()
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":60
+  /* "plumed.pyx":89
  *                  raise RuntimeError("PLUMED not available, check your PLUMED_KERNEL environment variable")
  *          else:
  *             py_kernel= kernel.encode()             # <<<<<<<<<<<<<<
  *             ckernel = py_kernel
- *             self.c_plumed=cplumed.Plumed.dlopen(ckernel)
+ *             cplumed.plumed_finalize(self.c_plumed)
  */
   /*else*/ {
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_kernel, __pyx_n_s_encode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 60, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_7 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
-      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
-      if (likely(__pyx_t_7)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
-        __Pyx_INCREF(__pyx_t_7);
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_kernel, __pyx_n_s_encode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 89, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = NULL;
+    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+        __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_6, function);
+        __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
-    __pyx_t_5 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
-    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 60, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (!(likely(PyBytes_CheckExact(__pyx_t_5))||((__pyx_t_5) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_5)->tp_name), 0))) __PYX_ERR(0, 60, __pyx_L1_error)
-    __pyx_v_py_kernel = ((PyObject*)__pyx_t_5);
-    __pyx_t_5 = 0;
+    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 89, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 89, __pyx_L1_error)
+    __pyx_v_py_kernel = ((PyObject*)__pyx_t_3);
+    __pyx_t_3 = 0;
 
-    /* "plumed.pyx":61
+    /* "plumed.pyx":90
  *          else:
  *             py_kernel= kernel.encode()
  *             ckernel = py_kernel             # <<<<<<<<<<<<<<
- *             self.c_plumed=cplumed.Plumed.dlopen(ckernel)
- *             if not self.c_plumed.valid():
+ *             cplumed.plumed_finalize(self.c_plumed)
+ *             self.c_plumed=cplumed.plumed_create_dlopen(ckernel)
  */
     if (unlikely(__pyx_v_py_kernel == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-      __PYX_ERR(0, 61, __pyx_L1_error)
+      __PYX_ERR(0, 90, __pyx_L1_error)
     }
-    __pyx_t_8 = __Pyx_PyBytes_AsWritableString(__pyx_v_py_kernel); if (unlikely((!__pyx_t_8) && PyErr_Occurred())) __PYX_ERR(0, 61, __pyx_L1_error)
-    __pyx_v_ckernel = __pyx_t_8;
+    __pyx_t_6 = __Pyx_PyBytes_AsWritableString(__pyx_v_py_kernel); if (unlikely((!__pyx_t_6) && PyErr_Occurred())) __PYX_ERR(0, 90, __pyx_L1_error)
+    __pyx_v_ckernel = __pyx_t_6;
 
-    /* "plumed.pyx":62
+    /* "plumed.pyx":91
  *             py_kernel= kernel.encode()
  *             ckernel = py_kernel
- *             self.c_plumed=cplumed.Plumed.dlopen(ckernel)             # <<<<<<<<<<<<<<
- *             if not self.c_plumed.valid():
- *                  raise RuntimeError("Error loading PLUMED kernel at path " + kernel)
+ *             cplumed.plumed_finalize(self.c_plumed)             # <<<<<<<<<<<<<<
+ *             self.c_plumed=cplumed.plumed_create_dlopen(ckernel)
+ *             if not cplumed.plumed_valid(self.c_plumed):
  */
-    try {
-      __pyx_t_3 = PLMD::Plumed::dlopen(__pyx_v_ckernel);
-    } catch(...) {
-      exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-      __PYX_ERR(0, 62, __pyx_L1_error)
-    }
-    __pyx_v_self->c_plumed = __pyx_t_3;
+    plumed_finalize(__pyx_v_self->c_plumed);
 
-    /* "plumed.pyx":63
+    /* "plumed.pyx":92
  *             ckernel = py_kernel
- *             self.c_plumed=cplumed.Plumed.dlopen(ckernel)
- *             if not self.c_plumed.valid():             # <<<<<<<<<<<<<<
+ *             cplumed.plumed_finalize(self.c_plumed)
+ *             self.c_plumed=cplumed.plumed_create_dlopen(ckernel)             # <<<<<<<<<<<<<<
+ *             if not cplumed.plumed_valid(self.c_plumed):
  *                  raise RuntimeError("Error loading PLUMED kernel at path " + kernel)
- *          cdef int pres = 8
  */
-    try {
-      __pyx_t_4 = __pyx_v_self->c_plumed.valid();
-    } catch(...) {
-      exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-      __PYX_ERR(0, 63, __pyx_L1_error)
-    }
-    __pyx_t_2 = ((!(__pyx_t_4 != 0)) != 0);
+    __pyx_v_self->c_plumed = plumed_create_dlopen(__pyx_v_ckernel);
+
+    /* "plumed.pyx":93
+ *             cplumed.plumed_finalize(self.c_plumed)
+ *             self.c_plumed=cplumed.plumed_create_dlopen(ckernel)
+ *             if not cplumed.plumed_valid(self.c_plumed):             # <<<<<<<<<<<<<<
+ *                  raise RuntimeError("Error loading PLUMED kernel at path " + kernel)
+ *          api=array.array('i',[0])
+ */
+    __pyx_t_2 = ((!(plumed_valid(__pyx_v_self->c_plumed) != 0)) != 0);
     if (unlikely(__pyx_t_2)) {
 
-      /* "plumed.pyx":64
- *             self.c_plumed=cplumed.Plumed.dlopen(ckernel)
- *             if not self.c_plumed.valid():
+      /* "plumed.pyx":94
+ *             self.c_plumed=cplumed.plumed_create_dlopen(ckernel)
+ *             if not cplumed.plumed_valid(self.c_plumed):
  *                  raise RuntimeError("Error loading PLUMED kernel at path " + kernel)             # <<<<<<<<<<<<<<
- *          cdef int pres = 8
- *          self.c_plumed.cmd_int( "setRealPrecision", pres)
+ *          api=array.array('i',[0])
+ *          self.cmd( "getApiVersion", api)
  */
-      __pyx_t_5 = PyNumber_Add(__pyx_kp_u_Error_loading_PLUMED_kernel_at_p, __pyx_v_kernel); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 64, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_RuntimeError, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 64, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __Pyx_Raise(__pyx_t_6, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __PYX_ERR(0, 64, __pyx_L1_error)
+      __pyx_t_3 = PyNumber_Add(__pyx_kp_u_Error_loading_PLUMED_kernel_at_p, __pyx_v_kernel); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 94, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_RuntimeError, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 94, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_Raise(__pyx_t_4, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __PYX_ERR(0, 94, __pyx_L1_error)
 
-      /* "plumed.pyx":63
- *             ckernel = py_kernel
- *             self.c_plumed=cplumed.Plumed.dlopen(ckernel)
- *             if not self.c_plumed.valid():             # <<<<<<<<<<<<<<
+      /* "plumed.pyx":93
+ *             cplumed.plumed_finalize(self.c_plumed)
+ *             self.c_plumed=cplumed.plumed_create_dlopen(ckernel)
+ *             if not cplumed.plumed_valid(self.c_plumed):             # <<<<<<<<<<<<<<
  *                  raise RuntimeError("Error loading PLUMED kernel at path " + kernel)
- *          cdef int pres = 8
+ *          api=array.array('i',[0])
  */
     }
   }
   __pyx_L3:;
 
-  /* "plumed.pyx":65
- *             if not self.c_plumed.valid():
+  /* "plumed.pyx":95
+ *             if not cplumed.plumed_valid(self.c_plumed):
  *                  raise RuntimeError("Error loading PLUMED kernel at path " + kernel)
- *          cdef int pres = 8             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd_int( "setRealPrecision", pres)
- *      def finalize(self):
+ *          api=array.array('i',[0])             # <<<<<<<<<<<<<<
+ *          self.cmd( "getApiVersion", api)
+ *          if(api[0]>=10):
  */
-  __pyx_v_pres = 8;
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(__pyx_int_0);
+  __Pyx_GIVEREF(__pyx_int_0);
+  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_int_0);
+  __pyx_t_7 = NULL;
+  __pyx_t_8 = 0;
+  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
+    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
+    if (likely(__pyx_t_7)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
+      __Pyx_INCREF(__pyx_t_7);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_5, function);
+      __pyx_t_8 = 1;
+    }
+  }
+  #if CYTHON_FAST_PYCALL
+  if (PyFunction_Check(__pyx_t_5)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_n_u_i, __pyx_t_3};
+    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 95, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  } else
+  #endif
+  #if CYTHON_FAST_PYCCALL
+  if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_n_u_i, __pyx_t_3};
+    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 95, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  } else
+  #endif
+  {
+    __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 95, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_9);
+    if (__pyx_t_7) {
+      __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
+    }
+    __Pyx_INCREF(__pyx_n_u_i);
+    __Pyx_GIVEREF(__pyx_n_u_i);
+    PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_n_u_i);
+    __Pyx_GIVEREF(__pyx_t_3);
+    PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_3);
+    __pyx_t_3 = 0;
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 95, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+  }
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_v_api = __pyx_t_4;
+  __pyx_t_4 = 0;
 
-  /* "plumed.pyx":66
+  /* "plumed.pyx":96
  *                  raise RuntimeError("Error loading PLUMED kernel at path " + kernel)
- *          cdef int pres = 8
- *          self.c_plumed.cmd_int( "setRealPrecision", pres)             # <<<<<<<<<<<<<<
+ *          api=array.array('i',[0])
+ *          self.cmd( "getApiVersion", api)             # <<<<<<<<<<<<<<
+ *          if(api[0]>=10):
+ *            self.cmd("setNestedExceptions",1)
+ */
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_cmd); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 96, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_9 = NULL;
+  __pyx_t_8 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
+    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_5);
+    if (likely(__pyx_t_9)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
+      __Pyx_INCREF(__pyx_t_9);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_5, function);
+      __pyx_t_8 = 1;
+    }
+  }
+  #if CYTHON_FAST_PYCALL
+  if (PyFunction_Check(__pyx_t_5)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_n_u_getApiVersion, __pyx_v_api};
+    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
+    __Pyx_GOTREF(__pyx_t_4);
+  } else
+  #endif
+  #if CYTHON_FAST_PYCCALL
+  if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
+    PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_n_u_getApiVersion, __pyx_v_api};
+    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
+    __Pyx_GOTREF(__pyx_t_4);
+  } else
+  #endif
+  {
+    __pyx_t_3 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    if (__pyx_t_9) {
+      __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_9); __pyx_t_9 = NULL;
+    }
+    __Pyx_INCREF(__pyx_n_u_getApiVersion);
+    __Pyx_GIVEREF(__pyx_n_u_getApiVersion);
+    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_8, __pyx_n_u_getApiVersion);
+    __Pyx_INCREF(__pyx_v_api);
+    __Pyx_GIVEREF(__pyx_v_api);
+    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_8, __pyx_v_api);
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  }
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+  /* "plumed.pyx":97
+ *          api=array.array('i',[0])
+ *          self.cmd( "getApiVersion", api)
+ *          if(api[0]>=10):             # <<<<<<<<<<<<<<
+ *            self.cmd("setNestedExceptions",1)
+ *          self.cmd( "setRealPrecision", 8)
+ */
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_api, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_int_10, Py_GE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  if (__pyx_t_2) {
+
+    /* "plumed.pyx":98
+ *          self.cmd( "getApiVersion", api)
+ *          if(api[0]>=10):
+ *            self.cmd("setNestedExceptions",1)             # <<<<<<<<<<<<<<
+ *          self.cmd( "setRealPrecision", 8)
  *      def finalize(self):
- *          """ Explicitly finalize a Plumed object.
  */
-  try {
-    __pyx_v_self->c_plumed.cmd(((char const *)"setRealPrecision"), __pyx_v_pres);
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_cmd); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "plumed.pyx":97
+ *          api=array.array('i',[0])
+ *          self.cmd( "getApiVersion", api)
+ *          if(api[0]>=10):             # <<<<<<<<<<<<<<
+ *            self.cmd("setNestedExceptions",1)
+ *          self.cmd( "setRealPrecision", 8)
+ */
   }
 
-  /* "plumed.pyx":52
- * cdef class Plumed:
- *      cdef cplumed.Plumed c_plumed
- *      def __cinit__(self,kernel=None):             # <<<<<<<<<<<<<<
+  /* "plumed.pyx":99
+ *          if(api[0]>=10):
+ *            self.cmd("setNestedExceptions",1)
+ *          self.cmd( "setRealPrecision", 8)             # <<<<<<<<<<<<<<
+ *      def finalize(self):
+ *          """ Explicitly finalize a Plumed object.
+ */
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_cmd); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "plumed.pyx":80
+ *          # we use it to make sure c_plumed is finalized correctly
+ *         cplumed.plumed_finalize(self.c_plumed)
+ *      def __init__(self,kernel=None):             # <<<<<<<<<<<<<<
  *          cdef bytes py_kernel
  *          cdef char* ckernel
  */
 
   /* function exit code */
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_AddTraceback("plumed.Plumed.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_9);
+  __Pyx_AddTraceback("plumed.Plumed.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_py_kernel);
+  __Pyx_XDECREF(__pyx_v_api);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":67
- *          cdef int pres = 8
- *          self.c_plumed.cmd_int( "setRealPrecision", pres)
+/* "plumed.pyx":100
+ *            self.cmd("setNestedExceptions",1)
+ *          self.cmd( "setRealPrecision", 8)
  *      def finalize(self):             # <<<<<<<<<<<<<<
  *          """ Explicitly finalize a Plumed object.
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_6Plumed_3finalize(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static char __pyx_doc_6plumed_6Plumed_2finalize[] = " Explicitly finalize a Plumed object.\n\n             Can be used in cases where one wants to make sure the Plumed object is finalized\n             (so that all output files are flushed and all calculations are finalized) but there is\n             a dangling reference to that Plumed object. Notice that after this call the self object\n             will be invalid so that using cmd will raise an exception.\n\n             It is also called by __exit__ in order to allow the following usage:\n             ````\n             with plumed.Plumed() as p:\n                 p.cmd(\"init\")\n                 # ETC\n\n             # p object will be finalized when exiting from this context\n             ````\n         ";
-static PyMethodDef __pyx_mdef_6plumed_6Plumed_3finalize = {"finalize", (PyCFunction)__pyx_pw_6plumed_6Plumed_3finalize, METH_NOARGS, __pyx_doc_6plumed_6Plumed_2finalize};
-static PyObject *__pyx_pw_6plumed_6Plumed_3finalize(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_6plumed_6Plumed_7finalize(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static char __pyx_doc_6plumed_6Plumed_6finalize[] = " Explicitly finalize a Plumed object.\n\n             Can be used in cases where one wants to make sure the Plumed object is finalized\n             (so that all output files are flushed and all calculations are finalized) but there is\n             a dangling reference to that Plumed object. Notice that after this call the self object\n             will be invalid so that using cmd will raise an exception.\n\n             It is also called by __exit__ in order to allow the following usage:\n             ````\n             with plumed.Plumed() as p:\n                 p.cmd(\"init\")\n                 # ETC\n\n             # p object will be finalized when exiting from this context\n             ````\n         ";
+static PyMethodDef __pyx_mdef_6plumed_6Plumed_7finalize = {"finalize", (PyCFunction)__pyx_pw_6plumed_6Plumed_7finalize, METH_NOARGS, __pyx_doc_6plumed_6Plumed_6finalize};
+static PyObject *__pyx_pw_6plumed_6Plumed_7finalize(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("finalize (wrapper)", 0);
-  __pyx_r = __pyx_pf_6plumed_6Plumed_2finalize(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self));
+  __pyx_r = __pyx_pf_6plumed_6Plumed_6finalize(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_6Plumed_2finalize(struct __pyx_obj_6plumed_Plumed *__pyx_v_self) {
+static PyObject *__pyx_pf_6plumed_6Plumed_6finalize(struct __pyx_obj_6plumed_Plumed *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PLMD::Plumed __pyx_t_1;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("finalize", 0);
 
-  /* "plumed.pyx":84
+  /* "plumed.pyx":117
  *              ````
  *          """
- *          self.c_plumed=cplumed.Plumed()             # <<<<<<<<<<<<<<
+ *          cplumed.plumed_finalize(self.c_plumed)             # <<<<<<<<<<<<<<
+ *          self.c_plumed=cplumed.plumed_create_invalid()
+ *      def __enter__(self):
+ */
+  plumed_finalize(__pyx_v_self->c_plumed);
+
+  /* "plumed.pyx":118
+ *          """
+ *          cplumed.plumed_finalize(self.c_plumed)
+ *          self.c_plumed=cplumed.plumed_create_invalid()             # <<<<<<<<<<<<<<
  *      def __enter__(self):
  *          return self
  */
-  try {
-    __pyx_t_1 = PLMD::Plumed();
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 84, __pyx_L1_error)
-  }
-  __pyx_v_self->c_plumed = __pyx_t_1;
-
-  /* "plumed.pyx":67
- *          cdef int pres = 8
- *          self.c_plumed.cmd_int( "setRealPrecision", pres)
+  __pyx_v_self->c_plumed = plumed_create_invalid();
+
+  /* "plumed.pyx":100
+ *            self.cmd("setNestedExceptions",1)
+ *          self.cmd( "setRealPrecision", 8)
  *      def finalize(self):             # <<<<<<<<<<<<<<
  *          """ Explicitly finalize a Plumed object.
  * 
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_AddTraceback("plumed.Plumed.finalize", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":85
- *          """
- *          self.c_plumed=cplumed.Plumed()
+/* "plumed.pyx":119
+ *          cplumed.plumed_finalize(self.c_plumed)
+ *          self.c_plumed=cplumed.plumed_create_invalid()
  *      def __enter__(self):             # <<<<<<<<<<<<<<
  *          return self
  *      def __exit__(self, type, value, traceback):
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_6Plumed_5__enter__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static PyMethodDef __pyx_mdef_6plumed_6Plumed_5__enter__ = {"__enter__", (PyCFunction)__pyx_pw_6plumed_6Plumed_5__enter__, METH_NOARGS, 0};
-static PyObject *__pyx_pw_6plumed_6Plumed_5__enter__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_6plumed_6Plumed_9__enter__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static PyMethodDef __pyx_mdef_6plumed_6Plumed_9__enter__ = {"__enter__", (PyCFunction)__pyx_pw_6plumed_6Plumed_9__enter__, METH_NOARGS, 0};
+static PyObject *__pyx_pw_6plumed_6Plumed_9__enter__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__enter__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_6plumed_6Plumed_4__enter__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self));
+  __pyx_r = __pyx_pf_6plumed_6Plumed_8__enter__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_6Plumed_4__enter__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self) {
+static PyObject *__pyx_pf_6plumed_6Plumed_8__enter__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__enter__", 0);
 
-  /* "plumed.pyx":86
- *          self.c_plumed=cplumed.Plumed()
+  /* "plumed.pyx":120
+ *          self.c_plumed=cplumed.plumed_create_invalid()
  *      def __enter__(self):
  *          return self             # <<<<<<<<<<<<<<
  *      def __exit__(self, type, value, traceback):
  *         self.finalize()
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __pyx_r = ((PyObject *)__pyx_v_self);
   goto __pyx_L0;
 
-  /* "plumed.pyx":85
- *          """
- *          self.c_plumed=cplumed.Plumed()
+  /* "plumed.pyx":119
+ *          cplumed.plumed_finalize(self.c_plumed)
+ *          self.c_plumed=cplumed.plumed_create_invalid()
  *      def __enter__(self):             # <<<<<<<<<<<<<<
  *          return self
  *      def __exit__(self, type, value, traceback):
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":87
+/* "plumed.pyx":121
  *      def __enter__(self):
  *          return self
  *      def __exit__(self, type, value, traceback):             # <<<<<<<<<<<<<<
  *         self.finalize()
- *      cdef cmd_ndarray_double(self, ckey, val):
+ *      cdef raise_exception(self,cplumed.plumed_error error):
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_6Plumed_7__exit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_6plumed_6Plumed_7__exit__ = {"__exit__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_6Plumed_7__exit__, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_6plumed_6Plumed_7__exit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_6Plumed_11__exit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_6plumed_6Plumed_11__exit__ = {"__exit__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_6Plumed_11__exit__, METH_VARARGS|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_6plumed_6Plumed_11__exit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   CYTHON_UNUSED PyObject *__pyx_v_type = 0;
   CYTHON_UNUSED PyObject *__pyx_v_value = 0;
   CYTHON_UNUSED PyObject *__pyx_v_traceback = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -4058,95 +4355,95 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_type)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_value)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, 1); __PYX_ERR(0, 87, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, 1); __PYX_ERR(0, 121, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traceback)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, 2); __PYX_ERR(0, 87, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, 2); __PYX_ERR(0, 121, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__exit__") < 0)) __PYX_ERR(0, 87, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__exit__") < 0)) __PYX_ERR(0, 121, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_type = values[0];
     __pyx_v_value = values[1];
     __pyx_v_traceback = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 87, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 121, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.Plumed.__exit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_6Plumed_6__exit__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self), __pyx_v_type, __pyx_v_value, __pyx_v_traceback);
+  __pyx_r = __pyx_pf_6plumed_6Plumed_10__exit__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self), __pyx_v_type, __pyx_v_value, __pyx_v_traceback);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_6Plumed_6__exit__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_type, CYTHON_UNUSED PyObject *__pyx_v_value, CYTHON_UNUSED PyObject *__pyx_v_traceback) {
+static PyObject *__pyx_pf_6plumed_6Plumed_10__exit__(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_type, CYTHON_UNUSED PyObject *__pyx_v_value, CYTHON_UNUSED PyObject *__pyx_v_traceback) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__exit__", 0);
 
-  /* "plumed.pyx":88
+  /* "plumed.pyx":122
  *          return self
  *      def __exit__(self, type, value, traceback):
  *         self.finalize()             # <<<<<<<<<<<<<<
- *      cdef cmd_ndarray_double(self, ckey, val):
- *          cdef double [:] abuffer = val.ravel()
+ *      cdef raise_exception(self,cplumed.plumed_error error):
+ *         if error.nested:
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_finalize); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_finalize); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":87
+  /* "plumed.pyx":121
  *      def __enter__(self):
  *          return self
  *      def __exit__(self, type, value, traceback):             # <<<<<<<<<<<<<<
  *         self.finalize()
- *      cdef cmd_ndarray_double(self, ckey, val):
+ *      cdef raise_exception(self,cplumed.plumed_error error):
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
@@ -4156,17 +4453,1028 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":89
+/* "plumed.pyx":123
  *      def __exit__(self, type, value, traceback):
  *         self.finalize()
+ *      cdef raise_exception(self,cplumed.plumed_error error):             # <<<<<<<<<<<<<<
+ *         if error.nested:
+ *           try:
+ */
+
+static PyObject *__pyx_f_6plumed_6Plumed_raise_exception(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, plumed_error __pyx_v_error) {
+  PyObject *__pyx_v_e = NULL;
+  PyObject *__pyx_v_raise_from = NULL;
+  char const *__pyx_v_msg;
+  PyObject *__pyx_v_what = NULL;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  char const *__pyx_t_9;
+  int __pyx_t_10;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("raise_exception", 0);
+
+  /* "plumed.pyx":124
+ *         self.finalize()
+ *      cdef raise_exception(self,cplumed.plumed_error error):
+ *         if error.nested:             # <<<<<<<<<<<<<<
+ *           try:
+ *             self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))
+ */
+  __pyx_t_1 = (__pyx_v_error.nested != 0);
+  if (__pyx_t_1) {
+
+    /* "plumed.pyx":125
+ *      cdef raise_exception(self,cplumed.plumed_error error):
+ *         if error.nested:
+ *           try:             # <<<<<<<<<<<<<<
+ *             self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))
+ *           except Exception as e:
+ */
+    {
+      __Pyx_PyThreadState_declare
+      __Pyx_PyThreadState_assign
+      __Pyx_ExceptionSave(&__pyx_t_2, &__pyx_t_3, &__pyx_t_4);
+      __Pyx_XGOTREF(__pyx_t_2);
+      __Pyx_XGOTREF(__pyx_t_3);
+      __Pyx_XGOTREF(__pyx_t_4);
+      /*try:*/ {
+
+        /* "plumed.pyx":126
+ *         if error.nested:
+ *           try:
+ *             self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))             # <<<<<<<<<<<<<<
+ *           except Exception as e:
+ *             raise_from = e
+ */
+        __pyx_t_5 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->raise_exception(__pyx_v_self, (*((plumed_error *)__pyx_v_error.nested))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 126, __pyx_L4_error)
+        __Pyx_GOTREF(__pyx_t_5);
+        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+        /* "plumed.pyx":125
+ *      cdef raise_exception(self,cplumed.plumed_error error):
+ *         if error.nested:
+ *           try:             # <<<<<<<<<<<<<<
+ *             self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))
+ *           except Exception as e:
+ */
+      }
+      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+      goto __pyx_L9_try_end;
+      __pyx_L4_error:;
+      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+      /* "plumed.pyx":127
+ *           try:
+ *             self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))
+ *           except Exception as e:             # <<<<<<<<<<<<<<
+ *             raise_from = e
+ *         else:
+ */
+      __pyx_t_6 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
+      if (__pyx_t_6) {
+        __Pyx_AddTraceback("plumed.Plumed.raise_exception", __pyx_clineno, __pyx_lineno, __pyx_filename);
+        if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_7, &__pyx_t_8) < 0) __PYX_ERR(0, 127, __pyx_L6_except_error)
+        __Pyx_GOTREF(__pyx_t_5);
+        __Pyx_GOTREF(__pyx_t_7);
+        __Pyx_GOTREF(__pyx_t_8);
+        __Pyx_INCREF(__pyx_t_7);
+        __pyx_v_e = __pyx_t_7;
+        /*try:*/ {
+
+          /* "plumed.pyx":128
+ *             self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))
+ *           except Exception as e:
+ *             raise_from = e             # <<<<<<<<<<<<<<
+ *         else:
+ *           raise_from = None
+ */
+          __Pyx_INCREF(__pyx_v_e);
+          __pyx_v_raise_from = __pyx_v_e;
+        }
+
+        /* "plumed.pyx":127
+ *           try:
+ *             self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))
+ *           except Exception as e:             # <<<<<<<<<<<<<<
+ *             raise_from = e
+ *         else:
+ */
+        /*finally:*/ {
+          /*normal exit:*/{
+            __Pyx_DECREF(__pyx_v_e);
+            __pyx_v_e = NULL;
+            goto __pyx_L16;
+          }
+          __pyx_L16:;
+        }
+        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+        goto __pyx_L5_exception_handled;
+      }
+      goto __pyx_L6_except_error;
+      __pyx_L6_except_error:;
+
+      /* "plumed.pyx":125
+ *      cdef raise_exception(self,cplumed.plumed_error error):
+ *         if error.nested:
+ *           try:             # <<<<<<<<<<<<<<
+ *             self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))
+ *           except Exception as e:
+ */
+      __Pyx_XGIVEREF(__pyx_t_2);
+      __Pyx_XGIVEREF(__pyx_t_3);
+      __Pyx_XGIVEREF(__pyx_t_4);
+      __Pyx_ExceptionReset(__pyx_t_2, __pyx_t_3, __pyx_t_4);
+      goto __pyx_L1_error;
+      __pyx_L5_exception_handled:;
+      __Pyx_XGIVEREF(__pyx_t_2);
+      __Pyx_XGIVEREF(__pyx_t_3);
+      __Pyx_XGIVEREF(__pyx_t_4);
+      __Pyx_ExceptionReset(__pyx_t_2, __pyx_t_3, __pyx_t_4);
+      __pyx_L9_try_end:;
+    }
+
+    /* "plumed.pyx":124
+ *         self.finalize()
+ *      cdef raise_exception(self,cplumed.plumed_error error):
+ *         if error.nested:             # <<<<<<<<<<<<<<
+ *           try:
+ *             self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))
+ */
+    goto __pyx_L3;
+  }
+
+  /* "plumed.pyx":130
+ *             raise_from = e
+ *         else:
+ *           raise_from = None             # <<<<<<<<<<<<<<
+ *         msg = error.what
+ *         what = msg.decode("utf-8")
+ */
+  /*else*/ {
+    __Pyx_INCREF(Py_None);
+    __pyx_v_raise_from = Py_None;
+  }
+  __pyx_L3:;
+
+  /* "plumed.pyx":131
+ *         else:
+ *           raise_from = None
+ *         msg = error.what             # <<<<<<<<<<<<<<
+ *         what = msg.decode("utf-8")
+ *         # this map is from cython doc
+ */
+  __pyx_t_9 = __pyx_v_error.what;
+  __pyx_v_msg = __pyx_t_9;
+
+  /* "plumed.pyx":132
+ *           raise_from = None
+ *         msg = error.what
+ *         what = msg.decode("utf-8")             # <<<<<<<<<<<<<<
+ *         # this map is from cython doc
+ *         if error.code>=20300 and error.code<20400: # PLMD::Plumed::ExceptionTypeError
+ */
+  __pyx_t_8 = __Pyx_decode_c_string(__pyx_v_msg, 0, strlen(__pyx_v_msg), NULL, NULL, PyUnicode_DecodeUTF8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __pyx_v_what = __pyx_t_8;
+  __pyx_t_8 = 0;
+
+  /* "plumed.pyx":134
+ *         what = msg.decode("utf-8")
+ *         # this map is from cython doc
+ *         if error.code>=20300 and error.code<20400: # PLMD::Plumed::ExceptionTypeError             # <<<<<<<<<<<<<<
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11400 and error.code<11500: # std::bad_alloc
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x4F4C) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L18_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x4FB0) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L18_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":135
+ *         # this map is from cython doc
+ *         if error.code>=20300 and error.code<20400: # PLMD::Plumed::ExceptionTypeError
+ *            raise TypeError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=11400 and error.code<11500: # std::bad_alloc
+ *            raise MemoryError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 135, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 135, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 135, __pyx_L1_error)
+
+    /* "plumed.pyx":134
+ *         what = msg.decode("utf-8")
+ *         # this map is from cython doc
+ *         if error.code>=20300 and error.code<20400: # PLMD::Plumed::ExceptionTypeError             # <<<<<<<<<<<<<<
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11400 and error.code<11500: # std::bad_alloc
+ */
+  }
+
+  /* "plumed.pyx":136
+ *         if error.code>=20300 and error.code<20400: # PLMD::Plumed::ExceptionTypeError
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11400 and error.code<11500: # std::bad_alloc             # <<<<<<<<<<<<<<
+ *            raise MemoryError(what) from raise_from
+ *         elif error.code>=11000 and error.code<11100: # std::bad_typeid
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x2C88) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L20_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x2CEC) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L20_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":137
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11400 and error.code<11500: # std::bad_alloc
+ *            raise MemoryError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=11000 and error.code<11100: # std::bad_typeid
+ *            raise TypeError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_MemoryError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 137, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 137, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 137, __pyx_L1_error)
+
+    /* "plumed.pyx":136
+ *         if error.code>=20300 and error.code<20400: # PLMD::Plumed::ExceptionTypeError
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11400 and error.code<11500: # std::bad_alloc             # <<<<<<<<<<<<<<
+ *            raise MemoryError(what) from raise_from
+ *         elif error.code>=11000 and error.code<11100: # std::bad_typeid
+ */
+  }
+
+  /* "plumed.pyx":138
+ *         elif error.code>=11400 and error.code<11500: # std::bad_alloc
+ *            raise MemoryError(what) from raise_from
+ *         elif error.code>=11000 and error.code<11100: # std::bad_typeid             # <<<<<<<<<<<<<<
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11100 and error.code<11200: # std::bad_cast
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x2AF8) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L22_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x2B5C) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L22_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":139
+ *            raise MemoryError(what) from raise_from
+ *         elif error.code>=11000 and error.code<11100: # std::bad_typeid
+ *            raise TypeError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=11100 and error.code<11200: # std::bad_cast
+ *            raise TypeError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 139, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 139, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 139, __pyx_L1_error)
+
+    /* "plumed.pyx":138
+ *         elif error.code>=11400 and error.code<11500: # std::bad_alloc
+ *            raise MemoryError(what) from raise_from
+ *         elif error.code>=11000 and error.code<11100: # std::bad_typeid             # <<<<<<<<<<<<<<
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11100 and error.code<11200: # std::bad_cast
+ */
+  }
+
+  /* "plumed.pyx":140
+ *         elif error.code>=11000 and error.code<11100: # std::bad_typeid
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11100 and error.code<11200: # std::bad_cast             # <<<<<<<<<<<<<<
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=10110 and error.code<10115: # std::domain_error
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x2B5C) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L24_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x2BC0) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L24_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":141
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11100 and error.code<11200: # std::bad_cast
+ *            raise TypeError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=10110 and error.code<10115: # std::domain_error
+ *            raise ValueError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 141, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 141, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 141, __pyx_L1_error)
+
+    /* "plumed.pyx":140
+ *         elif error.code>=11000 and error.code<11100: # std::bad_typeid
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=11100 and error.code<11200: # std::bad_cast             # <<<<<<<<<<<<<<
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=10110 and error.code<10115: # std::domain_error
+ */
+  }
+
+  /* "plumed.pyx":142
+ *         elif error.code>=11100 and error.code<11200: # std::bad_cast
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=10110 and error.code<10115: # std::domain_error             # <<<<<<<<<<<<<<
+ *            raise ValueError(what) from raise_from
+ *         elif error.code>=10105 and error.code<10110: # std::invalid_argument
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x277E) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L26_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x2783) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L26_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":143
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=10110 and error.code<10115: # std::domain_error
+ *            raise ValueError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=10105 and error.code<10110: # std::invalid_argument
+ *            raise ValueError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 143, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 143, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 143, __pyx_L1_error)
+
+    /* "plumed.pyx":142
+ *         elif error.code>=11100 and error.code<11200: # std::bad_cast
+ *            raise TypeError(what) from raise_from
+ *         elif error.code>=10110 and error.code<10115: # std::domain_error             # <<<<<<<<<<<<<<
+ *            raise ValueError(what) from raise_from
+ *         elif error.code>=10105 and error.code<10110: # std::invalid_argument
+ */
+  }
+
+  /* "plumed.pyx":144
+ *         elif error.code>=10110 and error.code<10115: # std::domain_error
+ *            raise ValueError(what) from raise_from
+ *         elif error.code>=10105 and error.code<10110: # std::invalid_argument             # <<<<<<<<<<<<<<
+ *            raise ValueError(what) from raise_from
+ *         elif error.code>=10230 and error.code<10240: # std::ios_base::failure
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x2779) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L28_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x277E) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L28_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":145
+ *            raise ValueError(what) from raise_from
+ *         elif error.code>=10105 and error.code<10110: # std::invalid_argument
+ *            raise ValueError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=10230 and error.code<10240: # std::ios_base::failure
+ *            # Unfortunately, in standard C++ we have no way of distinguishing EOF
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 145, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 145, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 145, __pyx_L1_error)
+
+    /* "plumed.pyx":144
+ *         elif error.code>=10110 and error.code<10115: # std::domain_error
+ *            raise ValueError(what) from raise_from
+ *         elif error.code>=10105 and error.code<10110: # std::invalid_argument             # <<<<<<<<<<<<<<
+ *            raise ValueError(what) from raise_from
+ *         elif error.code>=10230 and error.code<10240: # std::ios_base::failure
+ */
+  }
+
+  /* "plumed.pyx":146
+ *         elif error.code>=10105 and error.code<10110: # std::invalid_argument
+ *            raise ValueError(what) from raise_from
+ *         elif error.code>=10230 and error.code<10240: # std::ios_base::failure             # <<<<<<<<<<<<<<
+ *            # Unfortunately, in standard C++ we have no way of distinguishing EOF
+ *            # from other errors here; be careful with the exception mask
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x27F6) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L30_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x2800) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L30_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":149
+ *            # Unfortunately, in standard C++ we have no way of distinguishing EOF
+ *            # from other errors here; be careful with the exception mask
+ *            raise IOError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=10120 and error.code<10125: # std::out_of_range
+ *            raise IndexError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_IOError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 149, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 149, __pyx_L1_error)
+
+    /* "plumed.pyx":146
+ *         elif error.code>=10105 and error.code<10110: # std::invalid_argument
+ *            raise ValueError(what) from raise_from
+ *         elif error.code>=10230 and error.code<10240: # std::ios_base::failure             # <<<<<<<<<<<<<<
+ *            # Unfortunately, in standard C++ we have no way of distinguishing EOF
+ *            # from other errors here; be careful with the exception mask
+ */
+  }
+
+  /* "plumed.pyx":150
+ *            # from other errors here; be careful with the exception mask
+ *            raise IOError(what) from raise_from
+ *         elif error.code>=10120 and error.code<10125: # std::out_of_range             # <<<<<<<<<<<<<<
+ *            raise IndexError(what) from raise_from
+ *         elif error.code>=10210 and error.code<10215: # std::overflow_error
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x2788) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L32_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x278D) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L32_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":151
+ *            raise IOError(what) from raise_from
+ *         elif error.code>=10120 and error.code<10125: # std::out_of_range
+ *            raise IndexError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=10210 and error.code<10215: # std::overflow_error
+ *            raise OverflowError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_IndexError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 151, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 151, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 151, __pyx_L1_error)
+
+    /* "plumed.pyx":150
+ *            # from other errors here; be careful with the exception mask
+ *            raise IOError(what) from raise_from
+ *         elif error.code>=10120 and error.code<10125: # std::out_of_range             # <<<<<<<<<<<<<<
+ *            raise IndexError(what) from raise_from
+ *         elif error.code>=10210 and error.code<10215: # std::overflow_error
+ */
+  }
+
+  /* "plumed.pyx":152
+ *         elif error.code>=10120 and error.code<10125: # std::out_of_range
+ *            raise IndexError(what) from raise_from
+ *         elif error.code>=10210 and error.code<10215: # std::overflow_error             # <<<<<<<<<<<<<<
+ *            raise OverflowError(what) from raise_from
+ *         elif error.code>=10205 and error.code<10210: # std::range_error
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x27E2) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L34_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x27E7) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L34_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":153
+ *            raise IndexError(what) from raise_from
+ *         elif error.code>=10210 and error.code<10215: # std::overflow_error
+ *            raise OverflowError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=10205 and error.code<10210: # std::range_error
+ *            raise ArithmeticError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_OverflowError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 153, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 153, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 153, __pyx_L1_error)
+
+    /* "plumed.pyx":152
+ *         elif error.code>=10120 and error.code<10125: # std::out_of_range
+ *            raise IndexError(what) from raise_from
+ *         elif error.code>=10210 and error.code<10215: # std::overflow_error             # <<<<<<<<<<<<<<
+ *            raise OverflowError(what) from raise_from
+ *         elif error.code>=10205 and error.code<10210: # std::range_error
+ */
+  }
+
+  /* "plumed.pyx":154
+ *         elif error.code>=10210 and error.code<10215: # std::overflow_error
+ *            raise OverflowError(what) from raise_from
+ *         elif error.code>=10205 and error.code<10210: # std::range_error             # <<<<<<<<<<<<<<
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=10215 and error.code<10220: # std::underflow_error
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x27DD) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L36_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x27E2) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L36_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":155
+ *            raise OverflowError(what) from raise_from
+ *         elif error.code>=10205 and error.code<10210: # std::range_error
+ *            raise ArithmeticError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=10215 and error.code<10220: # std::underflow_error
+ *            raise ArithmeticError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ArithmeticError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 155, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 155, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 155, __pyx_L1_error)
+
+    /* "plumed.pyx":154
+ *         elif error.code>=10210 and error.code<10215: # std::overflow_error
+ *            raise OverflowError(what) from raise_from
+ *         elif error.code>=10205 and error.code<10210: # std::range_error             # <<<<<<<<<<<<<<
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=10215 and error.code<10220: # std::underflow_error
+ */
+  }
+
+  /* "plumed.pyx":156
+ *         elif error.code>=10205 and error.code<10210: # std::range_error
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=10215 and error.code<10220: # std::underflow_error             # <<<<<<<<<<<<<<
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=19900 and error.code<20000: # Lepton
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x27E7) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L38_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x27EC) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L38_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":157
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=10215 and error.code<10220: # std::underflow_error
+ *            raise ArithmeticError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=19900 and error.code<20000: # Lepton
+ *            raise LeptonError(what) from raise_from
+ */
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ArithmeticError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 157, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 157, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 157, __pyx_L1_error)
+
+    /* "plumed.pyx":156
+ *         elif error.code>=10205 and error.code<10210: # std::range_error
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=10215 and error.code<10220: # std::underflow_error             # <<<<<<<<<<<<<<
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=19900 and error.code<20000: # Lepton
+ */
+  }
+
+  /* "plumed.pyx":158
+ *         elif error.code>=10215 and error.code<10220: # std::underflow_error
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=19900 and error.code<20000: # Lepton             # <<<<<<<<<<<<<<
+ *            raise LeptonError(what) from raise_from
+ *         elif error.code>=20000 and error.code<30000: # Plumed
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x4DBC) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L40_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x4E20) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L40_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":159
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=19900 and error.code<20000: # Lepton
+ *            raise LeptonError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         elif error.code>=20000 and error.code<30000: # Plumed
+ *            raise PlumedError(what) from raise_from
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_LeptonError); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 159, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __pyx_t_5 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_7, function);
+      }
+    }
+    __pyx_t_8 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_5, __pyx_v_what) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_what);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 159, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 159, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 159, __pyx_L1_error)
+
+    /* "plumed.pyx":158
+ *         elif error.code>=10215 and error.code<10220: # std::underflow_error
+ *            raise ArithmeticError(what) from raise_from
+ *         elif error.code>=19900 and error.code<20000: # Lepton             # <<<<<<<<<<<<<<
+ *            raise LeptonError(what) from raise_from
+ *         elif error.code>=20000 and error.code<30000: # Plumed
+ */
+  }
+
+  /* "plumed.pyx":160
+ *         elif error.code>=19900 and error.code<20000: # Lepton
+ *            raise LeptonError(what) from raise_from
+ *         elif error.code>=20000 and error.code<30000: # Plumed             # <<<<<<<<<<<<<<
+ *            raise PlumedError(what) from raise_from
+ *         else:
+ */
+  __pyx_t_10 = ((__pyx_v_error.code >= 0x4E20) != 0);
+  if (__pyx_t_10) {
+  } else {
+    __pyx_t_1 = __pyx_t_10;
+    goto __pyx_L42_bool_binop_done;
+  }
+  __pyx_t_10 = ((__pyx_v_error.code < 0x7530) != 0);
+  __pyx_t_1 = __pyx_t_10;
+  __pyx_L42_bool_binop_done:;
+  if (unlikely(__pyx_t_1)) {
+
+    /* "plumed.pyx":161
+ *            raise LeptonError(what) from raise_from
+ *         elif error.code>=20000 and error.code<30000: # Plumed
+ *            raise PlumedError(what) from raise_from             # <<<<<<<<<<<<<<
+ *         else:
+ *            raise RuntimeError(what) from raise_from
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_PlumedError); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 161, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __pyx_t_5 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_7, function);
+      }
+    }
+    __pyx_t_8 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_5, __pyx_v_what) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_what);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 161, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 161, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 161, __pyx_L1_error)
+
+    /* "plumed.pyx":160
+ *         elif error.code>=19900 and error.code<20000: # Lepton
+ *            raise LeptonError(what) from raise_from
+ *         elif error.code>=20000 and error.code<30000: # Plumed             # <<<<<<<<<<<<<<
+ *            raise PlumedError(what) from raise_from
+ *         else:
+ */
+  }
+
+  /* "plumed.pyx":163
+ *            raise PlumedError(what) from raise_from
+ *         else:
+ *            raise RuntimeError(what) from raise_from             # <<<<<<<<<<<<<<
+ *      cdef cmd_low_level(self,const char* ckey, const void* val,size_t nelem, size_t* shape,size_t flags):
+ *          cdef cplumed.plumed_safeptr safe
+ */
+  /*else*/ {
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_RuntimeError, __pyx_v_what); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 163, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    if (unlikely(!__pyx_v_raise_from)) { __Pyx_RaiseUnboundLocalError("raise_from"); __PYX_ERR(0, 163, __pyx_L1_error) }
+    __Pyx_Raise(__pyx_t_8, 0, 0, __pyx_v_raise_from);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __PYX_ERR(0, 163, __pyx_L1_error)
+  }
+
+  /* "plumed.pyx":123
+ *      def __exit__(self, type, value, traceback):
+ *         self.finalize()
+ *      cdef raise_exception(self,cplumed.plumed_error error):             # <<<<<<<<<<<<<<
+ *         if error.nested:
+ *           try:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_AddTraceback("plumed.Plumed.raise_exception", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __Pyx_XDECREF(__pyx_v_e);
+  __Pyx_XDECREF(__pyx_v_raise_from);
+  __Pyx_XDECREF(__pyx_v_what);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "plumed.pyx":164
+ *         else:
+ *            raise RuntimeError(what) from raise_from
+ *      cdef cmd_low_level(self,const char* ckey, const void* val,size_t nelem, size_t* shape,size_t flags):             # <<<<<<<<<<<<<<
+ *          cdef cplumed.plumed_safeptr safe
+ *          cdef cplumed.plumed_nothrow_handler nothrow
+ */
+
+static PyObject *__pyx_f_6plumed_6Plumed_cmd_low_level(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, char const *__pyx_v_ckey, void const *__pyx_v_val, CYTHON_UNUSED size_t __pyx_v_nelem, size_t *__pyx_v_shape, size_t __pyx_v_flags) {
+  plumed_safeptr __pyx_v_safe;
+  plumed_nothrow_handler __pyx_v_nothrow;
+  plumed_error __pyx_v_error;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_3;
+  int __pyx_t_4;
+  char const *__pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  PyObject *__pyx_t_10 = NULL;
+  PyObject *__pyx_t_11 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("cmd_low_level", 0);
+
+  /* "plumed.pyx":168
+ *          cdef cplumed.plumed_nothrow_handler nothrow
+ *          cdef cplumed.plumed_error error
+ *          safe.ptr=val             # <<<<<<<<<<<<<<
+ *          safe.nelem=0
+ *          safe.shape=shape
+ */
+  __pyx_v_safe.ptr = __pyx_v_val;
+
+  /* "plumed.pyx":169
+ *          cdef cplumed.plumed_error error
+ *          safe.ptr=val
+ *          safe.nelem=0             # <<<<<<<<<<<<<<
+ *          safe.shape=shape
+ *          safe.flags=flags
+ */
+  __pyx_v_safe.nelem = 0;
+
+  /* "plumed.pyx":170
+ *          safe.ptr=val
+ *          safe.nelem=0
+ *          safe.shape=shape             # <<<<<<<<<<<<<<
+ *          safe.flags=flags
+ *          cplumed.plumed_error_init(&error)
+ */
+  __pyx_v_safe.shape = __pyx_v_shape;
+
+  /* "plumed.pyx":171
+ *          safe.nelem=0
+ *          safe.shape=shape
+ *          safe.flags=flags             # <<<<<<<<<<<<<<
+ *          cplumed.plumed_error_init(&error)
+ *          nothrow.ptr=&error
+ */
+  __pyx_v_safe.flags = __pyx_v_flags;
+
+  /* "plumed.pyx":172
+ *          safe.shape=shape
+ *          safe.flags=flags
+ *          cplumed.plumed_error_init(&error)             # <<<<<<<<<<<<<<
+ *          nothrow.ptr=&error
+ *          nothrow.handler=cplumed.plumed_error_set
+ */
+  plumed_error_init((&__pyx_v_error));
+
+  /* "plumed.pyx":173
+ *          safe.flags=flags
+ *          cplumed.plumed_error_init(&error)
+ *          nothrow.ptr=&error             # <<<<<<<<<<<<<<
+ *          nothrow.handler=cplumed.plumed_error_set
+ *          cplumed.plumed_cmd_safe_nothrow(self.c_plumed,ckey,safe,nothrow)
+ */
+  __pyx_v_nothrow.ptr = (&__pyx_v_error);
+
+  /* "plumed.pyx":174
+ *          cplumed.plumed_error_init(&error)
+ *          nothrow.ptr=&error
+ *          nothrow.handler=cplumed.plumed_error_set             # <<<<<<<<<<<<<<
+ *          cplumed.plumed_cmd_safe_nothrow(self.c_plumed,ckey,safe,nothrow)
+ *          if(error.code):
+ */
+  __pyx_v_nothrow.handler = plumed_error_set;
+
+  /* "plumed.pyx":175
+ *          nothrow.ptr=&error
+ *          nothrow.handler=cplumed.plumed_error_set
+ *          cplumed.plumed_cmd_safe_nothrow(self.c_plumed,ckey,safe,nothrow)             # <<<<<<<<<<<<<<
+ *          if(error.code):
+ *            try:
+ */
+  plumed_cmd_safe_nothrow(__pyx_v_self->c_plumed, __pyx_v_ckey, __pyx_v_safe, __pyx_v_nothrow);
+
+  /* "plumed.pyx":176
+ *          nothrow.handler=cplumed.plumed_error_set
+ *          cplumed.plumed_cmd_safe_nothrow(self.c_plumed,ckey,safe,nothrow)
+ *          if(error.code):             # <<<<<<<<<<<<<<
+ *            try:
+ *              self.raise_exception(error)
+ */
+  __pyx_t_1 = (__pyx_v_error.code != 0);
+  if (__pyx_t_1) {
+
+    /* "plumed.pyx":177
+ *          cplumed.plumed_cmd_safe_nothrow(self.c_plumed,ckey,safe,nothrow)
+ *          if(error.code):
+ *            try:             # <<<<<<<<<<<<<<
+ *              self.raise_exception(error)
+ *            finally:
+ */
+    /*try:*/ {
+
+      /* "plumed.pyx":178
+ *          if(error.code):
+ *            try:
+ *              self.raise_exception(error)             # <<<<<<<<<<<<<<
+ *            finally:
+ *              cplumed.plumed_error_finalize(error)
+ */
+      __pyx_t_2 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->raise_exception(__pyx_v_self, __pyx_v_error); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 178, __pyx_L5_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    }
+
+    /* "plumed.pyx":180
+ *              self.raise_exception(error)
+ *            finally:
+ *              cplumed.plumed_error_finalize(error)             # <<<<<<<<<<<<<<
+ *      cdef cmd_ndarray_double(self, ckey, val):
+ *          cdef double [:] abuffer = val.ravel()
+ */
+    /*finally:*/ {
+      /*normal exit:*/{
+        plumed_error_finalize(__pyx_v_error);
+        goto __pyx_L6;
+      }
+      __pyx_L5_error:;
+      /*exception exit:*/{
+        __Pyx_PyThreadState_declare
+        __Pyx_PyThreadState_assign
+        __pyx_t_6 = 0; __pyx_t_7 = 0; __pyx_t_8 = 0; __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0;
+        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+        if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
+        if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_6, &__pyx_t_7, &__pyx_t_8) < 0)) __Pyx_ErrFetch(&__pyx_t_6, &__pyx_t_7, &__pyx_t_8);
+        __Pyx_XGOTREF(__pyx_t_6);
+        __Pyx_XGOTREF(__pyx_t_7);
+        __Pyx_XGOTREF(__pyx_t_8);
+        __Pyx_XGOTREF(__pyx_t_9);
+        __Pyx_XGOTREF(__pyx_t_10);
+        __Pyx_XGOTREF(__pyx_t_11);
+        __pyx_t_3 = __pyx_lineno; __pyx_t_4 = __pyx_clineno; __pyx_t_5 = __pyx_filename;
+        {
+          plumed_error_finalize(__pyx_v_error);
+        }
+        if (PY_MAJOR_VERSION >= 3) {
+          __Pyx_XGIVEREF(__pyx_t_9);
+          __Pyx_XGIVEREF(__pyx_t_10);
+          __Pyx_XGIVEREF(__pyx_t_11);
+          __Pyx_ExceptionReset(__pyx_t_9, __pyx_t_10, __pyx_t_11);
+        }
+        __Pyx_XGIVEREF(__pyx_t_6);
+        __Pyx_XGIVEREF(__pyx_t_7);
+        __Pyx_XGIVEREF(__pyx_t_8);
+        __Pyx_ErrRestore(__pyx_t_6, __pyx_t_7, __pyx_t_8);
+        __pyx_t_6 = 0; __pyx_t_7 = 0; __pyx_t_8 = 0; __pyx_t_9 = 0; __pyx_t_10 = 0; __pyx_t_11 = 0;
+        __pyx_lineno = __pyx_t_3; __pyx_clineno = __pyx_t_4; __pyx_filename = __pyx_t_5;
+        goto __pyx_L1_error;
+      }
+      __pyx_L6:;
+    }
+
+    /* "plumed.pyx":176
+ *          nothrow.handler=cplumed.plumed_error_set
+ *          cplumed.plumed_cmd_safe_nothrow(self.c_plumed,ckey,safe,nothrow)
+ *          if(error.code):             # <<<<<<<<<<<<<<
+ *            try:
+ *              self.raise_exception(error)
+ */
+  }
+
+  /* "plumed.pyx":164
+ *         else:
+ *            raise RuntimeError(what) from raise_from
+ *      cdef cmd_low_level(self,const char* ckey, const void* val,size_t nelem, size_t* shape,size_t flags):             # <<<<<<<<<<<<<<
+ *          cdef cplumed.plumed_safeptr safe
+ *          cdef cplumed.plumed_nothrow_handler nothrow
+ */
+
+  /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("plumed.Plumed.cmd_low_level", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "plumed.pyx":181
+ *            finally:
+ *              cplumed.plumed_error_finalize(error)
  *      cdef cmd_ndarray_double(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef double [:] abuffer = val.ravel()
  *          cdef size_t ashape[5]
  */
 
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_ndarray_double(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val) {
   __Pyx_memviewslice __pyx_v_abuffer = { 0, 0, { 0 }, { 0 }, { 0 } };
@@ -4182,142 +5490,151 @@
   Py_ssize_t __pyx_t_5;
   Py_ssize_t __pyx_t_6;
   Py_ssize_t __pyx_t_7;
   size_t __pyx_t_8;
   char const *__pyx_t_9;
   Py_ssize_t __pyx_t_10;
   int __pyx_t_11;
+  Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd_ndarray_double", 0);
 
-  /* "plumed.pyx":90
- *         self.finalize()
+  /* "plumed.pyx":182
+ *              cplumed.plumed_error_finalize(error)
  *      cdef cmd_ndarray_double(self, ckey, val):
  *          cdef double [:] abuffer = val.ravel()             # <<<<<<<<<<<<<<
  *          cdef size_t ashape[5]
  *          shape=val.shape
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 90, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 182, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 90, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 182, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 90, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 182, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_abuffer = __pyx_t_4;
   __pyx_t_4.memview = NULL;
   __pyx_t_4.data = NULL;
 
-  /* "plumed.pyx":92
+  /* "plumed.pyx":184
  *          cdef double [:] abuffer = val.ravel()
  *          cdef size_t ashape[5]
  *          shape=val.shape             # <<<<<<<<<<<<<<
  *          assert len(shape)<5
  *          for i in range(len(shape)):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 92, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_shape = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":93
+  /* "plumed.pyx":185
  *          cdef size_t ashape[5]
  *          shape=val.shape
  *          assert len(shape)<5             # <<<<<<<<<<<<<<
  *          for i in range(len(shape)):
  *             ashape[i]=shape[i]
  */
   #ifndef CYTHON_WITHOUT_ASSERTIONS
   if (unlikely(!Py_OptimizeFlag)) {
-    __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 93, __pyx_L1_error)
+    __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 185, __pyx_L1_error)
     if (unlikely(!((__pyx_t_5 < 5) != 0))) {
       PyErr_SetNone(PyExc_AssertionError);
-      __PYX_ERR(0, 93, __pyx_L1_error)
+      __PYX_ERR(0, 185, __pyx_L1_error)
     }
   }
   #endif
 
-  /* "plumed.pyx":94
+  /* "plumed.pyx":186
  *          shape=val.shape
  *          assert len(shape)<5
  *          for i in range(len(shape)):             # <<<<<<<<<<<<<<
  *             ashape[i]=shape[i]
  *          ashape[len(shape)]=0
  */
-  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 94, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 186, __pyx_L1_error)
   __pyx_t_6 = __pyx_t_5;
   for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
     __pyx_v_i = __pyx_t_7;
 
-    /* "plumed.pyx":95
+    /* "plumed.pyx":187
  *          assert len(shape)<5
  *          for i in range(len(shape)):
  *             ashape[i]=shape[i]             # <<<<<<<<<<<<<<
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <double*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_real +  type_pointer)
  */
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_shape, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 95, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_shape, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 187, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyInt_As_size_t(__pyx_t_1); if (unlikely((__pyx_t_8 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 95, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_As_size_t(__pyx_t_1); if (unlikely((__pyx_t_8 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 187, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     (__pyx_v_ashape[__pyx_v_i]) = __pyx_t_8;
   }
 
-  /* "plumed.pyx":96
+  /* "plumed.pyx":188
  *          for i in range(len(shape)):
  *             ashape[i]=shape[i]
  *          ashape[len(shape)]=0             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd_shaped( ckey, <double*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_real +  type_pointer)
  *      cdef cmd_ndarray_int(self, ckey, val):
  */
-  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 96, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 188, __pyx_L1_error)
   (__pyx_v_ashape[__pyx_t_5]) = 0;
 
-  /* "plumed.pyx":97
+  /* "plumed.pyx":189
  *             ashape[i]=shape[i]
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <double*>&abuffer[0], <size_t*> & ashape[0])             # <<<<<<<<<<<<<<
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_real +  type_pointer)             # <<<<<<<<<<<<<<
  *      cdef cmd_ndarray_int(self, ckey, val):
  *          cdef int [:] abuffer = val.ravel()
  */
-  __pyx_t_9 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_9) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_9) && PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L1_error)
   __pyx_t_10 = 0;
   __pyx_t_11 = -1;
   if (__pyx_t_10 < 0) {
     __pyx_t_10 += __pyx_v_abuffer.shape[0];
     if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
   } else if (unlikely(__pyx_t_10 >= __pyx_v_abuffer.shape[0])) __pyx_t_11 = 0;
   if (unlikely(__pyx_t_11 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_11);
-    __PYX_ERR(0, 97, __pyx_L1_error)
+    __PYX_ERR(0, 189, __pyx_L1_error)
   }
-  try {
-    __pyx_v_self->c_plumed.cmd(__pyx_t_9, ((double *)(&(*((double *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_10 * __pyx_v_abuffer.strides[0]) ))))), ((size_t *)(&(__pyx_v_ashape[0]))));
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 97, __pyx_L1_error)
+  if (unlikely(!__pyx_v_abuffer.memview)) { __Pyx_RaiseUnboundLocalError("abuffer"); __PYX_ERR(0, 189, __pyx_L1_error) }
+  __pyx_t_12 = 0;
+  __pyx_t_11 = -1;
+  if (__pyx_t_12 < 0) {
+    __pyx_t_12 += __pyx_v_abuffer.shape[0];
+    if (unlikely(__pyx_t_12 < 0)) __pyx_t_11 = 0;
+  } else if (unlikely(__pyx_t_12 >= __pyx_v_abuffer.shape[0])) __pyx_t_11 = 0;
+  if (unlikely(__pyx_t_11 != -1)) {
+    __Pyx_RaiseBufferIndexError(__pyx_t_11);
+    __PYX_ERR(0, 189, __pyx_L1_error)
   }
+  __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_t_9, (&(*((double *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_10 * __pyx_v_abuffer.strides[0]) )))), 0, (&(__pyx_v_ashape[0])), (((sizeof((*((double *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_12 * __pyx_v_abuffer.strides[0]) ))))) + 0x40000) + 0x4000000)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":89
- *      def __exit__(self, type, value, traceback):
- *         self.finalize()
+  /* "plumed.pyx":181
+ *            finally:
+ *              cplumed.plumed_error_finalize(error)
  *      cdef cmd_ndarray_double(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef double [:] abuffer = val.ravel()
  *          cdef size_t ashape[5]
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
@@ -4333,17 +5650,17 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_abuffer, 1);
   __Pyx_XDECREF(__pyx_v_shape);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":98
+/* "plumed.pyx":190
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <double*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_real +  type_pointer)
  *      cdef cmd_ndarray_int(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef int [:] abuffer = val.ravel()
  *          cdef size_t ashape[5]
  */
 
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_ndarray_int(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val) {
   __Pyx_memviewslice __pyx_v_abuffer = { 0, 0, { 0 }, { 0 }, { 0 } };
@@ -4359,142 +5676,151 @@
   Py_ssize_t __pyx_t_5;
   Py_ssize_t __pyx_t_6;
   Py_ssize_t __pyx_t_7;
   size_t __pyx_t_8;
   char const *__pyx_t_9;
   Py_ssize_t __pyx_t_10;
   int __pyx_t_11;
+  Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd_ndarray_int", 0);
 
-  /* "plumed.pyx":99
- *          self.c_plumed.cmd_shaped( ckey, <double*>&abuffer[0], <size_t*> & ashape[0])
+  /* "plumed.pyx":191
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_real +  type_pointer)
  *      cdef cmd_ndarray_int(self, ckey, val):
  *          cdef int [:] abuffer = val.ravel()             # <<<<<<<<<<<<<<
  *          cdef size_t ashape[5]
  *          shape=val.shape
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 191, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 99, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 191, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 191, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_abuffer = __pyx_t_4;
   __pyx_t_4.memview = NULL;
   __pyx_t_4.data = NULL;
 
-  /* "plumed.pyx":101
+  /* "plumed.pyx":193
  *          cdef int [:] abuffer = val.ravel()
  *          cdef size_t ashape[5]
  *          shape=val.shape             # <<<<<<<<<<<<<<
  *          assert len(shape)<5
  *          for i in range(len(shape)):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 193, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_shape = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":102
+  /* "plumed.pyx":194
  *          cdef size_t ashape[5]
  *          shape=val.shape
  *          assert len(shape)<5             # <<<<<<<<<<<<<<
  *          for i in range(len(shape)):
  *             ashape[i]=shape[i]
  */
   #ifndef CYTHON_WITHOUT_ASSERTIONS
   if (unlikely(!Py_OptimizeFlag)) {
-    __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
+    __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 194, __pyx_L1_error)
     if (unlikely(!((__pyx_t_5 < 5) != 0))) {
       PyErr_SetNone(PyExc_AssertionError);
-      __PYX_ERR(0, 102, __pyx_L1_error)
+      __PYX_ERR(0, 194, __pyx_L1_error)
     }
   }
   #endif
 
-  /* "plumed.pyx":103
+  /* "plumed.pyx":195
  *          shape=val.shape
  *          assert len(shape)<5
  *          for i in range(len(shape)):             # <<<<<<<<<<<<<<
  *             ashape[i]=shape[i]
  *          ashape[len(shape)]=0
  */
-  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 103, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 195, __pyx_L1_error)
   __pyx_t_6 = __pyx_t_5;
   for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
     __pyx_v_i = __pyx_t_7;
 
-    /* "plumed.pyx":104
+    /* "plumed.pyx":196
  *          assert len(shape)<5
  *          for i in range(len(shape)):
  *             ashape[i]=shape[i]             # <<<<<<<<<<<<<<
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <int*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  */
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_shape, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 104, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_shape, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 196, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyInt_As_size_t(__pyx_t_1); if (unlikely((__pyx_t_8 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 104, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_As_size_t(__pyx_t_1); if (unlikely((__pyx_t_8 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 196, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     (__pyx_v_ashape[__pyx_v_i]) = __pyx_t_8;
   }
 
-  /* "plumed.pyx":105
+  /* "plumed.pyx":197
  *          for i in range(len(shape)):
  *             ashape[i]=shape[i]
  *          ashape[len(shape)]=0             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd_shaped( ckey, <int*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_ndarray_long(self, ckey, val):
  */
-  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 105, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 197, __pyx_L1_error)
   (__pyx_v_ashape[__pyx_t_5]) = 0;
 
-  /* "plumed.pyx":106
+  /* "plumed.pyx":198
  *             ashape[i]=shape[i]
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <int*>&abuffer[0], <size_t*> & ashape[0])             # <<<<<<<<<<<<<<
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)             # <<<<<<<<<<<<<<
  *      cdef cmd_ndarray_long(self, ckey, val):
  *          cdef long [:] abuffer = val.ravel()
  */
-  __pyx_t_9 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_9) && PyErr_Occurred())) __PYX_ERR(0, 106, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_9) && PyErr_Occurred())) __PYX_ERR(0, 198, __pyx_L1_error)
   __pyx_t_10 = 0;
   __pyx_t_11 = -1;
   if (__pyx_t_10 < 0) {
     __pyx_t_10 += __pyx_v_abuffer.shape[0];
     if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
   } else if (unlikely(__pyx_t_10 >= __pyx_v_abuffer.shape[0])) __pyx_t_11 = 0;
   if (unlikely(__pyx_t_11 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_11);
-    __PYX_ERR(0, 106, __pyx_L1_error)
+    __PYX_ERR(0, 198, __pyx_L1_error)
   }
-  try {
-    __pyx_v_self->c_plumed.cmd(__pyx_t_9, ((int *)(&(*((int *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_10 * __pyx_v_abuffer.strides[0]) ))))), ((size_t *)(&(__pyx_v_ashape[0]))));
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 106, __pyx_L1_error)
+  if (unlikely(!__pyx_v_abuffer.memview)) { __Pyx_RaiseUnboundLocalError("abuffer"); __PYX_ERR(0, 198, __pyx_L1_error) }
+  __pyx_t_12 = 0;
+  __pyx_t_11 = -1;
+  if (__pyx_t_12 < 0) {
+    __pyx_t_12 += __pyx_v_abuffer.shape[0];
+    if (unlikely(__pyx_t_12 < 0)) __pyx_t_11 = 0;
+  } else if (unlikely(__pyx_t_12 >= __pyx_v_abuffer.shape[0])) __pyx_t_11 = 0;
+  if (unlikely(__pyx_t_11 != -1)) {
+    __Pyx_RaiseBufferIndexError(__pyx_t_11);
+    __PYX_ERR(0, 198, __pyx_L1_error)
   }
+  __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_t_9, (&(*((int *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_10 * __pyx_v_abuffer.strides[0]) )))), 0, (&(__pyx_v_ashape[0])), (((sizeof((*((int *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_12 * __pyx_v_abuffer.strides[0]) ))))) + 0x30000) + 0x4000000)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 198, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":98
+  /* "plumed.pyx":190
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <double*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_real +  type_pointer)
  *      cdef cmd_ndarray_int(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef int [:] abuffer = val.ravel()
  *          cdef size_t ashape[5]
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
@@ -4510,17 +5836,17 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_abuffer, 1);
   __Pyx_XDECREF(__pyx_v_shape);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":107
+/* "plumed.pyx":199
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <int*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_ndarray_long(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef long [:] abuffer = val.ravel()
  *          cdef size_t ashape[5]
  */
 
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_ndarray_long(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val) {
   __Pyx_memviewslice __pyx_v_abuffer = { 0, 0, { 0 }, { 0 }, { 0 } };
@@ -4536,142 +5862,151 @@
   Py_ssize_t __pyx_t_5;
   Py_ssize_t __pyx_t_6;
   Py_ssize_t __pyx_t_7;
   size_t __pyx_t_8;
   char const *__pyx_t_9;
   Py_ssize_t __pyx_t_10;
   int __pyx_t_11;
+  Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd_ndarray_long", 0);
 
-  /* "plumed.pyx":108
- *          self.c_plumed.cmd_shaped( ckey, <int*>&abuffer[0], <size_t*> & ashape[0])
+  /* "plumed.pyx":200
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_ndarray_long(self, ckey, val):
  *          cdef long [:] abuffer = val.ravel()             # <<<<<<<<<<<<<<
  *          cdef size_t ashape[5]
  *          shape=val.shape
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 200, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 200, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 200, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_abuffer = __pyx_t_4;
   __pyx_t_4.memview = NULL;
   __pyx_t_4.data = NULL;
 
-  /* "plumed.pyx":110
+  /* "plumed.pyx":202
  *          cdef long [:] abuffer = val.ravel()
  *          cdef size_t ashape[5]
  *          shape=val.shape             # <<<<<<<<<<<<<<
  *          assert len(shape)<5
  *          for i in range(len(shape)):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 202, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_shape = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":111
+  /* "plumed.pyx":203
  *          cdef size_t ashape[5]
  *          shape=val.shape
  *          assert len(shape)<5             # <<<<<<<<<<<<<<
  *          for i in range(len(shape)):
  *             ashape[i]=shape[i]
  */
   #ifndef CYTHON_WITHOUT_ASSERTIONS
   if (unlikely(!Py_OptimizeFlag)) {
-    __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 111, __pyx_L1_error)
+    __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 203, __pyx_L1_error)
     if (unlikely(!((__pyx_t_5 < 5) != 0))) {
       PyErr_SetNone(PyExc_AssertionError);
-      __PYX_ERR(0, 111, __pyx_L1_error)
+      __PYX_ERR(0, 203, __pyx_L1_error)
     }
   }
   #endif
 
-  /* "plumed.pyx":112
+  /* "plumed.pyx":204
  *          shape=val.shape
  *          assert len(shape)<5
  *          for i in range(len(shape)):             # <<<<<<<<<<<<<<
  *             ashape[i]=shape[i]
  *          ashape[len(shape)]=0
  */
-  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 112, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 204, __pyx_L1_error)
   __pyx_t_6 = __pyx_t_5;
   for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
     __pyx_v_i = __pyx_t_7;
 
-    /* "plumed.pyx":113
+    /* "plumed.pyx":205
  *          assert len(shape)<5
  *          for i in range(len(shape)):
  *             ashape[i]=shape[i]             # <<<<<<<<<<<<<<
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <long*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  */
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_shape, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_shape, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 205, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyInt_As_size_t(__pyx_t_1); if (unlikely((__pyx_t_8 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 113, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_As_size_t(__pyx_t_1); if (unlikely((__pyx_t_8 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 205, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     (__pyx_v_ashape[__pyx_v_i]) = __pyx_t_8;
   }
 
-  /* "plumed.pyx":114
+  /* "plumed.pyx":206
  *          for i in range(len(shape)):
  *             ashape[i]=shape[i]
  *          ashape[len(shape)]=0             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd_shaped( ckey, <long*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_array_double(self, ckey, val):
  */
-  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 114, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 206, __pyx_L1_error)
   (__pyx_v_ashape[__pyx_t_5]) = 0;
 
-  /* "plumed.pyx":115
+  /* "plumed.pyx":207
  *             ashape[i]=shape[i]
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <long*>&abuffer[0], <size_t*> & ashape[0])             # <<<<<<<<<<<<<<
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)             # <<<<<<<<<<<<<<
  *      cdef cmd_array_double(self, ckey, val):
  *          cdef double [:] abuffer = val
  */
-  __pyx_t_9 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_9) && PyErr_Occurred())) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_9) && PyErr_Occurred())) __PYX_ERR(0, 207, __pyx_L1_error)
   __pyx_t_10 = 0;
   __pyx_t_11 = -1;
   if (__pyx_t_10 < 0) {
     __pyx_t_10 += __pyx_v_abuffer.shape[0];
     if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
   } else if (unlikely(__pyx_t_10 >= __pyx_v_abuffer.shape[0])) __pyx_t_11 = 0;
   if (unlikely(__pyx_t_11 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_11);
-    __PYX_ERR(0, 115, __pyx_L1_error)
+    __PYX_ERR(0, 207, __pyx_L1_error)
   }
-  try {
-    __pyx_v_self->c_plumed.cmd(__pyx_t_9, ((long *)(&(*((long *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_10 * __pyx_v_abuffer.strides[0]) ))))), ((size_t *)(&(__pyx_v_ashape[0]))));
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 115, __pyx_L1_error)
+  if (unlikely(!__pyx_v_abuffer.memview)) { __Pyx_RaiseUnboundLocalError("abuffer"); __PYX_ERR(0, 207, __pyx_L1_error) }
+  __pyx_t_12 = 0;
+  __pyx_t_11 = -1;
+  if (__pyx_t_12 < 0) {
+    __pyx_t_12 += __pyx_v_abuffer.shape[0];
+    if (unlikely(__pyx_t_12 < 0)) __pyx_t_11 = 0;
+  } else if (unlikely(__pyx_t_12 >= __pyx_v_abuffer.shape[0])) __pyx_t_11 = 0;
+  if (unlikely(__pyx_t_11 != -1)) {
+    __Pyx_RaiseBufferIndexError(__pyx_t_11);
+    __PYX_ERR(0, 207, __pyx_L1_error)
   }
+  __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_t_9, (&(*((long *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_10 * __pyx_v_abuffer.strides[0]) )))), 0, (&(__pyx_v_ashape[0])), (((sizeof((*((long *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_12 * __pyx_v_abuffer.strides[0]) ))))) + 0x30000) + 0x4000000)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 207, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":107
+  /* "plumed.pyx":199
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <int*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_ndarray_long(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef long [:] abuffer = val.ravel()
  *          cdef size_t ashape[5]
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
@@ -4687,367 +6022,398 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_abuffer, 1);
   __Pyx_XDECREF(__pyx_v_shape);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":116
+/* "plumed.pyx":208
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <long*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_array_double(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef double [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <double*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_real +  type_pointer)
  */
 
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_array_double(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val) {
   __Pyx_memviewslice __pyx_v_abuffer = { 0, 0, { 0 }, { 0 }, { 0 } };
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_memviewslice __pyx_t_1 = { 0, 0, { 0 }, { 0 }, { 0 } };
   char const *__pyx_t_2;
   Py_ssize_t __pyx_t_3;
   int __pyx_t_4;
   size_t __pyx_t_5;
+  Py_ssize_t __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd_array_double", 0);
 
-  /* "plumed.pyx":117
- *          self.c_plumed.cmd_shaped( ckey, <long*>&abuffer[0], <size_t*> & ashape[0])
+  /* "plumed.pyx":209
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_array_double(self, ckey, val):
  *          cdef double [:] abuffer = val             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd( ckey, <double*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_real +  type_pointer)
  *      cdef cmd_array_int(self, ckey, val):
  */
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_val, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_val, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 209, __pyx_L1_error)
   __pyx_v_abuffer = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "plumed.pyx":118
+  /* "plumed.pyx":210
  *      cdef cmd_array_double(self, ckey, val):
  *          cdef double [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <double*>&abuffer[0], len(abuffer))             # <<<<<<<<<<<<<<
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_real +  type_pointer)             # <<<<<<<<<<<<<<
  *      cdef cmd_array_int(self, ckey, val):
  *          cdef int [:] abuffer = val
  */
-  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 210, __pyx_L1_error)
   __pyx_t_3 = 0;
   __pyx_t_4 = -1;
   if (__pyx_t_3 < 0) {
     __pyx_t_3 += __pyx_v_abuffer.shape[0];
     if (unlikely(__pyx_t_3 < 0)) __pyx_t_4 = 0;
   } else if (unlikely(__pyx_t_3 >= __pyx_v_abuffer.shape[0])) __pyx_t_4 = 0;
   if (unlikely(__pyx_t_4 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_4);
-    __PYX_ERR(0, 118, __pyx_L1_error)
+    __PYX_ERR(0, 210, __pyx_L1_error)
   }
   __pyx_t_5 = __Pyx_MemoryView_Len(__pyx_v_abuffer); 
-  try {
-    __pyx_v_self->c_plumed.cmd(__pyx_t_2, ((double *)(&(*((double *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_3 * __pyx_v_abuffer.strides[0]) ))))), __pyx_t_5);
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 118, __pyx_L1_error)
+  if (unlikely(!__pyx_v_abuffer.memview)) { __Pyx_RaiseUnboundLocalError("abuffer"); __PYX_ERR(0, 210, __pyx_L1_error) }
+  __pyx_t_6 = 0;
+  __pyx_t_4 = -1;
+  if (__pyx_t_6 < 0) {
+    __pyx_t_6 += __pyx_v_abuffer.shape[0];
+    if (unlikely(__pyx_t_6 < 0)) __pyx_t_4 = 0;
+  } else if (unlikely(__pyx_t_6 >= __pyx_v_abuffer.shape[0])) __pyx_t_4 = 0;
+  if (unlikely(__pyx_t_4 != -1)) {
+    __Pyx_RaiseBufferIndexError(__pyx_t_4);
+    __PYX_ERR(0, 210, __pyx_L1_error)
   }
+  __pyx_t_7 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_t_2, (&(*((double *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_3 * __pyx_v_abuffer.strides[0]) )))), __pyx_t_5, NULL, (((sizeof((*((double *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_6 * __pyx_v_abuffer.strides[0]) ))))) + 0x40000) + 0x4000000)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 210, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "plumed.pyx":116
+  /* "plumed.pyx":208
  *          ashape[len(shape)]=0
- *          self.c_plumed.cmd_shaped( ckey, <long*>&abuffer[0], <size_t*> & ashape[0])
+ *          self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_array_double(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef double [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <double*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_real +  type_pointer)
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
+  __Pyx_XDECREF(__pyx_t_7);
   __Pyx_AddTraceback("plumed.Plumed.cmd_array_double", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __PYX_XDEC_MEMVIEW(&__pyx_v_abuffer, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":119
+/* "plumed.pyx":211
  *          cdef double [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <double*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_real +  type_pointer)
  *      cdef cmd_array_int(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef int [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <int*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  */
 
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_array_int(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val) {
   __Pyx_memviewslice __pyx_v_abuffer = { 0, 0, { 0 }, { 0 }, { 0 } };
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_memviewslice __pyx_t_1 = { 0, 0, { 0 }, { 0 }, { 0 } };
   char const *__pyx_t_2;
   Py_ssize_t __pyx_t_3;
   int __pyx_t_4;
   size_t __pyx_t_5;
+  Py_ssize_t __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd_array_int", 0);
 
-  /* "plumed.pyx":120
- *          self.c_plumed.cmd( ckey, <double*>&abuffer[0], len(abuffer))
+  /* "plumed.pyx":212
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_real +  type_pointer)
  *      cdef cmd_array_int(self, ckey, val):
  *          cdef int [:] abuffer = val             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd( ckey, <int*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_array_long(self, ckey, val):
  */
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_val, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 120, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_val, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 212, __pyx_L1_error)
   __pyx_v_abuffer = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "plumed.pyx":121
+  /* "plumed.pyx":213
  *      cdef cmd_array_int(self, ckey, val):
  *          cdef int [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <int*>&abuffer[0], len(abuffer))             # <<<<<<<<<<<<<<
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)             # <<<<<<<<<<<<<<
  *      cdef cmd_array_long(self, ckey, val):
  *          cdef long [:] abuffer = val
  */
-  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 213, __pyx_L1_error)
   __pyx_t_3 = 0;
   __pyx_t_4 = -1;
   if (__pyx_t_3 < 0) {
     __pyx_t_3 += __pyx_v_abuffer.shape[0];
     if (unlikely(__pyx_t_3 < 0)) __pyx_t_4 = 0;
   } else if (unlikely(__pyx_t_3 >= __pyx_v_abuffer.shape[0])) __pyx_t_4 = 0;
   if (unlikely(__pyx_t_4 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_4);
-    __PYX_ERR(0, 121, __pyx_L1_error)
+    __PYX_ERR(0, 213, __pyx_L1_error)
   }
   __pyx_t_5 = __Pyx_MemoryView_Len(__pyx_v_abuffer); 
-  try {
-    __pyx_v_self->c_plumed.cmd(__pyx_t_2, ((int *)(&(*((int *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_3 * __pyx_v_abuffer.strides[0]) ))))), __pyx_t_5);
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 121, __pyx_L1_error)
+  if (unlikely(!__pyx_v_abuffer.memview)) { __Pyx_RaiseUnboundLocalError("abuffer"); __PYX_ERR(0, 213, __pyx_L1_error) }
+  __pyx_t_6 = 0;
+  __pyx_t_4 = -1;
+  if (__pyx_t_6 < 0) {
+    __pyx_t_6 += __pyx_v_abuffer.shape[0];
+    if (unlikely(__pyx_t_6 < 0)) __pyx_t_4 = 0;
+  } else if (unlikely(__pyx_t_6 >= __pyx_v_abuffer.shape[0])) __pyx_t_4 = 0;
+  if (unlikely(__pyx_t_4 != -1)) {
+    __Pyx_RaiseBufferIndexError(__pyx_t_4);
+    __PYX_ERR(0, 213, __pyx_L1_error)
   }
+  __pyx_t_7 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_t_2, (&(*((int *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_3 * __pyx_v_abuffer.strides[0]) )))), __pyx_t_5, NULL, (((sizeof((*((int *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_6 * __pyx_v_abuffer.strides[0]) ))))) + 0x30000) + 0x4000000)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 213, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "plumed.pyx":119
+  /* "plumed.pyx":211
  *          cdef double [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <double*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_real +  type_pointer)
  *      cdef cmd_array_int(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef int [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <int*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
+  __Pyx_XDECREF(__pyx_t_7);
   __Pyx_AddTraceback("plumed.Plumed.cmd_array_int", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __PYX_XDEC_MEMVIEW(&__pyx_v_abuffer, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":122
+/* "plumed.pyx":214
  *          cdef int [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <int*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_array_long(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef long [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <long*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  */
 
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_array_long(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val) {
   __Pyx_memviewslice __pyx_v_abuffer = { 0, 0, { 0 }, { 0 }, { 0 } };
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   __Pyx_memviewslice __pyx_t_1 = { 0, 0, { 0 }, { 0 }, { 0 } };
   char const *__pyx_t_2;
   Py_ssize_t __pyx_t_3;
   int __pyx_t_4;
   size_t __pyx_t_5;
+  Py_ssize_t __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd_array_long", 0);
 
-  /* "plumed.pyx":123
- *          self.c_plumed.cmd( ckey, <int*>&abuffer[0], len(abuffer))
+  /* "plumed.pyx":215
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_array_long(self, ckey, val):
  *          cdef long [:] abuffer = val             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd( ckey, <long*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_float(self, ckey, double val ):
  */
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_val, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 123, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_val, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 215, __pyx_L1_error)
   __pyx_v_abuffer = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "plumed.pyx":124
+  /* "plumed.pyx":216
  *      cdef cmd_array_long(self, ckey, val):
  *          cdef long [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <long*>&abuffer[0], len(abuffer))             # <<<<<<<<<<<<<<
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)             # <<<<<<<<<<<<<<
  *      cdef cmd_float(self, ckey, double val ):
- *          self.c_plumed.cmd_float( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_real +  type_value)
  */
-  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 124, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 216, __pyx_L1_error)
   __pyx_t_3 = 0;
   __pyx_t_4 = -1;
   if (__pyx_t_3 < 0) {
     __pyx_t_3 += __pyx_v_abuffer.shape[0];
     if (unlikely(__pyx_t_3 < 0)) __pyx_t_4 = 0;
   } else if (unlikely(__pyx_t_3 >= __pyx_v_abuffer.shape[0])) __pyx_t_4 = 0;
   if (unlikely(__pyx_t_4 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_4);
-    __PYX_ERR(0, 124, __pyx_L1_error)
+    __PYX_ERR(0, 216, __pyx_L1_error)
   }
   __pyx_t_5 = __Pyx_MemoryView_Len(__pyx_v_abuffer); 
-  try {
-    __pyx_v_self->c_plumed.cmd(__pyx_t_2, ((long *)(&(*((long *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_3 * __pyx_v_abuffer.strides[0]) ))))), __pyx_t_5);
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 124, __pyx_L1_error)
+  if (unlikely(!__pyx_v_abuffer.memview)) { __Pyx_RaiseUnboundLocalError("abuffer"); __PYX_ERR(0, 216, __pyx_L1_error) }
+  __pyx_t_6 = 0;
+  __pyx_t_4 = -1;
+  if (__pyx_t_6 < 0) {
+    __pyx_t_6 += __pyx_v_abuffer.shape[0];
+    if (unlikely(__pyx_t_6 < 0)) __pyx_t_4 = 0;
+  } else if (unlikely(__pyx_t_6 >= __pyx_v_abuffer.shape[0])) __pyx_t_4 = 0;
+  if (unlikely(__pyx_t_4 != -1)) {
+    __Pyx_RaiseBufferIndexError(__pyx_t_4);
+    __PYX_ERR(0, 216, __pyx_L1_error)
   }
+  __pyx_t_7 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_t_2, (&(*((long *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_3 * __pyx_v_abuffer.strides[0]) )))), __pyx_t_5, NULL, (((sizeof((*((long *) ( /* dim=0 */ (__pyx_v_abuffer.data + __pyx_t_6 * __pyx_v_abuffer.strides[0]) ))))) + 0x30000) + 0x4000000)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 216, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "plumed.pyx":122
+  /* "plumed.pyx":214
  *          cdef int [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <int*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_array_long(self, ckey, val):             # <<<<<<<<<<<<<<
  *          cdef long [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <long*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
+  __Pyx_XDECREF(__pyx_t_7);
   __Pyx_AddTraceback("plumed.Plumed.cmd_array_long", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __PYX_XDEC_MEMVIEW(&__pyx_v_abuffer, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":125
+/* "plumed.pyx":217
  *          cdef long [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <long*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_float(self, ckey, double val ):             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd_float( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_real +  type_value)
  *      cdef cmd_int(self, ckey, int val):
  */
 
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_float(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, double __pyx_v_val) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   char const *__pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd_float", 0);
 
-  /* "plumed.pyx":126
- *          self.c_plumed.cmd( ckey, <long*>&abuffer[0], len(abuffer))
+  /* "plumed.pyx":218
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_float(self, ckey, double val ):
- *          self.c_plumed.cmd_float( ckey, val)             # <<<<<<<<<<<<<<
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_real +  type_value)             # <<<<<<<<<<<<<<
  *      cdef cmd_int(self, ckey, int val):
- *          self.c_plumed.cmd_int( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_integral +  type_value)
  */
-  __pyx_t_1 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 126, __pyx_L1_error)
-  try {
-    __pyx_v_self->c_plumed.cmd(__pyx_t_1, __pyx_v_val);
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 126, __pyx_L1_error)
-  }
+  __pyx_t_1 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 218, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_t_1, (&__pyx_v_val), 1, NULL, (((sizeof(__pyx_v_val)) + 0x40000) + 0x2000000)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 218, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":125
+  /* "plumed.pyx":217
  *          cdef long [:] abuffer = val
- *          self.c_plumed.cmd( ckey, <long*>&abuffer[0], len(abuffer))
+ *          self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
  *      cdef cmd_float(self, ckey, double val ):             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd_float( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_real +  type_value)
  *      cdef cmd_int(self, ckey, int val):
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("plumed.Plumed.cmd_float", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":127
+/* "plumed.pyx":219
  *      cdef cmd_float(self, ckey, double val ):
- *          self.c_plumed.cmd_float( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_real +  type_value)
  *      cdef cmd_int(self, ckey, int val):             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd_int( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_integral +  type_value)
  *      cdef cmd_mpi(self, ckey, val):
  */
 
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_int(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, int __pyx_v_val) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   char const *__pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd_int", 0);
 
-  /* "plumed.pyx":128
- *          self.c_plumed.cmd_float( ckey, val)
+  /* "plumed.pyx":220
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_real +  type_value)
  *      cdef cmd_int(self, ckey, int val):
- *          self.c_plumed.cmd_int( ckey, val)             # <<<<<<<<<<<<<<
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_integral +  type_value)             # <<<<<<<<<<<<<<
  *      cdef cmd_mpi(self, ckey, val):
  *          import mpi4py.MPI as MPI
  */
-  __pyx_t_1 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 128, __pyx_L1_error)
-  try {
-    __pyx_v_self->c_plumed.cmd(__pyx_t_1, __pyx_v_val);
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 128, __pyx_L1_error)
-  }
+  __pyx_t_1 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_t_1, (&__pyx_v_val), 1, NULL, (((sizeof(__pyx_v_val)) + 0x30000) + 0x2000000)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":127
+  /* "plumed.pyx":219
  *      cdef cmd_float(self, ckey, double val ):
- *          self.c_plumed.cmd_float( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_real +  type_value)
  *      cdef cmd_int(self, ckey, int val):             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd_int( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_integral +  type_value)
  *      cdef cmd_mpi(self, ckey, val):
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("plumed.Plumed.cmd_int", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":129
+/* "plumed.pyx":221
  *      cdef cmd_int(self, ckey, int val):
- *          self.c_plumed.cmd_int( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_integral +  type_value)
  *      cdef cmd_mpi(self, ckey, val):             # <<<<<<<<<<<<<<
  *          import mpi4py.MPI as MPI
  *          cdef size_t comm_addr = MPI._addressof(val)
  */
 
 static PyObject *__pyx_f_6plumed_6Plumed_cmd_mpi(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_ckey, PyObject *__pyx_v_val) {
   PyObject *__pyx_v_MPI = NULL;
@@ -5060,78 +6426,75 @@
   size_t __pyx_t_4;
   char const *__pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd_mpi", 0);
 
-  /* "plumed.pyx":130
- *          self.c_plumed.cmd_int( ckey, val)
+  /* "plumed.pyx":222
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_integral +  type_value)
  *      cdef cmd_mpi(self, ckey, val):
  *          import mpi4py.MPI as MPI             # <<<<<<<<<<<<<<
  *          cdef size_t comm_addr = MPI._addressof(val)
- *          self.c_plumed.cmd_mpi( ckey, <const void*>comm_addr)
+ *          self.cmd_low_level(ckey,<void*>comm_addr, 0, NULL, type_void +  type_const_pointer)
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 130, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 222, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_INCREF(__pyx_n_s__2);
-  __Pyx_GIVEREF(__pyx_n_s__2);
-  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s__2);
-  __pyx_t_2 = __Pyx_Import(__pyx_n_s_mpi4py_MPI, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 130, __pyx_L1_error)
+  __Pyx_INCREF(__pyx_n_s__4);
+  __Pyx_GIVEREF(__pyx_n_s__4);
+  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s__4);
+  __pyx_t_2 = __Pyx_Import(__pyx_n_s_mpi4py_MPI, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 222, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_MPI = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "plumed.pyx":131
+  /* "plumed.pyx":223
  *      cdef cmd_mpi(self, ckey, val):
  *          import mpi4py.MPI as MPI
  *          cdef size_t comm_addr = MPI._addressof(val)             # <<<<<<<<<<<<<<
- *          self.c_plumed.cmd_mpi( ckey, <const void*>comm_addr)
+ *          self.cmd_low_level(ckey,<void*>comm_addr, 0, NULL, type_void +  type_const_pointer)
  *      def cmd( self, key, val=None ):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_MPI, __pyx_n_s_addressof); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_MPI, __pyx_n_s_addressof); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 223, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_v_val) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_val);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 131, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 223, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_4 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_4 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_4 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 223, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_comm_addr = __pyx_t_4;
 
-  /* "plumed.pyx":132
+  /* "plumed.pyx":224
  *          import mpi4py.MPI as MPI
  *          cdef size_t comm_addr = MPI._addressof(val)
- *          self.c_plumed.cmd_mpi( ckey, <const void*>comm_addr)             # <<<<<<<<<<<<<<
+ *          self.cmd_low_level(ckey,<void*>comm_addr, 0, NULL, type_void +  type_const_pointer)             # <<<<<<<<<<<<<<
  *      def cmd( self, key, val=None ):
  *          cdef bytes py_bytes = key.encode()
  */
-  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) __PYX_ERR(0, 132, __pyx_L1_error)
-  try {
-    __pyx_v_self->c_plumed.cmd(__pyx_t_5, ((void const *)__pyx_v_comm_addr));
-  } catch(...) {
-    exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-    __PYX_ERR(0, 132, __pyx_L1_error)
-  }
+  __pyx_t_5 = __Pyx_PyObject_AsString(__pyx_v_ckey); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_t_5, ((void *)__pyx_v_comm_addr), 0, NULL, 0x6010000); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 224, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":129
+  /* "plumed.pyx":221
  *      cdef cmd_int(self, ckey, int val):
- *          self.c_plumed.cmd_int( ckey, val)
+ *          self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_integral +  type_value)
  *      cdef cmd_mpi(self, ckey, val):             # <<<<<<<<<<<<<<
  *          import mpi4py.MPI as MPI
  *          cdef size_t comm_addr = MPI._addressof(val)
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
@@ -5145,26 +6508,26 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_MPI);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":133
+/* "plumed.pyx":225
  *          cdef size_t comm_addr = MPI._addressof(val)
- *          self.c_plumed.cmd_mpi( ckey, <const void*>comm_addr)
+ *          self.cmd_low_level(ckey,<void*>comm_addr, 0, NULL, type_void +  type_const_pointer)
  *      def cmd( self, key, val=None ):             # <<<<<<<<<<<<<<
  *          cdef bytes py_bytes = key.encode()
  *          cdef char* ckey = py_bytes
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_6Plumed_9cmd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_6plumed_6Plumed_9cmd = {"cmd", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_6Plumed_9cmd, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_6plumed_6Plumed_9cmd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_6Plumed_13cmd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_6plumed_6Plumed_13cmd = {"cmd", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_6Plumed_13cmd, METH_VARARGS|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_6plumed_6Plumed_13cmd(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_key = 0;
   PyObject *__pyx_v_val = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
@@ -5193,15 +6556,15 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_val);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cmd") < 0)) __PYX_ERR(0, 133, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cmd") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
@@ -5209,28 +6572,28 @@
       }
     }
     __pyx_v_key = values[0];
     __pyx_v_val = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("cmd", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 133, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("cmd", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.Plumed.cmd", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_6Plumed_8cmd(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self), __pyx_v_key, __pyx_v_val);
+  __pyx_r = __pyx_pf_6plumed_6Plumed_12cmd(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self), __pyx_v_key, __pyx_v_val);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_6Plumed_8cmd(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_key, PyObject *__pyx_v_val) {
+static PyObject *__pyx_pf_6plumed_6Plumed_12cmd(struct __pyx_obj_6plumed_Plumed *__pyx_v_self, PyObject *__pyx_v_key, PyObject *__pyx_v_val) {
   PyObject *__pyx_v_py_bytes = 0;
   char *__pyx_v_ckey;
   char *__pyx_v_cval;
   PyObject *__pyx_v_MPI = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
@@ -5244,103 +6607,100 @@
   double __pyx_t_9;
   PyObject *__pyx_t_10 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("cmd", 0);
 
-  /* "plumed.pyx":134
- *          self.c_plumed.cmd_mpi( ckey, <const void*>comm_addr)
+  /* "plumed.pyx":226
+ *          self.cmd_low_level(ckey,<void*>comm_addr, 0, NULL, type_void +  type_const_pointer)
  *      def cmd( self, key, val=None ):
  *          cdef bytes py_bytes = key.encode()             # <<<<<<<<<<<<<<
  *          cdef char* ckey = py_bytes
  *          cdef char* cval
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_encode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 134, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_encode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 226, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 226, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 134, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 226, __pyx_L1_error)
   __pyx_v_py_bytes = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":135
+  /* "plumed.pyx":227
  *      def cmd( self, key, val=None ):
  *          cdef bytes py_bytes = key.encode()
  *          cdef char* ckey = py_bytes             # <<<<<<<<<<<<<<
  *          cdef char* cval
  *          if val is None :
  */
   if (unlikely(__pyx_v_py_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 135, __pyx_L1_error)
+    __PYX_ERR(0, 227, __pyx_L1_error)
   }
-  __pyx_t_4 = __Pyx_PyBytes_AsWritableString(__pyx_v_py_bytes); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 135, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBytes_AsWritableString(__pyx_v_py_bytes); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 227, __pyx_L1_error)
   __pyx_v_ckey = __pyx_t_4;
 
-  /* "plumed.pyx":137
+  /* "plumed.pyx":229
  *          cdef char* ckey = py_bytes
  *          cdef char* cval
  *          if val is None :             # <<<<<<<<<<<<<<
- *             self.c_plumed.cmd( ckey)
+ *             self.cmd_low_level(ckey,NULL,0,NULL,type_nullptr)
  *             return
  */
   __pyx_t_5 = (__pyx_v_val == Py_None);
   __pyx_t_6 = (__pyx_t_5 != 0);
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":138
+    /* "plumed.pyx":230
  *          cdef char* cval
  *          if val is None :
- *             self.c_plumed.cmd( ckey)             # <<<<<<<<<<<<<<
+ *             self.cmd_low_level(ckey,NULL,0,NULL,type_nullptr)             # <<<<<<<<<<<<<<
  *             return
  *          if isinstance(val, (int,long) ):
  */
-    try {
-      __pyx_v_self->c_plumed.cmd(__pyx_v_ckey);
-    } catch(...) {
-      exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-      __PYX_ERR(0, 138, __pyx_L1_error)
-    }
+    __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_v_ckey, NULL, 0, NULL, 0x20000); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "plumed.pyx":139
+    /* "plumed.pyx":231
  *          if val is None :
- *             self.c_plumed.cmd( ckey)
+ *             self.cmd_low_level(ckey,NULL,0,NULL,type_nullptr)
  *             return             # <<<<<<<<<<<<<<
  *          if isinstance(val, (int,long) ):
  *             self.cmd_int(ckey, val)
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "plumed.pyx":137
+    /* "plumed.pyx":229
  *          cdef char* ckey = py_bytes
  *          cdef char* cval
  *          if val is None :             # <<<<<<<<<<<<<<
- *             self.c_plumed.cmd( ckey)
+ *             self.cmd_low_level(ckey,NULL,0,NULL,type_nullptr)
  *             return
  */
   }
 
-  /* "plumed.pyx":140
- *             self.c_plumed.cmd( ckey)
+  /* "plumed.pyx":232
+ *             self.cmd_low_level(ckey,NULL,0,NULL,type_nullptr)
  *             return
  *          if isinstance(val, (int,long) ):             # <<<<<<<<<<<<<<
  *             self.cmd_int(ckey, val)
  *             return
  */
   __pyx_t_5 = PyInt_Check(__pyx_v_val); 
   __pyx_t_7 = (__pyx_t_5 != 0);
@@ -5352,719 +6712,716 @@
   __pyx_t_7 = PyLong_Check(__pyx_v_val); 
   __pyx_t_5 = (__pyx_t_7 != 0);
   __pyx_t_6 = __pyx_t_5;
   __pyx_L5_bool_binop_done:;
   __pyx_t_5 = (__pyx_t_6 != 0);
   if (__pyx_t_5) {
 
-    /* "plumed.pyx":141
+    /* "plumed.pyx":233
  *             return
  *          if isinstance(val, (int,long) ):
  *             self.cmd_int(ckey, val)             # <<<<<<<<<<<<<<
  *             return
  *          if isinstance(val, float ) :
  */
-    __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 233, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_v_val); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 141, __pyx_L1_error)
-    __pyx_t_2 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_int(__pyx_v_self, __pyx_t_1, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 141, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_v_val); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
+    __pyx_t_2 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_int(__pyx_v_self, __pyx_t_1, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 233, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":142
+    /* "plumed.pyx":234
  *          if isinstance(val, (int,long) ):
  *             self.cmd_int(ckey, val)
  *             return             # <<<<<<<<<<<<<<
  *          if isinstance(val, float ) :
  *             self.cmd_float(ckey, val)
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "plumed.pyx":140
- *             self.c_plumed.cmd( ckey)
+    /* "plumed.pyx":232
+ *             self.cmd_low_level(ckey,NULL,0,NULL,type_nullptr)
  *             return
  *          if isinstance(val, (int,long) ):             # <<<<<<<<<<<<<<
  *             self.cmd_int(ckey, val)
  *             return
  */
   }
 
-  /* "plumed.pyx":143
+  /* "plumed.pyx":235
  *             self.cmd_int(ckey, val)
  *             return
  *          if isinstance(val, float ) :             # <<<<<<<<<<<<<<
  *             self.cmd_float(ckey, val)
  *             return
  */
   __pyx_t_5 = PyFloat_Check(__pyx_v_val); 
   __pyx_t_6 = (__pyx_t_5 != 0);
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":144
+    /* "plumed.pyx":236
  *             return
  *          if isinstance(val, float ) :
  *             self.cmd_float(ckey, val)             # <<<<<<<<<<<<<<
  *             return
  *          if HAS_NUMPY and isinstance(val, np.ndarray) :
  */
-    __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 144, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 236, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_val); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
-    __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_float(__pyx_v_self, __pyx_t_2, __pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
+    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_val); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
+    __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_float(__pyx_v_self, __pyx_t_2, __pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "plumed.pyx":145
+    /* "plumed.pyx":237
  *          if isinstance(val, float ) :
  *             self.cmd_float(ckey, val)
  *             return             # <<<<<<<<<<<<<<
  *          if HAS_NUMPY and isinstance(val, np.ndarray) :
  *             # See https://numpy.org/doc/stable/user/basics.types.html
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "plumed.pyx":143
+    /* "plumed.pyx":235
  *             self.cmd_int(ckey, val)
  *             return
  *          if isinstance(val, float ) :             # <<<<<<<<<<<<<<
  *             self.cmd_float(ckey, val)
  *             return
  */
   }
 
-  /* "plumed.pyx":146
+  /* "plumed.pyx":238
  *             self.cmd_float(ckey, val)
  *             return
  *          if HAS_NUMPY and isinstance(val, np.ndarray) :             # <<<<<<<<<<<<<<
  *             # See https://numpy.org/doc/stable/user/basics.types.html
  *             if( val.dtype==np.double):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_HAS_NUMPY); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_HAS_NUMPY); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 238, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 238, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_5) {
   } else {
     __pyx_t_6 = __pyx_t_5;
     goto __pyx_L9_bool_binop_done;
   }
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 238, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_ndarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_ndarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 238, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = PyObject_IsInstance(__pyx_v_val, __pyx_t_2); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 146, __pyx_L1_error)
+  __pyx_t_5 = PyObject_IsInstance(__pyx_v_val, __pyx_t_2); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 238, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_7 = (__pyx_t_5 != 0);
   __pyx_t_6 = __pyx_t_7;
   __pyx_L9_bool_binop_done:;
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":148
+    /* "plumed.pyx":240
  *          if HAS_NUMPY and isinstance(val, np.ndarray) :
  *             # See https://numpy.org/doc/stable/user/basics.types.html
  *             if( val.dtype==np.double):             # <<<<<<<<<<<<<<
  *                self.cmd_ndarray_double(ckey, val)
  *             elif( val.dtype==np.intc ) :
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 148, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 240, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 240, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_double); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 148, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_double); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 240, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 240, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 148, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 240, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (__pyx_t_6) {
 
-      /* "plumed.pyx":149
+      /* "plumed.pyx":241
  *             # See https://numpy.org/doc/stable/user/basics.types.html
  *             if( val.dtype==np.double):
  *                self.cmd_ndarray_double(ckey, val)             # <<<<<<<<<<<<<<
  *             elif( val.dtype==np.intc ) :
  *                self.cmd_ndarray_int(ckey, val)
  */
-      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 241, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_3 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_ndarray_double(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 149, __pyx_L1_error)
+      __pyx_t_3 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_ndarray_double(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 241, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-      /* "plumed.pyx":148
+      /* "plumed.pyx":240
  *          if HAS_NUMPY and isinstance(val, np.ndarray) :
  *             # See https://numpy.org/doc/stable/user/basics.types.html
  *             if( val.dtype==np.double):             # <<<<<<<<<<<<<<
  *                self.cmd_ndarray_double(ckey, val)
  *             elif( val.dtype==np.intc ) :
  */
       goto __pyx_L11;
     }
 
-    /* "plumed.pyx":150
+    /* "plumed.pyx":242
  *             if( val.dtype==np.double):
  *                self.cmd_ndarray_double(ckey, val)
  *             elif( val.dtype==np.intc ) :             # <<<<<<<<<<<<<<
  *                self.cmd_ndarray_int(ckey, val)
  *             elif( val.dtype==np.int_ ) :
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_dtype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 150, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_dtype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 242, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_intc); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 150, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_intc); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 150, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 242, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (__pyx_t_6) {
 
-      /* "plumed.pyx":151
+      /* "plumed.pyx":243
  *                self.cmd_ndarray_double(ckey, val)
  *             elif( val.dtype==np.intc ) :
  *                self.cmd_ndarray_int(ckey, val)             # <<<<<<<<<<<<<<
  *             elif( val.dtype==np.int_ ) :
  *                self.cmd_ndarray_long(ckey, val)
  */
-      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 243, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_2 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_ndarray_int(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 151, __pyx_L1_error)
+      __pyx_t_2 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_ndarray_int(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 243, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-      /* "plumed.pyx":150
+      /* "plumed.pyx":242
  *             if( val.dtype==np.double):
  *                self.cmd_ndarray_double(ckey, val)
  *             elif( val.dtype==np.intc ) :             # <<<<<<<<<<<<<<
  *                self.cmd_ndarray_int(ckey, val)
  *             elif( val.dtype==np.int_ ) :
  */
       goto __pyx_L11;
     }
 
-    /* "plumed.pyx":152
+    /* "plumed.pyx":244
  *             elif( val.dtype==np.intc ) :
  *                self.cmd_ndarray_int(ckey, val)
  *             elif( val.dtype==np.int_ ) :             # <<<<<<<<<<<<<<
  *                self.cmd_ndarray_long(ckey, val)
  *             else :
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 152, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 244, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 152, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 244, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 152, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 244, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (likely(__pyx_t_6)) {
 
-      /* "plumed.pyx":153
+      /* "plumed.pyx":245
  *                self.cmd_ndarray_int(ckey, val)
  *             elif( val.dtype==np.int_ ) :
  *                self.cmd_ndarray_long(ckey, val)             # <<<<<<<<<<<<<<
  *             else :
- *                raise ValueError("ndarrys should be np.double, np.intc, or np.int_")
+ *                raise ValueError("ndarrays should be type np.double, np.intc, or np.int_")
  */
-      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 153, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 245, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_3 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_ndarray_long(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 153, __pyx_L1_error)
+      __pyx_t_3 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_ndarray_long(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 245, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-      /* "plumed.pyx":152
+      /* "plumed.pyx":244
  *             elif( val.dtype==np.intc ) :
  *                self.cmd_ndarray_int(ckey, val)
  *             elif( val.dtype==np.int_ ) :             # <<<<<<<<<<<<<<
  *                self.cmd_ndarray_long(ckey, val)
  *             else :
  */
       goto __pyx_L11;
     }
 
-    /* "plumed.pyx":155
+    /* "plumed.pyx":247
  *                self.cmd_ndarray_long(ckey, val)
  *             else :
- *                raise ValueError("ndarrys should be np.double, np.intc, or np.int_")             # <<<<<<<<<<<<<<
+ *                raise ValueError("ndarrays should be type np.double, np.intc, or np.int_")             # <<<<<<<<<<<<<<
  *             return
  *          if isinstance(val, array.array) :
  */
     /*else*/ {
-      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 155, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 247, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_Raise(__pyx_t_3, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __PYX_ERR(0, 155, __pyx_L1_error)
+      __PYX_ERR(0, 247, __pyx_L1_error)
     }
     __pyx_L11:;
 
-    /* "plumed.pyx":156
+    /* "plumed.pyx":248
  *             else :
- *                raise ValueError("ndarrys should be np.double, np.intc, or np.int_")
+ *                raise ValueError("ndarrays should be type np.double, np.intc, or np.int_")
  *             return             # <<<<<<<<<<<<<<
  *          if isinstance(val, array.array) :
  *             if( (val.typecode=="d" or val.typecode=="f") and val.itemsize==8):
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "plumed.pyx":146
+    /* "plumed.pyx":238
  *             self.cmd_float(ckey, val)
  *             return
  *          if HAS_NUMPY and isinstance(val, np.ndarray) :             # <<<<<<<<<<<<<<
  *             # See https://numpy.org/doc/stable/user/basics.types.html
  *             if( val.dtype==np.double):
  */
   }
 
-  /* "plumed.pyx":157
- *                raise ValueError("ndarrys should be np.double, np.intc, or np.int_")
+  /* "plumed.pyx":249
+ *                raise ValueError("ndarrays should be type np.double, np.intc, or np.int_")
  *             return
  *          if isinstance(val, array.array) :             # <<<<<<<<<<<<<<
  *             if( (val.typecode=="d" or val.typecode=="f") and val.itemsize==8):
  *                self.cmd_array_double(ckey, val)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 249, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 249, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_6 = PyObject_IsInstance(__pyx_v_val, __pyx_t_1); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_6 = PyObject_IsInstance(__pyx_v_val, __pyx_t_1); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 249, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "plumed.pyx":158
+    /* "plumed.pyx":250
  *             return
  *          if isinstance(val, array.array) :
  *             if( (val.typecode=="d" or val.typecode=="f") and val.itemsize==8):             # <<<<<<<<<<<<<<
  *                self.cmd_array_double(ckey, val)
  *             elif( (val.typecode=="i" or val.typecode=="I") ) :
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 158, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_d, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 158, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_d, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (!__pyx_t_6) {
     } else {
       goto __pyx_L15_next_and;
     }
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 158, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_f, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 158, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_f, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (__pyx_t_6) {
     } else {
       __pyx_t_7 = __pyx_t_6;
       goto __pyx_L14_bool_binop_done;
     }
     __pyx_L15_next_and:;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 158, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_8, 8, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 158, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_8, 8, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 158, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_7 = __pyx_t_6;
     __pyx_L14_bool_binop_done:;
     if (__pyx_t_7) {
 
-      /* "plumed.pyx":159
+      /* "plumed.pyx":251
  *          if isinstance(val, array.array) :
  *             if( (val.typecode=="d" or val.typecode=="f") and val.itemsize==8):
  *                self.cmd_array_double(ckey, val)             # <<<<<<<<<<<<<<
  *             elif( (val.typecode=="i" or val.typecode=="I") ) :
  *                self.cmd_array_int(ckey, val)
  */
-      __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 159, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 251, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_array_double(__pyx_v_self, __pyx_t_3, __pyx_v_val); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 159, __pyx_L1_error)
+      __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_array_double(__pyx_v_self, __pyx_t_3, __pyx_v_val); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 251, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-      /* "plumed.pyx":158
+      /* "plumed.pyx":250
  *             return
  *          if isinstance(val, array.array) :
  *             if( (val.typecode=="d" or val.typecode=="f") and val.itemsize==8):             # <<<<<<<<<<<<<<
  *                self.cmd_array_double(ckey, val)
  *             elif( (val.typecode=="i" or val.typecode=="I") ) :
  */
       goto __pyx_L13;
     }
 
-    /* "plumed.pyx":160
+    /* "plumed.pyx":252
  *             if( (val.typecode=="d" or val.typecode=="f") and val.itemsize==8):
  *                self.cmd_array_double(ckey, val)
  *             elif( (val.typecode=="i" or val.typecode=="I") ) :             # <<<<<<<<<<<<<<
  *                self.cmd_array_int(ckey, val)
  *             elif( (val.typecode=="l" or val.typecode=="L") ) :
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 160, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_i, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 160, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_i, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 252, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (!__pyx_t_6) {
     } else {
       __pyx_t_7 = __pyx_t_6;
       goto __pyx_L17_bool_binop_done;
     }
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 160, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_I, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 160, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_I, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 252, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_7 = __pyx_t_6;
     __pyx_L17_bool_binop_done:;
     if (__pyx_t_7) {
 
-      /* "plumed.pyx":161
+      /* "plumed.pyx":253
  *                self.cmd_array_double(ckey, val)
  *             elif( (val.typecode=="i" or val.typecode=="I") ) :
  *                self.cmd_array_int(ckey, val)             # <<<<<<<<<<<<<<
  *             elif( (val.typecode=="l" or val.typecode=="L") ) :
  *                self.cmd_array_long(ckey, val)
  */
-      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 161, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 253, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_3 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_array_int(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 161, __pyx_L1_error)
+      __pyx_t_3 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_array_int(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 253, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-      /* "plumed.pyx":160
+      /* "plumed.pyx":252
  *             if( (val.typecode=="d" or val.typecode=="f") and val.itemsize==8):
  *                self.cmd_array_double(ckey, val)
  *             elif( (val.typecode=="i" or val.typecode=="I") ) :             # <<<<<<<<<<<<<<
  *                self.cmd_array_int(ckey, val)
  *             elif( (val.typecode=="l" or val.typecode=="L") ) :
  */
       goto __pyx_L13;
     }
 
-    /* "plumed.pyx":162
+    /* "plumed.pyx":254
  *             elif( (val.typecode=="i" or val.typecode=="I") ) :
  *                self.cmd_array_int(ckey, val)
  *             elif( (val.typecode=="l" or val.typecode=="L") ) :             # <<<<<<<<<<<<<<
  *                self.cmd_array_long(ckey, val)
  *             else :
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 162, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_n_u_l, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 162, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_n_u_l, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (!__pyx_t_6) {
     } else {
       __pyx_t_7 = __pyx_t_6;
       goto __pyx_L19_bool_binop_done;
     }
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 162, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_typecode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_n_u_L, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 162, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_n_u_L, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_7 = __pyx_t_6;
     __pyx_L19_bool_binop_done:;
     if (likely(__pyx_t_7)) {
 
-      /* "plumed.pyx":163
+      /* "plumed.pyx":255
  *                self.cmd_array_int(ckey, val)
  *             elif( (val.typecode=="l" or val.typecode=="L") ) :
  *                self.cmd_array_long(ckey, val)             # <<<<<<<<<<<<<<
  *             else :
- *                raise ValueError("ndarrays should be double (size=8), int, or long")
+ *                raise ValueError("arrays should be type double (size=8), int, or long")
  */
-      __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 163, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 255, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_array_long(__pyx_v_self, __pyx_t_3, __pyx_v_val); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 163, __pyx_L1_error)
+      __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_array_long(__pyx_v_self, __pyx_t_3, __pyx_v_val); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 255, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-      /* "plumed.pyx":162
+      /* "plumed.pyx":254
  *             elif( (val.typecode=="i" or val.typecode=="I") ) :
  *                self.cmd_array_int(ckey, val)
  *             elif( (val.typecode=="l" or val.typecode=="L") ) :             # <<<<<<<<<<<<<<
  *                self.cmd_array_long(ckey, val)
  *             else :
  */
       goto __pyx_L13;
     }
 
-    /* "plumed.pyx":165
+    /* "plumed.pyx":257
  *                self.cmd_array_long(ckey, val)
  *             else :
- *                raise ValueError("ndarrays should be double (size=8), int, or long")             # <<<<<<<<<<<<<<
+ *                raise ValueError("arrays should be type double (size=8), int, or long")             # <<<<<<<<<<<<<<
  *             return
  *          if isinstance(val, str ) :
  */
     /*else*/ {
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 257, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_Raise(__pyx_t_1, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __PYX_ERR(0, 165, __pyx_L1_error)
+      __PYX_ERR(0, 257, __pyx_L1_error)
     }
     __pyx_L13:;
 
-    /* "plumed.pyx":166
+    /* "plumed.pyx":258
  *             else :
- *                raise ValueError("ndarrays should be double (size=8), int, or long")
+ *                raise ValueError("arrays should be type double (size=8), int, or long")
  *             return             # <<<<<<<<<<<<<<
  *          if isinstance(val, str ) :
  *             py_bytes = val.encode()
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "plumed.pyx":157
- *                raise ValueError("ndarrys should be np.double, np.intc, or np.int_")
+    /* "plumed.pyx":249
+ *                raise ValueError("ndarrays should be type np.double, np.intc, or np.int_")
  *             return
  *          if isinstance(val, array.array) :             # <<<<<<<<<<<<<<
  *             if( (val.typecode=="d" or val.typecode=="f") and val.itemsize==8):
  *                self.cmd_array_double(ckey, val)
  */
   }
 
-  /* "plumed.pyx":167
- *                raise ValueError("ndarrays should be double (size=8), int, or long")
+  /* "plumed.pyx":259
+ *                raise ValueError("arrays should be type double (size=8), int, or long")
  *             return
  *          if isinstance(val, str ) :             # <<<<<<<<<<<<<<
  *             py_bytes = val.encode()
  *             cval = py_bytes
  */
   __pyx_t_7 = PyUnicode_Check(__pyx_v_val); 
   __pyx_t_6 = (__pyx_t_7 != 0);
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":168
+    /* "plumed.pyx":260
  *             return
  *          if isinstance(val, str ) :
  *             py_bytes = val.encode()             # <<<<<<<<<<<<<<
  *             cval = py_bytes
- *             self.c_plumed.cmd( ckey, <const char*>cval )
+ *             # assume sizeof(char)=1
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_encode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 168, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_val, __pyx_n_s_encode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 260, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 260, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 168, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 260, __pyx_L1_error)
     __Pyx_DECREF_SET(__pyx_v_py_bytes, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
 
-    /* "plumed.pyx":169
+    /* "plumed.pyx":261
  *          if isinstance(val, str ) :
  *             py_bytes = val.encode()
  *             cval = py_bytes             # <<<<<<<<<<<<<<
- *             self.c_plumed.cmd( ckey, <const char*>cval )
- *             return
+ *             # assume sizeof(char)=1
+ *             self.cmd_low_level(ckey,cval,0, NULL,1 + type_integral + type_const_pointer + type_nocopy)
  */
     if (unlikely(__pyx_v_py_bytes == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-      __PYX_ERR(0, 169, __pyx_L1_error)
+      __PYX_ERR(0, 261, __pyx_L1_error)
     }
-    __pyx_t_4 = __Pyx_PyBytes_AsWritableString(__pyx_v_py_bytes); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 169, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyBytes_AsWritableString(__pyx_v_py_bytes); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 261, __pyx_L1_error)
     __pyx_v_cval = __pyx_t_4;
 
-    /* "plumed.pyx":170
- *             py_bytes = val.encode()
+    /* "plumed.pyx":263
  *             cval = py_bytes
- *             self.c_plumed.cmd( ckey, <const char*>cval )             # <<<<<<<<<<<<<<
+ *             # assume sizeof(char)=1
+ *             self.cmd_low_level(ckey,cval,0, NULL,1 + type_integral + type_const_pointer + type_nocopy)             # <<<<<<<<<<<<<<
  *             return
  *          if 'mpi4py' in sys.modules:
  */
-    try {
-      __pyx_v_self->c_plumed.cmd(__pyx_v_ckey, ((char const *)__pyx_v_cval));
-    } catch(...) {
-      exceptions_handler(); if (!PyErr_Occurred())PyErr_SetString(PyExc_RuntimeError, "Error converting c++ exception.");
-      __PYX_ERR(0, 170, __pyx_L1_error)
-    }
+    __pyx_t_1 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_low_level(__pyx_v_self, __pyx_v_ckey, __pyx_v_cval, 0, NULL, 0x16030001); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 263, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "plumed.pyx":171
- *             cval = py_bytes
- *             self.c_plumed.cmd( ckey, <const char*>cval )
+    /* "plumed.pyx":264
+ *             # assume sizeof(char)=1
+ *             self.cmd_low_level(ckey,cval,0, NULL,1 + type_integral + type_const_pointer + type_nocopy)
  *             return             # <<<<<<<<<<<<<<
  *          if 'mpi4py' in sys.modules:
  *             import mpi4py.MPI as MPI
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "plumed.pyx":167
- *                raise ValueError("ndarrays should be double (size=8), int, or long")
+    /* "plumed.pyx":259
+ *                raise ValueError("arrays should be type double (size=8), int, or long")
  *             return
  *          if isinstance(val, str ) :             # <<<<<<<<<<<<<<
  *             py_bytes = val.encode()
  *             cval = py_bytes
  */
   }
 
-  /* "plumed.pyx":172
- *             self.c_plumed.cmd( ckey, <const char*>cval )
+  /* "plumed.pyx":265
+ *             self.cmd_low_level(ckey,cval,0, NULL,1 + type_integral + type_const_pointer + type_nocopy)
  *             return
  *          if 'mpi4py' in sys.modules:             # <<<<<<<<<<<<<<
  *             import mpi4py.MPI as MPI
  *             if isinstance(val, MPI.Comm):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 265, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_modules); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 172, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_modules); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 265, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_mpi4py, __pyx_t_3, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 172, __pyx_L1_error)
+  __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_mpi4py, __pyx_t_3, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 265, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "plumed.pyx":173
+    /* "plumed.pyx":266
  *             return
  *          if 'mpi4py' in sys.modules:
  *             import mpi4py.MPI as MPI             # <<<<<<<<<<<<<<
  *             if isinstance(val, MPI.Comm):
  *               self.cmd_mpi(ckey, val)
  */
-    __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 173, __pyx_L1_error)
+    __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_INCREF(__pyx_n_s__2);
-    __Pyx_GIVEREF(__pyx_n_s__2);
-    PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s__2);
-    __pyx_t_1 = __Pyx_Import(__pyx_n_s_mpi4py_MPI, __pyx_t_3, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)
+    __Pyx_INCREF(__pyx_n_s__4);
+    __Pyx_GIVEREF(__pyx_n_s__4);
+    PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s__4);
+    __pyx_t_1 = __Pyx_Import(__pyx_n_s_mpi4py_MPI, __pyx_t_3, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_MPI = __pyx_t_1;
     __pyx_t_1 = 0;
 
-    /* "plumed.pyx":174
+    /* "plumed.pyx":267
  *          if 'mpi4py' in sys.modules:
  *             import mpi4py.MPI as MPI
  *             if isinstance(val, MPI.Comm):             # <<<<<<<<<<<<<<
  *               self.cmd_mpi(ckey, val)
  *               return
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_MPI, __pyx_n_s_Comm); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 174, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_MPI, __pyx_n_s_Comm); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 267, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = PyObject_IsInstance(__pyx_v_val, __pyx_t_1); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 174, __pyx_L1_error)
+    __pyx_t_7 = PyObject_IsInstance(__pyx_v_val, __pyx_t_1); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 267, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_6 = (__pyx_t_7 != 0);
     if (__pyx_t_6) {
 
-      /* "plumed.pyx":175
+      /* "plumed.pyx":268
  *             import mpi4py.MPI as MPI
  *             if isinstance(val, MPI.Comm):
  *               self.cmd_mpi(ckey, val)             # <<<<<<<<<<<<<<
  *               return
  *          raise ValueError("Unknown value type ({})".format(str(type(val))))
  */
-      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 175, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_ckey); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 268, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_3 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_mpi(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 175, __pyx_L1_error)
+      __pyx_t_3 = ((struct __pyx_vtabstruct_6plumed_Plumed *)__pyx_v_self->__pyx_vtab)->cmd_mpi(__pyx_v_self, __pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 268, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-      /* "plumed.pyx":176
+      /* "plumed.pyx":269
  *             if isinstance(val, MPI.Comm):
  *               self.cmd_mpi(ckey, val)
  *               return             # <<<<<<<<<<<<<<
  *          raise ValueError("Unknown value type ({})".format(str(type(val))))
  * 
  */
       __Pyx_XDECREF(__pyx_r);
       __pyx_r = Py_None; __Pyx_INCREF(Py_None);
       goto __pyx_L0;
 
-      /* "plumed.pyx":174
+      /* "plumed.pyx":267
  *          if 'mpi4py' in sys.modules:
  *             import mpi4py.MPI as MPI
  *             if isinstance(val, MPI.Comm):             # <<<<<<<<<<<<<<
  *               self.cmd_mpi(ckey, val)
  *               return
  */
     }
 
-    /* "plumed.pyx":172
- *             self.c_plumed.cmd( ckey, <const char*>cval )
+    /* "plumed.pyx":265
+ *             self.cmd_low_level(ckey,cval,0, NULL,1 + type_integral + type_const_pointer + type_nocopy)
  *             return
  *          if 'mpi4py' in sys.modules:             # <<<<<<<<<<<<<<
  *             import mpi4py.MPI as MPI
  *             if isinstance(val, MPI.Comm):
  */
   }
 
-  /* "plumed.pyx":177
+  /* "plumed.pyx":270
  *               self.cmd_mpi(ckey, val)
  *               return
  *          raise ValueError("Unknown value type ({})".format(str(type(val))))             # <<<<<<<<<<<<<<
  * 
  * class FormatError(Exception):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Unknown_value_type, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Unknown_value_type, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), ((PyObject *)Py_TYPE(__pyx_v_val))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), ((PyObject *)Py_TYPE(__pyx_v_val))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_10 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_10)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_10);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_10, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(0, 177, __pyx_L1_error)
+  __PYX_ERR(0, 270, __pyx_L1_error)
 
-  /* "plumed.pyx":133
+  /* "plumed.pyx":225
  *          cdef size_t comm_addr = MPI._addressof(val)
- *          self.c_plumed.cmd_mpi( ckey, <const void*>comm_addr)
+ *          self.cmd_low_level(ckey,<void*>comm_addr, 0, NULL, type_void +  type_const_pointer)
  *      def cmd( self, key, val=None ):             # <<<<<<<<<<<<<<
  *          cdef bytes py_bytes = key.encode()
  *          cdef char* ckey = py_bytes
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6085,43 +7442,43 @@
 /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_6Plumed_11__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static PyMethodDef __pyx_mdef_6plumed_6Plumed_11__reduce_cython__ = {"__reduce_cython__", (PyCFunction)__pyx_pw_6plumed_6Plumed_11__reduce_cython__, METH_NOARGS, 0};
-static PyObject *__pyx_pw_6plumed_6Plumed_11__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_6plumed_6Plumed_15__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static PyMethodDef __pyx_mdef_6plumed_6Plumed_15__reduce_cython__ = {"__reduce_cython__", (PyCFunction)__pyx_pw_6plumed_6Plumed_15__reduce_cython__, METH_NOARGS, 0};
+static PyObject *__pyx_pw_6plumed_6Plumed_15__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_6plumed_6Plumed_10__reduce_cython__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self));
+  __pyx_r = __pyx_pf_6plumed_6Plumed_14__reduce_cython__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_6Plumed_10__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_6plumed_Plumed *__pyx_v_self) {
+static PyObject *__pyx_pf_6plumed_6Plumed_14__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_6plumed_Plumed *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__reduce_cython__", 0);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -6143,42 +7500,42 @@
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_6Plumed_13__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
-static PyMethodDef __pyx_mdef_6plumed_6Plumed_13__setstate_cython__ = {"__setstate_cython__", (PyCFunction)__pyx_pw_6plumed_6Plumed_13__setstate_cython__, METH_O, 0};
-static PyObject *__pyx_pw_6plumed_6Plumed_13__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_pw_6plumed_6Plumed_17__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
+static PyMethodDef __pyx_mdef_6plumed_6Plumed_17__setstate_cython__ = {"__setstate_cython__", (PyCFunction)__pyx_pw_6plumed_6Plumed_17__setstate_cython__, METH_O, 0};
+static PyObject *__pyx_pw_6plumed_6Plumed_17__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_6plumed_6Plumed_12__setstate_cython__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));
+  __pyx_r = __pyx_pf_6plumed_6Plumed_16__setstate_cython__(((struct __pyx_obj_6plumed_Plumed *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_6Plumed_12__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_6plumed_Plumed *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state) {
+static PyObject *__pyx_pf_6plumed_6Plumed_16__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_6plumed_Plumed *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -6193,15 +7550,15 @@
   __Pyx_AddTraceback("plumed.Plumed.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":184
+/* "plumed.pyx":277
  *     pass
  * 
  * def _fix_file(file,mode):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a file open with mode.
  * 
  */
 
@@ -6237,32 +7594,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_file)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mode)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_fix_file", 1, 2, 2, 1); __PYX_ERR(0, 184, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_fix_file", 1, 2, 2, 1); __PYX_ERR(0, 277, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_fix_file") < 0)) __PYX_ERR(0, 184, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_fix_file") < 0)) __PYX_ERR(0, 277, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_file = values[0];
     __pyx_v_mode = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_fix_file", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 184, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_fix_file", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 277, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._fix_file", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed__fix_file(__pyx_self, __pyx_v_file, __pyx_v_mode);
 
@@ -6284,68 +7641,68 @@
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_fix_file", 0);
   __Pyx_INCREF(__pyx_v_file);
 
-  /* "plumed.pyx":191
+  /* "plumed.pyx":284
  *     """
  * # allow passing a string
  *     if isinstance(file,str):             # <<<<<<<<<<<<<<
  *         file=open(file,mode)
  * # takes care of gzipped files
  */
   __pyx_t_1 = PyUnicode_Check(__pyx_v_file); 
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":192
+    /* "plumed.pyx":285
  * # allow passing a string
  *     if isinstance(file,str):
  *         file=open(file,mode)             # <<<<<<<<<<<<<<
  * # takes care of gzipped files
  *     if re.match(".*\.gz",file.name):
  */
-    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 192, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 285, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_v_file);
     __Pyx_GIVEREF(__pyx_v_file);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_file);
     __Pyx_INCREF(__pyx_v_mode);
     __Pyx_GIVEREF(__pyx_v_mode);
     PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_mode);
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 192, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 285, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF_SET(__pyx_v_file, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":191
+    /* "plumed.pyx":284
  *     """
  * # allow passing a string
  *     if isinstance(file,str):             # <<<<<<<<<<<<<<
  *         file=open(file,mode)
  * # takes care of gzipped files
  */
   }
 
-  /* "plumed.pyx":194
+  /* "plumed.pyx":287
  *         file=open(file,mode)
  * # takes care of gzipped files
  *     if re.match(".*\.gz",file.name):             # <<<<<<<<<<<<<<
  *         file = gzip.open(file.name,mode)
  *     return file
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_re); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 194, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_re); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 287, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 194, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 287, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_file, __pyx_n_s_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 194, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_file, __pyx_n_s_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 287, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_6 = NULL;
   __pyx_t_7 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -6354,63 +7711,63 @@
       __Pyx_DECREF_SET(__pyx_t_5, function);
       __pyx_t_7 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_5)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u_gz, __pyx_t_3};
-    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 194, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 287, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u_gz, __pyx_t_3};
-    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 194, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 287, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else
   #endif
   {
-    __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 194, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 287, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_kp_u_gz);
     __Pyx_GIVEREF(__pyx_kp_u_gz);
     PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_kp_u_gz);
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_3);
     __pyx_t_3 = 0;
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 194, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 287, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 194, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 287, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":195
+    /* "plumed.pyx":288
  * # takes care of gzipped files
  *     if re.match(".*\.gz",file.name):
  *         file = gzip.open(file.name,mode)             # <<<<<<<<<<<<<<
  *     return file
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_gzip); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_gzip); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 288, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_open); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_open); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 288, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_file, __pyx_n_s_name); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_file, __pyx_n_s_name); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 288, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_3 = NULL;
     __pyx_t_7 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -6419,71 +7776,71 @@
         __Pyx_DECREF_SET(__pyx_t_8, function);
         __pyx_t_7 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_8)) {
       PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_5, __pyx_v_mode};
-      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 288, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
       PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_5, __pyx_v_mode};
-      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 288, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     } else
     #endif
     {
-      __pyx_t_6 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 288, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       if (__pyx_t_3) {
         __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3); __pyx_t_3 = NULL;
       }
       __Pyx_GIVEREF(__pyx_t_5);
       PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_7, __pyx_t_5);
       __Pyx_INCREF(__pyx_v_mode);
       __Pyx_GIVEREF(__pyx_v_mode);
       PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_7, __pyx_v_mode);
       __pyx_t_5 = 0;
-      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 288, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     }
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF_SET(__pyx_v_file, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":194
+    /* "plumed.pyx":287
  *         file=open(file,mode)
  * # takes care of gzipped files
  *     if re.match(".*\.gz",file.name):             # <<<<<<<<<<<<<<
  *         file = gzip.open(file.name,mode)
  *     return file
  */
   }
 
-  /* "plumed.pyx":196
+  /* "plumed.pyx":289
  *     if re.match(".*\.gz",file.name):
  *         file = gzip.open(file.name,mode)
  *     return file             # <<<<<<<<<<<<<<
  * 
  * def _build_convert_function(kernel=None):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_file);
   __pyx_r = __pyx_v_file;
   goto __pyx_L0;
 
-  /* "plumed.pyx":184
+  /* "plumed.pyx":277
  *     pass
  * 
  * def _fix_file(file,mode):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a file open with mode.
  * 
  */
 
@@ -6499,15 +7856,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_file);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":198
+/* "plumed.pyx":291
  *     return file
  * 
  * def _build_convert_function(kernel=None):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a function that can be used for conversions.
  * 
  */
 
@@ -6541,42 +7898,42 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kernel);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_build_convert_function") < 0)) __PYX_ERR(0, 198, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_build_convert_function") < 0)) __PYX_ERR(0, 291, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_kernel = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_build_convert_function", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 198, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_build_convert_function", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 291, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._build_convert_function", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_2_build_convert_function(__pyx_self, __pyx_v_kernel);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":221
+/* "plumed.pyx":314
  *     try:
  * # define a function to convert data
  *         def convert_func(a):             # <<<<<<<<<<<<<<
  *             r=array.array('d',[float('nan')])
  *             convert_func.kernel.cmd("convert "+str(a),r)
  */
 
@@ -6610,29 +7967,29 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("convert_func", 0);
   __pyx_outer_scope = (struct __pyx_obj_6plumed___pyx_scope_struct___build_convert_function *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
 
-  /* "plumed.pyx":222
+  /* "plumed.pyx":315
  * # define a function to convert data
  *         def convert_func(a):
  *             r=array.array('d',[float('nan')])             # <<<<<<<<<<<<<<
  *             convert_func.kernel.cmd("convert "+str(a),r)
  *             if math.isnan(r[0]):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 222, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 315, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 222, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 315, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyNumber_Float(__pyx_n_u_nan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 222, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyNumber_Float(__pyx_n_u_nan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 315, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 222, __pyx_L1_error)
+  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 315, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_2);
   PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
   __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   __pyx_t_5 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
@@ -6644,65 +8001,65 @@
       __Pyx_DECREF_SET(__pyx_t_3, function);
       __pyx_t_5 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_n_u_d, __pyx_t_4};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 222, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 315, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_n_u_d, __pyx_t_4};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 222, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 315, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } else
   #endif
   {
-    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 222, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     if (__pyx_t_2) {
       __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_2); __pyx_t_2 = NULL;
     }
     __Pyx_INCREF(__pyx_n_u_d);
     __Pyx_GIVEREF(__pyx_n_u_d);
     PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_n_u_d);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 222, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_r = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":223
+  /* "plumed.pyx":316
  *         def convert_func(a):
  *             r=array.array('d',[float('nan')])
  *             convert_func.kernel.cmd("convert "+str(a),r)             # <<<<<<<<<<<<<<
  *             if math.isnan(r[0]):
  *                return a
  */
-  if (unlikely(!__pyx_cur_scope->__pyx_v_convert_func)) { __Pyx_RaiseClosureNameError("convert_func"); __PYX_ERR(0, 223, __pyx_L1_error) }
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_convert_func, __pyx_n_s_kernel); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 223, __pyx_L1_error)
+  if (unlikely(!__pyx_cur_scope->__pyx_v_convert_func)) { __Pyx_RaiseClosureNameError("convert_func"); __PYX_ERR(0, 316, __pyx_L1_error) }
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_convert_func, __pyx_n_s_kernel); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 316, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_cmd); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 223, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_cmd); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 316, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 223, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 316, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_convert, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 223, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_convert, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 316, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   __pyx_t_5 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_3)) {
@@ -6712,118 +8069,118 @@
       __Pyx_DECREF_SET(__pyx_t_6, function);
       __pyx_t_5 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_6)) {
     PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_4, __pyx_v_r};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 223, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 316, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
     PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_4, __pyx_v_r};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 223, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 316, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } else
   #endif
   {
-    __pyx_t_2 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 223, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_2, 0+__pyx_t_5, __pyx_t_4);
     __Pyx_INCREF(__pyx_v_r);
     __Pyx_GIVEREF(__pyx_v_r);
     PyTuple_SET_ITEM(__pyx_t_2, 1+__pyx_t_5, __pyx_v_r);
     __pyx_t_4 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 223, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":224
+  /* "plumed.pyx":317
  *             r=array.array('d',[float('nan')])
  *             convert_func.kernel.cmd("convert "+str(a),r)
  *             if math.isnan(r[0]):             # <<<<<<<<<<<<<<
  *                return a
  *             return r[0];
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_math); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 224, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_math); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 317, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_isnan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 224, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_isnan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 317, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_r, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 224, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_r, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 317, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_6);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 317, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 224, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 317, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_7) {
 
-    /* "plumed.pyx":225
+    /* "plumed.pyx":318
  *             convert_func.kernel.cmd("convert "+str(a),r)
  *             if math.isnan(r[0]):
  *                return a             # <<<<<<<<<<<<<<
  *             return r[0];
  *         convert_func.kernel=kernel
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_a);
     __pyx_r = __pyx_v_a;
     goto __pyx_L0;
 
-    /* "plumed.pyx":224
+    /* "plumed.pyx":317
  *             r=array.array('d',[float('nan')])
  *             convert_func.kernel.cmd("convert "+str(a),r)
  *             if math.isnan(r[0]):             # <<<<<<<<<<<<<<
  *                return a
  *             return r[0];
  */
   }
 
-  /* "plumed.pyx":226
+  /* "plumed.pyx":319
  *             if math.isnan(r[0]):
  *                return a
  *             return r[0];             # <<<<<<<<<<<<<<
  *         convert_func.kernel=kernel
  * # check if convert_func is working correctly
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_r, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 226, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_r, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 319, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":221
+  /* "plumed.pyx":314
  *     try:
  * # define a function to convert data
  *         def convert_func(a):             # <<<<<<<<<<<<<<
  *             r=array.array('d',[float('nan')])
  *             convert_func.kernel.cmd("convert "+str(a),r)
  */
 
@@ -6839,15 +8196,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_r);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":198
+/* "plumed.pyx":291
  *     return file
  * 
  * def _build_convert_function(kernel=None):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a function that can be used for conversions.
  * 
  */
 
@@ -6871,21 +8228,21 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_build_convert_function", 0);
   __pyx_cur_scope = (struct __pyx_obj_6plumed___pyx_scope_struct___build_convert_function *)__pyx_tp_new_6plumed___pyx_scope_struct___build_convert_function(__pyx_ptype_6plumed___pyx_scope_struct___build_convert_function, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_6plumed___pyx_scope_struct___build_convert_function *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 198, __pyx_L1_error)
+    __PYX_ERR(0, 291, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __Pyx_INCREF(__pyx_v_kernel);
 
-  /* "plumed.pyx":212
+  /* "plumed.pyx":305
  *        thus potentially increasing its lifetime.
  *     """
  *     try:             # <<<<<<<<<<<<<<
  * # if necessary, load a kernel
  *         if not isinstance(kernel,Plumed):
  */
   {
@@ -6893,51 +8250,51 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "plumed.pyx":214
+      /* "plumed.pyx":307
  *     try:
  * # if necessary, load a kernel
  *         if not isinstance(kernel,Plumed):             # <<<<<<<<<<<<<<
  *             kernel=Plumed(kernel=kernel)
  *     except Exception:
  */
       __pyx_t_4 = __Pyx_TypeCheck(__pyx_v_kernel, __pyx_ptype_6plumed_Plumed); 
       __pyx_t_5 = ((!(__pyx_t_4 != 0)) != 0);
       if (__pyx_t_5) {
 
-        /* "plumed.pyx":215
+        /* "plumed.pyx":308
  * # if necessary, load a kernel
  *         if not isinstance(kernel,Plumed):
  *             kernel=Plumed(kernel=kernel)             # <<<<<<<<<<<<<<
  *     except Exception:
  *         warnings.warn("cannot load PLUMED instance, conversions will not be available")
  */
-        __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 215, __pyx_L3_error)
+        __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 308, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_kernel, __pyx_v_kernel) < 0) __PYX_ERR(0, 215, __pyx_L3_error)
-        __pyx_t_7 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6plumed_Plumed), __pyx_empty_tuple, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 215, __pyx_L3_error)
+        if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_kernel, __pyx_v_kernel) < 0) __PYX_ERR(0, 308, __pyx_L3_error)
+        __pyx_t_7 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_6plumed_Plumed), __pyx_empty_tuple, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 308, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF_SET(__pyx_v_kernel, __pyx_t_7);
         __pyx_t_7 = 0;
 
-        /* "plumed.pyx":214
+        /* "plumed.pyx":307
  *     try:
  * # if necessary, load a kernel
  *         if not isinstance(kernel,Plumed):             # <<<<<<<<<<<<<<
  *             kernel=Plumed(kernel=kernel)
  *     except Exception:
  */
       }
 
-      /* "plumed.pyx":212
+      /* "plumed.pyx":305
  *        thus potentially increasing its lifetime.
  *     """
  *     try:             # <<<<<<<<<<<<<<
  * # if necessary, load a kernel
  *         if not isinstance(kernel,Plumed):
  */
     }
@@ -6945,59 +8302,59 @@
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-    /* "plumed.pyx":216
+    /* "plumed.pyx":309
  *         if not isinstance(kernel,Plumed):
  *             kernel=Plumed(kernel=kernel)
  *     except Exception:             # <<<<<<<<<<<<<<
  *         warnings.warn("cannot load PLUMED instance, conversions will not be available")
  *         return None
  */
     __pyx_t_8 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_8) {
       __Pyx_AddTraceback("plumed._build_convert_function", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_7, &__pyx_t_6, &__pyx_t_9) < 0) __PYX_ERR(0, 216, __pyx_L5_except_error)
+      if (__Pyx_GetException(&__pyx_t_7, &__pyx_t_6, &__pyx_t_9) < 0) __PYX_ERR(0, 309, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_9);
 
-      /* "plumed.pyx":217
+      /* "plumed.pyx":310
  *             kernel=Plumed(kernel=kernel)
  *     except Exception:
  *         warnings.warn("cannot load PLUMED instance, conversions will not be available")             # <<<<<<<<<<<<<<
  *         return None
  *     try:
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_warnings); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 217, __pyx_L5_except_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_warnings); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 310, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_warn); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 217, __pyx_L5_except_error)
+      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_warn); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 310, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __pyx_t_11 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_12))) {
         __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_12);
         if (likely(__pyx_t_11)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
           __Pyx_INCREF(__pyx_t_11);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_12, function);
         }
       }
       __pyx_t_10 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_11, __pyx_kp_u_cannot_load_PLUMED_instance_conv) : __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_kp_u_cannot_load_PLUMED_instance_conv);
       __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
-      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 217, __pyx_L5_except_error)
+      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 310, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-      /* "plumed.pyx":218
+      /* "plumed.pyx":311
  *     except Exception:
  *         warnings.warn("cannot load PLUMED instance, conversions will not be available")
  *         return None             # <<<<<<<<<<<<<<
  *     try:
  * # define a function to convert data
  */
       __Pyx_XDECREF(__pyx_r);
@@ -7006,15 +8363,15 @@
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       goto __pyx_L6_except_return;
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "plumed.pyx":212
+    /* "plumed.pyx":305
  *        thus potentially increasing its lifetime.
  *     """
  *     try:             # <<<<<<<<<<<<<<
  * # if necessary, load a kernel
  *         if not isinstance(kernel,Plumed):
  */
     __Pyx_XGIVEREF(__pyx_t_1);
@@ -7027,15 +8384,15 @@
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L0;
     __pyx_L8_try_end:;
   }
 
-  /* "plumed.pyx":219
+  /* "plumed.pyx":312
  *         warnings.warn("cannot load PLUMED instance, conversions will not be available")
  *         return None
  *     try:             # <<<<<<<<<<<<<<
  * # define a function to convert data
  *         def convert_func(a):
  */
   {
@@ -7043,111 +8400,111 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_3, &__pyx_t_2, &__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_1);
     /*try:*/ {
 
-      /* "plumed.pyx":221
+      /* "plumed.pyx":314
  *     try:
  * # define a function to convert data
  *         def convert_func(a):             # <<<<<<<<<<<<<<
  *             r=array.array('d',[float('nan')])
  *             convert_func.kernel.cmd("convert "+str(a),r)
  */
-      __pyx_t_9 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_23_build_convert_function_1convert_func, 0, __pyx_n_s_build_convert_function_locals_c, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 221, __pyx_L12_error)
+      __pyx_t_9 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_23_build_convert_function_1convert_func, 0, __pyx_n_s_build_convert_function_locals_c, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__10)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 314, __pyx_L12_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_GIVEREF(__pyx_t_9);
       __pyx_cur_scope->__pyx_v_convert_func = __pyx_t_9;
       __pyx_t_9 = 0;
 
-      /* "plumed.pyx":227
+      /* "plumed.pyx":320
  *                return a
  *             return r[0];
  *         convert_func.kernel=kernel             # <<<<<<<<<<<<<<
  * # check if convert_func is working correctly
  *         if (convert_func("pi")=="pi"):
  */
-      if (__Pyx_PyObject_SetAttrStr(__pyx_cur_scope->__pyx_v_convert_func, __pyx_n_s_kernel, __pyx_v_kernel) < 0) __PYX_ERR(0, 227, __pyx_L12_error)
+      if (__Pyx_PyObject_SetAttrStr(__pyx_cur_scope->__pyx_v_convert_func, __pyx_n_s_kernel, __pyx_v_kernel) < 0) __PYX_ERR(0, 320, __pyx_L12_error)
 
-      /* "plumed.pyx":229
+      /* "plumed.pyx":322
  *         convert_func.kernel=kernel
  * # check if convert_func is working correctly
  *         if (convert_func("pi")=="pi"):             # <<<<<<<<<<<<<<
  *             warnings.warn("PLUMED instance seems to have a non-working convert cmd, conversions do not work and will be disabled")
  *             return None
  */
-      __pyx_t_9 = __pyx_pf_6plumed_23_build_convert_function_convert_func(__pyx_cur_scope->__pyx_v_convert_func, __pyx_n_u_pi); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 229, __pyx_L12_error)
+      __pyx_t_9 = __pyx_pf_6plumed_23_build_convert_function_convert_func(__pyx_cur_scope->__pyx_v_convert_func, __pyx_n_u_pi); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 322, __pyx_L12_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_9, __pyx_n_u_pi, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 229, __pyx_L12_error)
+      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_t_9, __pyx_n_u_pi, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 322, __pyx_L12_error)
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       if (__pyx_t_5) {
 
-        /* "plumed.pyx":230
+        /* "plumed.pyx":323
  * # check if convert_func is working correctly
  *         if (convert_func("pi")=="pi"):
  *             warnings.warn("PLUMED instance seems to have a non-working convert cmd, conversions do not work and will be disabled")             # <<<<<<<<<<<<<<
  *             return None
  * # set convert
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_warnings); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 230, __pyx_L12_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_warnings); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 323, __pyx_L12_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_warn); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 230, __pyx_L12_error)
+        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_warn); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 323, __pyx_L12_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_6 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
           if (likely(__pyx_t_6)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
             __Pyx_INCREF(__pyx_t_6);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_7, function);
           }
         }
         __pyx_t_9 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_6, __pyx_kp_u_PLUMED_instance_seems_to_have_a) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_kp_u_PLUMED_instance_seems_to_have_a);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 230, __pyx_L12_error)
+        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 323, __pyx_L12_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-        /* "plumed.pyx":231
+        /* "plumed.pyx":324
  *         if (convert_func("pi")=="pi"):
  *             warnings.warn("PLUMED instance seems to have a non-working convert cmd, conversions do not work and will be disabled")
  *             return None             # <<<<<<<<<<<<<<
  * # set convert
  *         return convert_func
  */
         __Pyx_XDECREF(__pyx_r);
         __pyx_r = Py_None; __Pyx_INCREF(Py_None);
         goto __pyx_L16_try_return;
 
-        /* "plumed.pyx":229
+        /* "plumed.pyx":322
  *         convert_func.kernel=kernel
  * # check if convert_func is working correctly
  *         if (convert_func("pi")=="pi"):             # <<<<<<<<<<<<<<
  *             warnings.warn("PLUMED instance seems to have a non-working convert cmd, conversions do not work and will be disabled")
  *             return None
  */
       }
 
-      /* "plumed.pyx":233
+      /* "plumed.pyx":326
  *             return None
  * # set convert
  *         return convert_func             # <<<<<<<<<<<<<<
  *     except Exception:
  *         warnings.warn("PLUMED instance is too old, conversions do not work and will be disabled")
  */
       __Pyx_XDECREF(__pyx_r);
       __Pyx_INCREF(__pyx_cur_scope->__pyx_v_convert_func);
       __pyx_r = __pyx_cur_scope->__pyx_v_convert_func;
       goto __pyx_L16_try_return;
 
-      /* "plumed.pyx":219
+      /* "plumed.pyx":312
  *         warnings.warn("cannot load PLUMED instance, conversions will not be available")
  *         return None
  *     try:             # <<<<<<<<<<<<<<
  * # define a function to convert data
  *         def convert_func(a):
  */
     }
@@ -7155,59 +8512,59 @@
     __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
     __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-    /* "plumed.pyx":234
+    /* "plumed.pyx":327
  * # set convert
  *         return convert_func
  *     except Exception:             # <<<<<<<<<<<<<<
  *         warnings.warn("PLUMED instance is too old, conversions do not work and will be disabled")
  *         return None
  */
     __pyx_t_8 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_8) {
       __Pyx_AddTraceback("plumed._build_convert_function", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_9, &__pyx_t_7, &__pyx_t_6) < 0) __PYX_ERR(0, 234, __pyx_L14_except_error)
+      if (__Pyx_GetException(&__pyx_t_9, &__pyx_t_7, &__pyx_t_6) < 0) __PYX_ERR(0, 327, __pyx_L14_except_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_GOTREF(__pyx_t_6);
 
-      /* "plumed.pyx":235
+      /* "plumed.pyx":328
  *         return convert_func
  *     except Exception:
  *         warnings.warn("PLUMED instance is too old, conversions do not work and will be disabled")             # <<<<<<<<<<<<<<
  *         return None
  * 
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_warnings); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 235, __pyx_L14_except_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_warnings); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 328, __pyx_L14_except_error)
       __Pyx_GOTREF(__pyx_t_12);
-      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_warn); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 235, __pyx_L14_except_error)
+      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_warn); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 328, __pyx_L14_except_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __pyx_t_12 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
         __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
         if (likely(__pyx_t_12)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
           __Pyx_INCREF(__pyx_t_12);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_11, function);
         }
       }
       __pyx_t_10 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_12, __pyx_kp_u_PLUMED_instance_is_too_old_conve) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_kp_u_PLUMED_instance_is_too_old_conve);
       __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 235, __pyx_L14_except_error)
+      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 328, __pyx_L14_except_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-      /* "plumed.pyx":236
+      /* "plumed.pyx":329
  *     except Exception:
  *         warnings.warn("PLUMED instance is too old, conversions do not work and will be disabled")
  *         return None             # <<<<<<<<<<<<<<
  * 
  * class Constants(list):
  */
       __Pyx_XDECREF(__pyx_r);
@@ -7216,15 +8573,15 @@
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       goto __pyx_L15_except_return;
     }
     goto __pyx_L14_except_error;
     __pyx_L14_except_error:;
 
-    /* "plumed.pyx":219
+    /* "plumed.pyx":312
  *         warnings.warn("cannot load PLUMED instance, conversions will not be available")
  *         return None
  *     try:             # <<<<<<<<<<<<<<
  * # define a function to convert data
  *         def convert_func(a):
  */
     __Pyx_XGIVEREF(__pyx_t_3);
@@ -7242,15 +8599,15 @@
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_ExceptionReset(__pyx_t_3, __pyx_t_2, __pyx_t_1);
     goto __pyx_L0;
   }
 
-  /* "plumed.pyx":198
+  /* "plumed.pyx":291
  *     return file
  * 
  * def _build_convert_function(kernel=None):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a function that can be used for conversions.
  * 
  */
 
@@ -7268,15 +8625,15 @@
   __Pyx_XDECREF(__pyx_v_kernel);
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":241
+/* "plumed.pyx":334
  *    """Custom class used to store plumed constants.
  *    """
  *    def __init__(self,l,kernel=None,convert=None):             # <<<<<<<<<<<<<<
  *        if(isinstance(l,dict)):
  *            for k in l:
  */
 
@@ -7319,15 +8676,15 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_l)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 4, 1); __PYX_ERR(0, 241, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 4, 1); __PYX_ERR(0, 334, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kernel);
           if (value) { values[2] = value; kw_args--; }
         }
@@ -7335,15 +8692,15 @@
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_convert_2);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 241, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 334, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -7356,15 +8713,15 @@
     __pyx_v_self = values[0];
     __pyx_v_l = values[1];
     __pyx_v_kernel = values[2];
     __pyx_v_convert = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 241, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 334, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.Constants.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_9Constants___init__(__pyx_self, __pyx_v_self, __pyx_v_l, __pyx_v_kernel, __pyx_v_convert);
 
@@ -7393,241 +8750,241 @@
   PyObject *__pyx_t_13 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
   __Pyx_INCREF(__pyx_v_convert);
 
-  /* "plumed.pyx":242
+  /* "plumed.pyx":335
  *    """
  *    def __init__(self,l,kernel=None,convert=None):
  *        if(isinstance(l,dict)):             # <<<<<<<<<<<<<<
  *            for k in l:
  *               self.append((k,l[k]))
  */
   __pyx_t_1 = PyDict_Check(__pyx_v_l); 
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":243
+    /* "plumed.pyx":336
  *    def __init__(self,l,kernel=None,convert=None):
  *        if(isinstance(l,dict)):
  *            for k in l:             # <<<<<<<<<<<<<<
  *               self.append((k,l[k]))
  *        else:
  */
     if (likely(PyList_CheckExact(__pyx_v_l)) || PyTuple_CheckExact(__pyx_v_l)) {
       __pyx_t_3 = __pyx_v_l; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
       __pyx_t_5 = NULL;
     } else {
-      __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_l); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 243, __pyx_L1_error)
+      __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_l); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 336, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 243, __pyx_L1_error)
+      __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 336, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_5)) {
         if (likely(PyList_CheckExact(__pyx_t_3))) {
           if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 243, __pyx_L1_error)
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 336, __pyx_L1_error)
           #else
-          __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 243, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 336, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
         } else {
           if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 243, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 336, __pyx_L1_error)
           #else
-          __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 243, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 336, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
         }
       } else {
         __pyx_t_6 = __pyx_t_5(__pyx_t_3);
         if (unlikely(!__pyx_t_6)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 243, __pyx_L1_error)
+            else __PYX_ERR(0, 336, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_6);
       }
       __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "plumed.pyx":244
+      /* "plumed.pyx":337
  *        if(isinstance(l,dict)):
  *            for k in l:
  *               self.append((k,l[k]))             # <<<<<<<<<<<<<<
  *        else:
  *            self.extend(l)
  */
-      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_l, __pyx_v_k); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_l, __pyx_v_k); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 337, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+      __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 337, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_INCREF(__pyx_v_k);
       __Pyx_GIVEREF(__pyx_v_k);
       PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_k);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
       __pyx_t_6 = 0;
-      __pyx_t_8 = __Pyx_PyObject_Append(__pyx_v_self, __pyx_t_7); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 244, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyObject_Append(__pyx_v_self, __pyx_t_7); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 337, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-      /* "plumed.pyx":243
+      /* "plumed.pyx":336
  *    def __init__(self,l,kernel=None,convert=None):
  *        if(isinstance(l,dict)):
  *            for k in l:             # <<<<<<<<<<<<<<
  *               self.append((k,l[k]))
  *        else:
  */
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "plumed.pyx":242
+    /* "plumed.pyx":335
  *    """
  *    def __init__(self,l,kernel=None,convert=None):
  *        if(isinstance(l,dict)):             # <<<<<<<<<<<<<<
  *            for k in l:
  *               self.append((k,l[k]))
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":246
+  /* "plumed.pyx":339
  *               self.append((k,l[k]))
  *        else:
  *            self.extend(l)             # <<<<<<<<<<<<<<
  *        for i in range(len(self)):
  *            if(len(self[i])==2):
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_extend); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 246, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_extend); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 339, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __pyx_t_6 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
         __Pyx_INCREF(__pyx_t_6);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_6, __pyx_v_l) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_l);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 246, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 339, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __pyx_L3:;
 
-  /* "plumed.pyx":247
+  /* "plumed.pyx":340
  *        else:
  *            self.extend(l)
  *        for i in range(len(self)):             # <<<<<<<<<<<<<<
  *            if(len(self[i])==2):
  *                if not convert:
  */
-  __pyx_t_4 = PyObject_Length(__pyx_v_self); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 247, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_self); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 340, __pyx_L1_error)
   __pyx_t_9 = __pyx_t_4;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_i = __pyx_t_10;
 
-    /* "plumed.pyx":248
+    /* "plumed.pyx":341
  *            self.extend(l)
  *        for i in range(len(self)):
  *            if(len(self[i])==2):             # <<<<<<<<<<<<<<
  *                if not convert:
  *                    convert=_build_convert_function(kernel)
  */
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 248, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 341, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_11 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 248, __pyx_L1_error)
+    __pyx_t_11 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 341, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_2 = ((__pyx_t_11 == 2) != 0);
     if (__pyx_t_2) {
 
-      /* "plumed.pyx":249
+      /* "plumed.pyx":342
  *        for i in range(len(self)):
  *            if(len(self[i])==2):
  *                if not convert:             # <<<<<<<<<<<<<<
  *                    convert=_build_convert_function(kernel)
  *                if convert:
  */
-      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_convert); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 249, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_convert); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 342, __pyx_L1_error)
       __pyx_t_1 = ((!__pyx_t_2) != 0);
       if (__pyx_t_1) {
 
-        /* "plumed.pyx":250
+        /* "plumed.pyx":343
  *            if(len(self[i])==2):
  *                if not convert:
  *                    convert=_build_convert_function(kernel)             # <<<<<<<<<<<<<<
  *                if convert:
  *                    self[i]=(self[i][0],convert(self[i][1]),str(self[i][1]))
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_build_convert_function); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_build_convert_function); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 343, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __pyx_t_6 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
           if (likely(__pyx_t_6)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
             __Pyx_INCREF(__pyx_t_6);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_7, function);
           }
         }
         __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_6, __pyx_v_kernel) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_kernel);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 250, __pyx_L1_error)
+        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 343, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF_SET(__pyx_v_convert, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "plumed.pyx":249
+        /* "plumed.pyx":342
  *        for i in range(len(self)):
  *            if(len(self[i])==2):
  *                if not convert:             # <<<<<<<<<<<<<<
  *                    convert=_build_convert_function(kernel)
  *                if convert:
  */
       }
 
-      /* "plumed.pyx":251
+      /* "plumed.pyx":344
  *                if not convert:
  *                    convert=_build_convert_function(kernel)
  *                if convert:             # <<<<<<<<<<<<<<
  *                    self[i]=(self[i][0],convert(self[i][1]),str(self[i][1]))
  *                else:
  */
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_convert); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 251, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_convert); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 344, __pyx_L1_error)
       if (__pyx_t_1) {
 
-        /* "plumed.pyx":252
+        /* "plumed.pyx":345
  *                    convert=_build_convert_function(kernel)
  *                if convert:
  *                    self[i]=(self[i][0],convert(self[i][1]),str(self[i][1]))             # <<<<<<<<<<<<<<
  *                else:
  *                    self[i]=(self[i][0],self[i][1],str(self[i][1]))
  */
-        __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 252, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 252, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 252, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_12 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 252, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_INCREF(__pyx_v_convert);
         __pyx_t_6 = __pyx_v_convert; __pyx_t_13 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_13)) {
@@ -7636,135 +8993,135 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_6, function);
           }
         }
         __pyx_t_3 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_13, __pyx_t_12) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_12);
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 252, __pyx_L1_error)
+        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 252, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_12 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 252, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_12); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 252, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_12); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 252, __pyx_L1_error)
+        __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_GIVEREF(__pyx_t_7);
         PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_7);
         __Pyx_GIVEREF(__pyx_t_3);
         PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_3);
         __Pyx_GIVEREF(__pyx_t_6);
         PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_6);
         __pyx_t_7 = 0;
         __pyx_t_3 = 0;
         __pyx_t_6 = 0;
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_self, __pyx_v_i, __pyx_t_12, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1) < 0)) __PYX_ERR(0, 252, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_self, __pyx_v_i, __pyx_t_12, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1) < 0)) __PYX_ERR(0, 345, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
 
-        /* "plumed.pyx":251
+        /* "plumed.pyx":344
  *                if not convert:
  *                    convert=_build_convert_function(kernel)
  *                if convert:             # <<<<<<<<<<<<<<
  *                    self[i]=(self[i][0],convert(self[i][1]),str(self[i][1]))
  *                else:
  */
         goto __pyx_L10;
       }
 
-      /* "plumed.pyx":254
+      /* "plumed.pyx":347
  *                    self[i]=(self[i][0],convert(self[i][1]),str(self[i][1]))
  *                else:
  *                    self[i]=(self[i][0],self[i][1],str(self[i][1]))             # <<<<<<<<<<<<<<
  *            elif(len(self[i])==3):
  *                pass
  */
       /*else*/ {
-        __pyx_t_12 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 254, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 347, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_12, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 254, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_12, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 347, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 254, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 347, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
-        __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_12, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 254, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_12, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 347, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 254, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 347, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
-        __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_12, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 254, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_12, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 347, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_7); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 254, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_7); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 347, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-        __pyx_t_7 = PyTuple_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 254, __pyx_L1_error)
+        __pyx_t_7 = PyTuple_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 347, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_GIVEREF(__pyx_t_6);
         PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6);
         __Pyx_GIVEREF(__pyx_t_3);
         PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_3);
         __Pyx_GIVEREF(__pyx_t_12);
         PyTuple_SET_ITEM(__pyx_t_7, 2, __pyx_t_12);
         __pyx_t_6 = 0;
         __pyx_t_3 = 0;
         __pyx_t_12 = 0;
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_self, __pyx_v_i, __pyx_t_7, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1) < 0)) __PYX_ERR(0, 254, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_self, __pyx_v_i, __pyx_t_7, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1) < 0)) __PYX_ERR(0, 347, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       }
       __pyx_L10:;
 
-      /* "plumed.pyx":248
+      /* "plumed.pyx":341
  *            self.extend(l)
  *        for i in range(len(self)):
  *            if(len(self[i])==2):             # <<<<<<<<<<<<<<
  *                if not convert:
  *                    convert=_build_convert_function(kernel)
  */
       goto __pyx_L8;
     }
 
-    /* "plumed.pyx":255
+    /* "plumed.pyx":348
  *                else:
  *                    self[i]=(self[i][0],self[i][1],str(self[i][1]))
  *            elif(len(self[i])==3):             # <<<<<<<<<<<<<<
  *                pass
  *            else:
  */
-    __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 255, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_self, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 348, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_11 = PyObject_Length(__pyx_t_7); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 255, __pyx_L1_error)
+    __pyx_t_11 = PyObject_Length(__pyx_t_7); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 348, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_1 = ((__pyx_t_11 == 3) != 0);
     if (likely(__pyx_t_1)) {
       goto __pyx_L8;
     }
 
-    /* "plumed.pyx":258
+    /* "plumed.pyx":351
  *                pass
  *            else:
  *                raise ValueError("plumed.Constants should be initialized with a list of 2- or 3-plets")             # <<<<<<<<<<<<<<
  * 
  * def read_as_pandas(file_or_path,enable_constants=True,enable_conversion=True,kernel=None,chunksize=None,usecols=None,skiprows=None,nrows=None,index_col=None):
  */
     /*else*/ {
-      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 258, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 351, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_Raise(__pyx_t_7, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __PYX_ERR(0, 258, __pyx_L1_error)
+      __PYX_ERR(0, 351, __pyx_L1_error)
     }
     __pyx_L8:;
   }
 
-  /* "plumed.pyx":241
+  /* "plumed.pyx":334
  *    """Custom class used to store plumed constants.
  *    """
  *    def __init__(self,l,kernel=None,convert=None):             # <<<<<<<<<<<<<<
  *        if(isinstance(l,dict)):
  *            for k in l:
  */
 
@@ -7783,15 +9140,15 @@
   __Pyx_XDECREF(__pyx_v_k);
   __Pyx_XDECREF(__pyx_v_convert);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":260
+/* "plumed.pyx":353
  *                raise ValueError("plumed.Constants should be initialized with a list of 2- or 3-plets")
  * 
  * def read_as_pandas(file_or_path,enable_constants=True,enable_conversion=True,kernel=None,chunksize=None,usecols=None,skiprows=None,nrows=None,index_col=None):             # <<<<<<<<<<<<<<
  *     """Import a plumed data file as a pandas dataset.
  * 
  */
 
@@ -7902,15 +9259,15 @@
         case  8:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_index_col);
           if (value) { values[8] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_as_pandas") < 0)) __PYX_ERR(0, 260, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_as_pandas") < 0)) __PYX_ERR(0, 353, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
         CYTHON_FALLTHROUGH;
         case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
         CYTHON_FALLTHROUGH;
@@ -7939,28 +9296,28 @@
     __pyx_v_usecols = values[5];
     __pyx_v_skiprows = values[6];
     __pyx_v_nrows = values[7];
     __pyx_v_index_col = values[8];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("read_as_pandas", 0, 1, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 260, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("read_as_pandas", 0, 1, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 353, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.read_as_pandas", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_4read_as_pandas(__pyx_self, __pyx_v_file_or_path, __pyx_v_enable_constants, __pyx_v_enable_conversion, __pyx_v_kernel, __pyx_v_chunksize, __pyx_v_usecols, __pyx_v_skiprows, __pyx_v_nrows, __pyx_v_index_col);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":354
+/* "plumed.pyx":447
  *     class PlumedSeries(pd.Series):
  *         @property
  *         def _constructor(self):             # <<<<<<<<<<<<<<
  *             return PlumedSeries
  *         @property
  */
 
@@ -7986,28 +9343,28 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_constructor", 0);
   __pyx_outer_scope = (struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
 
-  /* "plumed.pyx":355
+  /* "plumed.pyx":448
  *         @property
  *         def _constructor(self):
  *             return PlumedSeries             # <<<<<<<<<<<<<<
  *         @property
  *         def _constructor_expanddim(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedSeries)) { __Pyx_RaiseClosureNameError("PlumedSeries"); __PYX_ERR(0, 355, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedSeries)) { __Pyx_RaiseClosureNameError("PlumedSeries"); __PYX_ERR(0, 448, __pyx_L1_error) }
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_PlumedSeries);
   __pyx_r = __pyx_cur_scope->__pyx_v_PlumedSeries;
   goto __pyx_L0;
 
-  /* "plumed.pyx":354
+  /* "plumed.pyx":447
  *     class PlumedSeries(pd.Series):
  *         @property
  *         def _constructor(self):             # <<<<<<<<<<<<<<
  *             return PlumedSeries
  *         @property
  */
 
@@ -8017,15 +9374,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":357
+/* "plumed.pyx":450
  *             return PlumedSeries
  *         @property
  *         def _constructor_expanddim(self):             # <<<<<<<<<<<<<<
  *             return PlumedDataFrame
  * 
  */
 
@@ -8051,28 +9408,28 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_constructor_expanddim", 0);
   __pyx_outer_scope = (struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
 
-  /* "plumed.pyx":358
+  /* "plumed.pyx":451
  *         @property
  *         def _constructor_expanddim(self):
  *             return PlumedDataFrame             # <<<<<<<<<<<<<<
  * 
  *     class PlumedDataFrame(pd.DataFrame):
  */
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedDataFrame)) { __Pyx_RaiseClosureNameError("PlumedDataFrame"); __PYX_ERR(0, 358, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedDataFrame)) { __Pyx_RaiseClosureNameError("PlumedDataFrame"); __PYX_ERR(0, 451, __pyx_L1_error) }
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_PlumedDataFrame);
   __pyx_r = __pyx_cur_scope->__pyx_v_PlumedDataFrame;
   goto __pyx_L0;
 
-  /* "plumed.pyx":357
+  /* "plumed.pyx":450
  *             return PlumedSeries
  *         @property
  *         def _constructor_expanddim(self):             # <<<<<<<<<<<<<<
  *             return PlumedDataFrame
  * 
  */
 
@@ -8082,15 +9439,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":363
+/* "plumed.pyx":456
  *         _metadata=["plumed_constants"]
  *         @property
  *         def _constructor(self):             # <<<<<<<<<<<<<<
  *             return PlumedDataFrame
  *         @property
  */
 
@@ -8116,28 +9473,28 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_constructor", 0);
   __pyx_outer_scope = (struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
 
-  /* "plumed.pyx":364
+  /* "plumed.pyx":457
  *         @property
  *         def _constructor(self):
  *             return PlumedDataFrame             # <<<<<<<<<<<<<<
  *         @property
  *         def _constructor_sliced(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedDataFrame)) { __Pyx_RaiseClosureNameError("PlumedDataFrame"); __PYX_ERR(0, 364, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedDataFrame)) { __Pyx_RaiseClosureNameError("PlumedDataFrame"); __PYX_ERR(0, 457, __pyx_L1_error) }
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_PlumedDataFrame);
   __pyx_r = __pyx_cur_scope->__pyx_v_PlumedDataFrame;
   goto __pyx_L0;
 
-  /* "plumed.pyx":363
+  /* "plumed.pyx":456
  *         _metadata=["plumed_constants"]
  *         @property
  *         def _constructor(self):             # <<<<<<<<<<<<<<
  *             return PlumedDataFrame
  *         @property
  */
 
@@ -8147,15 +9504,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":366
+/* "plumed.pyx":459
  *             return PlumedDataFrame
  *         @property
  *         def _constructor_sliced(self):             # <<<<<<<<<<<<<<
  *             return PlumedSeries
  * 
  */
 
@@ -8181,28 +9538,28 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_constructor_sliced", 0);
   __pyx_outer_scope = (struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
 
-  /* "plumed.pyx":367
+  /* "plumed.pyx":460
  *         @property
  *         def _constructor_sliced(self):
  *             return PlumedSeries             # <<<<<<<<<<<<<<
  * 
  * # auxiliary function to process a dataframe
  */
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedSeries)) { __Pyx_RaiseClosureNameError("PlumedSeries"); __PYX_ERR(0, 367, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedSeries)) { __Pyx_RaiseClosureNameError("PlumedSeries"); __PYX_ERR(0, 460, __pyx_L1_error) }
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_PlumedSeries);
   __pyx_r = __pyx_cur_scope->__pyx_v_PlumedSeries;
   goto __pyx_L0;
 
-  /* "plumed.pyx":366
+  /* "plumed.pyx":459
  *             return PlumedDataFrame
  *         @property
  *         def _constructor_sliced(self):             # <<<<<<<<<<<<<<
  *             return PlumedSeries
  * 
  */
 
@@ -8212,15 +9569,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":371
+/* "plumed.pyx":464
  * # auxiliary function to process a dataframe
  * # it is defined here since it requires PlumedDataFrame to be defined
  *     def process_dataframe(df,enable_constants,constants,convert_all):             # <<<<<<<<<<<<<<
  *         if convert_all: df=df.applymap(convert_all)
  *         if enable_constants=='columns':
  */
 
@@ -8261,31 +9618,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_df)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_enable_constants)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("process_dataframe", 1, 4, 4, 1); __PYX_ERR(0, 371, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("process_dataframe", 1, 4, 4, 1); __PYX_ERR(0, 464, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_constants)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("process_dataframe", 1, 4, 4, 2); __PYX_ERR(0, 371, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("process_dataframe", 1, 4, 4, 2); __PYX_ERR(0, 464, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_convert_all)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("process_dataframe", 1, 4, 4, 3); __PYX_ERR(0, 371, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("process_dataframe", 1, 4, 4, 3); __PYX_ERR(0, 464, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "process_dataframe") < 0)) __PYX_ERR(0, 371, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "process_dataframe") < 0)) __PYX_ERR(0, 464, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -8294,15 +9651,15 @@
     __pyx_v_df = values[0];
     __pyx_v_enable_constants = values[1];
     __pyx_v_constants = values[2];
     __pyx_v_convert_all = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("process_dataframe", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 371, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("process_dataframe", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 464, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.read_as_pandas.process_dataframe", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_14read_as_pandas_process_dataframe(__pyx_self, __pyx_v_df, __pyx_v_enable_constants, __pyx_v_constants, __pyx_v_convert_all);
 
@@ -8327,193 +9684,193 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("process_dataframe", 0);
   __pyx_outer_scope = (struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
   __Pyx_INCREF(__pyx_v_df);
 
-  /* "plumed.pyx":372
+  /* "plumed.pyx":465
  * # it is defined here since it requires PlumedDataFrame to be defined
  *     def process_dataframe(df,enable_constants,constants,convert_all):
  *         if convert_all: df=df.applymap(convert_all)             # <<<<<<<<<<<<<<
  *         if enable_constants=='columns':
  *             for c in constants: df[c[0]]=c[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_convert_all); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 372, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_convert_all); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 465, __pyx_L1_error)
   if (__pyx_t_1) {
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_applymap); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 372, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_applymap); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 465, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_convert_all) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_convert_all);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 372, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 465, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF_SET(__pyx_v_df, __pyx_t_2);
     __pyx_t_2 = 0;
   }
 
-  /* "plumed.pyx":373
+  /* "plumed.pyx":466
  *     def process_dataframe(df,enable_constants,constants,convert_all):
  *         if convert_all: df=df.applymap(convert_all)
  *         if enable_constants=='columns':             # <<<<<<<<<<<<<<
  *             for c in constants: df[c[0]]=c[1]
  *         if enable_constants=='metadata':
  */
-  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_columns, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 373, __pyx_L1_error)
+  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_columns, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 466, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":374
+    /* "plumed.pyx":467
  *         if convert_all: df=df.applymap(convert_all)
  *         if enable_constants=='columns':
  *             for c in constants: df[c[0]]=c[1]             # <<<<<<<<<<<<<<
  *         if enable_constants=='metadata':
  *             df=PlumedDataFrame(df)
  */
     if (likely(PyList_CheckExact(__pyx_v_constants)) || PyTuple_CheckExact(__pyx_v_constants)) {
       __pyx_t_2 = __pyx_v_constants; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
       __pyx_t_6 = NULL;
     } else {
-      __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_constants); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 374, __pyx_L1_error)
+      __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_constants); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 467, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 374, __pyx_L1_error)
+      __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 467, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_6)) {
         if (likely(PyList_CheckExact(__pyx_t_2))) {
           if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 374, __pyx_L1_error)
+          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 467, __pyx_L1_error)
           #else
-          __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 374, __pyx_L1_error)
+          __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 467, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
           #endif
         } else {
           if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 374, __pyx_L1_error)
+          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 467, __pyx_L1_error)
           #else
-          __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 374, __pyx_L1_error)
+          __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 467, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
           #endif
         }
       } else {
         __pyx_t_3 = __pyx_t_6(__pyx_t_2);
         if (unlikely(!__pyx_t_3)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 374, __pyx_L1_error)
+            else __PYX_ERR(0, 467, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_3);
       }
       __Pyx_XDECREF_SET(__pyx_v_c, __pyx_t_3);
       __pyx_t_3 = 0;
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_c, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 374, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_c, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 467, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_c, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 374, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_c, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 467, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (unlikely(PyObject_SetItem(__pyx_v_df, __pyx_t_4, __pyx_t_3) < 0)) __PYX_ERR(0, 374, __pyx_L1_error)
+      if (unlikely(PyObject_SetItem(__pyx_v_df, __pyx_t_4, __pyx_t_3) < 0)) __PYX_ERR(0, 467, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":373
+    /* "plumed.pyx":466
  *     def process_dataframe(df,enable_constants,constants,convert_all):
  *         if convert_all: df=df.applymap(convert_all)
  *         if enable_constants=='columns':             # <<<<<<<<<<<<<<
  *             for c in constants: df[c[0]]=c[1]
  *         if enable_constants=='metadata':
  */
   }
 
-  /* "plumed.pyx":375
+  /* "plumed.pyx":468
  *         if enable_constants=='columns':
  *             for c in constants: df[c[0]]=c[1]
  *         if enable_constants=='metadata':             # <<<<<<<<<<<<<<
  *             df=PlumedDataFrame(df)
  *             df.plumed_constants=Constants(constants)
  */
-  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_metadata, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 375, __pyx_L1_error)
+  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_metadata, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 468, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":376
+    /* "plumed.pyx":469
  *             for c in constants: df[c[0]]=c[1]
  *         if enable_constants=='metadata':
  *             df=PlumedDataFrame(df)             # <<<<<<<<<<<<<<
  *             df.plumed_constants=Constants(constants)
  *         return df
  */
-    if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedDataFrame)) { __Pyx_RaiseClosureNameError("PlumedDataFrame"); __PYX_ERR(0, 376, __pyx_L1_error) }
-    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_cur_scope->__pyx_v_PlumedDataFrame, __pyx_v_df); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 376, __pyx_L1_error)
+    if (unlikely(!__pyx_cur_scope->__pyx_v_PlumedDataFrame)) { __Pyx_RaiseClosureNameError("PlumedDataFrame"); __PYX_ERR(0, 469, __pyx_L1_error) }
+    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_cur_scope->__pyx_v_PlumedDataFrame, __pyx_v_df); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 469, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF_SET(__pyx_v_df, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "plumed.pyx":377
+    /* "plumed.pyx":470
  *         if enable_constants=='metadata':
  *             df=PlumedDataFrame(df)
  *             df.plumed_constants=Constants(constants)             # <<<<<<<<<<<<<<
  *         return df
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_Constants); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 377, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_Constants); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 470, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_constants) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_constants);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 377, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 470, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_df, __pyx_n_s_plumed_constants, __pyx_t_2) < 0) __PYX_ERR(0, 377, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_df, __pyx_n_s_plumed_constants, __pyx_t_2) < 0) __PYX_ERR(0, 470, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":375
+    /* "plumed.pyx":468
  *         if enable_constants=='columns':
  *             for c in constants: df[c[0]]=c[1]
  *         if enable_constants=='metadata':             # <<<<<<<<<<<<<<
  *             df=PlumedDataFrame(df)
  *             df.plumed_constants=Constants(constants)
  */
   }
 
-  /* "plumed.pyx":378
+  /* "plumed.pyx":471
  *             df=PlumedDataFrame(df)
  *             df.plumed_constants=Constants(constants)
  *         return df             # <<<<<<<<<<<<<<
  * 
  * # process arguments:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_df);
   __pyx_r = __pyx_v_df;
   goto __pyx_L0;
 
-  /* "plumed.pyx":371
+  /* "plumed.pyx":464
  * # auxiliary function to process a dataframe
  * # it is defined here since it requires PlumedDataFrame to be defined
  *     def process_dataframe(df,enable_constants,constants,convert_all):             # <<<<<<<<<<<<<<
  *         if convert_all: df=df.applymap(convert_all)
  *         if enable_constants=='columns':
  */
 
@@ -8528,15 +9885,15 @@
   __Pyx_XDECREF(__pyx_v_c);
   __Pyx_XDECREF(__pyx_v_df);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":457
+/* "plumed.pyx":550
  * # some information (constant values and conversion function)
  * # should be stored in the class to be used while iterating on it
  *             def __init__(self,reader,enable_constants,constants,convert_all):             # <<<<<<<<<<<<<<
  *                 self.TextFileReader=reader
  *                 self.enable_constants=enable_constants
  */
 
@@ -8580,37 +9937,37 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reader)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 1); __PYX_ERR(0, 457, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 1); __PYX_ERR(0, 550, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_enable_constants)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 2); __PYX_ERR(0, 457, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 2); __PYX_ERR(0, 550, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_constants)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 3); __PYX_ERR(0, 457, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 3); __PYX_ERR(0, 550, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_convert_all)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 4); __PYX_ERR(0, 457, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 4); __PYX_ERR(0, 550, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 457, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 550, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -8621,15 +9978,15 @@
     __pyx_v_reader = values[1];
     __pyx_v_enable_constants = values[2];
     __pyx_v_constants = values[3];
     __pyx_v_convert_all = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 457, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 550, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.read_as_pandas.TextFileReader.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_14read_as_pandas_14TextFileReader___init__(__pyx_self, __pyx_v_self, __pyx_v_reader, __pyx_v_enable_constants, __pyx_v_constants, __pyx_v_convert_all);
 
@@ -8642,51 +9999,51 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "plumed.pyx":458
+  /* "plumed.pyx":551
  * # should be stored in the class to be used while iterating on it
  *             def __init__(self,reader,enable_constants,constants,convert_all):
  *                 self.TextFileReader=reader             # <<<<<<<<<<<<<<
  *                 self.enable_constants=enable_constants
  *                 self.constants=constants
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_TextFileReader, __pyx_v_reader) < 0) __PYX_ERR(0, 458, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_TextFileReader, __pyx_v_reader) < 0) __PYX_ERR(0, 551, __pyx_L1_error)
 
-  /* "plumed.pyx":459
+  /* "plumed.pyx":552
  *             def __init__(self,reader,enable_constants,constants,convert_all):
  *                 self.TextFileReader=reader
  *                 self.enable_constants=enable_constants             # <<<<<<<<<<<<<<
  *                 self.constants=constants
  *                 self.convert_all=convert_all
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_enable_constants, __pyx_v_enable_constants) < 0) __PYX_ERR(0, 459, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_enable_constants, __pyx_v_enable_constants) < 0) __PYX_ERR(0, 552, __pyx_L1_error)
 
-  /* "plumed.pyx":460
+  /* "plumed.pyx":553
  *                 self.TextFileReader=reader
  *                 self.enable_constants=enable_constants
  *                 self.constants=constants             # <<<<<<<<<<<<<<
  *                 self.convert_all=convert_all
  *             def __next__(self):
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_constants, __pyx_v_constants) < 0) __PYX_ERR(0, 460, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_constants, __pyx_v_constants) < 0) __PYX_ERR(0, 553, __pyx_L1_error)
 
-  /* "plumed.pyx":461
+  /* "plumed.pyx":554
  *                 self.enable_constants=enable_constants
  *                 self.constants=constants
  *                 self.convert_all=convert_all             # <<<<<<<<<<<<<<
  *             def __next__(self):
  * # override __next__
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_convert_all, __pyx_v_convert_all) < 0) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_convert_all, __pyx_v_convert_all) < 0) __PYX_ERR(0, 554, __pyx_L1_error)
 
-  /* "plumed.pyx":457
+  /* "plumed.pyx":550
  * # some information (constant values and conversion function)
  * # should be stored in the class to be used while iterating on it
  *             def __init__(self,reader,enable_constants,constants,convert_all):             # <<<<<<<<<<<<<<
  *                 self.TextFileReader=reader
  *                 self.enable_constants=enable_constants
  */
 
@@ -8698,15 +10055,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":462
+/* "plumed.pyx":555
  *                 self.constants=constants
  *                 self.convert_all=convert_all
  *             def __next__(self):             # <<<<<<<<<<<<<<
  * # override __next__
  *                 df=self.TextFileReader.__next__()
  */
 
@@ -8737,69 +10094,69 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__next__", 0);
   __pyx_outer_scope = (struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
 
-  /* "plumed.pyx":464
+  /* "plumed.pyx":557
  *             def __next__(self):
  * # override __next__
  *                 df=self.TextFileReader.__next__()             # <<<<<<<<<<<<<<
  *                 return process_dataframe(df,self.enable_constants,self.constants,self.convert_all)
  *         return TextFileReader(df,enable_constants,constants,convert_all)
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_TextFileReader); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 464, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_TextFileReader); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 557, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_next); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 464, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_next); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 557, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 464, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 557, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_df = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":465
+  /* "plumed.pyx":558
  * # override __next__
  *                 df=self.TextFileReader.__next__()
  *                 return process_dataframe(df,self.enable_constants,self.constants,self.convert_all)             # <<<<<<<<<<<<<<
  *         return TextFileReader(df,enable_constants,constants,convert_all)
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_enable_constants); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 465, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_enable_constants); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_constants); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 465, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_constants); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_convert_all); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 465, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_convert_all); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (unlikely(!__pyx_cur_scope->__pyx_v_process_dataframe)) { __Pyx_RaiseClosureNameError("process_dataframe"); __PYX_ERR(0, 465, __pyx_L1_error) }
-  __pyx_t_4 = __pyx_pf_6plumed_14read_as_pandas_process_dataframe(__pyx_cur_scope->__pyx_v_process_dataframe, __pyx_v_df, __pyx_t_1, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 465, __pyx_L1_error)
+  if (unlikely(!__pyx_cur_scope->__pyx_v_process_dataframe)) { __Pyx_RaiseClosureNameError("process_dataframe"); __PYX_ERR(0, 558, __pyx_L1_error) }
+  __pyx_t_4 = __pyx_pf_6plumed_14read_as_pandas_process_dataframe(__pyx_cur_scope->__pyx_v_process_dataframe, __pyx_v_df, __pyx_t_1, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":462
+  /* "plumed.pyx":555
  *                 self.constants=constants
  *                 self.convert_all=convert_all
  *             def __next__(self):             # <<<<<<<<<<<<<<
  * # override __next__
  *                 df=self.TextFileReader.__next__()
  */
 
@@ -8814,15 +10171,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_df);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":260
+/* "plumed.pyx":353
  *                raise ValueError("plumed.Constants should be initialized with a list of 2- or 3-plets")
  * 
  * def read_as_pandas(file_or_path,enable_constants=True,enable_conversion=True,kernel=None,chunksize=None,usecols=None,skiprows=None,nrows=None,index_col=None):             # <<<<<<<<<<<<<<
  *     """Import a plumed data file as a pandas dataset.
  * 
  */
 
@@ -8855,539 +10212,539 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read_as_pandas", 0);
   __pyx_cur_scope = (struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas *)__pyx_tp_new_6plumed___pyx_scope_struct_1_read_as_pandas(__pyx_ptype_6plumed___pyx_scope_struct_1_read_as_pandas, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_6plumed___pyx_scope_struct_1_read_as_pandas *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 260, __pyx_L1_error)
+    __PYX_ERR(0, 353, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __Pyx_INCREF(__pyx_v_file_or_path);
   __Pyx_INCREF(__pyx_v_enable_constants);
   __Pyx_INCREF(__pyx_v_enable_conversion);
 
-  /* "plumed.pyx":347
+  /* "plumed.pyx":440
  * 
  * # importing pandas is pretty slow, so we only do it when needed
  *     import pandas as pd             # <<<<<<<<<<<<<<
  * 
  * # special classes used to attach metadata
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_pandas, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 347, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_pandas, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 440, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_pd = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":352
+  /* "plumed.pyx":445
  * # they are defined inside this function since they need pandas to be imported
  * # see https://pandas.pydata.org/pandas-docs/stable/development/extending.html
  *     class PlumedSeries(pd.Series):             # <<<<<<<<<<<<<<
  *         @property
  *         def _constructor(self):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_pd, __pyx_n_s_Series); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 352, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_pd, __pyx_n_s_Series); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 445, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 352, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 445, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 352, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 445, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_PlumedSeries, __pyx_n_s_read_as_pandas_locals_PlumedSeri, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 352, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_PlumedSeries, __pyx_n_s_read_as_pandas_locals_PlumedSeri, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 445, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
 
-  /* "plumed.pyx":354
+  /* "plumed.pyx":447
  *     class PlumedSeries(pd.Series):
  *         @property
  *         def _constructor(self):             # <<<<<<<<<<<<<<
  *             return PlumedSeries
  *         @property
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_12PlumedSeries_1_constructor, 0, __pyx_n_s_read_as_pandas_locals_PlumedSeri_2, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__11)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_12PlumedSeries_1_constructor, 0, __pyx_n_s_read_as_pandas_locals_PlumedSeri_2, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__13)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 447, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
 
-  /* "plumed.pyx":353
+  /* "plumed.pyx":446
  * # see https://pandas.pydata.org/pandas-docs/stable/development/extending.html
  *     class PlumedSeries(pd.Series):
  *         @property             # <<<<<<<<<<<<<<
  *         def _constructor(self):
  *             return PlumedSeries
  */
-  __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_property, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_property, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 446, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_constructor, __pyx_t_5) < 0) __PYX_ERR(0, 354, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_constructor, __pyx_t_5) < 0) __PYX_ERR(0, 447, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "plumed.pyx":357
+  /* "plumed.pyx":450
  *             return PlumedSeries
  *         @property
  *         def _constructor_expanddim(self):             # <<<<<<<<<<<<<<
  *             return PlumedDataFrame
  * 
  */
-  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_12PlumedSeries_3_constructor_expanddim, 0, __pyx_n_s_read_as_pandas_locals_PlumedSeri_3, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__13)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 357, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_12PlumedSeries_3_constructor_expanddim, 0, __pyx_n_s_read_as_pandas_locals_PlumedSeri_3, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__15)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 450, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
 
-  /* "plumed.pyx":356
+  /* "plumed.pyx":449
  *         def _constructor(self):
  *             return PlumedSeries
  *         @property             # <<<<<<<<<<<<<<
  *         def _constructor_expanddim(self):
  *             return PlumedDataFrame
  */
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_property, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 356, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_property, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 449, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_constructor_expanddim, __pyx_t_4) < 0) __PYX_ERR(0, 357, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_constructor_expanddim, __pyx_t_4) < 0) __PYX_ERR(0, 450, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "plumed.pyx":352
+  /* "plumed.pyx":445
  * # they are defined inside this function since they need pandas to be imported
  * # see https://pandas.pydata.org/pandas-docs/stable/development/extending.html
  *     class PlumedSeries(pd.Series):             # <<<<<<<<<<<<<<
  *         @property
  *         def _constructor(self):
  */
-  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_PlumedSeries, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 352, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_PlumedSeries, __pyx_t_2, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 445, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_cur_scope->__pyx_v_PlumedSeries = __pyx_t_4;
   __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":360
+  /* "plumed.pyx":453
  *             return PlumedDataFrame
  * 
  *     class PlumedDataFrame(pd.DataFrame):             # <<<<<<<<<<<<<<
  *         _metadata=["plumed_constants"]
  *         @property
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_pd, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 360, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_pd, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 453, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 360, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 453, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 360, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 453, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_1, __pyx_n_s_PlumedDataFrame, __pyx_n_s_read_as_pandas_locals_PlumedData, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 360, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_1, __pyx_n_s_PlumedDataFrame, __pyx_n_s_read_as_pandas_locals_PlumedData, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 453, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
 
-  /* "plumed.pyx":361
+  /* "plumed.pyx":454
  * 
  *     class PlumedDataFrame(pd.DataFrame):
  *         _metadata=["plumed_constants"]             # <<<<<<<<<<<<<<
  *         @property
  *         def _constructor(self):
  */
-  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 454, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_INCREF(__pyx_n_u_plumed_constants);
   __Pyx_GIVEREF(__pyx_n_u_plumed_constants);
   PyList_SET_ITEM(__pyx_t_4, 0, __pyx_n_u_plumed_constants);
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_metadata_2, __pyx_t_4) < 0) __PYX_ERR(0, 361, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_metadata_2, __pyx_t_4) < 0) __PYX_ERR(0, 454, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "plumed.pyx":363
+  /* "plumed.pyx":456
  *         _metadata=["plumed_constants"]
  *         @property
  *         def _constructor(self):             # <<<<<<<<<<<<<<
  *             return PlumedDataFrame
  *         @property
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_15PlumedDataFrame_1_constructor, 0, __pyx_n_s_read_as_pandas_locals_PlumedData_2, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__15)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 363, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_15PlumedDataFrame_1_constructor, 0, __pyx_n_s_read_as_pandas_locals_PlumedData_2, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__17)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 456, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
 
-  /* "plumed.pyx":362
+  /* "plumed.pyx":455
  *     class PlumedDataFrame(pd.DataFrame):
  *         _metadata=["plumed_constants"]
  *         @property             # <<<<<<<<<<<<<<
  *         def _constructor(self):
  *             return PlumedDataFrame
  */
-  __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_property, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 362, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_property, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 455, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_constructor, __pyx_t_5) < 0) __PYX_ERR(0, 363, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_constructor, __pyx_t_5) < 0) __PYX_ERR(0, 456, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "plumed.pyx":366
+  /* "plumed.pyx":459
  *             return PlumedDataFrame
  *         @property
  *         def _constructor_sliced(self):             # <<<<<<<<<<<<<<
  *             return PlumedSeries
  * 
  */
-  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_15PlumedDataFrame_3_constructor_sliced, 0, __pyx_n_s_read_as_pandas_locals_PlumedData_3, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__17)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 366, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_15PlumedDataFrame_3_constructor_sliced, 0, __pyx_n_s_read_as_pandas_locals_PlumedData_3, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__19)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 459, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
 
-  /* "plumed.pyx":365
+  /* "plumed.pyx":458
  *         def _constructor(self):
  *             return PlumedDataFrame
  *         @property             # <<<<<<<<<<<<<<
  *         def _constructor_sliced(self):
  *             return PlumedSeries
  */
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_property, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 365, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_property, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 458, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_constructor_sliced, __pyx_t_4) < 0) __PYX_ERR(0, 366, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_3, __pyx_n_s_constructor_sliced, __pyx_t_4) < 0) __PYX_ERR(0, 459, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "plumed.pyx":360
+  /* "plumed.pyx":453
  *             return PlumedDataFrame
  * 
  *     class PlumedDataFrame(pd.DataFrame):             # <<<<<<<<<<<<<<
  *         _metadata=["plumed_constants"]
  *         @property
  */
-  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_PlumedDataFrame, __pyx_t_1, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 360, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_PlumedDataFrame, __pyx_t_1, __pyx_t_3, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 453, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_cur_scope->__pyx_v_PlumedDataFrame = __pyx_t_4;
   __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":371
+  /* "plumed.pyx":464
  * # auxiliary function to process a dataframe
  * # it is defined here since it requires PlumedDataFrame to be defined
  *     def process_dataframe(df,enable_constants,constants,convert_all):             # <<<<<<<<<<<<<<
  *         if convert_all: df=df.applymap(convert_all)
  *         if enable_constants=='columns':
  */
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_1process_dataframe, 0, __pyx_n_s_read_as_pandas_locals_process_da, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__19)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 371, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_1process_dataframe, 0, __pyx_n_s_read_as_pandas_locals_process_da, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__21)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 464, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_process_dataframe = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":381
+  /* "plumed.pyx":474
  * 
  * # process arguments:
  *     if enable_conversion is True:             # <<<<<<<<<<<<<<
  *        enable_conversion='constants'
  *     if enable_conversion is False:
  */
   __pyx_t_6 = (__pyx_v_enable_conversion == Py_True);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "plumed.pyx":382
+    /* "plumed.pyx":475
  * # process arguments:
  *     if enable_conversion is True:
  *        enable_conversion='constants'             # <<<<<<<<<<<<<<
  *     if enable_conversion is False:
  *        enable_conversion='no'
  */
     __Pyx_INCREF(__pyx_n_u_constants);
     __Pyx_DECREF_SET(__pyx_v_enable_conversion, __pyx_n_u_constants);
 
-    /* "plumed.pyx":381
+    /* "plumed.pyx":474
  * 
  * # process arguments:
  *     if enable_conversion is True:             # <<<<<<<<<<<<<<
  *        enable_conversion='constants'
  *     if enable_conversion is False:
  */
   }
 
-  /* "plumed.pyx":383
+  /* "plumed.pyx":476
  *     if enable_conversion is True:
  *        enable_conversion='constants'
  *     if enable_conversion is False:             # <<<<<<<<<<<<<<
  *        enable_conversion='no'
  *     if enable_constants is True:
  */
   __pyx_t_7 = (__pyx_v_enable_conversion == Py_False);
   __pyx_t_6 = (__pyx_t_7 != 0);
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":384
+    /* "plumed.pyx":477
  *        enable_conversion='constants'
  *     if enable_conversion is False:
  *        enable_conversion='no'             # <<<<<<<<<<<<<<
  *     if enable_constants is True:
  *        enable_constants='metadata'
  */
     __Pyx_INCREF(__pyx_n_u_no);
     __Pyx_DECREF_SET(__pyx_v_enable_conversion, __pyx_n_u_no);
 
-    /* "plumed.pyx":383
+    /* "plumed.pyx":476
  *     if enable_conversion is True:
  *        enable_conversion='constants'
  *     if enable_conversion is False:             # <<<<<<<<<<<<<<
  *        enable_conversion='no'
  *     if enable_constants is True:
  */
   }
 
-  /* "plumed.pyx":385
+  /* "plumed.pyx":478
  *     if enable_conversion is False:
  *        enable_conversion='no'
  *     if enable_constants is True:             # <<<<<<<<<<<<<<
  *        enable_constants='metadata'
  *     if enable_constants is False:
  */
   __pyx_t_6 = (__pyx_v_enable_constants == Py_True);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "plumed.pyx":386
+    /* "plumed.pyx":479
  *        enable_conversion='no'
  *     if enable_constants is True:
  *        enable_constants='metadata'             # <<<<<<<<<<<<<<
  *     if enable_constants is False:
  *        enable_constants='no'
  */
     __Pyx_INCREF(__pyx_n_u_metadata);
     __Pyx_DECREF_SET(__pyx_v_enable_constants, __pyx_n_u_metadata);
 
-    /* "plumed.pyx":385
+    /* "plumed.pyx":478
  *     if enable_conversion is False:
  *        enable_conversion='no'
  *     if enable_constants is True:             # <<<<<<<<<<<<<<
  *        enable_constants='metadata'
  *     if enable_constants is False:
  */
   }
 
-  /* "plumed.pyx":387
+  /* "plumed.pyx":480
  *     if enable_constants is True:
  *        enable_constants='metadata'
  *     if enable_constants is False:             # <<<<<<<<<<<<<<
  *        enable_constants='no'
  * 
  */
   __pyx_t_7 = (__pyx_v_enable_constants == Py_False);
   __pyx_t_6 = (__pyx_t_7 != 0);
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":388
+    /* "plumed.pyx":481
  *        enable_constants='metadata'
  *     if enable_constants is False:
  *        enable_constants='no'             # <<<<<<<<<<<<<<
  * 
  * # check arguments:
  */
     __Pyx_INCREF(__pyx_n_u_no);
     __Pyx_DECREF_SET(__pyx_v_enable_constants, __pyx_n_u_no);
 
-    /* "plumed.pyx":387
+    /* "plumed.pyx":480
  *     if enable_constants is True:
  *        enable_constants='metadata'
  *     if enable_constants is False:             # <<<<<<<<<<<<<<
  *        enable_constants='no'
  * 
  */
   }
 
-  /* "plumed.pyx":391
+  /* "plumed.pyx":484
  * 
  * # check arguments:
  *     if not (enable_conversion=='no' or enable_conversion=='constants' or enable_conversion=='all'):             # <<<<<<<<<<<<<<
  *         raise ValueError("enable_conversion not valid")
  *     if not (enable_constants=='no' or enable_constants=='metadata' or enable_constants=='columns'):
  */
-  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_no, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 391, __pyx_L1_error)
+  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_no, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 484, __pyx_L1_error)
   if (!__pyx_t_7) {
   } else {
     __pyx_t_6 = __pyx_t_7;
     goto __pyx_L8_bool_binop_done;
   }
-  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_constants, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 391, __pyx_L1_error)
+  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_constants, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 484, __pyx_L1_error)
   if (!__pyx_t_7) {
   } else {
     __pyx_t_6 = __pyx_t_7;
     goto __pyx_L8_bool_binop_done;
   }
-  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_all, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 391, __pyx_L1_error)
+  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_all, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 484, __pyx_L1_error)
   __pyx_t_6 = __pyx_t_7;
   __pyx_L8_bool_binop_done:;
   __pyx_t_7 = ((!__pyx_t_6) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "plumed.pyx":392
+    /* "plumed.pyx":485
  * # check arguments:
  *     if not (enable_conversion=='no' or enable_conversion=='constants' or enable_conversion=='all'):
  *         raise ValueError("enable_conversion not valid")             # <<<<<<<<<<<<<<
  *     if not (enable_constants=='no' or enable_constants=='metadata' or enable_constants=='columns'):
  *         raise ValueError("enable_conversion not valid")
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__20, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 392, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 392, __pyx_L1_error)
+    __PYX_ERR(0, 485, __pyx_L1_error)
 
-    /* "plumed.pyx":391
+    /* "plumed.pyx":484
  * 
  * # check arguments:
  *     if not (enable_conversion=='no' or enable_conversion=='constants' or enable_conversion=='all'):             # <<<<<<<<<<<<<<
  *         raise ValueError("enable_conversion not valid")
  *     if not (enable_constants=='no' or enable_constants=='metadata' or enable_constants=='columns'):
  */
   }
 
-  /* "plumed.pyx":393
+  /* "plumed.pyx":486
  *     if not (enable_conversion=='no' or enable_conversion=='constants' or enable_conversion=='all'):
  *         raise ValueError("enable_conversion not valid")
  *     if not (enable_constants=='no' or enable_constants=='metadata' or enable_constants=='columns'):             # <<<<<<<<<<<<<<
  *         raise ValueError("enable_conversion not valid")
  * 
  */
-  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_no, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 393, __pyx_L1_error)
+  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_no, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 486, __pyx_L1_error)
   if (!__pyx_t_6) {
   } else {
     __pyx_t_7 = __pyx_t_6;
     goto __pyx_L12_bool_binop_done;
   }
-  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_metadata, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 393, __pyx_L1_error)
+  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_metadata, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 486, __pyx_L1_error)
   if (!__pyx_t_6) {
   } else {
     __pyx_t_7 = __pyx_t_6;
     goto __pyx_L12_bool_binop_done;
   }
-  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_columns, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 393, __pyx_L1_error)
+  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_columns, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 486, __pyx_L1_error)
   __pyx_t_7 = __pyx_t_6;
   __pyx_L12_bool_binop_done:;
   __pyx_t_6 = ((!__pyx_t_7) != 0);
   if (unlikely(__pyx_t_6)) {
 
-    /* "plumed.pyx":394
+    /* "plumed.pyx":487
  *         raise ValueError("enable_conversion not valid")
  *     if not (enable_constants=='no' or enable_constants=='metadata' or enable_constants=='columns'):
  *         raise ValueError("enable_conversion not valid")             # <<<<<<<<<<<<<<
  * 
  * # conversions functions:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__20, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 394, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 487, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 394, __pyx_L1_error)
+    __PYX_ERR(0, 487, __pyx_L1_error)
 
-    /* "plumed.pyx":393
+    /* "plumed.pyx":486
  *     if not (enable_conversion=='no' or enable_conversion=='constants' or enable_conversion=='all'):
  *         raise ValueError("enable_conversion not valid")
  *     if not (enable_constants=='no' or enable_constants=='metadata' or enable_constants=='columns'):             # <<<<<<<<<<<<<<
  *         raise ValueError("enable_conversion not valid")
  * 
  */
   }
 
-  /* "plumed.pyx":397
+  /* "plumed.pyx":490
  * 
  * # conversions functions:
  *     convert=None             # <<<<<<<<<<<<<<
  *     convert_all=None
  * # only create them if needed
  */
   __Pyx_INCREF(Py_None);
   __pyx_v_convert = Py_None;
 
-  /* "plumed.pyx":398
+  /* "plumed.pyx":491
  * # conversions functions:
  *     convert=None
  *     convert_all=None             # <<<<<<<<<<<<<<
  * # only create them if needed
  *     if (enable_conversion=='constants' and enable_constants) or enable_conversion=='all':
  */
   __Pyx_INCREF(Py_None);
   __pyx_v_convert_all = Py_None;
 
-  /* "plumed.pyx":400
+  /* "plumed.pyx":493
  *     convert_all=None
  * # only create them if needed
  *     if (enable_conversion=='constants' and enable_constants) or enable_conversion=='all':             # <<<<<<<<<<<<<<
  *         convert=_build_convert_function(kernel)
  * # if necessary, set convert_all
  */
-  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_constants, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 400, __pyx_L1_error)
+  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_constants, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 493, __pyx_L1_error)
   if (!__pyx_t_7) {
     goto __pyx_L17_next_or;
   } else {
   }
-  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_enable_constants); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 400, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_enable_constants); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 493, __pyx_L1_error)
   if (!__pyx_t_7) {
   } else {
     __pyx_t_6 = __pyx_t_7;
     goto __pyx_L16_bool_binop_done;
   }
   __pyx_L17_next_or:;
-  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_all, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 400, __pyx_L1_error)
+  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_all, Py_EQ)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 493, __pyx_L1_error)
   __pyx_t_6 = __pyx_t_7;
   __pyx_L16_bool_binop_done:;
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":401
+    /* "plumed.pyx":494
  * # only create them if needed
  *     if (enable_conversion=='constants' and enable_constants) or enable_conversion=='all':
  *         convert=_build_convert_function(kernel)             # <<<<<<<<<<<<<<
  * # if necessary, set convert_all
  *         if enable_conversion=='all': convert_all=convert
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_build_convert_function); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 401, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_build_convert_function); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 494, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_kernel) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_kernel);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 401, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 494, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF_SET(__pyx_v_convert, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "plumed.pyx":403
+    /* "plumed.pyx":496
  *         convert=_build_convert_function(kernel)
  * # if necessary, set convert_all
  *         if enable_conversion=='all': convert_all=convert             # <<<<<<<<<<<<<<
  * 
  * # handle file
  */
-    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_all, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 403, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_conversion, __pyx_n_u_all, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 496, __pyx_L1_error)
     if (__pyx_t_6) {
       __Pyx_INCREF(__pyx_v_convert);
       __Pyx_DECREF_SET(__pyx_v_convert_all, __pyx_v_convert);
     }
 
-    /* "plumed.pyx":400
+    /* "plumed.pyx":493
  *     convert_all=None
  * # only create them if needed
  *     if (enable_conversion=='constants' and enable_constants) or enable_conversion=='all':             # <<<<<<<<<<<<<<
  *         convert=_build_convert_function(kernel)
  * # if necessary, set convert_all
  */
   }
 
-  /* "plumed.pyx":406
+  /* "plumed.pyx":499
  * 
  * # handle file
  *     file_or_path=_fix_file(file_or_path,'rt')             # <<<<<<<<<<<<<<
  * 
  * # read first line
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_fix_file); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 406, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_fix_file); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 499, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_8 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -9396,127 +10753,127 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_8 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_file_or_path, __pyx_n_u_rt};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 499, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_file_or_path, __pyx_n_u_rt};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 499, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_4 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 406, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 499, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_INCREF(__pyx_v_file_or_path);
     __Pyx_GIVEREF(__pyx_v_file_or_path);
     PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_8, __pyx_v_file_or_path);
     __Pyx_INCREF(__pyx_n_u_rt);
     __Pyx_GIVEREF(__pyx_n_u_rt);
     PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_8, __pyx_n_u_rt);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 499, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF_SET(__pyx_v_file_or_path, __pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":409
+  /* "plumed.pyx":502
  * 
  * # read first line
  *     line = file_or_path.readline()             # <<<<<<<<<<<<<<
  *     columns = line.split()
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_readline); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 409, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_readline); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 502, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 409, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 502, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_line = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":410
+  /* "plumed.pyx":503
  * # read first line
  *     line = file_or_path.readline()
  *     columns = line.split()             # <<<<<<<<<<<<<<
  * 
  * # check header
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_line, __pyx_n_s_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 410, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_line, __pyx_n_s_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 503, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 410, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 503, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_columns = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":413
+  /* "plumed.pyx":506
  * 
  * # check header
  *     if len(columns)<2:             # <<<<<<<<<<<<<<
  *         raise FormatError("Error reading PLUMED file "+file_or_path.name + ". Not enough columns")
  *     if columns[0] != "#!" or columns[1] != "FIELDS":
  */
-  __pyx_t_9 = PyObject_Length(__pyx_v_columns); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 413, __pyx_L1_error)
+  __pyx_t_9 = PyObject_Length(__pyx_v_columns); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 506, __pyx_L1_error)
   __pyx_t_6 = ((__pyx_t_9 < 2) != 0);
   if (unlikely(__pyx_t_6)) {
 
-    /* "plumed.pyx":414
+    /* "plumed.pyx":507
  * # check header
  *     if len(columns)<2:
  *         raise FormatError("Error reading PLUMED file "+file_or_path.name + ". Not enough columns")             # <<<<<<<<<<<<<<
  *     if columns[0] != "#!" or columns[1] != "FIELDS":
  *         raise FormatError("Error reading PLUMED file" +file_or_path.name + ". Columns: "+columns[0]+" "+columns[1])
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FormatError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 414, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FormatError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 507, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 414, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 507, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = PyNumber_Add(__pyx_kp_u_Error_reading_PLUMED_file, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 414, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_kp_u_Error_reading_PLUMED_file, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 507, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_Not_enough_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 414, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_Not_enough_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 507, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -9524,83 +10881,83 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 414, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 507, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 414, __pyx_L1_error)
+    __PYX_ERR(0, 507, __pyx_L1_error)
 
-    /* "plumed.pyx":413
+    /* "plumed.pyx":506
  * 
  * # check header
  *     if len(columns)<2:             # <<<<<<<<<<<<<<
  *         raise FormatError("Error reading PLUMED file "+file_or_path.name + ". Not enough columns")
  *     if columns[0] != "#!" or columns[1] != "FIELDS":
  */
   }
 
-  /* "plumed.pyx":415
+  /* "plumed.pyx":508
  *     if len(columns)<2:
  *         raise FormatError("Error reading PLUMED file "+file_or_path.name + ". Not enough columns")
  *     if columns[0] != "#!" or columns[1] != "FIELDS":             # <<<<<<<<<<<<<<
  *         raise FormatError("Error reading PLUMED file" +file_or_path.name + ". Columns: "+columns[0]+" "+columns[1])
  * 
  */
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_columns, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 415, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_columns, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_kp_u__21, Py_NE)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 415, __pyx_L1_error)
+  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_kp_u__23, Py_NE)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (!__pyx_t_7) {
   } else {
     __pyx_t_6 = __pyx_t_7;
     goto __pyx_L22_bool_binop_done;
   }
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_columns, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 415, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_columns, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_FIELDS, Py_NE)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 415, __pyx_L1_error)
+  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_FIELDS, Py_NE)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_6 = __pyx_t_7;
   __pyx_L22_bool_binop_done:;
   if (unlikely(__pyx_t_6)) {
 
-    /* "plumed.pyx":416
+    /* "plumed.pyx":509
  *         raise FormatError("Error reading PLUMED file "+file_or_path.name + ". Not enough columns")
  *     if columns[0] != "#!" or columns[1] != "FIELDS":
  *         raise FormatError("Error reading PLUMED file" +file_or_path.name + ". Columns: "+columns[0]+" "+columns[1])             # <<<<<<<<<<<<<<
  * 
  * # read column names
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FormatError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_FormatError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = PyNumber_Add(__pyx_kp_u_Error_reading_PLUMED_file_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_kp_u_Error_reading_PLUMED_file_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_Columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_Columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_columns, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_columns, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = PyNumber_Add(__pyx_t_5, __pyx_kp_u__22); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_5, __pyx_kp_u__24); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_columns, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_columns, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_5)) {
@@ -9609,298 +10966,298 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 416, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 509, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 416, __pyx_L1_error)
+    __PYX_ERR(0, 509, __pyx_L1_error)
 
-    /* "plumed.pyx":415
+    /* "plumed.pyx":508
  *     if len(columns)<2:
  *         raise FormatError("Error reading PLUMED file "+file_or_path.name + ". Not enough columns")
  *     if columns[0] != "#!" or columns[1] != "FIELDS":             # <<<<<<<<<<<<<<
  *         raise FormatError("Error reading PLUMED file" +file_or_path.name + ". Columns: "+columns[0]+" "+columns[1])
  * 
  */
   }
 
-  /* "plumed.pyx":419
+  /* "plumed.pyx":512
  * 
  * # read column names
  *     columns = columns[2:]             # <<<<<<<<<<<<<<
  * 
  * # read constants
  */
-  __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_columns, 2, 0, NULL, NULL, &__pyx_slice__23, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 419, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_columns, 2, 0, NULL, NULL, &__pyx_slice__25, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 512, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF_SET(__pyx_v_columns, __pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":422
+  /* "plumed.pyx":515
  * 
  * # read constants
  *     constants=[]             # <<<<<<<<<<<<<<
  *     if enable_constants!='no':
  *         while True:
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 422, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 515, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_constants = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":423
+  /* "plumed.pyx":516
  * # read constants
  *     constants=[]
  *     if enable_constants!='no':             # <<<<<<<<<<<<<<
  *         while True:
  *             pos=file_or_path.tell()
  */
-  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_no, Py_NE)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 423, __pyx_L1_error)
+  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_enable_constants, __pyx_n_u_no, Py_NE)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 516, __pyx_L1_error)
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":424
+    /* "plumed.pyx":517
  *     constants=[]
  *     if enable_constants!='no':
  *         while True:             # <<<<<<<<<<<<<<
  *             pos=file_or_path.tell()
  *             line = file_or_path.readline()
  */
     while (1) {
 
-      /* "plumed.pyx":425
+      /* "plumed.pyx":518
  *     if enable_constants!='no':
  *         while True:
  *             pos=file_or_path.tell()             # <<<<<<<<<<<<<<
  *             line = file_or_path.readline()
  *             file_or_path.seek(pos)
  */
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_tell); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 425, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_tell); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 518, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_4 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_4)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
           __Pyx_INCREF(__pyx_t_4);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 425, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 518, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_XDECREF_SET(__pyx_v_pos, __pyx_t_1);
       __pyx_t_1 = 0;
 
-      /* "plumed.pyx":426
+      /* "plumed.pyx":519
  *         while True:
  *             pos=file_or_path.tell()
  *             line = file_or_path.readline()             # <<<<<<<<<<<<<<
  *             file_or_path.seek(pos)
  *             if not line:
  */
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_readline); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 426, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_readline); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 519, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_4 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_4)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
           __Pyx_INCREF(__pyx_t_4);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 426, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 519, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF_SET(__pyx_v_line, __pyx_t_1);
       __pyx_t_1 = 0;
 
-      /* "plumed.pyx":427
+      /* "plumed.pyx":520
  *             pos=file_or_path.tell()
  *             line = file_or_path.readline()
  *             file_or_path.seek(pos)             # <<<<<<<<<<<<<<
  *             if not line:
  *                 break
  */
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_seek); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 427, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_seek); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 520, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_4 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_4)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
           __Pyx_INCREF(__pyx_t_4);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v_pos) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_pos);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 427, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 520, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-      /* "plumed.pyx":428
+      /* "plumed.pyx":521
  *             line = file_or_path.readline()
  *             file_or_path.seek(pos)
  *             if not line:             # <<<<<<<<<<<<<<
  *                 break
  *             sets = line.split()
  */
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_line); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 428, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_line); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 521, __pyx_L1_error)
       __pyx_t_7 = ((!__pyx_t_6) != 0);
       if (__pyx_t_7) {
 
-        /* "plumed.pyx":429
+        /* "plumed.pyx":522
  *             file_or_path.seek(pos)
  *             if not line:
  *                 break             # <<<<<<<<<<<<<<
  *             sets = line.split()
  *             if len(sets) < 4:
  */
         goto __pyx_L26_break;
 
-        /* "plumed.pyx":428
+        /* "plumed.pyx":521
  *             line = file_or_path.readline()
  *             file_or_path.seek(pos)
  *             if not line:             # <<<<<<<<<<<<<<
  *                 break
  *             sets = line.split()
  */
       }
 
-      /* "plumed.pyx":430
+      /* "plumed.pyx":523
  *             if not line:
  *                 break
  *             sets = line.split()             # <<<<<<<<<<<<<<
  *             if len(sets) < 4:
  *                 break
  */
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_line, __pyx_n_s_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 430, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_line, __pyx_n_s_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 523, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_4 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_4)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
           __Pyx_INCREF(__pyx_t_4);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 430, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_XDECREF_SET(__pyx_v_sets, __pyx_t_1);
       __pyx_t_1 = 0;
 
-      /* "plumed.pyx":431
+      /* "plumed.pyx":524
  *                 break
  *             sets = line.split()
  *             if len(sets) < 4:             # <<<<<<<<<<<<<<
  *                 break
  *             if sets[0]!="#!" or sets[1]!="SET":
  */
-      __pyx_t_9 = PyObject_Length(__pyx_v_sets); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 431, __pyx_L1_error)
+      __pyx_t_9 = PyObject_Length(__pyx_v_sets); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 524, __pyx_L1_error)
       __pyx_t_7 = ((__pyx_t_9 < 4) != 0);
       if (__pyx_t_7) {
 
-        /* "plumed.pyx":432
+        /* "plumed.pyx":525
  *             sets = line.split()
  *             if len(sets) < 4:
  *                 break             # <<<<<<<<<<<<<<
  *             if sets[0]!="#!" or sets[1]!="SET":
  *                 break
  */
         goto __pyx_L26_break;
 
-        /* "plumed.pyx":431
+        /* "plumed.pyx":524
  *                 break
  *             sets = line.split()
  *             if len(sets) < 4:             # <<<<<<<<<<<<<<
  *                 break
  *             if sets[0]!="#!" or sets[1]!="SET":
  */
       }
 
-      /* "plumed.pyx":433
+      /* "plumed.pyx":526
  *             if len(sets) < 4:
  *                 break
  *             if sets[0]!="#!" or sets[1]!="SET":             # <<<<<<<<<<<<<<
  *                 break
  *             if(convert):
  */
-      __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_sets, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 433, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_sets, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_kp_u__21, Py_NE)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 433, __pyx_L1_error)
+      __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_kp_u__23, Py_NE)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       if (!__pyx_t_6) {
       } else {
         __pyx_t_7 = __pyx_t_6;
         goto __pyx_L30_bool_binop_done;
       }
-      __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_sets, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 433, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_sets, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_SET, Py_NE)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 433, __pyx_L1_error)
+      __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_SET, Py_NE)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_7 = __pyx_t_6;
       __pyx_L30_bool_binop_done:;
       if (__pyx_t_7) {
 
-        /* "plumed.pyx":434
+        /* "plumed.pyx":527
  *                 break
  *             if sets[0]!="#!" or sets[1]!="SET":
  *                 break             # <<<<<<<<<<<<<<
  *             if(convert):
  *                 v=convert(sets[3])
  */
         goto __pyx_L26_break;
 
-        /* "plumed.pyx":433
+        /* "plumed.pyx":526
  *             if len(sets) < 4:
  *                 break
  *             if sets[0]!="#!" or sets[1]!="SET":             # <<<<<<<<<<<<<<
  *                 break
  *             if(convert):
  */
       }
 
-      /* "plumed.pyx":435
+      /* "plumed.pyx":528
  *             if sets[0]!="#!" or sets[1]!="SET":
  *                 break
  *             if(convert):             # <<<<<<<<<<<<<<
  *                 v=convert(sets[3])
  *             else:
  */
-      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_convert); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 435, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_convert); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 528, __pyx_L1_error)
       if (__pyx_t_7) {
 
-        /* "plumed.pyx":436
+        /* "plumed.pyx":529
  *                 break
  *             if(convert):
  *                 v=convert(sets[3])             # <<<<<<<<<<<<<<
  *             else:
  *                 v=sets[3]
  */
-        __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_sets, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 436, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_sets, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 529, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_INCREF(__pyx_v_convert);
         __pyx_t_4 = __pyx_v_convert; __pyx_t_5 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -9908,278 +11265,278 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2);
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 436, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 529, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_1);
         __pyx_t_1 = 0;
 
-        /* "plumed.pyx":435
+        /* "plumed.pyx":528
  *             if sets[0]!="#!" or sets[1]!="SET":
  *                 break
  *             if(convert):             # <<<<<<<<<<<<<<
  *                 v=convert(sets[3])
  *             else:
  */
         goto __pyx_L32;
       }
 
-      /* "plumed.pyx":438
+      /* "plumed.pyx":531
  *                 v=convert(sets[3])
  *             else:
  *                 v=sets[3]             # <<<<<<<<<<<<<<
  * # name / value / string
  *             constants.append((sets[2],v,sets[3]))
  */
       /*else*/ {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_sets, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 438, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_sets, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 531, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_1);
         __pyx_t_1 = 0;
       }
       __pyx_L32:;
 
-      /* "plumed.pyx":440
+      /* "plumed.pyx":533
  *                 v=sets[3]
  * # name / value / string
  *             constants.append((sets[2],v,sets[3]))             # <<<<<<<<<<<<<<
  *             file_or_path.readline() # read again to go to next line
  * 
  */
-      __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_sets, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 440, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_sets, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 533, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_sets, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 440, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_sets, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 533, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 440, __pyx_L1_error)
+      __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 533, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_GIVEREF(__pyx_t_1);
       PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
       __Pyx_INCREF(__pyx_v_v);
       __Pyx_GIVEREF(__pyx_v_v);
       PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_v);
       __Pyx_GIVEREF(__pyx_t_4);
       PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_t_4);
       __pyx_t_1 = 0;
       __pyx_t_4 = 0;
-      __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_constants, __pyx_t_2); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 440, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_constants, __pyx_t_2); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 533, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-      /* "plumed.pyx":441
+      /* "plumed.pyx":534
  * # name / value / string
  *             constants.append((sets[2],v,sets[3]))
  *             file_or_path.readline() # read again to go to next line             # <<<<<<<<<<<<<<
  * 
  * # read the rest of the file
  */
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_readline); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 441, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_readline); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 534, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __pyx_t_1 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
         __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
         if (likely(__pyx_t_1)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
           __Pyx_INCREF(__pyx_t_1);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_4, function);
         }
       }
       __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 441, __pyx_L1_error)
+      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 534, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     }
     __pyx_L26_break:;
 
-    /* "plumed.pyx":423
+    /* "plumed.pyx":516
  * # read constants
  *     constants=[]
  *     if enable_constants!='no':             # <<<<<<<<<<<<<<
  *         while True:
  *             pos=file_or_path.tell()
  */
   }
 
-  /* "plumed.pyx":445
+  /* "plumed.pyx":538
  * # read the rest of the file
  * # notice that if chunksize was provided the result will be an iterable object
  *     df=pd.read_csv(file_or_path, delim_whitespace=True, comment="#", header=None,names=columns,             # <<<<<<<<<<<<<<
  *                     usecols=usecols,skiprows=skiprows,nrows=nrows,chunksize=chunksize,index_col=index_col)
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_pd, __pyx_n_s_read_csv); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 445, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_pd, __pyx_n_s_read_csv); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 445, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_INCREF(__pyx_v_file_or_path);
   __Pyx_GIVEREF(__pyx_v_file_or_path);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_file_or_path);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 445, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_delim_whitespace, Py_True) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_comment, __pyx_kp_u__24) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_header, Py_None) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_names, __pyx_v_columns) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_delim_whitespace, Py_True) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_comment, __pyx_kp_u__26) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_header, Py_None) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_names, __pyx_v_columns) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
 
-  /* "plumed.pyx":446
+  /* "plumed.pyx":539
  * # notice that if chunksize was provided the result will be an iterable object
  *     df=pd.read_csv(file_or_path, delim_whitespace=True, comment="#", header=None,names=columns,
  *                     usecols=usecols,skiprows=skiprows,nrows=nrows,chunksize=chunksize,index_col=index_col)             # <<<<<<<<<<<<<<
  * 
  *     if chunksize is None:
  */
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_usecols, __pyx_v_usecols) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_skiprows, __pyx_v_skiprows) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_nrows, __pyx_v_nrows) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_chunksize, __pyx_v_chunksize) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_index_col, __pyx_v_index_col) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_usecols, __pyx_v_usecols) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_skiprows, __pyx_v_skiprows) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_nrows, __pyx_v_nrows) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_chunksize, __pyx_v_chunksize) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_index_col, __pyx_v_index_col) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
 
-  /* "plumed.pyx":445
+  /* "plumed.pyx":538
  * # read the rest of the file
  * # notice that if chunksize was provided the result will be an iterable object
  *     df=pd.read_csv(file_or_path, delim_whitespace=True, comment="#", header=None,names=columns,             # <<<<<<<<<<<<<<
  *                     usecols=usecols,skiprows=skiprows,nrows=nrows,chunksize=chunksize,index_col=index_col)
  * 
  */
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 445, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_df = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "plumed.pyx":448
+  /* "plumed.pyx":541
  *                     usecols=usecols,skiprows=skiprows,nrows=nrows,chunksize=chunksize,index_col=index_col)
  * 
  *     if chunksize is None:             # <<<<<<<<<<<<<<
  * # just perform conversions and attach constants to the dataframe
  *         return process_dataframe(df,enable_constants,constants,convert_all)
  */
   __pyx_t_7 = (__pyx_v_chunksize == Py_None);
   __pyx_t_6 = (__pyx_t_7 != 0);
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":450
+    /* "plumed.pyx":543
  *     if chunksize is None:
  * # just perform conversions and attach constants to the dataframe
  *         return process_dataframe(df,enable_constants,constants,convert_all)             # <<<<<<<<<<<<<<
  *     else:
  * # declare an alternate class that is iterable to read the file in chunks
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_5 = __pyx_pf_6plumed_14read_as_pandas_process_dataframe(__pyx_cur_scope->__pyx_v_process_dataframe, __pyx_v_df, __pyx_v_enable_constants, __pyx_v_constants, __pyx_v_convert_all); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 450, __pyx_L1_error)
+    __pyx_t_5 = __pyx_pf_6plumed_14read_as_pandas_process_dataframe(__pyx_cur_scope->__pyx_v_process_dataframe, __pyx_v_df, __pyx_v_enable_constants, __pyx_v_constants, __pyx_v_convert_all); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 543, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_r = __pyx_t_5;
     __pyx_t_5 = 0;
     goto __pyx_L0;
 
-    /* "plumed.pyx":448
+    /* "plumed.pyx":541
  *                     usecols=usecols,skiprows=skiprows,nrows=nrows,chunksize=chunksize,index_col=index_col)
  * 
  *     if chunksize is None:             # <<<<<<<<<<<<<<
  * # just perform conversions and attach constants to the dataframe
  *         return process_dataframe(df,enable_constants,constants,convert_all)
  */
   }
 
-  /* "plumed.pyx":453
+  /* "plumed.pyx":546
  *     else:
  * # declare an alternate class that is iterable to read the file in chunks
  *         class TextFileReader(type(df)):             # <<<<<<<<<<<<<<
  *             """Subclass of pandas.io.TestFileReader, needed for storing constants"""
  * # some information (constant values and conversion function)
  */
   /*else*/ {
-    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 546, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_INCREF(((PyObject *)Py_TYPE(__pyx_v_df)));
     __Pyx_GIVEREF(((PyObject *)Py_TYPE(__pyx_v_df)));
     PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)Py_TYPE(__pyx_v_df)));
-    __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 546, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_5, __pyx_n_s_TextFileReader, __pyx_n_s_read_as_pandas_locals_TextFileRe, (PyObject *) NULL, __pyx_n_s_plumed, __pyx_kp_s_Subclass_of_pandas_io_TestFileRe); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_5, __pyx_n_s_TextFileReader, __pyx_n_s_read_as_pandas_locals_TextFileRe, (PyObject *) NULL, __pyx_n_s_plumed, __pyx_kp_s_Subclass_of_pandas_io_TestFileRe); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 546, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
 
-    /* "plumed.pyx":457
+    /* "plumed.pyx":550
  * # some information (constant values and conversion function)
  * # should be stored in the class to be used while iterating on it
  *             def __init__(self,reader,enable_constants,constants,convert_all):             # <<<<<<<<<<<<<<
  *                 self.TextFileReader=reader
  *                 self.enable_constants=enable_constants
  */
-    __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_14TextFileReader_1__init__, 0, __pyx_n_s_read_as_pandas_locals_TextFileRe_2, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__26)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 457, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_14TextFileReader_1__init__, 0, __pyx_n_s_read_as_pandas_locals_TextFileRe_2, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 550, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    if (__Pyx_SetNameInClass(__pyx_t_4, __pyx_n_s_init, __pyx_t_2) < 0) __PYX_ERR(0, 457, __pyx_L1_error)
+    if (__Pyx_SetNameInClass(__pyx_t_4, __pyx_n_s_init, __pyx_t_2) < 0) __PYX_ERR(0, 550, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":462
+    /* "plumed.pyx":555
  *                 self.constants=constants
  *                 self.convert_all=convert_all
  *             def __next__(self):             # <<<<<<<<<<<<<<
  * # override __next__
  *                 df=self.TextFileReader.__next__()
  */
-    __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_14TextFileReader_3__next__, 0, __pyx_n_s_read_as_pandas_locals_TextFileRe_3, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 462, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_14read_as_pandas_14TextFileReader_3__next__, 0, __pyx_n_s_read_as_pandas_locals_TextFileRe_3, ((PyObject*)__pyx_cur_scope), __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 555, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    if (__Pyx_SetNameInClass(__pyx_t_4, __pyx_n_s_next, __pyx_t_2) < 0) __PYX_ERR(0, 462, __pyx_L1_error)
+    if (__Pyx_SetNameInClass(__pyx_t_4, __pyx_n_s_next, __pyx_t_2) < 0) __PYX_ERR(0, 555, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":453
+    /* "plumed.pyx":546
  *     else:
  * # declare an alternate class that is iterable to read the file in chunks
  *         class TextFileReader(type(df)):             # <<<<<<<<<<<<<<
  *             """Subclass of pandas.io.TestFileReader, needed for storing constants"""
  * # some information (constant values and conversion function)
  */
-    __pyx_t_2 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_TextFileReader, __pyx_t_5, __pyx_t_4, NULL, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_TextFileReader, __pyx_t_5, __pyx_t_4, NULL, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 546, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_v_TextFileReader = __pyx_t_2;
     __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "plumed.pyx":466
+    /* "plumed.pyx":559
  *                 df=self.TextFileReader.__next__()
  *                 return process_dataframe(df,self.enable_constants,self.constants,self.convert_all)
  *         return TextFileReader(df,enable_constants,constants,convert_all)             # <<<<<<<<<<<<<<
  * 
  * def write_pandas(df,file_or_path=None):
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 466, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 559, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_INCREF(__pyx_v_df);
     __Pyx_GIVEREF(__pyx_v_df);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_df);
     __Pyx_INCREF(__pyx_v_enable_constants);
     __Pyx_GIVEREF(__pyx_v_enable_constants);
     PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_enable_constants);
     __Pyx_INCREF(__pyx_v_constants);
     __Pyx_GIVEREF(__pyx_v_constants);
     PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_v_constants);
     __Pyx_INCREF(__pyx_v_convert_all);
     __Pyx_GIVEREF(__pyx_v_convert_all);
     PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_v_convert_all);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_v_TextFileReader, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 466, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_v_TextFileReader, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 559, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
   }
 
-  /* "plumed.pyx":260
+  /* "plumed.pyx":353
  *                raise ValueError("plumed.Constants should be initialized with a list of 2- or 3-plets")
  * 
  * def read_as_pandas(file_or_path,enable_constants=True,enable_conversion=True,kernel=None,chunksize=None,usecols=None,skiprows=None,nrows=None,index_col=None):             # <<<<<<<<<<<<<<
  *     """Import a plumed data file as a pandas dataset.
  * 
  */
 
@@ -10209,15 +11566,15 @@
   __Pyx_XDECREF(__pyx_v_enable_conversion);
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":468
+/* "plumed.pyx":561
  *         return TextFileReader(df,enable_constants,constants,convert_all)
  * 
  * def write_pandas(df,file_or_path=None):             # <<<<<<<<<<<<<<
  *     """Save a pandas dataframe as a PLUMED file.
  * 
  */
 
@@ -10258,15 +11615,15 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_file_or_path);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "write_pandas") < 0)) __PYX_ERR(0, 468, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "write_pandas") < 0)) __PYX_ERR(0, 561, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
@@ -10274,15 +11631,15 @@
       }
     }
     __pyx_v_df = values[0];
     __pyx_v_file_or_path = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("write_pandas", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 468, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("write_pandas", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 561, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.write_pandas", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_6write_pandas(__pyx_self, __pyx_v_df, __pyx_v_file_or_path);
 
@@ -10317,182 +11674,182 @@
   PyObject *(*__pyx_t_14)(PyObject *);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("write_pandas", 0);
   __Pyx_INCREF(__pyx_v_file_or_path);
 
-  /* "plumed.pyx":488
+  /* "plumed.pyx":581
  *     """
  * # importing pandas is pretty slow, so we only do it when needed
  *     import pandas as pd             # <<<<<<<<<<<<<<
  * # check if there is an index. if so, write it as an additional field
  *     has_index=hasattr(df.index,'name') and df.index.name is not None
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_pandas, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_pandas, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 581, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_pd = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":490
+  /* "plumed.pyx":583
  *     import pandas as pd
  * # check if there is an index. if so, write it as an additional field
  *     has_index=hasattr(df.index,'name') and df.index.name is not None             # <<<<<<<<<<<<<<
  * # check if there is a multi-index
  *     has_mindex=(not has_index) and hasattr(df.index,'names') and df.index.names[0] is not None
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 583, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_HasAttr(__pyx_t_2, __pyx_n_u_name); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_HasAttr(__pyx_t_2, __pyx_n_u_name); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 583, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (__pyx_t_3) {
   } else {
-    __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 583, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_1 = __pyx_t_2;
     __pyx_t_2 = 0;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 583, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 583, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_3 = (__pyx_t_4 != Py_None);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 583, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_1 = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_L3_bool_binop_done:;
   __pyx_v_has_index = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":492
+  /* "plumed.pyx":585
  *     has_index=hasattr(df.index,'name') and df.index.name is not None
  * # check if there is a multi-index
  *     has_mindex=(not has_index) and hasattr(df.index,'names') and df.index.names[0] is not None             # <<<<<<<<<<<<<<
  * # writing multiindex is currently not supported
  *     if has_mindex:
  */
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_has_index); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 492, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_has_index); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 585, __pyx_L1_error)
   __pyx_t_5 = (!__pyx_t_3);
   if (__pyx_t_5) {
   } else {
-    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 492, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_1 = __pyx_t_4;
     __pyx_t_4 = 0;
     goto __pyx_L5_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 492, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_HasAttr(__pyx_t_4, __pyx_n_u_names); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 492, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_HasAttr(__pyx_t_4, __pyx_n_u_names); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 585, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_5) {
   } else {
-    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 492, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_1 = __pyx_t_4;
     __pyx_t_4 = 0;
     goto __pyx_L5_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 492, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_names); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 492, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_names); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 492, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_5 = (__pyx_t_4 != Py_None);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 492, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_1 = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_L5_bool_binop_done:;
   __pyx_v_has_mindex = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":494
+  /* "plumed.pyx":587
  *     has_mindex=(not has_index) and hasattr(df.index,'names') and df.index.names[0] is not None
  * # writing multiindex is currently not supported
  *     if has_mindex:             # <<<<<<<<<<<<<<
  *         raise TypeError("Writing dataframes with MultiIndexes is not supported at this time")
  * # handle file
  */
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_has_mindex); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 494, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_has_mindex); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 587, __pyx_L1_error)
   if (unlikely(__pyx_t_5)) {
 
-    /* "plumed.pyx":495
+    /* "plumed.pyx":588
  * # writing multiindex is currently not supported
  *     if has_mindex:
  *         raise TypeError("Writing dataframes with MultiIndexes is not supported at this time")             # <<<<<<<<<<<<<<
  * # handle file
  *     if file_or_path is None:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 495, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__31, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 588, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 495, __pyx_L1_error)
+    __PYX_ERR(0, 588, __pyx_L1_error)
 
-    /* "plumed.pyx":494
+    /* "plumed.pyx":587
  *     has_mindex=(not has_index) and hasattr(df.index,'names') and df.index.names[0] is not None
  * # writing multiindex is currently not supported
  *     if has_mindex:             # <<<<<<<<<<<<<<
  *         raise TypeError("Writing dataframes with MultiIndexes is not supported at this time")
  * # handle file
  */
   }
 
-  /* "plumed.pyx":497
+  /* "plumed.pyx":590
  *         raise TypeError("Writing dataframes with MultiIndexes is not supported at this time")
  * # handle file
  *     if file_or_path is None:             # <<<<<<<<<<<<<<
  *         file_or_path=sys.stdout
  *     file_or_path=_fix_file(file_or_path,'wt')
  */
   __pyx_t_5 = (__pyx_v_file_or_path == Py_None);
   __pyx_t_3 = (__pyx_t_5 != 0);
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":498
+    /* "plumed.pyx":591
  * # handle file
  *     if file_or_path is None:
  *         file_or_path=sys.stdout             # <<<<<<<<<<<<<<
  *     file_or_path=_fix_file(file_or_path,'wt')
  * # write header
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 498, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 591, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 498, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 591, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF_SET(__pyx_v_file_or_path, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":497
+    /* "plumed.pyx":590
  *         raise TypeError("Writing dataframes with MultiIndexes is not supported at this time")
  * # handle file
  *     if file_or_path is None:             # <<<<<<<<<<<<<<
  *         file_or_path=sys.stdout
  *     file_or_path=_fix_file(file_or_path,'wt')
  */
   }
 
-  /* "plumed.pyx":499
+  /* "plumed.pyx":592
  *     if file_or_path is None:
  *         file_or_path=sys.stdout
  *     file_or_path=_fix_file(file_or_path,'wt')             # <<<<<<<<<<<<<<
  * # write header
  *     file_or_path.write("#! FIELDS")
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_fix_file); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 499, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_fix_file); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 592, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = NULL;
   __pyx_t_6 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
@@ -10501,101 +11858,101 @@
       __Pyx_DECREF_SET(__pyx_t_1, function);
       __pyx_t_6 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_1)) {
     PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_file_or_path, __pyx_n_u_wt};
-    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 499, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 592, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_GOTREF(__pyx_t_4);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
     PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_file_or_path, __pyx_n_u_wt};
-    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 499, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 592, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_GOTREF(__pyx_t_4);
   } else
   #endif
   {
-    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 499, __pyx_L1_error)
+    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 592, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     if (__pyx_t_2) {
       __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2); __pyx_t_2 = NULL;
     }
     __Pyx_INCREF(__pyx_v_file_or_path);
     __Pyx_GIVEREF(__pyx_v_file_or_path);
     PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_file_or_path);
     __Pyx_INCREF(__pyx_n_u_wt);
     __Pyx_GIVEREF(__pyx_n_u_wt);
     PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_n_u_wt);
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 499, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 592, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF_SET(__pyx_v_file_or_path, __pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "plumed.pyx":501
+  /* "plumed.pyx":594
  *     file_or_path=_fix_file(file_or_path,'wt')
  * # write header
  *     file_or_path.write("#! FIELDS")             # <<<<<<<<<<<<<<
  *     if has_index:
  *         file_or_path.write(" "+str(df.index.name))
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 501, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 594, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_7 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_7)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_7);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_7, __pyx_kp_u_FIELDS_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_kp_u_FIELDS_2);
   __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 501, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 594, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "plumed.pyx":502
+  /* "plumed.pyx":595
  * # write header
  *     file_or_path.write("#! FIELDS")
  *     if has_index:             # <<<<<<<<<<<<<<
  *         file_or_path.write(" "+str(df.index.name))
  *     for n in df.columns:
  */
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_has_index); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 502, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_has_index); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 595, __pyx_L1_error)
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":503
+    /* "plumed.pyx":596
  *     file_or_path.write("#! FIELDS")
  *     if has_index:
  *         file_or_path.write(" "+str(df.index.name))             # <<<<<<<<<<<<<<
  *     for n in df.columns:
  *         file_or_path.write(" "+str(n))
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 503, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 596, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 503, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 596, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 503, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 596, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 503, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 596, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u__22, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 503, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u__24, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 596, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_7 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
@@ -10603,92 +11960,92 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_7, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 503, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 596, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "plumed.pyx":502
+    /* "plumed.pyx":595
  * # write header
  *     file_or_path.write("#! FIELDS")
  *     if has_index:             # <<<<<<<<<<<<<<
  *         file_or_path.write(" "+str(df.index.name))
  *     for n in df.columns:
  */
   }
 
-  /* "plumed.pyx":504
+  /* "plumed.pyx":597
  *     if has_index:
  *         file_or_path.write(" "+str(df.index.name))
  *     for n in df.columns:             # <<<<<<<<<<<<<<
  *         file_or_path.write(" "+str(n))
  *     file_or_path.write("\n")
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 504, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 597, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
     __pyx_t_1 = __pyx_t_4; __Pyx_INCREF(__pyx_t_1); __pyx_t_8 = 0;
     __pyx_t_9 = NULL;
   } else {
-    __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 504, __pyx_L1_error)
+    __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 597, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 504, __pyx_L1_error)
+    __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 597, __pyx_L1_error)
   }
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   for (;;) {
     if (likely(!__pyx_t_9)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 504, __pyx_L1_error)
+        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 597, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 504, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 597, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       } else {
         if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 504, __pyx_L1_error)
+        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 597, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 504, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 597, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       }
     } else {
       __pyx_t_4 = __pyx_t_9(__pyx_t_1);
       if (unlikely(!__pyx_t_4)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 504, __pyx_L1_error)
+          else __PYX_ERR(0, 597, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_4);
     }
     __Pyx_XDECREF_SET(__pyx_v_n, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":505
+    /* "plumed.pyx":598
  *         file_or_path.write(" "+str(df.index.name))
  *     for n in df.columns:
  *         file_or_path.write(" "+str(n))             # <<<<<<<<<<<<<<
  *     file_or_path.write("\n")
  * # write constants
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 505, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 598, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_n); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 505, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_n); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 598, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_10 = __Pyx_PyUnicode_Concat(__pyx_kp_u__22, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 505, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyUnicode_Concat(__pyx_kp_u__24, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 598, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_7 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -10696,157 +12053,157 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_7, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_10);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 505, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 598, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "plumed.pyx":504
+    /* "plumed.pyx":597
  *     if has_index:
  *         file_or_path.write(" "+str(df.index.name))
  *     for n in df.columns:             # <<<<<<<<<<<<<<
  *         file_or_path.write(" "+str(n))
  *     file_or_path.write("\n")
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":506
+  /* "plumed.pyx":599
  *     for n in df.columns:
  *         file_or_path.write(" "+str(n))
  *     file_or_path.write("\n")             # <<<<<<<<<<<<<<
  * # write constants
  *     if hasattr(df,"plumed_constants") and isinstance(df.plumed_constants,Constants):
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 506, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 599, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
-  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_kp_u__30) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u__30);
+  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_kp_u__32) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u__32);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 506, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 599, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":508
+  /* "plumed.pyx":601
  *     file_or_path.write("\n")
  * # write constants
  *     if hasattr(df,"plumed_constants") and isinstance(df.plumed_constants,Constants):             # <<<<<<<<<<<<<<
  *         for c in df.plumed_constants:
  * # notice that string constants are written (e.g. pi) rather than the numeric ones (e.g. 3.14...)
  */
-  __pyx_t_5 = __Pyx_HasAttr(__pyx_v_df, __pyx_n_u_plumed_constants); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 508, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_HasAttr(__pyx_v_df, __pyx_n_u_plumed_constants); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 601, __pyx_L1_error)
   __pyx_t_11 = (__pyx_t_5 != 0);
   if (__pyx_t_11) {
   } else {
     __pyx_t_3 = __pyx_t_11;
     goto __pyx_L14_bool_binop_done;
   }
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_plumed_constants); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 508, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_plumed_constants); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 601, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_Constants); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 508, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_Constants); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 601, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_11 = PyObject_IsInstance(__pyx_t_1, __pyx_t_4); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 508, __pyx_L1_error)
+  __pyx_t_11 = PyObject_IsInstance(__pyx_t_1, __pyx_t_4); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 601, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_5 = (__pyx_t_11 != 0);
   __pyx_t_3 = __pyx_t_5;
   __pyx_L14_bool_binop_done:;
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":509
+    /* "plumed.pyx":602
  * # write constants
  *     if hasattr(df,"plumed_constants") and isinstance(df.plumed_constants,Constants):
  *         for c in df.plumed_constants:             # <<<<<<<<<<<<<<
  * # notice that string constants are written (e.g. pi) rather than the numeric ones (e.g. 3.14...)
  *             file_or_path.write("#! SET "+c[0]+" "+c[2]+"\n")
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_plumed_constants); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 509, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_plumed_constants); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 602, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
       __pyx_t_1 = __pyx_t_4; __Pyx_INCREF(__pyx_t_1); __pyx_t_8 = 0;
       __pyx_t_9 = NULL;
     } else {
-      __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 509, __pyx_L1_error)
+      __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 602, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 509, __pyx_L1_error)
+      __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 602, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     for (;;) {
       if (likely(!__pyx_t_9)) {
         if (likely(PyList_CheckExact(__pyx_t_1))) {
           if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 509, __pyx_L1_error)
+          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 602, __pyx_L1_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 509, __pyx_L1_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 602, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         } else {
           if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 509, __pyx_L1_error)
+          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 602, __pyx_L1_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 509, __pyx_L1_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 602, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         }
       } else {
         __pyx_t_4 = __pyx_t_9(__pyx_t_1);
         if (unlikely(!__pyx_t_4)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 509, __pyx_L1_error)
+            else __PYX_ERR(0, 602, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_4);
       }
       __Pyx_XDECREF_SET(__pyx_v_c, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "plumed.pyx":511
+      /* "plumed.pyx":604
  *         for c in df.plumed_constants:
  * # notice that string constants are written (e.g. pi) rather than the numeric ones (e.g. 3.14...)
  *             file_or_path.write("#! SET "+c[0]+" "+c[2]+"\n")             # <<<<<<<<<<<<<<
  * # write data
  *     for i in range(df.shape[0]):
  */
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 511, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 604, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_10 = __Pyx_GetItemInt(__pyx_v_c, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 511, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_GetItemInt(__pyx_v_c, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 604, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
-      __pyx_t_7 = PyNumber_Add(__pyx_kp_u_SET_2, __pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 511, __pyx_L1_error)
+      __pyx_t_7 = PyNumber_Add(__pyx_kp_u_SET_2, __pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 604, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __pyx_t_10 = PyNumber_Add(__pyx_t_7, __pyx_kp_u__22); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 511, __pyx_L1_error)
+      __pyx_t_10 = PyNumber_Add(__pyx_t_7, __pyx_kp_u__24); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 604, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_c, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 511, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_c, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 604, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_12 = PyNumber_Add(__pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 511, __pyx_L1_error)
+      __pyx_t_12 = PyNumber_Add(__pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 604, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__30); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 511, __pyx_L1_error)
+      __pyx_t_7 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__32); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 604, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __pyx_t_12 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_12)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -10854,124 +12211,124 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_4 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_12, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_7);
       __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 511, __pyx_L1_error)
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 604, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-      /* "plumed.pyx":509
+      /* "plumed.pyx":602
  * # write constants
  *     if hasattr(df,"plumed_constants") and isinstance(df.plumed_constants,Constants):
  *         for c in df.plumed_constants:             # <<<<<<<<<<<<<<
  * # notice that string constants are written (e.g. pi) rather than the numeric ones (e.g. 3.14...)
  *             file_or_path.write("#! SET "+c[0]+" "+c[2]+"\n")
  */
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "plumed.pyx":508
+    /* "plumed.pyx":601
  *     file_or_path.write("\n")
  * # write constants
  *     if hasattr(df,"plumed_constants") and isinstance(df.plumed_constants,Constants):             # <<<<<<<<<<<<<<
  *         for c in df.plumed_constants:
  * # notice that string constants are written (e.g. pi) rather than the numeric ones (e.g. 3.14...)
  */
   }
 
-  /* "plumed.pyx":513
+  /* "plumed.pyx":606
  *             file_or_path.write("#! SET "+c[0]+" "+c[2]+"\n")
  * # write data
  *     for i in range(df.shape[0]):             # <<<<<<<<<<<<<<
  *         if has_index:
  *             file_or_path.write(" "+str(df.index[i]))
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 513, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 606, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 513, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 606, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 513, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 606, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
     __pyx_t_4 = __pyx_t_1; __Pyx_INCREF(__pyx_t_4); __pyx_t_8 = 0;
     __pyx_t_9 = NULL;
   } else {
-    __pyx_t_8 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 513, __pyx_L1_error)
+    __pyx_t_8 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 606, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 513, __pyx_L1_error)
+    __pyx_t_9 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 606, __pyx_L1_error)
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   for (;;) {
     if (likely(!__pyx_t_9)) {
       if (likely(PyList_CheckExact(__pyx_t_4))) {
         if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_4)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 513, __pyx_L1_error)
+        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 606, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 513, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 606, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       } else {
         if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 513, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 606, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 513, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 606, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       }
     } else {
       __pyx_t_1 = __pyx_t_9(__pyx_t_4);
       if (unlikely(!__pyx_t_1)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 513, __pyx_L1_error)
+          else __PYX_ERR(0, 606, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_1);
     }
     __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "plumed.pyx":514
+    /* "plumed.pyx":607
  * # write data
  *     for i in range(df.shape[0]):
  *         if has_index:             # <<<<<<<<<<<<<<
  *             file_or_path.write(" "+str(df.index[i]))
  *         for j in df.columns:
  */
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_has_index); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 514, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_has_index); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 607, __pyx_L1_error)
     if (__pyx_t_3) {
 
-      /* "plumed.pyx":515
+      /* "plumed.pyx":608
  *     for i in range(df.shape[0]):
  *         if has_index:
  *             file_or_path.write(" "+str(df.index[i]))             # <<<<<<<<<<<<<<
  *         for j in df.columns:
  *             file_or_path.write(" "+str(df[j][i]))
  */
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 515, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 608, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 515, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_index); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 608, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_v_i); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 515, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_v_i); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 608, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_12); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 515, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_12); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 608, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-      __pyx_t_12 = __Pyx_PyUnicode_Concat(__pyx_kp_u__22, __pyx_t_7); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 515, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyUnicode_Concat(__pyx_kp_u__24, __pyx_t_7); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 608, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __pyx_t_7 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -10979,98 +12336,98 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_7, __pyx_t_12) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_12);
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 515, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 608, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-      /* "plumed.pyx":514
+      /* "plumed.pyx":607
  * # write data
  *     for i in range(df.shape[0]):
  *         if has_index:             # <<<<<<<<<<<<<<
  *             file_or_path.write(" "+str(df.index[i]))
  *         for j in df.columns:
  */
     }
 
-    /* "plumed.pyx":516
+    /* "plumed.pyx":609
  *         if has_index:
  *             file_or_path.write(" "+str(df.index[i]))
  *         for j in df.columns:             # <<<<<<<<<<<<<<
  *             file_or_path.write(" "+str(df[j][i]))
  *         file_or_path.write("\n")
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_columns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 516, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_columns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 609, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
       __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_13 = 0;
       __pyx_t_14 = NULL;
     } else {
-      __pyx_t_13 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 516, __pyx_L1_error)
+      __pyx_t_13 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 609, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_14 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 516, __pyx_L1_error)
+      __pyx_t_14 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 609, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     for (;;) {
       if (likely(!__pyx_t_14)) {
         if (likely(PyList_CheckExact(__pyx_t_2))) {
           if (__pyx_t_13 >= PyList_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_13); __Pyx_INCREF(__pyx_t_1); __pyx_t_13++; if (unlikely(0 < 0)) __PYX_ERR(0, 516, __pyx_L1_error)
+          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_13); __Pyx_INCREF(__pyx_t_1); __pyx_t_13++; if (unlikely(0 < 0)) __PYX_ERR(0, 609, __pyx_L1_error)
           #else
-          __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_13); __pyx_t_13++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 516, __pyx_L1_error)
+          __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_13); __pyx_t_13++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 609, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           #endif
         } else {
           if (__pyx_t_13 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_13); __Pyx_INCREF(__pyx_t_1); __pyx_t_13++; if (unlikely(0 < 0)) __PYX_ERR(0, 516, __pyx_L1_error)
+          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_13); __Pyx_INCREF(__pyx_t_1); __pyx_t_13++; if (unlikely(0 < 0)) __PYX_ERR(0, 609, __pyx_L1_error)
           #else
-          __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_13); __pyx_t_13++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 516, __pyx_L1_error)
+          __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_13); __pyx_t_13++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 609, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           #endif
         }
       } else {
         __pyx_t_1 = __pyx_t_14(__pyx_t_2);
         if (unlikely(!__pyx_t_1)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 516, __pyx_L1_error)
+            else __PYX_ERR(0, 609, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_1);
       }
       __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_1);
       __pyx_t_1 = 0;
 
-      /* "plumed.pyx":517
+      /* "plumed.pyx":610
  *             file_or_path.write(" "+str(df.index[i]))
  *         for j in df.columns:
  *             file_or_path.write(" "+str(df[j][i]))             # <<<<<<<<<<<<<<
  *         file_or_path.write("\n")
  * 
  */
-      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 517, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 610, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
-      __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_v_df, __pyx_v_j); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 517, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_v_df, __pyx_v_j); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 610, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_v_i); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 517, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_v_i); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 610, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 517, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 610, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __pyx_t_10 = __Pyx_PyUnicode_Concat(__pyx_kp_u__22, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 517, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyUnicode_Concat(__pyx_kp_u__24, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 610, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __pyx_t_7 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_12))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_12);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
@@ -11078,66 +12435,66 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_12, function);
         }
       }
       __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_7, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_10);
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 517, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 610, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-      /* "plumed.pyx":516
+      /* "plumed.pyx":609
  *         if has_index:
  *             file_or_path.write(" "+str(df.index[i]))
  *         for j in df.columns:             # <<<<<<<<<<<<<<
  *             file_or_path.write(" "+str(df[j][i]))
  *         file_or_path.write("\n")
  */
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":518
+    /* "plumed.pyx":611
  *         for j in df.columns:
  *             file_or_path.write(" "+str(df[j][i]))
  *         file_or_path.write("\n")             # <<<<<<<<<<<<<<
  * 
- * def _guessplumedroot(kernel=None):
+ * def hills_time_average(hills, tofile=None, *, t0=None, t1=None, frac0=None, frac1=None, inplace=False):
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 518, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_file_or_path, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 611, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
-    __pyx_t_2 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_12, __pyx_kp_u__30) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_kp_u__30);
+    __pyx_t_2 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_12, __pyx_kp_u__32) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_kp_u__32);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 518, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 611, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":513
+    /* "plumed.pyx":606
  *             file_or_path.write("#! SET "+c[0]+" "+c[2]+"\n")
  * # write data
  *     for i in range(df.shape[0]):             # <<<<<<<<<<<<<<
  *         if has_index:
  *             file_or_path.write(" "+str(df.index[i]))
  */
   }
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "plumed.pyx":468
+  /* "plumed.pyx":561
  *         return TextFileReader(df,enable_constants,constants,convert_all)
  * 
  * def write_pandas(df,file_or_path=None):             # <<<<<<<<<<<<<<
  *     """Save a pandas dataframe as a PLUMED file.
  * 
  */
 
@@ -11163,27 +12520,1012 @@
   __Pyx_XDECREF(__pyx_v_j);
   __Pyx_XDECREF(__pyx_v_file_or_path);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":520
+/* "plumed.pyx":613
  *         file_or_path.write("\n")
  * 
+ * def hills_time_average(hills, tofile=None, *, t0=None, t1=None, frac0=None, frac1=None, inplace=False):             # <<<<<<<<<<<<<<
+ *     """Compute a time-averaged hills file.
+ * 
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_6plumed_9hills_time_average(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_8hills_time_average[] = "Compute a time-averaged hills file.\n\n       hills: dataframe containing a hills file, or file, or filename\n\n       tofile: write the resulting dataframe to a file or filename\n\n       t0: initial time for averaging\n\n       t1: final time for averaging\n\n       frac0: initial fraction for averaging\n\n       frac1: final fraction for averaging\n\n       inplace: pass true to avoid copying the dataframe (for very large dataframes)\n\n       Returns\n       -------\n\n       if inplace=False and tofile=None (default): a modified copy of the dataframe\n       if inplace=True or tofile!=None: None\n\n       This tool takes as an input a pandas dataframe read from a HILLS file and\n       returns an equivalent dataframe where Gaussian heights have been scaled\n       with a windowing function so as to effectively result in a time-averaged\n       potential. By default, the average is taken along to entire list based on the\n       value of the time column. The averaging windows can be specified in two ways:\n       - using the time field, from t0 to t1. If t0 (t1) is omitted, its default is\n         to be set to np.min(hills.time) (np.max(hills.time))\n       - using the index of the hill, from frac0 to frac1 specified as a fraction\n         of the entire length; that is, frac0=0.5 implies avering from the mid of the\n         simulation. If frac0 (frac1) is omitted, its default is to be set to 0.0 (1.0)\n\n       If tofile is specified, nothing is returned and the resulting dataframe is written\n       on file.\n\n       Examples\n       --------\n\n       plumed.hills_time_average(\"HILLS\",\"HILLSOUT\") # time average along entire file\n\n       plumed.hills_time_average(\"HILLS\",\"HILLSOUT1\",t0=100,t1=200) # time average between 100 and 200 ps\n\n       plumed.hills_time_average(\"HILLS\",\"HILLSOUT2\",frac0=0.5) # time average in second half of the file\n\n       df=plumed.hills_time_average(\"HILLS\") # time average and return dataframe\n\n       df=plum""ed.read_as_pandas(\"HILLS\") # first read hills file\n       df=plumed.hills_time_average(df) # then perform time average\n\n\n    ";
+static PyMethodDef __pyx_mdef_6plumed_9hills_time_average = {"hills_time_average", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_9hills_time_average, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_8hills_time_average};
+static PyObject *__pyx_pw_6plumed_9hills_time_average(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyObject *__pyx_v_hills = 0;
+  PyObject *__pyx_v_tofile = 0;
+  PyObject *__pyx_v_t0 = 0;
+  PyObject *__pyx_v_t1 = 0;
+  PyObject *__pyx_v_frac0 = 0;
+  PyObject *__pyx_v_frac1 = 0;
+  PyObject *__pyx_v_inplace = 0;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("hills_time_average (wrapper)", 0);
+  {
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_hills,&__pyx_n_s_tofile,&__pyx_n_s_t0,&__pyx_n_s_t1,&__pyx_n_s_frac0,&__pyx_n_s_frac1,&__pyx_n_s_inplace,0};
+    PyObject* values[7] = {0,0,0,0,0,0,0};
+    values[1] = ((PyObject *)((PyObject *)Py_None));
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    values[4] = ((PyObject *)((PyObject *)Py_None));
+    values[5] = ((PyObject *)((PyObject *)Py_None));
+    values[6] = ((PyObject *)((PyObject *)Py_False));
+    if (unlikely(__pyx_kwds)) {
+      Py_ssize_t kw_args;
+      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
+      switch (pos_args) {
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = PyDict_Size(__pyx_kwds);
+      switch (pos_args) {
+        case  0:
+        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_hills)) != 0)) kw_args--;
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tofile);
+          if (value) { values[1] = value; kw_args--; }
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 5)) {
+        Py_ssize_t index;
+        for (index = 2; index < 7 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "hills_time_average") < 0)) __PYX_ERR(0, 613, __pyx_L3_error)
+      }
+    } else {
+      switch (PyTuple_GET_SIZE(__pyx_args)) {
+        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+    }
+    __pyx_v_hills = values[0];
+    __pyx_v_tofile = values[1];
+    __pyx_v_t0 = values[2];
+    __pyx_v_t1 = values[3];
+    __pyx_v_frac0 = values[4];
+    __pyx_v_frac1 = values[5];
+    __pyx_v_inplace = values[6];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("hills_time_average", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 613, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("plumed.hills_time_average", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_6plumed_8hills_time_average(__pyx_self, __pyx_v_hills, __pyx_v_tofile, __pyx_v_t0, __pyx_v_t1, __pyx_v_frac0, __pyx_v_frac1, __pyx_v_inplace);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_6plumed_8hills_time_average(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_hills, PyObject *__pyx_v_tofile, PyObject *__pyx_v_t0, PyObject *__pyx_v_t1, PyObject *__pyx_v_frac0, PyObject *__pyx_v_frac1, PyObject *__pyx_v_inplace) {
+  PyObject *__pyx_v_pd = NULL;
+  PyObject *__pyx_v_use_time = NULL;
+  PyObject *__pyx_v_use_index = NULL;
+  PyObject *__pyx_v_w = NULL;
+  PyObject *__pyx_v_i0 = NULL;
+  PyObject *__pyx_v_i1 = NULL;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_2;
+  int __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  int __pyx_t_9;
+  Py_ssize_t __pyx_t_10;
+  PyObject *__pyx_t_11 = NULL;
+  PyObject *__pyx_t_12 = NULL;
+  PyObject *__pyx_t_13 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("hills_time_average", 0);
+  __Pyx_INCREF(__pyx_v_hills);
+  __Pyx_INCREF(__pyx_v_t0);
+  __Pyx_INCREF(__pyx_v_t1);
+  __Pyx_INCREF(__pyx_v_frac0);
+  __Pyx_INCREF(__pyx_v_frac1);
+
+  /* "plumed.pyx":666
+ * 
+ *     """
+ *     import pandas as pd             # <<<<<<<<<<<<<<
+ *     if not isinstance(hills,pd.DataFrame):
+ *         hills=read_as_pandas(hills)
+ */
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_pandas, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 666, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_v_pd = __pyx_t_1;
+  __pyx_t_1 = 0;
+
+  /* "plumed.pyx":667
+ *     """
+ *     import pandas as pd
+ *     if not isinstance(hills,pd.DataFrame):             # <<<<<<<<<<<<<<
+ *         hills=read_as_pandas(hills)
+ *     elif not inplace:
+ */
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_pd, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 667, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_IsInstance(__pyx_v_hills, __pyx_t_1); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 667, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_3 = ((!(__pyx_t_2 != 0)) != 0);
+  if (__pyx_t_3) {
+
+    /* "plumed.pyx":668
+ *     import pandas as pd
+ *     if not isinstance(hills,pd.DataFrame):
+ *         hills=read_as_pandas(hills)             # <<<<<<<<<<<<<<
+ *     elif not inplace:
+ *         hills=hills.copy()
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_read_as_pandas); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 668, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_4, function);
+      }
+    }
+    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_hills) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_hills);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 668, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF_SET(__pyx_v_hills, __pyx_t_1);
+    __pyx_t_1 = 0;
+
+    /* "plumed.pyx":667
+ *     """
+ *     import pandas as pd
+ *     if not isinstance(hills,pd.DataFrame):             # <<<<<<<<<<<<<<
+ *         hills=read_as_pandas(hills)
+ *     elif not inplace:
+ */
+    goto __pyx_L3;
+  }
+
+  /* "plumed.pyx":669
+ *     if not isinstance(hills,pd.DataFrame):
+ *         hills=read_as_pandas(hills)
+ *     elif not inplace:             # <<<<<<<<<<<<<<
+ *         hills=hills.copy()
+ * 
+ */
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_inplace); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 669, __pyx_L1_error)
+  __pyx_t_2 = ((!__pyx_t_3) != 0);
+  if (__pyx_t_2) {
+
+    /* "plumed.pyx":670
+ *         hills=read_as_pandas(hills)
+ *     elif not inplace:
+ *         hills=hills.copy()             # <<<<<<<<<<<<<<
+ * 
+ *     use_time = (t0 is not None or t1 is not None)
+ */
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_hills, __pyx_n_s_copy); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 670, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = NULL;
+    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_4, function);
+      }
+    }
+    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 670, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF_SET(__pyx_v_hills, __pyx_t_1);
+    __pyx_t_1 = 0;
+
+    /* "plumed.pyx":669
+ *     if not isinstance(hills,pd.DataFrame):
+ *         hills=read_as_pandas(hills)
+ *     elif not inplace:             # <<<<<<<<<<<<<<
+ *         hills=hills.copy()
+ * 
+ */
+  }
+  __pyx_L3:;
+
+  /* "plumed.pyx":672
+ *         hills=hills.copy()
+ * 
+ *     use_time = (t0 is not None or t1 is not None)             # <<<<<<<<<<<<<<
+ *     use_index = (frac0 is not None or frac1 is not None)
+ * 
+ */
+  __pyx_t_2 = (__pyx_v_t0 != Py_None);
+  if (!__pyx_t_2) {
+  } else {
+    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 672, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_1 = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_2 = (__pyx_v_t1 != Py_None);
+  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 672, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = __pyx_t_4;
+  __pyx_t_4 = 0;
+  __pyx_L4_bool_binop_done:;
+  __pyx_v_use_time = __pyx_t_1;
+  __pyx_t_1 = 0;
+
+  /* "plumed.pyx":673
+ * 
+ *     use_time = (t0 is not None or t1 is not None)
+ *     use_index = (frac0 is not None or frac1 is not None)             # <<<<<<<<<<<<<<
+ * 
+ *     if use_time and use_index:
+ */
+  __pyx_t_2 = (__pyx_v_frac0 != Py_None);
+  if (!__pyx_t_2) {
+  } else {
+    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 673, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_1 = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L6_bool_binop_done;
+  }
+  __pyx_t_2 = (__pyx_v_frac1 != Py_None);
+  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 673, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = __pyx_t_4;
+  __pyx_t_4 = 0;
+  __pyx_L6_bool_binop_done:;
+  __pyx_v_use_index = __pyx_t_1;
+  __pyx_t_1 = 0;
+
+  /* "plumed.pyx":675
+ *     use_index = (frac0 is not None or frac1 is not None)
+ * 
+ *     if use_time and use_index:             # <<<<<<<<<<<<<<
+ *         raise ValueError("cannot use simultaneously time and fraction")
+ * 
+ */
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_use_time); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 675, __pyx_L1_error)
+  if (__pyx_t_3) {
+  } else {
+    __pyx_t_2 = __pyx_t_3;
+    goto __pyx_L9_bool_binop_done;
+  }
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_use_index); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 675, __pyx_L1_error)
+  __pyx_t_2 = __pyx_t_3;
+  __pyx_L9_bool_binop_done:;
+  if (unlikely(__pyx_t_2)) {
+
+    /* "plumed.pyx":676
+ * 
+ *     if use_time and use_index:
+ *         raise ValueError("cannot use simultaneously time and fraction")             # <<<<<<<<<<<<<<
+ * 
+ *     if not use_index and not use_time:
+ */
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__33, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 676, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __PYX_ERR(0, 676, __pyx_L1_error)
+
+    /* "plumed.pyx":675
+ *     use_index = (frac0 is not None or frac1 is not None)
+ * 
+ *     if use_time and use_index:             # <<<<<<<<<<<<<<
+ *         raise ValueError("cannot use simultaneously time and fraction")
+ * 
+ */
+  }
+
+  /* "plumed.pyx":678
+ *         raise ValueError("cannot use simultaneously time and fraction")
+ * 
+ *     if not use_index and not use_time:             # <<<<<<<<<<<<<<
+ *         use_time=True
+ * 
+ */
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_use_index); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 678, __pyx_L1_error)
+  __pyx_t_6 = ((!__pyx_t_3) != 0);
+  if (__pyx_t_6) {
+  } else {
+    __pyx_t_2 = __pyx_t_6;
+    goto __pyx_L12_bool_binop_done;
+  }
+  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_use_time); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 678, __pyx_L1_error)
+  __pyx_t_3 = ((!__pyx_t_6) != 0);
+  __pyx_t_2 = __pyx_t_3;
+  __pyx_L12_bool_binop_done:;
+  if (__pyx_t_2) {
+
+    /* "plumed.pyx":679
+ * 
+ *     if not use_index and not use_time:
+ *         use_time=True             # <<<<<<<<<<<<<<
+ * 
+ *     if use_time:
+ */
+    __Pyx_INCREF(Py_True);
+    __Pyx_DECREF_SET(__pyx_v_use_time, Py_True);
+
+    /* "plumed.pyx":678
+ *         raise ValueError("cannot use simultaneously time and fraction")
+ * 
+ *     if not use_index and not use_time:             # <<<<<<<<<<<<<<
+ *         use_time=True
+ * 
+ */
+  }
+
+  /* "plumed.pyx":681
+ *         use_time=True
+ * 
+ *     if use_time:             # <<<<<<<<<<<<<<
+ *         if t0 is None:
+ *             t0=np.min(hills.time)
+ */
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_use_time); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 681, __pyx_L1_error)
+  if (__pyx_t_2) {
+
+    /* "plumed.pyx":682
+ * 
+ *     if use_time:
+ *         if t0 is None:             # <<<<<<<<<<<<<<
+ *             t0=np.min(hills.time)
+ *         if t1 is None:
+ */
+    __pyx_t_2 = (__pyx_v_t0 == Py_None);
+    __pyx_t_3 = (__pyx_t_2 != 0);
+    if (__pyx_t_3) {
+
+      /* "plumed.pyx":683
+ *     if use_time:
+ *         if t0 is None:
+ *             t0=np.min(hills.time)             # <<<<<<<<<<<<<<
+ *         if t1 is None:
+ *             t1=np.max(hills.time)
+ */
+      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 683, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_min); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 683, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_hills, __pyx_n_s_time); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 683, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_t_7 = NULL;
+      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
+        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
+        if (likely(__pyx_t_7)) {
+          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
+          __Pyx_INCREF(__pyx_t_7);
+          __Pyx_INCREF(function);
+          __Pyx_DECREF_SET(__pyx_t_5, function);
+        }
+      }
+      __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4);
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 683, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __Pyx_DECREF_SET(__pyx_v_t0, __pyx_t_1);
+      __pyx_t_1 = 0;
+
+      /* "plumed.pyx":682
+ * 
+ *     if use_time:
+ *         if t0 is None:             # <<<<<<<<<<<<<<
+ *             t0=np.min(hills.time)
+ *         if t1 is None:
+ */
+    }
+
+    /* "plumed.pyx":684
+ *         if t0 is None:
+ *             t0=np.min(hills.time)
+ *         if t1 is None:             # <<<<<<<<<<<<<<
+ *             t1=np.max(hills.time)
+ *         w=np.clip((t1-hills.time)/(t1-t0),0.0,1.0)
+ */
+    __pyx_t_3 = (__pyx_v_t1 == Py_None);
+    __pyx_t_2 = (__pyx_t_3 != 0);
+    if (__pyx_t_2) {
+
+      /* "plumed.pyx":685
+ *             t0=np.min(hills.time)
+ *         if t1 is None:
+ *             t1=np.max(hills.time)             # <<<<<<<<<<<<<<
+ *         w=np.clip((t1-hills.time)/(t1-t0),0.0,1.0)
+ *     else:
+ */
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 685, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_max); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 685, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_hills, __pyx_n_s_time); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 685, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_7 = NULL;
+      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
+        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
+        if (likely(__pyx_t_7)) {
+          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+          __Pyx_INCREF(__pyx_t_7);
+          __Pyx_INCREF(function);
+          __Pyx_DECREF_SET(__pyx_t_4, function);
+        }
+      }
+      __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 685, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_DECREF_SET(__pyx_v_t1, __pyx_t_1);
+      __pyx_t_1 = 0;
+
+      /* "plumed.pyx":684
+ *         if t0 is None:
+ *             t0=np.min(hills.time)
+ *         if t1 is None:             # <<<<<<<<<<<<<<
+ *             t1=np.max(hills.time)
+ *         w=np.clip((t1-hills.time)/(t1-t0),0.0,1.0)
+ */
+    }
+
+    /* "plumed.pyx":686
+ *         if t1 is None:
+ *             t1=np.max(hills.time)
+ *         w=np.clip((t1-hills.time)/(t1-t0),0.0,1.0)             # <<<<<<<<<<<<<<
+ *     else:
+ *         if frac0 is None:
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 686, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_clip); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 686, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_hills, __pyx_n_s_time); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 686, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_7 = PyNumber_Subtract(__pyx_v_t1, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 686, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = PyNumber_Subtract(__pyx_v_t1, __pyx_v_t0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 686, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_8 = __Pyx_PyNumber_Divide(__pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 686, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = NULL;
+    __pyx_t_9 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
+      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
+      if (likely(__pyx_t_4)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
+        __Pyx_INCREF(__pyx_t_4);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_5, function);
+        __pyx_t_9 = 1;
+      }
+    }
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(__pyx_t_5)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_t_8, __pyx_float_0_0, __pyx_float_1_0};
+      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 686, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    } else
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_t_8, __pyx_float_0_0, __pyx_float_1_0};
+      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 686, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    } else
+    #endif
+    {
+      __pyx_t_7 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 686, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_7);
+      if (__pyx_t_4) {
+        __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
+      }
+      __Pyx_GIVEREF(__pyx_t_8);
+      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_9, __pyx_t_8);
+      __Pyx_INCREF(__pyx_float_0_0);
+      __Pyx_GIVEREF(__pyx_float_0_0);
+      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_9, __pyx_float_0_0);
+      __Pyx_INCREF(__pyx_float_1_0);
+      __Pyx_GIVEREF(__pyx_float_1_0);
+      PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_9, __pyx_float_1_0);
+      __pyx_t_8 = 0;
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 686, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    }
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_v_w = __pyx_t_1;
+    __pyx_t_1 = 0;
+
+    /* "plumed.pyx":681
+ *         use_time=True
+ * 
+ *     if use_time:             # <<<<<<<<<<<<<<
+ *         if t0 is None:
+ *             t0=np.min(hills.time)
+ */
+    goto __pyx_L14;
+  }
+
+  /* "plumed.pyx":688
+ *         w=np.clip((t1-hills.time)/(t1-t0),0.0,1.0)
+ *     else:
+ *         if frac0 is None:             # <<<<<<<<<<<<<<
+ *            frac0=0
+ *         if frac1 is None:
+ */
+  /*else*/ {
+    __pyx_t_2 = (__pyx_v_frac0 == Py_None);
+    __pyx_t_3 = (__pyx_t_2 != 0);
+    if (__pyx_t_3) {
+
+      /* "plumed.pyx":689
+ *     else:
+ *         if frac0 is None:
+ *            frac0=0             # <<<<<<<<<<<<<<
+ *         if frac1 is None:
+ *            frac1=1.0
+ */
+      __Pyx_INCREF(__pyx_int_0);
+      __Pyx_DECREF_SET(__pyx_v_frac0, __pyx_int_0);
+
+      /* "plumed.pyx":688
+ *         w=np.clip((t1-hills.time)/(t1-t0),0.0,1.0)
+ *     else:
+ *         if frac0 is None:             # <<<<<<<<<<<<<<
+ *            frac0=0
+ *         if frac1 is None:
+ */
+    }
+
+    /* "plumed.pyx":690
+ *         if frac0 is None:
+ *            frac0=0
+ *         if frac1 is None:             # <<<<<<<<<<<<<<
+ *            frac1=1.0
+ *         i0=int(len(hills)*frac0)
+ */
+    __pyx_t_3 = (__pyx_v_frac1 == Py_None);
+    __pyx_t_2 = (__pyx_t_3 != 0);
+    if (__pyx_t_2) {
+
+      /* "plumed.pyx":691
+ *            frac0=0
+ *         if frac1 is None:
+ *            frac1=1.0             # <<<<<<<<<<<<<<
+ *         i0=int(len(hills)*frac0)
+ *         i1=int(len(hills)*frac1)
+ */
+      __Pyx_INCREF(__pyx_float_1_0);
+      __Pyx_DECREF_SET(__pyx_v_frac1, __pyx_float_1_0);
+
+      /* "plumed.pyx":690
+ *         if frac0 is None:
+ *            frac0=0
+ *         if frac1 is None:             # <<<<<<<<<<<<<<
+ *            frac1=1.0
+ *         i0=int(len(hills)*frac0)
+ */
+    }
+
+    /* "plumed.pyx":692
+ *         if frac1 is None:
+ *            frac1=1.0
+ *         i0=int(len(hills)*frac0)             # <<<<<<<<<<<<<<
+ *         i1=int(len(hills)*frac1)
+ *         w=np.hstack((np.ones(i0),np.linspace(1.0,0.0,i1-i0),np.zeros(len(hills)-i1)))
+ */
+    __pyx_t_10 = PyObject_Length(__pyx_v_hills); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 692, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 692, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_5 = PyNumber_Multiply(__pyx_t_1, __pyx_v_frac0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 692, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 692, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_v_i0 = __pyx_t_1;
+    __pyx_t_1 = 0;
+
+    /* "plumed.pyx":693
+ *            frac1=1.0
+ *         i0=int(len(hills)*frac0)
+ *         i1=int(len(hills)*frac1)             # <<<<<<<<<<<<<<
+ *         w=np.hstack((np.ones(i0),np.linspace(1.0,0.0,i1-i0),np.zeros(len(hills)-i1)))
+ *     hills.height*=w
+ */
+    __pyx_t_10 = PyObject_Length(__pyx_v_hills); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 693, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 693, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_5 = PyNumber_Multiply(__pyx_t_1, __pyx_v_frac1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 693, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 693, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_v_i1 = __pyx_t_1;
+    __pyx_t_1 = 0;
+
+    /* "plumed.pyx":694
+ *         i0=int(len(hills)*frac0)
+ *         i1=int(len(hills)*frac1)
+ *         w=np.hstack((np.ones(i0),np.linspace(1.0,0.0,i1-i0),np.zeros(len(hills)-i1)))             # <<<<<<<<<<<<<<
+ *     hills.height*=w
+ * 
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_hstack); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_ones); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __pyx_t_8 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
+      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
+      if (likely(__pyx_t_8)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+        __Pyx_INCREF(__pyx_t_8);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_4, function);
+      }
+    }
+    __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_8, __pyx_v_i0) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_i0);
+    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_linspace); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_11);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __pyx_t_8 = PyNumber_Subtract(__pyx_v_i1, __pyx_v_i0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __pyx_t_12 = NULL;
+    __pyx_t_9 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
+      __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
+      if (likely(__pyx_t_12)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
+        __Pyx_INCREF(__pyx_t_12);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_11, function);
+        __pyx_t_9 = 1;
+      }
+    }
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(__pyx_t_11)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_12, __pyx_float_1_0, __pyx_float_0_0, __pyx_t_8};
+      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 694, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    } else
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_11)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_12, __pyx_float_1_0, __pyx_float_0_0, __pyx_t_8};
+      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 694, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    } else
+    #endif
+    {
+      __pyx_t_13 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 694, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_13);
+      if (__pyx_t_12) {
+        __Pyx_GIVEREF(__pyx_t_12); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_12); __pyx_t_12 = NULL;
+      }
+      __Pyx_INCREF(__pyx_float_1_0);
+      __Pyx_GIVEREF(__pyx_float_1_0);
+      PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_9, __pyx_float_1_0);
+      __Pyx_INCREF(__pyx_float_0_0);
+      __Pyx_GIVEREF(__pyx_float_0_0);
+      PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_9, __pyx_float_0_0);
+      __Pyx_GIVEREF(__pyx_t_8);
+      PyTuple_SET_ITEM(__pyx_t_13, 2+__pyx_t_9, __pyx_t_8);
+      __pyx_t_8 = 0;
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_13, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 694, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    }
+    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
+    __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_zeros); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __pyx_t_10 = PyObject_Length(__pyx_v_hills); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 694, __pyx_L1_error)
+    __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_10); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_12 = PyNumber_Subtract(__pyx_t_13, __pyx_v_i1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_12);
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __pyx_t_13 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
+      __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_8);
+      if (likely(__pyx_t_13)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
+        __Pyx_INCREF(__pyx_t_13);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_8, function);
+      }
+    }
+    __pyx_t_11 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_13, __pyx_t_12) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_12);
+    __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+    if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_11);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __Pyx_GIVEREF(__pyx_t_5);
+    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_11);
+    PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_11);
+    __pyx_t_5 = 0;
+    __pyx_t_4 = 0;
+    __pyx_t_11 = 0;
+    __pyx_t_11 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
+      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_7);
+      if (likely(__pyx_t_11)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
+        __Pyx_INCREF(__pyx_t_11);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_7, function);
+      }
+    }
+    __pyx_t_1 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_11, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8);
+    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 694, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __pyx_v_w = __pyx_t_1;
+    __pyx_t_1 = 0;
+  }
+  __pyx_L14:;
+
+  /* "plumed.pyx":695
+ *         i1=int(len(hills)*frac1)
+ *         w=np.hstack((np.ones(i0),np.linspace(1.0,0.0,i1-i0),np.zeros(len(hills)-i1)))
+ *     hills.height*=w             # <<<<<<<<<<<<<<
+ * 
+ *     if tofile is not None:
+ */
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_hills, __pyx_n_s_height); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 695, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_7 = PyNumber_InPlaceMultiply(__pyx_t_1, __pyx_v_w); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 695, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_hills, __pyx_n_s_height, __pyx_t_7) < 0) __PYX_ERR(0, 695, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+
+  /* "plumed.pyx":697
+ *     hills.height*=w
+ * 
+ *     if tofile is not None:             # <<<<<<<<<<<<<<
+ *         write_pandas(hills,tofile)
+ *     elif not inplace:
+ */
+  __pyx_t_2 = (__pyx_v_tofile != Py_None);
+  __pyx_t_3 = (__pyx_t_2 != 0);
+  if (__pyx_t_3) {
+
+    /* "plumed.pyx":698
+ * 
+ *     if tofile is not None:
+ *         write_pandas(hills,tofile)             # <<<<<<<<<<<<<<
+ *     elif not inplace:
+ *         return hills
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_write_pandas); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 698, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_8 = NULL;
+    __pyx_t_9 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
+      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
+      if (likely(__pyx_t_8)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
+        __Pyx_INCREF(__pyx_t_8);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_1, function);
+        __pyx_t_9 = 1;
+      }
+    }
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(__pyx_t_1)) {
+      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_v_hills, __pyx_v_tofile};
+      __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 698, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+      __Pyx_GOTREF(__pyx_t_7);
+    } else
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
+      PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_v_hills, __pyx_v_tofile};
+      __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 698, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+      __Pyx_GOTREF(__pyx_t_7);
+    } else
+    #endif
+    {
+      __pyx_t_11 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 698, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_11);
+      if (__pyx_t_8) {
+        __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_8); __pyx_t_8 = NULL;
+      }
+      __Pyx_INCREF(__pyx_v_hills);
+      __Pyx_GIVEREF(__pyx_v_hills);
+      PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_9, __pyx_v_hills);
+      __Pyx_INCREF(__pyx_v_tofile);
+      __Pyx_GIVEREF(__pyx_v_tofile);
+      PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_9, __pyx_v_tofile);
+      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_11, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 698, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_7);
+      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
+    }
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+
+    /* "plumed.pyx":697
+ *     hills.height*=w
+ * 
+ *     if tofile is not None:             # <<<<<<<<<<<<<<
+ *         write_pandas(hills,tofile)
+ *     elif not inplace:
+ */
+    goto __pyx_L19;
+  }
+
+  /* "plumed.pyx":699
+ *     if tofile is not None:
+ *         write_pandas(hills,tofile)
+ *     elif not inplace:             # <<<<<<<<<<<<<<
+ *         return hills
+ * 
+ */
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_inplace); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 699, __pyx_L1_error)
+  __pyx_t_2 = ((!__pyx_t_3) != 0);
+  if (__pyx_t_2) {
+
+    /* "plumed.pyx":700
+ *         write_pandas(hills,tofile)
+ *     elif not inplace:
+ *         return hills             # <<<<<<<<<<<<<<
+ * 
+ * def _guessplumedroot(kernel=None):
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_v_hills);
+    __pyx_r = __pyx_v_hills;
+    goto __pyx_L0;
+
+    /* "plumed.pyx":699
+ *     if tofile is not None:
+ *         write_pandas(hills,tofile)
+ *     elif not inplace:             # <<<<<<<<<<<<<<
+ *         return hills
+ * 
+ */
+  }
+  __pyx_L19:;
+
+  /* "plumed.pyx":613
+ *         file_or_path.write("\n")
+ * 
+ * def hills_time_average(hills, tofile=None, *, t0=None, t1=None, frac0=None, frac1=None, inplace=False):             # <<<<<<<<<<<<<<
+ *     """Compute a time-averaged hills file.
+ * 
+ */
+
+  /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_XDECREF(__pyx_t_11);
+  __Pyx_XDECREF(__pyx_t_12);
+  __Pyx_XDECREF(__pyx_t_13);
+  __Pyx_AddTraceback("plumed.hills_time_average", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_pd);
+  __Pyx_XDECREF(__pyx_v_use_time);
+  __Pyx_XDECREF(__pyx_v_use_index);
+  __Pyx_XDECREF(__pyx_v_w);
+  __Pyx_XDECREF(__pyx_v_i0);
+  __Pyx_XDECREF(__pyx_v_i1);
+  __Pyx_XDECREF(__pyx_v_hills);
+  __Pyx_XDECREF(__pyx_v_t0);
+  __Pyx_XDECREF(__pyx_v_t1);
+  __Pyx_XDECREF(__pyx_v_frac0);
+  __Pyx_XDECREF(__pyx_v_frac1);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "plumed.pyx":702
+ *         return hills
+ * 
  * def _guessplumedroot(kernel=None):             # <<<<<<<<<<<<<<
  *     """Guess plumed root.
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_9_guessplumedroot(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_8_guessplumedroot[] = "Guess plumed root.\n\n       kernel: path to the plumed kernel\n\n       In case the Plumed object cannot be created, try to launch a `plumed` executable and obtain the root\n       dir from there.\n    ";
-static PyMethodDef __pyx_mdef_6plumed_9_guessplumedroot = {"_guessplumedroot", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_9_guessplumedroot, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_8_guessplumedroot};
-static PyObject *__pyx_pw_6plumed_9_guessplumedroot(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_11_guessplumedroot(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_10_guessplumedroot[] = "Guess plumed root.\n\n       kernel: path to the plumed kernel\n\n       In case the Plumed object cannot be created, try to launch a `plumed` executable and obtain the root\n       dir from there.\n    ";
+static PyMethodDef __pyx_mdef_6plumed_11_guessplumedroot = {"_guessplumedroot", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_11_guessplumedroot, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_10_guessplumedroot};
+static PyObject *__pyx_pw_6plumed_11_guessplumedroot(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_kernel = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_guessplumedroot (wrapper)", 0);
@@ -11205,42 +13547,42 @@
         case  0:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kernel);
           if (value) { values[0] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_guessplumedroot") < 0)) __PYX_ERR(0, 520, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_guessplumedroot") < 0)) __PYX_ERR(0, 702, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_kernel = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_guessplumedroot", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 520, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_guessplumedroot", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 702, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._guessplumedroot", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_8_guessplumedroot(__pyx_self, __pyx_v_kernel);
+  __pyx_r = __pyx_pf_6plumed_10_guessplumedroot(__pyx_self, __pyx_v_kernel);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_8_guessplumedroot(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_kernel) {
+static PyObject *__pyx_pf_6plumed_10_guessplumedroot(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_kernel) {
   PyObject *__pyx_v_tempfile = NULL;
   PyObject *__pyx_v_log = NULL;
   PyObject *__pyx_v_p = NULL;
   PyObject *__pyx_v_i = NULL;
   PyObject *__pyx_v_root = NULL;
   PyObject *__pyx_v_fin = NULL;
   PyObject *__pyx_v_line = NULL;
@@ -11267,15 +13609,15 @@
   PyObject *__pyx_t_18 = NULL;
   PyObject *__pyx_t_19 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_guessplumedroot", 0);
 
-  /* "plumed.pyx":528
+  /* "plumed.pyx":710
  *        dir from there.
  *     """
  *     try:             # <<<<<<<<<<<<<<
  *         import tempfile
  *         log=tempfile.mkstemp()[1]
  */
   {
@@ -11283,83 +13625,83 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "plumed.pyx":529
+      /* "plumed.pyx":711
  *     """
  *     try:
  *         import tempfile             # <<<<<<<<<<<<<<
  *         log=tempfile.mkstemp()[1]
  *         with Plumed(kernel) as p:
  */
-      __pyx_t_4 = __Pyx_Import(__pyx_n_s_tempfile, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 529, __pyx_L3_error)
+      __pyx_t_4 = __Pyx_Import(__pyx_n_s_tempfile, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 711, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_4);
       __pyx_v_tempfile = __pyx_t_4;
       __pyx_t_4 = 0;
 
-      /* "plumed.pyx":530
+      /* "plumed.pyx":712
  *     try:
  *         import tempfile
  *         log=tempfile.mkstemp()[1]             # <<<<<<<<<<<<<<
  *         with Plumed(kernel) as p:
  *             p.cmd("setLogFile",log)
  */
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_tempfile, __pyx_n_s_mkstemp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 530, __pyx_L3_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_tempfile, __pyx_n_s_mkstemp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 712, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
       __pyx_t_6 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
         __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
         if (likely(__pyx_t_6)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_5, function);
         }
       }
       __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 530, __pyx_L3_error)
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 712, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 530, __pyx_L3_error)
+      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 712, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_v_log = __pyx_t_5;
       __pyx_t_5 = 0;
 
-      /* "plumed.pyx":531
+      /* "plumed.pyx":713
  *         import tempfile
  *         log=tempfile.mkstemp()[1]
  *         with Plumed(kernel) as p:             # <<<<<<<<<<<<<<
  *             p.cmd("setLogFile",log)
  *             p.cmd("init")
  */
       /*with:*/ {
-        __pyx_t_5 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_6plumed_Plumed), __pyx_v_kernel); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 531, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyObject_CallOneArg(((PyObject *)__pyx_ptype_6plumed_Plumed), __pyx_v_kernel); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 713, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_7 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_exit); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 531, __pyx_L3_error)
+        __pyx_t_7 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_exit); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 713, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_enter); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 531, __pyx_L9_error)
+        __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_5, __pyx_n_s_enter); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 713, __pyx_L9_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_t_8 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_8)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
             __Pyx_INCREF(__pyx_t_8);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_6, function);
           }
         }
         __pyx_t_4 = (__pyx_t_8) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_8) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
         __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-        if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 531, __pyx_L9_error)
+        if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 713, __pyx_L9_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_6 = __pyx_t_4;
         __pyx_t_4 = 0;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         /*try:*/ {
           {
@@ -11369,22 +13711,22 @@
             __Pyx_XGOTREF(__pyx_t_9);
             __Pyx_XGOTREF(__pyx_t_10);
             __Pyx_XGOTREF(__pyx_t_11);
             /*try:*/ {
               __pyx_v_p = __pyx_t_6;
               __pyx_t_6 = 0;
 
-              /* "plumed.pyx":532
+              /* "plumed.pyx":714
  *         log=tempfile.mkstemp()[1]
  *         with Plumed(kernel) as p:
  *             p.cmd("setLogFile",log)             # <<<<<<<<<<<<<<
  *             p.cmd("init")
  *         i=0
  */
-              __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_p, __pyx_n_s_cmd); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 532, __pyx_L13_error)
+              __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_p, __pyx_n_s_cmd); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 714, __pyx_L13_error)
               __Pyx_GOTREF(__pyx_t_5);
               __pyx_t_4 = NULL;
               __pyx_t_12 = 0;
               if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
                 __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
                 if (likely(__pyx_t_4)) {
                   PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -11393,73 +13735,73 @@
                   __Pyx_DECREF_SET(__pyx_t_5, function);
                   __pyx_t_12 = 1;
                 }
               }
               #if CYTHON_FAST_PYCALL
               if (PyFunction_Check(__pyx_t_5)) {
                 PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_n_u_setLogFile, __pyx_v_log};
-                __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 532, __pyx_L13_error)
+                __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 714, __pyx_L13_error)
                 __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
                 __Pyx_GOTREF(__pyx_t_6);
               } else
               #endif
               #if CYTHON_FAST_PYCCALL
               if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
                 PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_n_u_setLogFile, __pyx_v_log};
-                __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 532, __pyx_L13_error)
+                __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 714, __pyx_L13_error)
                 __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
                 __Pyx_GOTREF(__pyx_t_6);
               } else
               #endif
               {
-                __pyx_t_8 = PyTuple_New(2+__pyx_t_12); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 532, __pyx_L13_error)
+                __pyx_t_8 = PyTuple_New(2+__pyx_t_12); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 714, __pyx_L13_error)
                 __Pyx_GOTREF(__pyx_t_8);
                 if (__pyx_t_4) {
                   __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4); __pyx_t_4 = NULL;
                 }
                 __Pyx_INCREF(__pyx_n_u_setLogFile);
                 __Pyx_GIVEREF(__pyx_n_u_setLogFile);
                 PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_12, __pyx_n_u_setLogFile);
                 __Pyx_INCREF(__pyx_v_log);
                 __Pyx_GIVEREF(__pyx_v_log);
                 PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_12, __pyx_v_log);
-                __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 532, __pyx_L13_error)
+                __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 714, __pyx_L13_error)
                 __Pyx_GOTREF(__pyx_t_6);
                 __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
               }
               __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
               __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-              /* "plumed.pyx":533
+              /* "plumed.pyx":715
  *         with Plumed(kernel) as p:
  *             p.cmd("setLogFile",log)
  *             p.cmd("init")             # <<<<<<<<<<<<<<
  *         i=0
  *         root=""
  */
-              __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_p, __pyx_n_s_cmd); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 533, __pyx_L13_error)
+              __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_p, __pyx_n_s_cmd); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 715, __pyx_L13_error)
               __Pyx_GOTREF(__pyx_t_5);
               __pyx_t_8 = NULL;
               if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
                 __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
                 if (likely(__pyx_t_8)) {
                   PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
                   __Pyx_INCREF(__pyx_t_8);
                   __Pyx_INCREF(function);
                   __Pyx_DECREF_SET(__pyx_t_5, function);
                 }
               }
               __pyx_t_6 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_8, __pyx_n_u_init_2) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_n_u_init_2);
               __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-              if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 533, __pyx_L13_error)
+              if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 715, __pyx_L13_error)
               __Pyx_GOTREF(__pyx_t_6);
               __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
               __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-              /* "plumed.pyx":531
+              /* "plumed.pyx":713
  *         import tempfile
  *         log=tempfile.mkstemp()[1]
  *         with Plumed(kernel) as p:             # <<<<<<<<<<<<<<
  *             p.cmd("setLogFile",log)
  *             p.cmd("init")
  */
             }
@@ -11470,36 +13812,36 @@
             __pyx_L13_error:;
             __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
             __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
             __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
             __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
             /*except:*/ {
               __Pyx_AddTraceback("plumed._guessplumedroot", __pyx_clineno, __pyx_lineno, __pyx_filename);
-              if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_5, &__pyx_t_8) < 0) __PYX_ERR(0, 531, __pyx_L15_except_error)
+              if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_5, &__pyx_t_8) < 0) __PYX_ERR(0, 713, __pyx_L15_except_error)
               __Pyx_GOTREF(__pyx_t_6);
               __Pyx_GOTREF(__pyx_t_5);
               __Pyx_GOTREF(__pyx_t_8);
-              __pyx_t_4 = PyTuple_Pack(3, __pyx_t_6, __pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 531, __pyx_L15_except_error)
+              __pyx_t_4 = PyTuple_Pack(3, __pyx_t_6, __pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 713, __pyx_L15_except_error)
               __Pyx_GOTREF(__pyx_t_4);
               __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_4, NULL);
               __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
               __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-              if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 531, __pyx_L15_except_error)
+              if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 713, __pyx_L15_except_error)
               __Pyx_GOTREF(__pyx_t_13);
               __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_13);
               __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-              if (__pyx_t_14 < 0) __PYX_ERR(0, 531, __pyx_L15_except_error)
+              if (__pyx_t_14 < 0) __PYX_ERR(0, 713, __pyx_L15_except_error)
               __pyx_t_15 = ((!(__pyx_t_14 != 0)) != 0);
               if (__pyx_t_15) {
                 __Pyx_GIVEREF(__pyx_t_6);
                 __Pyx_GIVEREF(__pyx_t_5);
                 __Pyx_XGIVEREF(__pyx_t_8);
                 __Pyx_ErrRestoreWithState(__pyx_t_6, __pyx_t_5, __pyx_t_8);
                 __pyx_t_6 = 0; __pyx_t_5 = 0; __pyx_t_8 = 0; 
-                __PYX_ERR(0, 531, __pyx_L15_except_error)
+                __PYX_ERR(0, 713, __pyx_L15_except_error)
               }
               __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
               __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
               __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
               goto __pyx_L14_exception_handled;
             }
             __pyx_L15_except_error:;
@@ -11515,78 +13857,78 @@
             __Pyx_ExceptionReset(__pyx_t_9, __pyx_t_10, __pyx_t_11);
             __pyx_L18_try_end:;
           }
         }
         /*finally:*/ {
           /*normal exit:*/{
             if (__pyx_t_7) {
-              __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__31, NULL);
+              __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__34, NULL);
               __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-              if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 531, __pyx_L3_error)
+              if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 713, __pyx_L3_error)
               __Pyx_GOTREF(__pyx_t_11);
               __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
             }
             goto __pyx_L12;
           }
           __pyx_L12:;
         }
         goto __pyx_L22;
         __pyx_L9_error:;
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         goto __pyx_L3_error;
         __pyx_L22:;
       }
 
-      /* "plumed.pyx":534
+      /* "plumed.pyx":716
  *             p.cmd("setLogFile",log)
  *             p.cmd("init")
  *         i=0             # <<<<<<<<<<<<<<
  *         root=""
  *         with open(log) as fin:
  */
       __Pyx_INCREF(__pyx_int_0);
       __pyx_v_i = __pyx_int_0;
 
-      /* "plumed.pyx":535
+      /* "plumed.pyx":717
  *             p.cmd("init")
  *         i=0
  *         root=""             # <<<<<<<<<<<<<<
  *         with open(log) as fin:
  *             for line in fin:
  */
-      __Pyx_INCREF(__pyx_kp_u__32);
-      __pyx_v_root = __pyx_kp_u__32;
+      __Pyx_INCREF(__pyx_kp_u__35);
+      __pyx_v_root = __pyx_kp_u__35;
 
-      /* "plumed.pyx":536
+      /* "plumed.pyx":718
  *         i=0
  *         root=""
  *         with open(log) as fin:             # <<<<<<<<<<<<<<
  *             for line in fin:
  *                 i=i+1
  */
       /*with:*/ {
-        __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_open, __pyx_v_log); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 536, __pyx_L3_error)
+        __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_open, __pyx_v_log); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 718, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_7 = __Pyx_PyObject_LookupSpecial(__pyx_t_8, __pyx_n_s_exit); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 536, __pyx_L3_error)
+        __pyx_t_7 = __Pyx_PyObject_LookupSpecial(__pyx_t_8, __pyx_n_s_exit); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 718, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_8, __pyx_n_s_enter); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L23_error)
+        __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_8, __pyx_n_s_enter); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 718, __pyx_L23_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_4)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_6, function);
           }
         }
         __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 536, __pyx_L23_error)
+        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 718, __pyx_L23_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_6 = __pyx_t_5;
         __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         /*try:*/ {
           {
@@ -11596,85 +13938,85 @@
             __Pyx_XGOTREF(__pyx_t_11);
             __Pyx_XGOTREF(__pyx_t_10);
             __Pyx_XGOTREF(__pyx_t_9);
             /*try:*/ {
               __pyx_v_fin = __pyx_t_6;
               __pyx_t_6 = 0;
 
-              /* "plumed.pyx":537
+              /* "plumed.pyx":719
  *         root=""
  *         with open(log) as fin:
  *             for line in fin:             # <<<<<<<<<<<<<<
  *                 i=i+1
  *                 if re.match("PLUMED: Root: ",line):
  */
               if (likely(PyList_CheckExact(__pyx_v_fin)) || PyTuple_CheckExact(__pyx_v_fin)) {
                 __pyx_t_6 = __pyx_v_fin; __Pyx_INCREF(__pyx_t_6); __pyx_t_16 = 0;
                 __pyx_t_17 = NULL;
               } else {
-                __pyx_t_16 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_v_fin); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L27_error)
+                __pyx_t_16 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_v_fin); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 719, __pyx_L27_error)
                 __Pyx_GOTREF(__pyx_t_6);
-                __pyx_t_17 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 537, __pyx_L27_error)
+                __pyx_t_17 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 719, __pyx_L27_error)
               }
               for (;;) {
                 if (likely(!__pyx_t_17)) {
                   if (likely(PyList_CheckExact(__pyx_t_6))) {
                     if (__pyx_t_16 >= PyList_GET_SIZE(__pyx_t_6)) break;
                     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                    __pyx_t_8 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_16); __Pyx_INCREF(__pyx_t_8); __pyx_t_16++; if (unlikely(0 < 0)) __PYX_ERR(0, 537, __pyx_L27_error)
+                    __pyx_t_8 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_16); __Pyx_INCREF(__pyx_t_8); __pyx_t_16++; if (unlikely(0 < 0)) __PYX_ERR(0, 719, __pyx_L27_error)
                     #else
-                    __pyx_t_8 = PySequence_ITEM(__pyx_t_6, __pyx_t_16); __pyx_t_16++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 537, __pyx_L27_error)
+                    __pyx_t_8 = PySequence_ITEM(__pyx_t_6, __pyx_t_16); __pyx_t_16++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 719, __pyx_L27_error)
                     __Pyx_GOTREF(__pyx_t_8);
                     #endif
                   } else {
                     if (__pyx_t_16 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
                     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                    __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_16); __Pyx_INCREF(__pyx_t_8); __pyx_t_16++; if (unlikely(0 < 0)) __PYX_ERR(0, 537, __pyx_L27_error)
+                    __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_16); __Pyx_INCREF(__pyx_t_8); __pyx_t_16++; if (unlikely(0 < 0)) __PYX_ERR(0, 719, __pyx_L27_error)
                     #else
-                    __pyx_t_8 = PySequence_ITEM(__pyx_t_6, __pyx_t_16); __pyx_t_16++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 537, __pyx_L27_error)
+                    __pyx_t_8 = PySequence_ITEM(__pyx_t_6, __pyx_t_16); __pyx_t_16++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 719, __pyx_L27_error)
                     __Pyx_GOTREF(__pyx_t_8);
                     #endif
                   }
                 } else {
                   __pyx_t_8 = __pyx_t_17(__pyx_t_6);
                   if (unlikely(!__pyx_t_8)) {
                     PyObject* exc_type = PyErr_Occurred();
                     if (exc_type) {
                       if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-                      else __PYX_ERR(0, 537, __pyx_L27_error)
+                      else __PYX_ERR(0, 719, __pyx_L27_error)
                     }
                     break;
                   }
                   __Pyx_GOTREF(__pyx_t_8);
                 }
                 __Pyx_XDECREF_SET(__pyx_v_line, __pyx_t_8);
                 __pyx_t_8 = 0;
 
-                /* "plumed.pyx":538
+                /* "plumed.pyx":720
  *         with open(log) as fin:
  *             for line in fin:
  *                 i=i+1             # <<<<<<<<<<<<<<
  *                 if re.match("PLUMED: Root: ",line):
  *                     root=re.sub("PLUMED: Root: ","",line).rstrip("\n")
  */
-                __pyx_t_8 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 538, __pyx_L27_error)
+                __pyx_t_8 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 720, __pyx_L27_error)
                 __Pyx_GOTREF(__pyx_t_8);
                 __Pyx_DECREF_SET(__pyx_v_i, __pyx_t_8);
                 __pyx_t_8 = 0;
 
-                /* "plumed.pyx":539
+                /* "plumed.pyx":721
  *             for line in fin:
  *                 i=i+1
  *                 if re.match("PLUMED: Root: ",line):             # <<<<<<<<<<<<<<
  *                     root=re.sub("PLUMED: Root: ","",line).rstrip("\n")
  *                     break
  */
-                __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L27_error)
+                __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 721, __pyx_L27_error)
                 __Pyx_GOTREF(__pyx_t_5);
-                __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_match); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L27_error)
+                __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_match); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 721, __pyx_L27_error)
                 __Pyx_GOTREF(__pyx_t_4);
                 __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
                 __pyx_t_5 = NULL;
                 __pyx_t_12 = 0;
                 if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
                   __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
                   if (likely(__pyx_t_5)) {
@@ -11684,58 +14026,58 @@
                     __Pyx_DECREF_SET(__pyx_t_4, function);
                     __pyx_t_12 = 1;
                   }
                 }
                 #if CYTHON_FAST_PYCALL
                 if (PyFunction_Check(__pyx_t_4)) {
                   PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_kp_u_PLUMED_Root, __pyx_v_line};
-                  __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 539, __pyx_L27_error)
+                  __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 721, __pyx_L27_error)
                   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
                   __Pyx_GOTREF(__pyx_t_8);
                 } else
                 #endif
                 #if CYTHON_FAST_PYCCALL
                 if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
                   PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_kp_u_PLUMED_Root, __pyx_v_line};
-                  __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 539, __pyx_L27_error)
+                  __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_12, 2+__pyx_t_12); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 721, __pyx_L27_error)
                   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
                   __Pyx_GOTREF(__pyx_t_8);
                 } else
                 #endif
                 {
-                  __pyx_t_18 = PyTuple_New(2+__pyx_t_12); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 539, __pyx_L27_error)
+                  __pyx_t_18 = PyTuple_New(2+__pyx_t_12); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 721, __pyx_L27_error)
                   __Pyx_GOTREF(__pyx_t_18);
                   if (__pyx_t_5) {
                     __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_5); __pyx_t_5 = NULL;
                   }
                   __Pyx_INCREF(__pyx_kp_u_PLUMED_Root);
                   __Pyx_GIVEREF(__pyx_kp_u_PLUMED_Root);
                   PyTuple_SET_ITEM(__pyx_t_18, 0+__pyx_t_12, __pyx_kp_u_PLUMED_Root);
                   __Pyx_INCREF(__pyx_v_line);
                   __Pyx_GIVEREF(__pyx_v_line);
                   PyTuple_SET_ITEM(__pyx_t_18, 1+__pyx_t_12, __pyx_v_line);
-                  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_18, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 539, __pyx_L27_error)
+                  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_18, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 721, __pyx_L27_error)
                   __Pyx_GOTREF(__pyx_t_8);
                   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
                 }
                 __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-                __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 539, __pyx_L27_error)
+                __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 721, __pyx_L27_error)
                 __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
                 if (__pyx_t_15) {
 
-                  /* "plumed.pyx":540
+                  /* "plumed.pyx":722
  *                 i=i+1
  *                 if re.match("PLUMED: Root: ",line):
  *                     root=re.sub("PLUMED: Root: ","",line).rstrip("\n")             # <<<<<<<<<<<<<<
  *                     break
  *         if len(root)>0:
  */
-                  __Pyx_GetModuleGlobalName(__pyx_t_18, __pyx_n_s_re); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 540, __pyx_L27_error)
+                  __Pyx_GetModuleGlobalName(__pyx_t_18, __pyx_n_s_re); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 722, __pyx_L27_error)
                   __Pyx_GOTREF(__pyx_t_18);
-                  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_18, __pyx_n_s_sub); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 540, __pyx_L27_error)
+                  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_18, __pyx_n_s_sub); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 722, __pyx_L27_error)
                   __Pyx_GOTREF(__pyx_t_5);
                   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
                   __pyx_t_18 = NULL;
                   __pyx_t_12 = 0;
                   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
                     __pyx_t_18 = PyMethod_GET_SELF(__pyx_t_5);
                     if (likely(__pyx_t_18)) {
@@ -11744,99 +14086,99 @@
                       __Pyx_INCREF(function);
                       __Pyx_DECREF_SET(__pyx_t_5, function);
                       __pyx_t_12 = 1;
                     }
                   }
                   #if CYTHON_FAST_PYCALL
                   if (PyFunction_Check(__pyx_t_5)) {
-                    PyObject *__pyx_temp[4] = {__pyx_t_18, __pyx_kp_u_PLUMED_Root, __pyx_kp_u__32, __pyx_v_line};
-                    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 3+__pyx_t_12); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L27_error)
+                    PyObject *__pyx_temp[4] = {__pyx_t_18, __pyx_kp_u_PLUMED_Root, __pyx_kp_u__35, __pyx_v_line};
+                    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 3+__pyx_t_12); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 722, __pyx_L27_error)
                     __Pyx_XDECREF(__pyx_t_18); __pyx_t_18 = 0;
                     __Pyx_GOTREF(__pyx_t_4);
                   } else
                   #endif
                   #if CYTHON_FAST_PYCCALL
                   if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
-                    PyObject *__pyx_temp[4] = {__pyx_t_18, __pyx_kp_u_PLUMED_Root, __pyx_kp_u__32, __pyx_v_line};
-                    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 3+__pyx_t_12); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L27_error)
+                    PyObject *__pyx_temp[4] = {__pyx_t_18, __pyx_kp_u_PLUMED_Root, __pyx_kp_u__35, __pyx_v_line};
+                    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_12, 3+__pyx_t_12); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 722, __pyx_L27_error)
                     __Pyx_XDECREF(__pyx_t_18); __pyx_t_18 = 0;
                     __Pyx_GOTREF(__pyx_t_4);
                   } else
                   #endif
                   {
-                    __pyx_t_19 = PyTuple_New(3+__pyx_t_12); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 540, __pyx_L27_error)
+                    __pyx_t_19 = PyTuple_New(3+__pyx_t_12); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 722, __pyx_L27_error)
                     __Pyx_GOTREF(__pyx_t_19);
                     if (__pyx_t_18) {
                       __Pyx_GIVEREF(__pyx_t_18); PyTuple_SET_ITEM(__pyx_t_19, 0, __pyx_t_18); __pyx_t_18 = NULL;
                     }
                     __Pyx_INCREF(__pyx_kp_u_PLUMED_Root);
                     __Pyx_GIVEREF(__pyx_kp_u_PLUMED_Root);
                     PyTuple_SET_ITEM(__pyx_t_19, 0+__pyx_t_12, __pyx_kp_u_PLUMED_Root);
-                    __Pyx_INCREF(__pyx_kp_u__32);
-                    __Pyx_GIVEREF(__pyx_kp_u__32);
-                    PyTuple_SET_ITEM(__pyx_t_19, 1+__pyx_t_12, __pyx_kp_u__32);
+                    __Pyx_INCREF(__pyx_kp_u__35);
+                    __Pyx_GIVEREF(__pyx_kp_u__35);
+                    PyTuple_SET_ITEM(__pyx_t_19, 1+__pyx_t_12, __pyx_kp_u__35);
                     __Pyx_INCREF(__pyx_v_line);
                     __Pyx_GIVEREF(__pyx_v_line);
                     PyTuple_SET_ITEM(__pyx_t_19, 2+__pyx_t_12, __pyx_v_line);
-                    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_19, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L27_error)
+                    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_19, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 722, __pyx_L27_error)
                     __Pyx_GOTREF(__pyx_t_4);
                     __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
                   }
                   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-                  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 540, __pyx_L27_error)
+                  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 722, __pyx_L27_error)
                   __Pyx_GOTREF(__pyx_t_5);
                   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
                   __pyx_t_4 = NULL;
                   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
                     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
                     if (likely(__pyx_t_4)) {
                       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
                       __Pyx_INCREF(__pyx_t_4);
                       __Pyx_INCREF(function);
                       __Pyx_DECREF_SET(__pyx_t_5, function);
                     }
                   }
-                  __pyx_t_8 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_kp_u__30) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_kp_u__30);
+                  __pyx_t_8 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_kp_u__32) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_kp_u__32);
                   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-                  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 540, __pyx_L27_error)
+                  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 722, __pyx_L27_error)
                   __Pyx_GOTREF(__pyx_t_8);
                   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
                   __Pyx_DECREF_SET(__pyx_v_root, __pyx_t_8);
                   __pyx_t_8 = 0;
 
-                  /* "plumed.pyx":541
+                  /* "plumed.pyx":723
  *                 if re.match("PLUMED: Root: ",line):
  *                     root=re.sub("PLUMED: Root: ","",line).rstrip("\n")
  *                     break             # <<<<<<<<<<<<<<
  *         if len(root)>0:
  *             return root
  */
                   goto __pyx_L34_break;
 
-                  /* "plumed.pyx":539
+                  /* "plumed.pyx":721
  *             for line in fin:
  *                 i=i+1
  *                 if re.match("PLUMED: Root: ",line):             # <<<<<<<<<<<<<<
  *                     root=re.sub("PLUMED: Root: ","",line).rstrip("\n")
  *                     break
  */
                 }
 
-                /* "plumed.pyx":537
+                /* "plumed.pyx":719
  *         root=""
  *         with open(log) as fin:
  *             for line in fin:             # <<<<<<<<<<<<<<
  *                 i=i+1
  *                 if re.match("PLUMED: Root: ",line):
  */
               }
               __pyx_L34_break:;
               __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-              /* "plumed.pyx":536
+              /* "plumed.pyx":718
  *         i=0
  *         root=""
  *         with open(log) as fin:             # <<<<<<<<<<<<<<
  *             for line in fin:
  *                 i=i+1
  */
             }
@@ -11849,36 +14191,36 @@
             __Pyx_XDECREF(__pyx_t_19); __pyx_t_19 = 0;
             __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
             __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
             __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
             __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
             /*except:*/ {
               __Pyx_AddTraceback("plumed._guessplumedroot", __pyx_clineno, __pyx_lineno, __pyx_filename);
-              if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_8, &__pyx_t_5) < 0) __PYX_ERR(0, 536, __pyx_L29_except_error)
+              if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_8, &__pyx_t_5) < 0) __PYX_ERR(0, 718, __pyx_L29_except_error)
               __Pyx_GOTREF(__pyx_t_6);
               __Pyx_GOTREF(__pyx_t_8);
               __Pyx_GOTREF(__pyx_t_5);
-              __pyx_t_4 = PyTuple_Pack(3, __pyx_t_6, __pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 536, __pyx_L29_except_error)
+              __pyx_t_4 = PyTuple_Pack(3, __pyx_t_6, __pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 718, __pyx_L29_except_error)
               __Pyx_GOTREF(__pyx_t_4);
               __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_4, NULL);
               __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
               __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-              if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 536, __pyx_L29_except_error)
+              if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 718, __pyx_L29_except_error)
               __Pyx_GOTREF(__pyx_t_13);
               __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_13);
               __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-              if (__pyx_t_15 < 0) __PYX_ERR(0, 536, __pyx_L29_except_error)
+              if (__pyx_t_15 < 0) __PYX_ERR(0, 718, __pyx_L29_except_error)
               __pyx_t_14 = ((!(__pyx_t_15 != 0)) != 0);
               if (__pyx_t_14) {
                 __Pyx_GIVEREF(__pyx_t_6);
                 __Pyx_GIVEREF(__pyx_t_8);
                 __Pyx_XGIVEREF(__pyx_t_5);
                 __Pyx_ErrRestoreWithState(__pyx_t_6, __pyx_t_8, __pyx_t_5);
                 __pyx_t_6 = 0; __pyx_t_8 = 0; __pyx_t_5 = 0; 
-                __PYX_ERR(0, 536, __pyx_L29_except_error)
+                __PYX_ERR(0, 718, __pyx_L29_except_error)
               }
               __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
               __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
               __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
               goto __pyx_L28_exception_handled;
             }
             __pyx_L29_except_error:;
@@ -11894,64 +14236,64 @@
             __Pyx_ExceptionReset(__pyx_t_11, __pyx_t_10, __pyx_t_9);
             __pyx_L32_try_end:;
           }
         }
         /*finally:*/ {
           /*normal exit:*/{
             if (__pyx_t_7) {
-              __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__31, NULL);
+              __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__34, NULL);
               __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-              if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 536, __pyx_L3_error)
+              if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 718, __pyx_L3_error)
               __Pyx_GOTREF(__pyx_t_9);
               __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
             }
             goto __pyx_L26;
           }
           __pyx_L26:;
         }
         goto __pyx_L39;
         __pyx_L23_error:;
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         goto __pyx_L3_error;
         __pyx_L39:;
       }
 
-      /* "plumed.pyx":542
+      /* "plumed.pyx":724
  *                     root=re.sub("PLUMED: Root: ","",line).rstrip("\n")
  *                     break
  *         if len(root)>0:             # <<<<<<<<<<<<<<
  *             return root
  *     except:
  */
-      __pyx_t_16 = PyObject_Length(__pyx_v_root); if (unlikely(__pyx_t_16 == ((Py_ssize_t)-1))) __PYX_ERR(0, 542, __pyx_L3_error)
+      __pyx_t_16 = PyObject_Length(__pyx_v_root); if (unlikely(__pyx_t_16 == ((Py_ssize_t)-1))) __PYX_ERR(0, 724, __pyx_L3_error)
       __pyx_t_14 = ((__pyx_t_16 > 0) != 0);
       if (__pyx_t_14) {
 
-        /* "plumed.pyx":543
+        /* "plumed.pyx":725
  *                     break
  *         if len(root)>0:
  *             return root             # <<<<<<<<<<<<<<
  *     except:
  *         pass
  */
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_v_root);
         __pyx_r = __pyx_v_root;
         goto __pyx_L7_try_return;
 
-        /* "plumed.pyx":542
+        /* "plumed.pyx":724
  *                     root=re.sub("PLUMED: Root: ","",line).rstrip("\n")
  *                     break
  *         if len(root)>0:             # <<<<<<<<<<<<<<
  *             return root
  *     except:
  */
       }
 
-      /* "plumed.pyx":528
+      /* "plumed.pyx":710
  *        dir from there.
  *     """
  *     try:             # <<<<<<<<<<<<<<
  *         import tempfile
  *         log=tempfile.mkstemp()[1]
  */
     }
@@ -11963,28 +14305,28 @@
     __Pyx_XDECREF(__pyx_t_18); __pyx_t_18 = 0;
     __Pyx_XDECREF(__pyx_t_19); __pyx_t_19 = 0;
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-    /* "plumed.pyx":544
+    /* "plumed.pyx":726
  *         if len(root)>0:
  *             return root
  *     except:             # <<<<<<<<<<<<<<
  *         pass
  *     # alternative solution, search for a plumed executable in the path
  */
     /*except:*/ {
       __Pyx_ErrRestore(0,0,0);
       goto __pyx_L4_exception_handled;
     }
     __pyx_L7_try_return:;
 
-    /* "plumed.pyx":528
+    /* "plumed.pyx":710
  *        dir from there.
  *     """
  *     try:             # <<<<<<<<<<<<<<
  *         import tempfile
  *         log=tempfile.mkstemp()[1]
  */
     __Pyx_XGIVEREF(__pyx_t_1);
@@ -11996,37 +14338,37 @@
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     __pyx_L8_try_end:;
   }
 
-  /* "plumed.pyx":547
+  /* "plumed.pyx":729
  *         pass
  *     # alternative solution, search for a plumed executable in the path
  *     import subprocess             # <<<<<<<<<<<<<<
  *     return subprocess.check_output(["plumed","--no-mpi","info","--root"]).decode("utf-8").rstrip()
  * 
  */
-  __pyx_t_5 = __Pyx_Import(__pyx_n_s_subprocess, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 547, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_Import(__pyx_n_s_subprocess, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 729, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_v_subprocess = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "plumed.pyx":548
+  /* "plumed.pyx":730
  *     # alternative solution, search for a plumed executable in the path
  *     import subprocess
  *     return subprocess.check_output(["plumed","--no-mpi","info","--root"]).decode("utf-8").rstrip()             # <<<<<<<<<<<<<<
  * 
  * def _readvimdict(plumedroot=None,kernel=None):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_subprocess, __pyx_n_s_check_output); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_subprocess, __pyx_n_s_check_output); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 730, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_19 = PyList_New(4); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 548, __pyx_L1_error)
+  __pyx_t_19 = PyList_New(4); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 730, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_19);
   __Pyx_INCREF(__pyx_n_u_plumed);
   __Pyx_GIVEREF(__pyx_n_u_plumed);
   PyList_SET_ITEM(__pyx_t_19, 0, __pyx_n_u_plumed);
   __Pyx_INCREF(__pyx_kp_u_no_mpi);
   __Pyx_GIVEREF(__pyx_kp_u_no_mpi);
   PyList_SET_ITEM(__pyx_t_19, 1, __pyx_kp_u_no_mpi);
@@ -12045,59 +14387,59 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_6 = (__pyx_t_18) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_18, __pyx_t_19) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_19);
   __Pyx_XDECREF(__pyx_t_18); __pyx_t_18 = 0;
   __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 548, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 730, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_decode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_decode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 730, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_8 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_kp_u_utf_8) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_kp_u_utf_8);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 548, __pyx_L1_error)
+  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 730, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 730, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_8)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_8);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_8) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 548, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 730, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":520
- *         file_or_path.write("\n")
+  /* "plumed.pyx":702
+ *         return hills
  * 
  * def _guessplumedroot(kernel=None):             # <<<<<<<<<<<<<<
  *     """Guess plumed root.
  * 
  */
 
   /* function exit code */
@@ -12120,27 +14462,27 @@
   __Pyx_XDECREF(__pyx_v_line);
   __Pyx_XDECREF(__pyx_v_subprocess);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":550
+/* "plumed.pyx":732
  *     return subprocess.check_output(["plumed","--no-mpi","info","--root"]).decode("utf-8").rstrip()
  * 
  * def _readvimdict(plumedroot=None,kernel=None):             # <<<<<<<<<<<<<<
  *     """Read VIM dictionary given the path to PLUMED root and return (dictionary,doc).
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_11_readvimdict(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_10_readvimdict[] = "Read VIM dictionary given the path to PLUMED root and return (dictionary,doc).\n\n       If plumedroot is not given, it is guessed by launching `plumed` executable.\n       The dictionary is structured as follows:\n       - The keys are the names of the actions (e.g. \"RESTRAINT\").\n       - The values are dictionaries structured as follows:\n         - The keys are the available options.\n         - The value is a string describing the option type.\n       For instance `dictionary[\"RESTRAINT\"][\"NUMERICAL_DERIVATIVES\"]==\"(flag)\"`.\n\n       The doc is a dictionary structured as follows:\n       - The keys are the names of the actions (e.g. \"RESTRAINT\").\n       - The values are docstrings for the corresponding actions.\n    ";
-static PyMethodDef __pyx_mdef_6plumed_11_readvimdict = {"_readvimdict", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_11_readvimdict, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_10_readvimdict};
-static PyObject *__pyx_pw_6plumed_11_readvimdict(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_13_readvimdict(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_12_readvimdict[] = "Read VIM dictionary given the path to PLUMED root and return (dictionary,doc).\n\n       If plumedroot is not given, it is guessed by launching `plumed` executable.\n       The dictionary is structured as follows:\n       - The keys are the names of the actions (e.g. \"RESTRAINT\").\n       - The values are dictionaries structured as follows:\n         - The keys are the available options.\n         - The value is a string describing the option type.\n       For instance `dictionary[\"RESTRAINT\"][\"NUMERICAL_DERIVATIVES\"]==\"(flag)\"`.\n\n       The doc is a dictionary structured as follows:\n       - The keys are the names of the actions (e.g. \"RESTRAINT\").\n       - The values are docstrings for the corresponding actions.\n    ";
+static PyMethodDef __pyx_mdef_6plumed_13_readvimdict = {"_readvimdict", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_13_readvimdict, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_12_readvimdict};
+static PyObject *__pyx_pw_6plumed_13_readvimdict(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_plumedroot = 0;
   PyObject *__pyx_v_kernel = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
@@ -12172,15 +14514,15 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kernel);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_readvimdict") < 0)) __PYX_ERR(0, 550, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_readvimdict") < 0)) __PYX_ERR(0, 732, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
@@ -12189,28 +14531,28 @@
       }
     }
     __pyx_v_plumedroot = values[0];
     __pyx_v_kernel = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_readvimdict", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 550, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_readvimdict", 0, 0, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 732, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._readvimdict", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_10_readvimdict(__pyx_self, __pyx_v_plumedroot, __pyx_v_kernel);
+  __pyx_r = __pyx_pf_6plumed_12_readvimdict(__pyx_self, __pyx_v_plumedroot, __pyx_v_kernel);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_10_readvimdict(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_plumedroot, PyObject *__pyx_v_kernel) {
+static PyObject *__pyx_pf_6plumed_12_readvimdict(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_plumedroot, PyObject *__pyx_v_kernel) {
   PyObject *__pyx_v_syntax_file = NULL;
   PyObject *__pyx_v_help_dir = NULL;
   PyObject *__pyx_v_plumedDictionary = NULL;
   PyObject *__pyx_v_pattern = NULL;
   PyObject *__pyx_v_fin = NULL;
   PyObject *__pyx_v_line = NULL;
   PyObject *__pyx_v_ret = NULL;
@@ -12244,154 +14586,154 @@
   PyObject *__pyx_t_22 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_readvimdict", 0);
   __Pyx_INCREF(__pyx_v_plumedroot);
 
-  /* "plumed.pyx":565
+  /* "plumed.pyx":747
  *        - The values are docstrings for the corresponding actions.
  *     """
  *     if plumedroot is None:             # <<<<<<<<<<<<<<
  *         plumedroot=_guessplumedroot(kernel)
  *     syntax_file=plumedroot + "/vim/syntax/plumed.vim"
  */
   __pyx_t_1 = (__pyx_v_plumedroot == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":566
+    /* "plumed.pyx":748
  *     """
  *     if plumedroot is None:
  *         plumedroot=_guessplumedroot(kernel)             # <<<<<<<<<<<<<<
  *     syntax_file=plumedroot + "/vim/syntax/plumed.vim"
  *     help_dir=plumedroot + "/vim/help"
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_guessplumedroot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 566, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_guessplumedroot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 748, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_kernel) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_kernel);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 566, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 748, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_plumedroot, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "plumed.pyx":565
+    /* "plumed.pyx":747
  *        - The values are docstrings for the corresponding actions.
  *     """
  *     if plumedroot is None:             # <<<<<<<<<<<<<<
  *         plumedroot=_guessplumedroot(kernel)
  *     syntax_file=plumedroot + "/vim/syntax/plumed.vim"
  */
   }
 
-  /* "plumed.pyx":567
+  /* "plumed.pyx":749
  *     if plumedroot is None:
  *         plumedroot=_guessplumedroot(kernel)
  *     syntax_file=plumedroot + "/vim/syntax/plumed.vim"             # <<<<<<<<<<<<<<
  *     help_dir=plumedroot + "/vim/help"
  * # local dictionary, read from VIM
  */
-  __pyx_t_3 = PyNumber_Add(__pyx_v_plumedroot, __pyx_kp_u_vim_syntax_plumed_vim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 567, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Add(__pyx_v_plumedroot, __pyx_kp_u_vim_syntax_plumed_vim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 749, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_v_syntax_file = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "plumed.pyx":568
+  /* "plumed.pyx":750
  *         plumedroot=_guessplumedroot(kernel)
  *     syntax_file=plumedroot + "/vim/syntax/plumed.vim"
  *     help_dir=plumedroot + "/vim/help"             # <<<<<<<<<<<<<<
  * # local dictionary, read from VIM
  *     plumedDictionary={}
  */
-  __pyx_t_3 = PyNumber_Add(__pyx_v_plumedroot, __pyx_kp_u_vim_help); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 568, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Add(__pyx_v_plumedroot, __pyx_kp_u_vim_help); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 750, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_v_help_dir = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "plumed.pyx":570
+  /* "plumed.pyx":752
  *     help_dir=plumedroot + "/vim/help"
  * # local dictionary, read from VIM
  *     plumedDictionary={}             # <<<<<<<<<<<<<<
  *     pattern = re.compile("^let b:plumedDictionary\[.*$")
  *     with open(syntax_file) as fin:
  */
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 570, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 752, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_v_plumedDictionary = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
 
-  /* "plumed.pyx":571
+  /* "plumed.pyx":753
  * # local dictionary, read from VIM
  *     plumedDictionary={}
  *     pattern = re.compile("^let b:plumedDictionary\[.*$")             # <<<<<<<<<<<<<<
  *     with open(syntax_file) as fin:
  *         for line in fin:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_re); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 571, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_re); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 753, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_compile); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_compile); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 753, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_kp_u_let_b_plumedDictionary) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_kp_u_let_b_plumedDictionary);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 571, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 753, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_pattern = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "plumed.pyx":572
+  /* "plumed.pyx":754
  *     plumedDictionary={}
  *     pattern = re.compile("^let b:plumedDictionary\[.*$")
  *     with open(syntax_file) as fin:             # <<<<<<<<<<<<<<
  *         for line in fin:
  *             if pattern.match(line):
  */
   /*with:*/ {
-    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_open, __pyx_v_syntax_file); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 572, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_open, __pyx_v_syntax_file); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_3, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 572, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_3, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 754, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_4 = __Pyx_PyObject_LookupSpecial(__pyx_t_3, __pyx_n_s_enter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 572, __pyx_L4_error)
+    __pyx_t_4 = __Pyx_PyObject_LookupSpecial(__pyx_t_3, __pyx_n_s_enter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 754, __pyx_L4_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_7 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_7);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_5 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 572, __pyx_L4_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 754, __pyx_L4_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = __pyx_t_5;
     __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     /*try:*/ {
       {
@@ -12401,101 +14743,101 @@
         __Pyx_XGOTREF(__pyx_t_8);
         __Pyx_XGOTREF(__pyx_t_9);
         __Pyx_XGOTREF(__pyx_t_10);
         /*try:*/ {
           __pyx_v_fin = __pyx_t_4;
           __pyx_t_4 = 0;
 
-          /* "plumed.pyx":573
+          /* "plumed.pyx":755
  *     pattern = re.compile("^let b:plumedDictionary\[.*$")
  *     with open(syntax_file) as fin:
  *         for line in fin:             # <<<<<<<<<<<<<<
  *             if pattern.match(line):
  *                 line=re.sub("^let b:","",line)
  */
           if (likely(PyList_CheckExact(__pyx_v_fin)) || PyTuple_CheckExact(__pyx_v_fin)) {
             __pyx_t_4 = __pyx_v_fin; __Pyx_INCREF(__pyx_t_4); __pyx_t_11 = 0;
             __pyx_t_12 = NULL;
           } else {
-            __pyx_t_11 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_fin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 573, __pyx_L8_error)
+            __pyx_t_11 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_fin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 755, __pyx_L8_error)
             __Pyx_GOTREF(__pyx_t_4);
-            __pyx_t_12 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 573, __pyx_L8_error)
+            __pyx_t_12 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 755, __pyx_L8_error)
           }
           for (;;) {
             if (likely(!__pyx_t_12)) {
               if (likely(PyList_CheckExact(__pyx_t_4))) {
                 if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_4)) break;
                 #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                __pyx_t_3 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_11); __Pyx_INCREF(__pyx_t_3); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 573, __pyx_L8_error)
+                __pyx_t_3 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_11); __Pyx_INCREF(__pyx_t_3); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 755, __pyx_L8_error)
                 #else
-                __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 573, __pyx_L8_error)
+                __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 755, __pyx_L8_error)
                 __Pyx_GOTREF(__pyx_t_3);
                 #endif
               } else {
                 if (__pyx_t_11 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
                 #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_11); __Pyx_INCREF(__pyx_t_3); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 573, __pyx_L8_error)
+                __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_11); __Pyx_INCREF(__pyx_t_3); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 755, __pyx_L8_error)
                 #else
-                __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 573, __pyx_L8_error)
+                __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 755, __pyx_L8_error)
                 __Pyx_GOTREF(__pyx_t_3);
                 #endif
               }
             } else {
               __pyx_t_3 = __pyx_t_12(__pyx_t_4);
               if (unlikely(!__pyx_t_3)) {
                 PyObject* exc_type = PyErr_Occurred();
                 if (exc_type) {
                   if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-                  else __PYX_ERR(0, 573, __pyx_L8_error)
+                  else __PYX_ERR(0, 755, __pyx_L8_error)
                 }
                 break;
               }
               __Pyx_GOTREF(__pyx_t_3);
             }
             __Pyx_XDECREF_SET(__pyx_v_line, __pyx_t_3);
             __pyx_t_3 = 0;
 
-            /* "plumed.pyx":574
+            /* "plumed.pyx":756
  *     with open(syntax_file) as fin:
  *         for line in fin:
  *             if pattern.match(line):             # <<<<<<<<<<<<<<
  *                 line=re.sub("^let b:","",line)
  *                 exec(line,{'__builtins__': None},{'plumedDictionary':plumedDictionary})
  */
-            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_pattern, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 574, __pyx_L8_error)
+            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_pattern, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 756, __pyx_L8_error)
             __Pyx_GOTREF(__pyx_t_5);
             __pyx_t_7 = NULL;
             if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
               __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
               if (likely(__pyx_t_7)) {
                 PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
                 __Pyx_INCREF(__pyx_t_7);
                 __Pyx_INCREF(function);
                 __Pyx_DECREF_SET(__pyx_t_5, function);
               }
             }
             __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_v_line) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_line);
             __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-            if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 574, __pyx_L8_error)
+            if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 756, __pyx_L8_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 574, __pyx_L8_error)
+            __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 756, __pyx_L8_error)
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             if (__pyx_t_2) {
 
-              /* "plumed.pyx":575
+              /* "plumed.pyx":757
  *         for line in fin:
  *             if pattern.match(line):
  *                 line=re.sub("^let b:","",line)             # <<<<<<<<<<<<<<
  *                 exec(line,{'__builtins__': None},{'plumedDictionary':plumedDictionary})
  *     ret={}
  */
-              __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 575, __pyx_L8_error)
+              __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 757, __pyx_L8_error)
               __Pyx_GOTREF(__pyx_t_5);
-              __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_sub); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 575, __pyx_L8_error)
+              __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_sub); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 757, __pyx_L8_error)
               __Pyx_GOTREF(__pyx_t_7);
               __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
               __pyx_t_5 = NULL;
               __pyx_t_13 = 0;
               if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
                 __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
                 if (likely(__pyx_t_5)) {
@@ -12504,90 +14846,90 @@
                   __Pyx_INCREF(function);
                   __Pyx_DECREF_SET(__pyx_t_7, function);
                   __pyx_t_13 = 1;
                 }
               }
               #if CYTHON_FAST_PYCALL
               if (PyFunction_Check(__pyx_t_7)) {
-                PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u_let_b, __pyx_kp_u__32, __pyx_v_line};
-                __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_13, 3+__pyx_t_13); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 575, __pyx_L8_error)
+                PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u_let_b, __pyx_kp_u__35, __pyx_v_line};
+                __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_13, 3+__pyx_t_13); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 757, __pyx_L8_error)
                 __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
                 __Pyx_GOTREF(__pyx_t_3);
               } else
               #endif
               #if CYTHON_FAST_PYCCALL
               if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
-                PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u_let_b, __pyx_kp_u__32, __pyx_v_line};
-                __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_13, 3+__pyx_t_13); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 575, __pyx_L8_error)
+                PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u_let_b, __pyx_kp_u__35, __pyx_v_line};
+                __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_13, 3+__pyx_t_13); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 757, __pyx_L8_error)
                 __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
                 __Pyx_GOTREF(__pyx_t_3);
               } else
               #endif
               {
-                __pyx_t_14 = PyTuple_New(3+__pyx_t_13); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 575, __pyx_L8_error)
+                __pyx_t_14 = PyTuple_New(3+__pyx_t_13); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 757, __pyx_L8_error)
                 __Pyx_GOTREF(__pyx_t_14);
                 if (__pyx_t_5) {
                   __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_5); __pyx_t_5 = NULL;
                 }
                 __Pyx_INCREF(__pyx_kp_u_let_b);
                 __Pyx_GIVEREF(__pyx_kp_u_let_b);
                 PyTuple_SET_ITEM(__pyx_t_14, 0+__pyx_t_13, __pyx_kp_u_let_b);
-                __Pyx_INCREF(__pyx_kp_u__32);
-                __Pyx_GIVEREF(__pyx_kp_u__32);
-                PyTuple_SET_ITEM(__pyx_t_14, 1+__pyx_t_13, __pyx_kp_u__32);
+                __Pyx_INCREF(__pyx_kp_u__35);
+                __Pyx_GIVEREF(__pyx_kp_u__35);
+                PyTuple_SET_ITEM(__pyx_t_14, 1+__pyx_t_13, __pyx_kp_u__35);
                 __Pyx_INCREF(__pyx_v_line);
                 __Pyx_GIVEREF(__pyx_v_line);
                 PyTuple_SET_ITEM(__pyx_t_14, 2+__pyx_t_13, __pyx_v_line);
-                __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 575, __pyx_L8_error)
+                __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 757, __pyx_L8_error)
                 __Pyx_GOTREF(__pyx_t_3);
                 __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
               }
               __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
               __Pyx_DECREF_SET(__pyx_v_line, __pyx_t_3);
               __pyx_t_3 = 0;
 
-              /* "plumed.pyx":576
+              /* "plumed.pyx":758
  *             if pattern.match(line):
  *                 line=re.sub("^let b:","",line)
  *                 exec(line,{'__builtins__': None},{'plumedDictionary':plumedDictionary})             # <<<<<<<<<<<<<<
  *     ret={}
  *     doc={}
  */
-              __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 576, __pyx_L8_error)
+              __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L8_error)
               __Pyx_GOTREF(__pyx_t_3);
-              if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_builtins, Py_None) < 0) __PYX_ERR(0, 576, __pyx_L8_error)
-              __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 576, __pyx_L8_error)
+              if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_builtins, Py_None) < 0) __PYX_ERR(0, 758, __pyx_L8_error)
+              __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 758, __pyx_L8_error)
               __Pyx_GOTREF(__pyx_t_7);
-              if (PyDict_SetItem(__pyx_t_7, __pyx_n_u_plumedDictionary, __pyx_v_plumedDictionary) < 0) __PYX_ERR(0, 576, __pyx_L8_error)
-              __pyx_t_14 = __Pyx_PyExec3(__pyx_v_line, __pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 576, __pyx_L8_error)
+              if (PyDict_SetItem(__pyx_t_7, __pyx_n_u_plumedDictionary, __pyx_v_plumedDictionary) < 0) __PYX_ERR(0, 758, __pyx_L8_error)
+              __pyx_t_14 = __Pyx_PyExec3(__pyx_v_line, __pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 758, __pyx_L8_error)
               __Pyx_GOTREF(__pyx_t_14);
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
               __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
               __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
 
-              /* "plumed.pyx":574
+              /* "plumed.pyx":756
  *     with open(syntax_file) as fin:
  *         for line in fin:
  *             if pattern.match(line):             # <<<<<<<<<<<<<<
  *                 line=re.sub("^let b:","",line)
  *                 exec(line,{'__builtins__': None},{'plumedDictionary':plumedDictionary})
  */
             }
 
-            /* "plumed.pyx":573
+            /* "plumed.pyx":755
  *     pattern = re.compile("^let b:plumedDictionary\[.*$")
  *     with open(syntax_file) as fin:
  *         for line in fin:             # <<<<<<<<<<<<<<
  *             if pattern.match(line):
  *                 line=re.sub("^let b:","",line)
  */
           }
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-          /* "plumed.pyx":572
+          /* "plumed.pyx":754
  *     plumedDictionary={}
  *     pattern = re.compile("^let b:plumedDictionary\[.*$")
  *     with open(syntax_file) as fin:             # <<<<<<<<<<<<<<
  *         for line in fin:
  *             if pattern.match(line):
  */
         }
@@ -12599,36 +14941,36 @@
         __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         /*except:*/ {
           __Pyx_AddTraceback("plumed._readvimdict", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_14, &__pyx_t_7) < 0) __PYX_ERR(0, 572, __pyx_L10_except_error)
+          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_14, &__pyx_t_7) < 0) __PYX_ERR(0, 754, __pyx_L10_except_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_GOTREF(__pyx_t_7);
-          __pyx_t_3 = PyTuple_Pack(3, __pyx_t_4, __pyx_t_14, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 572, __pyx_L10_except_error)
+          __pyx_t_3 = PyTuple_Pack(3, __pyx_t_4, __pyx_t_14, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L10_except_error)
           __Pyx_GOTREF(__pyx_t_3);
           __pyx_t_15 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_3, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 572, __pyx_L10_except_error)
+          if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 754, __pyx_L10_except_error)
           __Pyx_GOTREF(__pyx_t_15);
           __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_15);
           __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
-          if (__pyx_t_2 < 0) __PYX_ERR(0, 572, __pyx_L10_except_error)
+          if (__pyx_t_2 < 0) __PYX_ERR(0, 754, __pyx_L10_except_error)
           __pyx_t_1 = ((!(__pyx_t_2 != 0)) != 0);
           if (__pyx_t_1) {
             __Pyx_GIVEREF(__pyx_t_4);
             __Pyx_GIVEREF(__pyx_t_14);
             __Pyx_XGIVEREF(__pyx_t_7);
             __Pyx_ErrRestoreWithState(__pyx_t_4, __pyx_t_14, __pyx_t_7);
             __pyx_t_4 = 0; __pyx_t_14 = 0; __pyx_t_7 = 0; 
-            __PYX_ERR(0, 572, __pyx_L10_except_error)
+            __PYX_ERR(0, 754, __pyx_L10_except_error)
           }
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
           __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
           goto __pyx_L9_exception_handled;
         }
         __pyx_L10_except_error:;
@@ -12644,136 +14986,136 @@
         __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
         __pyx_L13_try_end:;
       }
     }
     /*finally:*/ {
       /*normal exit:*/{
         if (__pyx_t_6) {
-          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__31, NULL);
+          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__34, NULL);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 572, __pyx_L1_error)
+          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 754, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_10);
           __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
         }
         goto __pyx_L7;
       }
       __pyx_L7:;
     }
     goto __pyx_L20;
     __pyx_L4_error:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L1_error;
     __pyx_L20:;
   }
 
-  /* "plumed.pyx":577
+  /* "plumed.pyx":759
  *                 line=re.sub("^let b:","",line)
  *                 exec(line,{'__builtins__': None},{'plumedDictionary':plumedDictionary})
  *     ret={}             # <<<<<<<<<<<<<<
  *     doc={}
  *     for action in plumedDictionary:
  */
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 577, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 759, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_v_ret = ((PyObject*)__pyx_t_7);
   __pyx_t_7 = 0;
 
-  /* "plumed.pyx":578
+  /* "plumed.pyx":760
  *                 exec(line,{'__builtins__': None},{'plumedDictionary':plumedDictionary})
  *     ret={}
  *     doc={}             # <<<<<<<<<<<<<<
  *     for action in plumedDictionary:
  *         ret[action]={}
  */
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 578, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 760, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_v_doc = ((PyObject*)__pyx_t_7);
   __pyx_t_7 = 0;
 
-  /* "plumed.pyx":579
+  /* "plumed.pyx":761
  *     ret={}
  *     doc={}
  *     for action in plumedDictionary:             # <<<<<<<<<<<<<<
  *         ret[action]={}
  *         doc[action]={}
  */
   __pyx_t_11 = 0;
-  __pyx_t_14 = __Pyx_dict_iterator(__pyx_v_plumedDictionary, 1, ((PyObject *)NULL), (&__pyx_t_16), (&__pyx_t_13)); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 579, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_dict_iterator(__pyx_v_plumedDictionary, 1, ((PyObject *)NULL), (&__pyx_t_16), (&__pyx_t_13)); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 761, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_XDECREF(__pyx_t_7);
   __pyx_t_7 = __pyx_t_14;
   __pyx_t_14 = 0;
   while (1) {
     __pyx_t_17 = __Pyx_dict_iter_next(__pyx_t_7, __pyx_t_16, &__pyx_t_11, &__pyx_t_14, NULL, NULL, __pyx_t_13);
     if (unlikely(__pyx_t_17 == 0)) break;
-    if (unlikely(__pyx_t_17 == -1)) __PYX_ERR(0, 579, __pyx_L1_error)
+    if (unlikely(__pyx_t_17 == -1)) __PYX_ERR(0, 761, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_XDECREF_SET(__pyx_v_action, __pyx_t_14);
     __pyx_t_14 = 0;
 
-    /* "plumed.pyx":580
+    /* "plumed.pyx":762
  *     doc={}
  *     for action in plumedDictionary:
  *         ret[action]={}             # <<<<<<<<<<<<<<
  *         doc[action]={}
  * # read documentation
  */
-    __pyx_t_14 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 580, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 762, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    if (unlikely(PyDict_SetItem(__pyx_v_ret, __pyx_v_action, __pyx_t_14) < 0)) __PYX_ERR(0, 580, __pyx_L1_error)
+    if (unlikely(PyDict_SetItem(__pyx_v_ret, __pyx_v_action, __pyx_t_14) < 0)) __PYX_ERR(0, 762, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
 
-    /* "plumed.pyx":581
+    /* "plumed.pyx":763
  *     for action in plumedDictionary:
  *         ret[action]={}
  *         doc[action]={}             # <<<<<<<<<<<<<<
  * # read documentation
  *         with open(help_dir + "/" + action + ".txt") as fin:
  */
-    __pyx_t_14 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 581, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 763, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    if (unlikely(PyDict_SetItem(__pyx_v_doc, __pyx_v_action, __pyx_t_14) < 0)) __PYX_ERR(0, 581, __pyx_L1_error)
+    if (unlikely(PyDict_SetItem(__pyx_v_doc, __pyx_v_action, __pyx_t_14) < 0)) __PYX_ERR(0, 763, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
 
-    /* "plumed.pyx":583
+    /* "plumed.pyx":765
  *         doc[action]={}
  * # read documentation
  *         with open(help_dir + "/" + action + ".txt") as fin:             # <<<<<<<<<<<<<<
  *             thisdoc=""
  *             for line in fin:
  */
     /*with:*/ {
-      __pyx_t_14 = PyNumber_Add(__pyx_v_help_dir, __pyx_kp_u__33); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 583, __pyx_L1_error)
+      __pyx_t_14 = PyNumber_Add(__pyx_v_help_dir, __pyx_kp_u__36); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 765, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_14);
-      __pyx_t_4 = PyNumber_Add(__pyx_t_14, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 583, __pyx_L1_error)
+      __pyx_t_4 = PyNumber_Add(__pyx_t_14, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 765, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      __pyx_t_14 = PyNumber_Add(__pyx_t_4, __pyx_kp_u_txt); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 583, __pyx_L1_error)
+      __pyx_t_14 = PyNumber_Add(__pyx_t_4, __pyx_kp_u_txt); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 765, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_14);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_open, __pyx_t_14); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 583, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_open, __pyx_t_14); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 765, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 583, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_exit); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 765, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_3 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_enter); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 583, __pyx_L23_error)
+      __pyx_t_3 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_enter); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 765, __pyx_L23_error)
       __Pyx_GOTREF(__pyx_t_3);
       __pyx_t_5 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
         __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
         if (likely(__pyx_t_5)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
           __Pyx_INCREF(__pyx_t_5);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_3, function);
         }
       }
       __pyx_t_14 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-      if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 583, __pyx_L23_error)
+      if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 765, __pyx_L23_error)
       __Pyx_GOTREF(__pyx_t_14);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_t_3 = __pyx_t_14;
       __pyx_t_14 = 0;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       /*try:*/ {
         {
@@ -12783,181 +15125,181 @@
           __Pyx_XGOTREF(__pyx_t_10);
           __Pyx_XGOTREF(__pyx_t_9);
           __Pyx_XGOTREF(__pyx_t_8);
           /*try:*/ {
             __Pyx_XDECREF_SET(__pyx_v_fin, __pyx_t_3);
             __pyx_t_3 = 0;
 
-            /* "plumed.pyx":584
+            /* "plumed.pyx":766
  * # read documentation
  *         with open(help_dir + "/" + action + ".txt") as fin:
  *             thisdoc=""             # <<<<<<<<<<<<<<
  *             for line in fin:
  *                 thisdoc+=line
  */
-            __Pyx_INCREF(__pyx_kp_u__32);
-            __Pyx_XDECREF_SET(__pyx_v_thisdoc, __pyx_kp_u__32);
+            __Pyx_INCREF(__pyx_kp_u__35);
+            __Pyx_XDECREF_SET(__pyx_v_thisdoc, __pyx_kp_u__35);
 
-            /* "plumed.pyx":585
+            /* "plumed.pyx":767
  *         with open(help_dir + "/" + action + ".txt") as fin:
  *             thisdoc=""
  *             for line in fin:             # <<<<<<<<<<<<<<
  *                 thisdoc+=line
  *                 if(line.rstrip("\n")=="****************************************"):
  */
             if (likely(PyList_CheckExact(__pyx_v_fin)) || PyTuple_CheckExact(__pyx_v_fin)) {
               __pyx_t_3 = __pyx_v_fin; __Pyx_INCREF(__pyx_t_3); __pyx_t_18 = 0;
               __pyx_t_12 = NULL;
             } else {
-              __pyx_t_18 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_fin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 585, __pyx_L29_error)
+              __pyx_t_18 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_fin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 767, __pyx_L29_error)
               __Pyx_GOTREF(__pyx_t_3);
-              __pyx_t_12 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 585, __pyx_L29_error)
+              __pyx_t_12 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 767, __pyx_L29_error)
             }
             for (;;) {
               if (likely(!__pyx_t_12)) {
                 if (likely(PyList_CheckExact(__pyx_t_3))) {
                   if (__pyx_t_18 >= PyList_GET_SIZE(__pyx_t_3)) break;
                   #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                  __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_18); __Pyx_INCREF(__pyx_t_4); __pyx_t_18++; if (unlikely(0 < 0)) __PYX_ERR(0, 585, __pyx_L29_error)
+                  __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_18); __Pyx_INCREF(__pyx_t_4); __pyx_t_18++; if (unlikely(0 < 0)) __PYX_ERR(0, 767, __pyx_L29_error)
                   #else
-                  __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 585, __pyx_L29_error)
+                  __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 767, __pyx_L29_error)
                   __Pyx_GOTREF(__pyx_t_4);
                   #endif
                 } else {
                   if (__pyx_t_18 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
                   #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                  __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_18); __Pyx_INCREF(__pyx_t_4); __pyx_t_18++; if (unlikely(0 < 0)) __PYX_ERR(0, 585, __pyx_L29_error)
+                  __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_18); __Pyx_INCREF(__pyx_t_4); __pyx_t_18++; if (unlikely(0 < 0)) __PYX_ERR(0, 767, __pyx_L29_error)
                   #else
-                  __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 585, __pyx_L29_error)
+                  __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 767, __pyx_L29_error)
                   __Pyx_GOTREF(__pyx_t_4);
                   #endif
                 }
               } else {
                 __pyx_t_4 = __pyx_t_12(__pyx_t_3);
                 if (unlikely(!__pyx_t_4)) {
                   PyObject* exc_type = PyErr_Occurred();
                   if (exc_type) {
                     if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-                    else __PYX_ERR(0, 585, __pyx_L29_error)
+                    else __PYX_ERR(0, 767, __pyx_L29_error)
                   }
                   break;
                 }
                 __Pyx_GOTREF(__pyx_t_4);
               }
               __Pyx_XDECREF_SET(__pyx_v_line, __pyx_t_4);
               __pyx_t_4 = 0;
 
-              /* "plumed.pyx":586
+              /* "plumed.pyx":768
  *             thisdoc=""
  *             for line in fin:
  *                 thisdoc+=line             # <<<<<<<<<<<<<<
  *                 if(line.rstrip("\n")=="****************************************"):
  *                     thisdoc="Create action " + action + "\n"
  */
-              __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_thisdoc, __pyx_v_line); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 586, __pyx_L29_error)
+              __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_thisdoc, __pyx_v_line); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 768, __pyx_L29_error)
               __Pyx_GOTREF(__pyx_t_4);
               __Pyx_DECREF_SET(__pyx_v_thisdoc, __pyx_t_4);
               __pyx_t_4 = 0;
 
-              /* "plumed.pyx":587
+              /* "plumed.pyx":769
  *             for line in fin:
  *                 thisdoc+=line
  *                 if(line.rstrip("\n")=="****************************************"):             # <<<<<<<<<<<<<<
  *                     thisdoc="Create action " + action + "\n"
  *             doc[action]=thisdoc
  */
-              __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_line, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 587, __pyx_L29_error)
+              __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_line, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 769, __pyx_L29_error)
               __Pyx_GOTREF(__pyx_t_14);
               __pyx_t_5 = NULL;
               if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_14))) {
                 __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_14);
                 if (likely(__pyx_t_5)) {
                   PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
                   __Pyx_INCREF(__pyx_t_5);
                   __Pyx_INCREF(function);
                   __Pyx_DECREF_SET(__pyx_t_14, function);
                 }
               }
-              __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_5, __pyx_kp_u__30) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_kp_u__30);
+              __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_5, __pyx_kp_u__32) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_kp_u__32);
               __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-              if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 587, __pyx_L29_error)
+              if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 769, __pyx_L29_error)
               __Pyx_GOTREF(__pyx_t_4);
               __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-              __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_t_4, __pyx_kp_u__34, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 587, __pyx_L29_error)
+              __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_t_4, __pyx_kp_u__37, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 769, __pyx_L29_error)
               __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
               if (__pyx_t_1) {
 
-                /* "plumed.pyx":588
+                /* "plumed.pyx":770
  *                 thisdoc+=line
  *                 if(line.rstrip("\n")=="****************************************"):
  *                     thisdoc="Create action " + action + "\n"             # <<<<<<<<<<<<<<
  *             doc[action]=thisdoc
  * # remove LaTex stuff
  */
-                __pyx_t_4 = PyNumber_Add(__pyx_kp_u_Create_action, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 588, __pyx_L29_error)
+                __pyx_t_4 = PyNumber_Add(__pyx_kp_u_Create_action, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 770, __pyx_L29_error)
                 __Pyx_GOTREF(__pyx_t_4);
-                __pyx_t_14 = PyNumber_Add(__pyx_t_4, __pyx_kp_u__30); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 588, __pyx_L29_error)
+                __pyx_t_14 = PyNumber_Add(__pyx_t_4, __pyx_kp_u__32); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 770, __pyx_L29_error)
                 __Pyx_GOTREF(__pyx_t_14);
                 __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
                 __Pyx_DECREF_SET(__pyx_v_thisdoc, __pyx_t_14);
                 __pyx_t_14 = 0;
 
-                /* "plumed.pyx":587
+                /* "plumed.pyx":769
  *             for line in fin:
  *                 thisdoc+=line
  *                 if(line.rstrip("\n")=="****************************************"):             # <<<<<<<<<<<<<<
  *                     thisdoc="Create action " + action + "\n"
  *             doc[action]=thisdoc
  */
               }
 
-              /* "plumed.pyx":585
+              /* "plumed.pyx":767
  *         with open(help_dir + "/" + action + ".txt") as fin:
  *             thisdoc=""
  *             for line in fin:             # <<<<<<<<<<<<<<
  *                 thisdoc+=line
  *                 if(line.rstrip("\n")=="****************************************"):
  */
             }
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-            /* "plumed.pyx":589
+            /* "plumed.pyx":771
  *                 if(line.rstrip("\n")=="****************************************"):
  *                     thisdoc="Create action " + action + "\n"
  *             doc[action]=thisdoc             # <<<<<<<<<<<<<<
  * # remove LaTex stuff
  *             doc[action]=doc[action].replace("\\f$","").replace("\\","")
  */
-            if (unlikely(PyDict_SetItem(__pyx_v_doc, __pyx_v_action, __pyx_v_thisdoc) < 0)) __PYX_ERR(0, 589, __pyx_L29_error)
+            if (unlikely(PyDict_SetItem(__pyx_v_doc, __pyx_v_action, __pyx_v_thisdoc) < 0)) __PYX_ERR(0, 771, __pyx_L29_error)
 
-            /* "plumed.pyx":591
+            /* "plumed.pyx":773
  *             doc[action]=thisdoc
  * # remove LaTex stuff
  *             doc[action]=doc[action].replace("\\f$","").replace("\\","")             # <<<<<<<<<<<<<<
  * # read dictionary
  *         for opt in plumedDictionary[action]:
  */
-            __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_doc, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L29_error)
+            __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_doc, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 773, __pyx_L29_error)
             __Pyx_GOTREF(__pyx_t_3);
-            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_replace); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 591, __pyx_L29_error)
+            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_replace); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 773, __pyx_L29_error)
             __Pyx_GOTREF(__pyx_t_14);
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-            __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_tuple__35, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L29_error)
+            __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_tuple__38, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 773, __pyx_L29_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_replace); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 591, __pyx_L29_error)
+            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_replace); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 773, __pyx_L29_error)
             __Pyx_GOTREF(__pyx_t_14);
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-            __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_tuple__37, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L29_error)
+            __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 773, __pyx_L29_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-            if (unlikely(PyDict_SetItem(__pyx_v_doc, __pyx_v_action, __pyx_t_3) < 0)) __PYX_ERR(0, 591, __pyx_L29_error)
+            if (unlikely(PyDict_SetItem(__pyx_v_doc, __pyx_v_action, __pyx_t_3) < 0)) __PYX_ERR(0, 773, __pyx_L29_error)
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-            /* "plumed.pyx":583
+            /* "plumed.pyx":765
  *         doc[action]={}
  * # read documentation
  *         with open(help_dir + "/" + action + ".txt") as fin:             # <<<<<<<<<<<<<<
  *             thisdoc=""
  *             for line in fin:
  */
           }
@@ -12968,36 +15310,36 @@
           __pyx_L29_error:;
           __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
           __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           /*except:*/ {
             __Pyx_AddTraceback("plumed._readvimdict", __pyx_clineno, __pyx_lineno, __pyx_filename);
-            if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_14, &__pyx_t_4) < 0) __PYX_ERR(0, 583, __pyx_L31_except_error)
+            if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_14, &__pyx_t_4) < 0) __PYX_ERR(0, 765, __pyx_L31_except_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_GOTREF(__pyx_t_14);
             __Pyx_GOTREF(__pyx_t_4);
-            __pyx_t_5 = PyTuple_Pack(3, __pyx_t_3, __pyx_t_14, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 583, __pyx_L31_except_error)
+            __pyx_t_5 = PyTuple_Pack(3, __pyx_t_3, __pyx_t_14, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 765, __pyx_L31_except_error)
             __Pyx_GOTREF(__pyx_t_5);
             __pyx_t_15 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_5, NULL);
             __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 583, __pyx_L31_except_error)
+            if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 765, __pyx_L31_except_error)
             __Pyx_GOTREF(__pyx_t_15);
             __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_15);
             __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
-            if (__pyx_t_1 < 0) __PYX_ERR(0, 583, __pyx_L31_except_error)
+            if (__pyx_t_1 < 0) __PYX_ERR(0, 765, __pyx_L31_except_error)
             __pyx_t_2 = ((!(__pyx_t_1 != 0)) != 0);
             if (__pyx_t_2) {
               __Pyx_GIVEREF(__pyx_t_3);
               __Pyx_GIVEREF(__pyx_t_14);
               __Pyx_XGIVEREF(__pyx_t_4);
               __Pyx_ErrRestoreWithState(__pyx_t_3, __pyx_t_14, __pyx_t_4);
               __pyx_t_3 = 0; __pyx_t_14 = 0; __pyx_t_4 = 0; 
-              __PYX_ERR(0, 583, __pyx_L31_except_error)
+              __PYX_ERR(0, 765, __pyx_L31_except_error)
             }
             __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
             __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
             __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
             goto __pyx_L30_exception_handled;
           }
           __pyx_L31_except_error:;
@@ -13013,113 +15355,113 @@
           __Pyx_ExceptionReset(__pyx_t_10, __pyx_t_9, __pyx_t_8);
           __pyx_L36_try_end:;
         }
       }
       /*finally:*/ {
         /*normal exit:*/{
           if (__pyx_t_6) {
-            __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__31, NULL);
+            __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_tuple__34, NULL);
             __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-            if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 583, __pyx_L1_error)
+            if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 765, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_8);
             __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
           }
           goto __pyx_L28;
         }
         __pyx_L28:;
       }
       goto __pyx_L43;
       __pyx_L23_error:;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       goto __pyx_L1_error;
       __pyx_L43:;
     }
 
-    /* "plumed.pyx":593
+    /* "plumed.pyx":775
  *             doc[action]=doc[action].replace("\\f$","").replace("\\","")
  * # read dictionary
  *         for opt in plumedDictionary[action]:             # <<<<<<<<<<<<<<
  * # skip label (it is added automatically)
  *             if opt["menu"] != "(label)":
  */
-    __pyx_t_4 = __Pyx_PyDict_GetItem(__pyx_v_plumedDictionary, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 593, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_GetItem(__pyx_v_plumedDictionary, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 775, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
       __pyx_t_14 = __pyx_t_4; __Pyx_INCREF(__pyx_t_14); __pyx_t_18 = 0;
       __pyx_t_12 = NULL;
     } else {
-      __pyx_t_18 = -1; __pyx_t_14 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 593, __pyx_L1_error)
+      __pyx_t_18 = -1; __pyx_t_14 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 775, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_14);
-      __pyx_t_12 = Py_TYPE(__pyx_t_14)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 593, __pyx_L1_error)
+      __pyx_t_12 = Py_TYPE(__pyx_t_14)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 775, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     for (;;) {
       if (likely(!__pyx_t_12)) {
         if (likely(PyList_CheckExact(__pyx_t_14))) {
           if (__pyx_t_18 >= PyList_GET_SIZE(__pyx_t_14)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_14, __pyx_t_18); __Pyx_INCREF(__pyx_t_4); __pyx_t_18++; if (unlikely(0 < 0)) __PYX_ERR(0, 593, __pyx_L1_error)
+          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_14, __pyx_t_18); __Pyx_INCREF(__pyx_t_4); __pyx_t_18++; if (unlikely(0 < 0)) __PYX_ERR(0, 775, __pyx_L1_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_14, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 593, __pyx_L1_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_14, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 775, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         } else {
           if (__pyx_t_18 >= PyTuple_GET_SIZE(__pyx_t_14)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_14, __pyx_t_18); __Pyx_INCREF(__pyx_t_4); __pyx_t_18++; if (unlikely(0 < 0)) __PYX_ERR(0, 593, __pyx_L1_error)
+          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_14, __pyx_t_18); __Pyx_INCREF(__pyx_t_4); __pyx_t_18++; if (unlikely(0 < 0)) __PYX_ERR(0, 775, __pyx_L1_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_14, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 593, __pyx_L1_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_14, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 775, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         }
       } else {
         __pyx_t_4 = __pyx_t_12(__pyx_t_14);
         if (unlikely(!__pyx_t_4)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 593, __pyx_L1_error)
+            else __PYX_ERR(0, 775, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_4);
       }
       __Pyx_XDECREF_SET(__pyx_v_opt, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "plumed.pyx":595
+      /* "plumed.pyx":777
  *         for opt in plumedDictionary[action]:
  * # skip label (it is added automatically)
  *             if opt["menu"] != "(label)":             # <<<<<<<<<<<<<<
  *                 ret[action][re.sub("=$","",opt["word"])]=opt["menu"]
  *     return ret,doc
  */
-      __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_opt, __pyx_n_u_menu); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 595, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_opt, __pyx_n_u_menu); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 777, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_t_4, __pyx_kp_u_label, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 595, __pyx_L1_error)
+      __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_t_4, __pyx_kp_u_label, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 777, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       if (__pyx_t_2) {
 
-        /* "plumed.pyx":596
+        /* "plumed.pyx":778
  * # skip label (it is added automatically)
  *             if opt["menu"] != "(label)":
  *                 ret[action][re.sub("=$","",opt["word"])]=opt["menu"]             # <<<<<<<<<<<<<<
  *     return ret,doc
  * 
  */
-        __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_opt, __pyx_n_u_menu); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_opt, __pyx_n_u_menu); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 778, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_ret, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_ret, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 778, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __Pyx_GetModuleGlobalName(__pyx_t_19, __pyx_n_s_re); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_19, __pyx_n_s_re); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 778, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_19);
-        __pyx_t_20 = __Pyx_PyObject_GetAttrStr(__pyx_t_19, __pyx_n_s_sub); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_20 = __Pyx_PyObject_GetAttrStr(__pyx_t_19, __pyx_n_s_sub); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 778, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_20);
         __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
-        __pyx_t_19 = __Pyx_PyObject_Dict_GetItem(__pyx_v_opt, __pyx_n_u_word); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyObject_Dict_GetItem(__pyx_v_opt, __pyx_n_u_word); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 778, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_19);
         __pyx_t_21 = NULL;
         __pyx_t_17 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_20))) {
           __pyx_t_21 = PyMethod_GET_SELF(__pyx_t_20);
           if (likely(__pyx_t_21)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_20);
@@ -13127,97 +15469,97 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_20, function);
             __pyx_t_17 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_20)) {
-          PyObject *__pyx_temp[4] = {__pyx_t_21, __pyx_kp_u__38, __pyx_kp_u__32, __pyx_t_19};
-          __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_20, __pyx_temp+1-__pyx_t_17, 3+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 596, __pyx_L1_error)
+          PyObject *__pyx_temp[4] = {__pyx_t_21, __pyx_kp_u__41, __pyx_kp_u__35, __pyx_t_19};
+          __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_20, __pyx_temp+1-__pyx_t_17, 3+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 778, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_21); __pyx_t_21 = 0;
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_20)) {
-          PyObject *__pyx_temp[4] = {__pyx_t_21, __pyx_kp_u__38, __pyx_kp_u__32, __pyx_t_19};
-          __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_20, __pyx_temp+1-__pyx_t_17, 3+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 596, __pyx_L1_error)
+          PyObject *__pyx_temp[4] = {__pyx_t_21, __pyx_kp_u__41, __pyx_kp_u__35, __pyx_t_19};
+          __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_20, __pyx_temp+1-__pyx_t_17, 3+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 778, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_21); __pyx_t_21 = 0;
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
         } else
         #endif
         {
-          __pyx_t_22 = PyTuple_New(3+__pyx_t_17); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_22 = PyTuple_New(3+__pyx_t_17); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 778, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_22);
           if (__pyx_t_21) {
             __Pyx_GIVEREF(__pyx_t_21); PyTuple_SET_ITEM(__pyx_t_22, 0, __pyx_t_21); __pyx_t_21 = NULL;
           }
-          __Pyx_INCREF(__pyx_kp_u__38);
-          __Pyx_GIVEREF(__pyx_kp_u__38);
-          PyTuple_SET_ITEM(__pyx_t_22, 0+__pyx_t_17, __pyx_kp_u__38);
-          __Pyx_INCREF(__pyx_kp_u__32);
-          __Pyx_GIVEREF(__pyx_kp_u__32);
-          PyTuple_SET_ITEM(__pyx_t_22, 1+__pyx_t_17, __pyx_kp_u__32);
+          __Pyx_INCREF(__pyx_kp_u__41);
+          __Pyx_GIVEREF(__pyx_kp_u__41);
+          PyTuple_SET_ITEM(__pyx_t_22, 0+__pyx_t_17, __pyx_kp_u__41);
+          __Pyx_INCREF(__pyx_kp_u__35);
+          __Pyx_GIVEREF(__pyx_kp_u__35);
+          PyTuple_SET_ITEM(__pyx_t_22, 1+__pyx_t_17, __pyx_kp_u__35);
           __Pyx_GIVEREF(__pyx_t_19);
           PyTuple_SET_ITEM(__pyx_t_22, 2+__pyx_t_17, __pyx_t_19);
           __pyx_t_19 = 0;
-          __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_20, __pyx_t_22, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_20, __pyx_t_22, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 778, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
         }
         __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
-        if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_t_5, __pyx_t_4) < 0)) __PYX_ERR(0, 596, __pyx_L1_error)
+        if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_t_5, __pyx_t_4) < 0)) __PYX_ERR(0, 778, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-        /* "plumed.pyx":595
+        /* "plumed.pyx":777
  *         for opt in plumedDictionary[action]:
  * # skip label (it is added automatically)
  *             if opt["menu"] != "(label)":             # <<<<<<<<<<<<<<
  *                 ret[action][re.sub("=$","",opt["word"])]=opt["menu"]
  *     return ret,doc
  */
       }
 
-      /* "plumed.pyx":593
+      /* "plumed.pyx":775
  *             doc[action]=doc[action].replace("\\f$","").replace("\\","")
  * # read dictionary
  *         for opt in plumedDictionary[action]:             # <<<<<<<<<<<<<<
  * # skip label (it is added automatically)
  *             if opt["menu"] != "(label)":
  */
     }
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   }
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "plumed.pyx":597
+  /* "plumed.pyx":779
  *             if opt["menu"] != "(label)":
  *                 ret[action][re.sub("=$","",opt["word"])]=opt["menu"]
  *     return ret,doc             # <<<<<<<<<<<<<<
  * 
  * def _create_functions(dictionary,*,doc=None,append_underscores=False):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 597, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 779, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_INCREF(__pyx_v_ret);
   __Pyx_GIVEREF(__pyx_v_ret);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_ret);
   __Pyx_INCREF(__pyx_v_doc);
   __Pyx_GIVEREF(__pyx_v_doc);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_doc);
   __pyx_r = __pyx_t_7;
   __pyx_t_7 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":550
+  /* "plumed.pyx":732
  *     return subprocess.check_output(["plumed","--no-mpi","info","--root"]).decode("utf-8").rstrip()
  * 
  * def _readvimdict(plumedroot=None,kernel=None):             # <<<<<<<<<<<<<<
  *     """Read VIM dictionary given the path to PLUMED root and return (dictionary,doc).
  * 
  */
 
@@ -13248,27 +15590,27 @@
   __Pyx_XDECREF(__pyx_v_opt);
   __Pyx_XDECREF(__pyx_v_plumedroot);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":599
+/* "plumed.pyx":781
  *     return ret,doc
  * 
  * def _create_functions(dictionary,*,doc=None,append_underscores=False):             # <<<<<<<<<<<<<<
  *     """Create functions given dictionary and, optionally, documentation.
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_13_create_functions(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_12_create_functions[] = "Create functions given dictionary and, optionally, documentation.\n\n       Given a dictionary a doc produced with _readvimdict, it returns a dictionary\n       containing the functions corresponding to each action. The functions are stored\n       in string that should be then evaluated with exec. For each action (say, \"RESTRAINT\")\n       we define both a function `def RESTRAINT and a docstring `RESTRAINT.__doc__`.\n       These functions are only using builtins and functions from the _format_tools dictionary.\n    ";
-static PyMethodDef __pyx_mdef_6plumed_13_create_functions = {"_create_functions", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_13_create_functions, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_12_create_functions};
-static PyObject *__pyx_pw_6plumed_13_create_functions(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_15_create_functions(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_14_create_functions[] = "Create functions given dictionary and, optionally, documentation.\n\n       Given a dictionary a doc produced with _readvimdict, it returns a dictionary\n       containing the functions corresponding to each action. The functions are stored\n       in string that should be then evaluated with exec. For each action (say, \"RESTRAINT\")\n       we define both a function `def RESTRAINT and a docstring `RESTRAINT.__doc__`.\n       These functions are only using builtins and functions from the _format_tools dictionary.\n    ";
+static PyMethodDef __pyx_mdef_6plumed_15_create_functions = {"_create_functions", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_15_create_functions, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_14_create_functions};
+static PyObject *__pyx_pw_6plumed_15_create_functions(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_dictionary = 0;
   PyObject *__pyx_v_doc = 0;
   PyObject *__pyx_v_append_underscores = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -13298,41 +15640,41 @@
         Py_ssize_t index;
         for (index = 1; index < 3 && kw_args > 0; index++) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_create_functions") < 0)) __PYX_ERR(0, 599, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_create_functions") < 0)) __PYX_ERR(0, 781, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_dictionary = values[0];
     __pyx_v_doc = values[1];
     __pyx_v_append_underscores = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_create_functions", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 599, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_create_functions", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 781, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._create_functions", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_12_create_functions(__pyx_self, __pyx_v_dictionary, __pyx_v_doc, __pyx_v_append_underscores);
+  __pyx_r = __pyx_pf_6plumed_14_create_functions(__pyx_self, __pyx_v_dictionary, __pyx_v_doc, __pyx_v_append_underscores);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_12_create_functions(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_dictionary, PyObject *__pyx_v_doc, PyObject *__pyx_v_append_underscores) {
+static PyObject *__pyx_pf_6plumed_14_create_functions(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_dictionary, PyObject *__pyx_v_doc, PyObject *__pyx_v_append_underscores) {
   PyObject *__pyx_v_functions = NULL;
   PyObject *__pyx_v_action = NULL;
   PyObject *__pyx_v_fname = NULL;
   PyObject *__pyx_v_string = NULL;
   PyObject *__pyx_v_w = NULL;
   PyObject *__pyx_v_t = NULL;
   PyObject *__pyx_v_x = NULL;
@@ -13352,85 +15694,85 @@
   PyObject *__pyx_t_12 = NULL;
   int __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_create_functions", 0);
 
-  /* "plumed.pyx":608
+  /* "plumed.pyx":790
  *        These functions are only using builtins and functions from the _format_tools dictionary.
  *     """
  *     functions={}             # <<<<<<<<<<<<<<
  *     for action in dictionary:
  *         # skip actions with incorrect name
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 608, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 790, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_functions = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":609
+  /* "plumed.pyx":791
  *     """
  *     functions={}
  *     for action in dictionary:             # <<<<<<<<<<<<<<
  *         # skip actions with incorrect name
  *         if re.match(".*-.*",action):
  */
   if (likely(PyList_CheckExact(__pyx_v_dictionary)) || PyTuple_CheckExact(__pyx_v_dictionary)) {
     __pyx_t_1 = __pyx_v_dictionary; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
     __pyx_t_3 = NULL;
   } else {
-    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_dictionary); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 609, __pyx_L1_error)
+    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_dictionary); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 791, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 609, __pyx_L1_error)
+    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 791, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_3)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 609, __pyx_L1_error)
+        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 791, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 609, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 791, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       } else {
         if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 609, __pyx_L1_error)
+        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 791, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 609, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 791, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       }
     } else {
       __pyx_t_4 = __pyx_t_3(__pyx_t_1);
       if (unlikely(!__pyx_t_4)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 609, __pyx_L1_error)
+          else __PYX_ERR(0, 791, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_4);
     }
     __Pyx_XDECREF_SET(__pyx_v_action, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":611
+    /* "plumed.pyx":793
  *     for action in dictionary:
  *         # skip actions with incorrect name
  *         if re.match(".*-.*",action):             # <<<<<<<<<<<<<<
  *             continue
  *         fname=action
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 611, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 793, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_match); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 611, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_match); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 793, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_5 = NULL;
     __pyx_t_7 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
       if (likely(__pyx_t_5)) {
@@ -13439,242 +15781,242 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_6, function);
         __pyx_t_7 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_6)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_kp_u__39, __pyx_v_action};
-      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 611, __pyx_L1_error)
+      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_kp_u__42, __pyx_v_action};
+      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 793, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_GOTREF(__pyx_t_4);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_kp_u__39, __pyx_v_action};
-      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 611, __pyx_L1_error)
+      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_kp_u__42, __pyx_v_action};
+      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 793, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_GOTREF(__pyx_t_4);
     } else
     #endif
     {
-      __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 611, __pyx_L1_error)
+      __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 793, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       if (__pyx_t_5) {
         __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
       }
-      __Pyx_INCREF(__pyx_kp_u__39);
-      __Pyx_GIVEREF(__pyx_kp_u__39);
-      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_kp_u__39);
+      __Pyx_INCREF(__pyx_kp_u__42);
+      __Pyx_GIVEREF(__pyx_kp_u__42);
+      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_kp_u__42);
       __Pyx_INCREF(__pyx_v_action);
       __Pyx_GIVEREF(__pyx_v_action);
       PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_v_action);
-      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 611, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 793, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 611, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 793, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     if (__pyx_t_9) {
 
-      /* "plumed.pyx":612
+      /* "plumed.pyx":794
  *         # skip actions with incorrect name
  *         if re.match(".*-.*",action):
  *             continue             # <<<<<<<<<<<<<<
  *         fname=action
  *         if append_underscores:
  */
       goto __pyx_L3_continue;
 
-      /* "plumed.pyx":611
+      /* "plumed.pyx":793
  *     for action in dictionary:
  *         # skip actions with incorrect name
  *         if re.match(".*-.*",action):             # <<<<<<<<<<<<<<
  *             continue
  *         fname=action
  */
     }
 
-    /* "plumed.pyx":613
+    /* "plumed.pyx":795
  *         if re.match(".*-.*",action):
  *             continue
  *         fname=action             # <<<<<<<<<<<<<<
  *         if append_underscores:
  *             fname+="__"
  */
     __Pyx_INCREF(__pyx_v_action);
     __Pyx_XDECREF_SET(__pyx_v_fname, __pyx_v_action);
 
-    /* "plumed.pyx":614
+    /* "plumed.pyx":796
  *             continue
  *         fname=action
  *         if append_underscores:             # <<<<<<<<<<<<<<
  *             fname+="__"
  *         string=""
  */
-    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_append_underscores); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 614, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_append_underscores); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 796, __pyx_L1_error)
     if (__pyx_t_9) {
 
-      /* "plumed.pyx":615
+      /* "plumed.pyx":797
  *         fname=action
  *         if append_underscores:
  *             fname+="__"             # <<<<<<<<<<<<<<
  *         string=""
  *         string+="def " + fname
  */
-      __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_fname, __pyx_n_u__40); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 615, __pyx_L1_error)
+      __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_fname, __pyx_n_u__43); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 797, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF_SET(__pyx_v_fname, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "plumed.pyx":614
+      /* "plumed.pyx":796
  *             continue
  *         fname=action
  *         if append_underscores:             # <<<<<<<<<<<<<<
  *             fname+="__"
  *         string=""
  */
     }
 
-    /* "plumed.pyx":616
+    /* "plumed.pyx":798
  *         if append_underscores:
  *             fname+="__"
  *         string=""             # <<<<<<<<<<<<<<
  *         string+="def " + fname
  *         string+="(self,LABEL=\"\",verbatim=None"
  */
-    __Pyx_INCREF(__pyx_kp_u__32);
-    __Pyx_XDECREF_SET(__pyx_v_string, __pyx_kp_u__32);
+    __Pyx_INCREF(__pyx_kp_u__35);
+    __Pyx_XDECREF_SET(__pyx_v_string, __pyx_kp_u__35);
 
-    /* "plumed.pyx":617
+    /* "plumed.pyx":799
  *             fname+="__"
  *         string=""
  *         string+="def " + fname             # <<<<<<<<<<<<<<
  *         string+="(self,LABEL=\"\",verbatim=None"
  *         if len(dictionary[action])>0:
  */
-    __pyx_t_4 = PyNumber_Add(__pyx_kp_u_def, __pyx_v_fname); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 617, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_kp_u_def, __pyx_v_fname); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 799, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_6 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 617, __pyx_L1_error)
+    __pyx_t_6 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 799, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_6);
     __pyx_t_6 = 0;
 
-    /* "plumed.pyx":618
+    /* "plumed.pyx":800
  *         string=""
  *         string+="def " + fname
  *         string+="(self,LABEL=\"\",verbatim=None"             # <<<<<<<<<<<<<<
  *         if len(dictionary[action])>0:
  *             string+=",*"
  */
-    __pyx_t_6 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_self_LABEL_verbatim_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 618, __pyx_L1_error)
+    __pyx_t_6 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_self_LABEL_verbatim_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 800, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_6);
     __pyx_t_6 = 0;
 
-    /* "plumed.pyx":619
+    /* "plumed.pyx":801
  *         string+="def " + fname
  *         string+="(self,LABEL=\"\",verbatim=None"
  *         if len(dictionary[action])>0:             # <<<<<<<<<<<<<<
  *             string+=",*"
  *         for w in dictionary[action]:
  */
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 619, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 801, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_10 = PyObject_Length(__pyx_t_6); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 619, __pyx_L1_error)
+    __pyx_t_10 = PyObject_Length(__pyx_t_6); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 801, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_t_9 = ((__pyx_t_10 > 0) != 0);
     if (__pyx_t_9) {
 
-      /* "plumed.pyx":620
+      /* "plumed.pyx":802
  *         string+="(self,LABEL=\"\",verbatim=None"
  *         if len(dictionary[action])>0:
  *             string+=",*"             # <<<<<<<<<<<<<<
  *         for w in dictionary[action]:
  *             # skip arguments with incorrect name
  */
-      __pyx_t_6 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u__41); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 620, __pyx_L1_error)
+      __pyx_t_6 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u__44); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 802, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "plumed.pyx":619
+      /* "plumed.pyx":801
  *         string+="def " + fname
  *         string+="(self,LABEL=\"\",verbatim=None"
  *         if len(dictionary[action])>0:             # <<<<<<<<<<<<<<
  *             string+=",*"
  *         for w in dictionary[action]:
  */
     }
 
-    /* "plumed.pyx":621
+    /* "plumed.pyx":803
  *         if len(dictionary[action])>0:
  *             string+=",*"
  *         for w in dictionary[action]:             # <<<<<<<<<<<<<<
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):
  */
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 621, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 803, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     if (likely(PyList_CheckExact(__pyx_t_6)) || PyTuple_CheckExact(__pyx_t_6)) {
       __pyx_t_4 = __pyx_t_6; __Pyx_INCREF(__pyx_t_4); __pyx_t_10 = 0;
       __pyx_t_11 = NULL;
     } else {
-      __pyx_t_10 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 621, __pyx_L1_error)
+      __pyx_t_10 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 803, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_11 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 621, __pyx_L1_error)
+      __pyx_t_11 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 803, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     for (;;) {
       if (likely(!__pyx_t_11)) {
         if (likely(PyList_CheckExact(__pyx_t_4))) {
           if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 621, __pyx_L1_error)
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 803, __pyx_L1_error)
           #else
-          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 621, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 803, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
         } else {
           if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 621, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 803, __pyx_L1_error)
           #else
-          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 621, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 803, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
         }
       } else {
         __pyx_t_6 = __pyx_t_11(__pyx_t_4);
         if (unlikely(!__pyx_t_6)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 621, __pyx_L1_error)
+            else __PYX_ERR(0, 803, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_6);
       }
       __Pyx_XDECREF_SET(__pyx_v_w, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "plumed.pyx":623
+      /* "plumed.pyx":805
  *         for w in dictionary[action]:
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):             # <<<<<<<<<<<<<<
  *                 continue
  *             if dictionary[action][w]=="(flag)" :
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_re); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 623, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_re); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 805, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 623, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 805, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __pyx_t_8 = NULL;
       __pyx_t_7 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
         __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
         if (likely(__pyx_t_8)) {
@@ -13683,271 +16025,271 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_5, function);
           __pyx_t_7 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_5)) {
-        PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_kp_u__39, __pyx_v_w};
-        __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 623, __pyx_L1_error)
+        PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_kp_u__42, __pyx_v_w};
+        __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 805, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_GOTREF(__pyx_t_6);
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
-        PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_kp_u__39, __pyx_v_w};
-        __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 623, __pyx_L1_error)
+        PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_kp_u__42, __pyx_v_w};
+        __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 805, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_GOTREF(__pyx_t_6);
       } else
       #endif
       {
-        __pyx_t_12 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 623, __pyx_L1_error)
+        __pyx_t_12 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 805, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         if (__pyx_t_8) {
           __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_8); __pyx_t_8 = NULL;
         }
-        __Pyx_INCREF(__pyx_kp_u__39);
-        __Pyx_GIVEREF(__pyx_kp_u__39);
-        PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_7, __pyx_kp_u__39);
+        __Pyx_INCREF(__pyx_kp_u__42);
+        __Pyx_GIVEREF(__pyx_kp_u__42);
+        PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_7, __pyx_kp_u__42);
         __Pyx_INCREF(__pyx_v_w);
         __Pyx_GIVEREF(__pyx_v_w);
         PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_7, __pyx_v_w);
-        __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 623, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 805, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 623, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 805, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_9) {
 
-        /* "plumed.pyx":624
+        /* "plumed.pyx":806
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):
  *                 continue             # <<<<<<<<<<<<<<
  *             if dictionary[action][w]=="(flag)" :
  *                 string+="," + w + "=False"
  */
         goto __pyx_L8_continue;
 
-        /* "plumed.pyx":623
+        /* "plumed.pyx":805
  *         for w in dictionary[action]:
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):             # <<<<<<<<<<<<<<
  *                 continue
  *             if dictionary[action][w]=="(flag)" :
  */
       }
 
-      /* "plumed.pyx":625
+      /* "plumed.pyx":807
  *             if re.match(".*-.*",w):
  *                 continue
  *             if dictionary[action][w]=="(flag)" :             # <<<<<<<<<<<<<<
  *                 string+="," + w + "=False"
  *             else:
  */
-      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 625, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 807, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_w); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 625, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_w); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 807, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_t_5, __pyx_kp_u_flag, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 625, __pyx_L1_error)
+      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_t_5, __pyx_kp_u_flag, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 807, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_9) {
 
-        /* "plumed.pyx":626
+        /* "plumed.pyx":808
  *                 continue
  *             if dictionary[action][w]=="(flag)" :
  *                 string+="," + w + "=False"             # <<<<<<<<<<<<<<
  *             else:
  *                 string+="," + w + "=None"
  */
-        __pyx_t_5 = PyNumber_Add(__pyx_kp_u__42, __pyx_v_w); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 626, __pyx_L1_error)
+        __pyx_t_5 = PyNumber_Add(__pyx_kp_u__45, __pyx_v_w); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 808, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_6 = PyNumber_Add(__pyx_t_5, __pyx_kp_u_False); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 626, __pyx_L1_error)
+        __pyx_t_6 = PyNumber_Add(__pyx_t_5, __pyx_kp_u_False); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 808, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 626, __pyx_L1_error)
+        __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 808, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_5);
         __pyx_t_5 = 0;
 
-        /* "plumed.pyx":625
+        /* "plumed.pyx":807
  *             if re.match(".*-.*",w):
  *                 continue
  *             if dictionary[action][w]=="(flag)" :             # <<<<<<<<<<<<<<
  *                 string+="," + w + "=False"
  *             else:
  */
         goto __pyx_L11;
       }
 
-      /* "plumed.pyx":628
+      /* "plumed.pyx":810
  *                 string+="," + w + "=False"
  *             else:
  *                 string+="," + w + "=None"             # <<<<<<<<<<<<<<
  *         string+=",**kwargs):\n"
  *         string+="  ret=\"\"\n"
  */
       /*else*/ {
-        __pyx_t_5 = PyNumber_Add(__pyx_kp_u__42, __pyx_v_w); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 628, __pyx_L1_error)
+        __pyx_t_5 = PyNumber_Add(__pyx_kp_u__45, __pyx_v_w); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 810, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_6 = PyNumber_Add(__pyx_t_5, __pyx_kp_u_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 628, __pyx_L1_error)
+        __pyx_t_6 = PyNumber_Add(__pyx_t_5, __pyx_kp_u_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 810, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 628, __pyx_L1_error)
+        __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 810, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_5);
         __pyx_t_5 = 0;
       }
       __pyx_L11:;
 
-      /* "plumed.pyx":621
+      /* "plumed.pyx":803
  *         if len(dictionary[action])>0:
  *             string+=",*"
  *         for w in dictionary[action]:             # <<<<<<<<<<<<<<
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):
  */
       __pyx_L8_continue:;
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "plumed.pyx":629
+    /* "plumed.pyx":811
  *             else:
  *                 string+="," + w + "=None"
  *         string+=",**kwargs):\n"             # <<<<<<<<<<<<<<
  *         string+="  ret=\"\"\n"
  *         string+="  ret+=_format_label(self,LABEL)\n"
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_kwargs); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 629, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_kwargs); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 811, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":630
+    /* "plumed.pyx":812
  *                 string+="," + w + "=None"
  *         string+=",**kwargs):\n"
  *         string+="  ret=\"\"\n"             # <<<<<<<<<<<<<<
  *         string+="  ret+=_format_label(self,LABEL)\n"
  *         string+="  ret+=\"" + action + "\"\n"
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_ret); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 630, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_ret); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 812, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":631
+    /* "plumed.pyx":813
  *         string+=",**kwargs):\n"
  *         string+="  ret=\"\"\n"
  *         string+="  ret+=_format_label(self,LABEL)\n"             # <<<<<<<<<<<<<<
  *         string+="  ret+=\"" + action + "\"\n"
  *         string+="  retlist=[]\n"
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_ret__format_label_self_LABEL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 631, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_ret__format_label_self_LABEL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 813, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":632
+    /* "plumed.pyx":814
  *         string+="  ret=\"\"\n"
  *         string+="  ret+=_format_label(self,LABEL)\n"
  *         string+="  ret+=\"" + action + "\"\n"             # <<<<<<<<<<<<<<
  *         string+="  retlist=[]\n"
  *         for w in dictionary[action]:
  */
-    __pyx_t_4 = PyNumber_Add(__pyx_kp_u_ret_2, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 632, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_kp_u_ret_2, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 814, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyNumber_Add(__pyx_t_4, __pyx_kp_u__43); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 632, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_t_4, __pyx_kp_u__46); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 814, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 632, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 814, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":633
+    /* "plumed.pyx":815
  *         string+="  ret+=_format_label(self,LABEL)\n"
  *         string+="  ret+=\"" + action + "\"\n"
  *         string+="  retlist=[]\n"             # <<<<<<<<<<<<<<
  *         for w in dictionary[action]:
  *             # skip arguments with incorrect name
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_retlist); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 633, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_retlist); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 815, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":634
+    /* "plumed.pyx":816
  *         string+="  ret+=\"" + action + "\"\n"
  *         string+="  retlist=[]\n"
  *         for w in dictionary[action]:             # <<<<<<<<<<<<<<
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):
  */
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 634, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 816, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
       __pyx_t_5 = __pyx_t_4; __Pyx_INCREF(__pyx_t_5); __pyx_t_10 = 0;
       __pyx_t_11 = NULL;
     } else {
-      __pyx_t_10 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 634, __pyx_L1_error)
+      __pyx_t_10 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 816, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_11 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 634, __pyx_L1_error)
+      __pyx_t_11 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 816, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     for (;;) {
       if (likely(!__pyx_t_11)) {
         if (likely(PyList_CheckExact(__pyx_t_5))) {
           if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_4); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 634, __pyx_L1_error)
+          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_4); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 816, __pyx_L1_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 634, __pyx_L1_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 816, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         } else {
           if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_4); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 634, __pyx_L1_error)
+          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_4); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 816, __pyx_L1_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 634, __pyx_L1_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 816, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         }
       } else {
         __pyx_t_4 = __pyx_t_11(__pyx_t_5);
         if (unlikely(!__pyx_t_4)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 634, __pyx_L1_error)
+            else __PYX_ERR(0, 816, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_4);
       }
       __Pyx_XDECREF_SET(__pyx_v_w, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "plumed.pyx":636
+      /* "plumed.pyx":818
  *         for w in dictionary[action]:
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):             # <<<<<<<<<<<<<<
  *                 continue
  *             t=dictionary[action][w]
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_re); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 636, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_re); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 818, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_match); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 636, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_match); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 818, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_6 = NULL;
       __pyx_t_7 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_12))) {
         __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_12);
         if (likely(__pyx_t_6)) {
@@ -13956,563 +16298,563 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_12, function);
           __pyx_t_7 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_12)) {
-        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__39, __pyx_v_w};
-        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 636, __pyx_L1_error)
+        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__42, __pyx_v_w};
+        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 818, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_GOTREF(__pyx_t_4);
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_12)) {
-        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__39, __pyx_v_w};
-        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 636, __pyx_L1_error)
+        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__42, __pyx_v_w};
+        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 818, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_GOTREF(__pyx_t_4);
       } else
       #endif
       {
-        __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 636, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 818, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         if (__pyx_t_6) {
           __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
         }
-        __Pyx_INCREF(__pyx_kp_u__39);
-        __Pyx_GIVEREF(__pyx_kp_u__39);
-        PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_kp_u__39);
+        __Pyx_INCREF(__pyx_kp_u__42);
+        __Pyx_GIVEREF(__pyx_kp_u__42);
+        PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_kp_u__42);
         __Pyx_INCREF(__pyx_v_w);
         __Pyx_GIVEREF(__pyx_v_w);
         PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_v_w);
-        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 636, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 818, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       }
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 636, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 818, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       if (__pyx_t_9) {
 
-        /* "plumed.pyx":637
+        /* "plumed.pyx":819
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):
  *                 continue             # <<<<<<<<<<<<<<
  *             t=dictionary[action][w]
  *             if t=="(flag)" :
  */
         goto __pyx_L12_continue;
 
-        /* "plumed.pyx":636
+        /* "plumed.pyx":818
  *         for w in dictionary[action]:
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):             # <<<<<<<<<<<<<<
  *                 continue
  *             t=dictionary[action][w]
  */
       }
 
-      /* "plumed.pyx":638
+      /* "plumed.pyx":820
  *             if re.match(".*-.*",w):
  *                 continue
  *             t=dictionary[action][w]             # <<<<<<<<<<<<<<
  *             if t=="(flag)" :
  *                 string+="  retlist.append(_format_flag(self,\"" + w + "\"," + w + "))\n"
  */
-      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 638, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 820, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 638, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 820, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_XDECREF_SET(__pyx_v_t, __pyx_t_12);
       __pyx_t_12 = 0;
 
-      /* "plumed.pyx":639
+      /* "plumed.pyx":821
  *                 continue
  *             t=dictionary[action][w]
  *             if t=="(flag)" :             # <<<<<<<<<<<<<<
  *                 string+="  retlist.append(_format_flag(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(option)" :
  */
-      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_t, __pyx_kp_u_flag, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 639, __pyx_L1_error)
+      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_t, __pyx_kp_u_flag, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 821, __pyx_L1_error)
       if (__pyx_t_9) {
 
-        /* "plumed.pyx":640
+        /* "plumed.pyx":822
  *             t=dictionary[action][w]
  *             if t=="(flag)" :
  *                 string+="  retlist.append(_format_flag(self,\"" + w + "\"," + w + "))\n"             # <<<<<<<<<<<<<<
  *             elif t=="(option)" :
  *                 string+="  retlist.append(_format_opt(self,\"" + w + "\"," + w + "))\n"
  */
-        __pyx_t_12 = PyNumber_Add(__pyx_kp_u_retlist_append__format_flag_sel, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 640, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_Add(__pyx_kp_u_retlist_append__format_flag_sel, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 822, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
-        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__44); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 640, __pyx_L1_error)
+        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__47); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 822, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = PyNumber_Add(__pyx_t_4, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 640, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_Add(__pyx_t_4, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 822, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__45); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 640, __pyx_L1_error)
+        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__48); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 822, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 640, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 822, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_12);
         __pyx_t_12 = 0;
 
-        /* "plumed.pyx":639
+        /* "plumed.pyx":821
  *                 continue
  *             t=dictionary[action][w]
  *             if t=="(flag)" :             # <<<<<<<<<<<<<<
  *                 string+="  retlist.append(_format_flag(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(option)" :
  */
         goto __pyx_L15;
       }
 
-      /* "plumed.pyx":641
+      /* "plumed.pyx":823
  *             if t=="(flag)" :
  *                 string+="  retlist.append(_format_flag(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(option)" :             # <<<<<<<<<<<<<<
  *                 string+="  retlist.append(_format_opt(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(numbered)":
  */
-      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_t, __pyx_kp_u_option, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 641, __pyx_L1_error)
+      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_t, __pyx_kp_u_option, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 823, __pyx_L1_error)
       if (__pyx_t_9) {
 
-        /* "plumed.pyx":642
+        /* "plumed.pyx":824
  *                 string+="  retlist.append(_format_flag(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(option)" :
  *                 string+="  retlist.append(_format_opt(self,\"" + w + "\"," + w + "))\n"             # <<<<<<<<<<<<<<
  *             elif t=="(numbered)":
  *                 string+="  retlist.append(_format_numbered(self,\"" + w + "\"," + w + "))\n"
  */
-        __pyx_t_12 = PyNumber_Add(__pyx_kp_u_retlist_append__format_opt_self, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 642, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_Add(__pyx_kp_u_retlist_append__format_opt_self, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 824, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
-        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__44); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
+        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__47); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 824, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = PyNumber_Add(__pyx_t_4, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 642, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_Add(__pyx_t_4, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 824, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__45); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
+        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__48); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 824, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 642, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 824, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_12);
         __pyx_t_12 = 0;
 
-        /* "plumed.pyx":641
+        /* "plumed.pyx":823
  *             if t=="(flag)" :
  *                 string+="  retlist.append(_format_flag(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(option)" :             # <<<<<<<<<<<<<<
  *                 string+="  retlist.append(_format_opt(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(numbered)":
  */
         goto __pyx_L15;
       }
 
-      /* "plumed.pyx":643
+      /* "plumed.pyx":825
  *             elif t=="(option)" :
  *                 string+="  retlist.append(_format_opt(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(numbered)":             # <<<<<<<<<<<<<<
  *                 string+="  retlist.append(_format_numbered(self,\"" + w + "\"," + w + "))\n"
  *             else:
  */
-      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_t, __pyx_kp_u_numbered, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 643, __pyx_L1_error)
+      __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_t, __pyx_kp_u_numbered, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 825, __pyx_L1_error)
       if (likely(__pyx_t_9)) {
 
-        /* "plumed.pyx":644
+        /* "plumed.pyx":826
  *                 string+="  retlist.append(_format_opt(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(numbered)":
  *                 string+="  retlist.append(_format_numbered(self,\"" + w + "\"," + w + "))\n"             # <<<<<<<<<<<<<<
  *             else:
  *                 raise TypeError("error parsing dictionary, unknown type "+t)
  */
-        __pyx_t_12 = PyNumber_Add(__pyx_kp_u_retlist_append__format_numbered, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 644, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_Add(__pyx_kp_u_retlist_append__format_numbered, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 826, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
-        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__44); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 644, __pyx_L1_error)
+        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__47); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 826, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = PyNumber_Add(__pyx_t_4, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 644, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_Add(__pyx_t_4, __pyx_v_w); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 826, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__45); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 644, __pyx_L1_error)
+        __pyx_t_4 = PyNumber_Add(__pyx_t_12, __pyx_kp_u__48); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 826, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 644, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 826, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_12);
         __pyx_t_12 = 0;
 
-        /* "plumed.pyx":643
+        /* "plumed.pyx":825
  *             elif t=="(option)" :
  *                 string+="  retlist.append(_format_opt(self,\"" + w + "\"," + w + "))\n"
  *             elif t=="(numbered)":             # <<<<<<<<<<<<<<
  *                 string+="  retlist.append(_format_numbered(self,\"" + w + "\"," + w + "))\n"
  *             else:
  */
         goto __pyx_L15;
       }
 
-      /* "plumed.pyx":646
+      /* "plumed.pyx":828
  *                 string+="  retlist.append(_format_numbered(self,\"" + w + "\"," + w + "))\n"
  *             else:
  *                 raise TypeError("error parsing dictionary, unknown type "+t)             # <<<<<<<<<<<<<<
  * # now process kwargs to allow numbered arguments
  *         string+="  for arg in kwargs:\n"
  */
       /*else*/ {
-        __pyx_t_12 = PyNumber_Add(__pyx_kp_u_error_parsing_dictionary_unknown, __pyx_v_t); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 646, __pyx_L1_error)
+        __pyx_t_12 = PyNumber_Add(__pyx_kp_u_error_parsing_dictionary_unknown, __pyx_v_t); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 828, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
-        __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_12); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 646, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_12); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 828, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
         __Pyx_Raise(__pyx_t_4, 0, 0, 0);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __PYX_ERR(0, 646, __pyx_L1_error)
+        __PYX_ERR(0, 828, __pyx_L1_error)
       }
       __pyx_L15:;
 
-      /* "plumed.pyx":634
+      /* "plumed.pyx":816
  *         string+="  ret+=\"" + action + "\"\n"
  *         string+="  retlist=[]\n"
  *         for w in dictionary[action]:             # <<<<<<<<<<<<<<
  *             # skip arguments with incorrect name
  *             if re.match(".*-.*",w):
  */
       __pyx_L12_continue:;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "plumed.pyx":648
+    /* "plumed.pyx":830
  *                 raise TypeError("error parsing dictionary, unknown type "+t)
  * # now process kwargs to allow numbered arguments
  *         string+="  for arg in kwargs:\n"             # <<<<<<<<<<<<<<
  *         string+="      import re\n"
  *         string+="      allowed=[]\n"
  */
-    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_for_arg_in_kwargs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 648, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_for_arg_in_kwargs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 830, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "plumed.pyx":649
+    /* "plumed.pyx":831
  * # now process kwargs to allow numbered arguments
  *         string+="  for arg in kwargs:\n"
  *         string+="      import re\n"             # <<<<<<<<<<<<<<
  *         string+="      allowed=[]\n"
  *         for x in dictionary[action]:
  */
-    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_import_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 649, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_import_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 831, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "plumed.pyx":650
+    /* "plumed.pyx":832
  *         string+="  for arg in kwargs:\n"
  *         string+="      import re\n"
  *         string+="      allowed=[]\n"             # <<<<<<<<<<<<<<
  *         for x in dictionary[action]:
  *           string+="      allowed.append(\"" + x + "\")\n"
  */
-    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_allowed); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 650, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_allowed); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 832, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "plumed.pyx":651
+    /* "plumed.pyx":833
  *         string+="      import re\n"
  *         string+="      allowed=[]\n"
  *         for x in dictionary[action]:             # <<<<<<<<<<<<<<
  *           string+="      allowed.append(\"" + x + "\")\n"
  *         string+="      if not re.sub(\"[0-9]*$\",\"\",arg) in allowed:\n"
  */
-    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 651, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_dictionary, __pyx_v_action); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 833, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
       __pyx_t_4 = __pyx_t_5; __Pyx_INCREF(__pyx_t_4); __pyx_t_10 = 0;
       __pyx_t_11 = NULL;
     } else {
-      __pyx_t_10 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 651, __pyx_L1_error)
+      __pyx_t_10 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 833, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_11 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 651, __pyx_L1_error)
+      __pyx_t_11 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 833, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     for (;;) {
       if (likely(!__pyx_t_11)) {
         if (likely(PyList_CheckExact(__pyx_t_4))) {
           if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_5); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 651, __pyx_L1_error)
+          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_5); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 833, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 651, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 833, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         } else {
           if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_5); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 651, __pyx_L1_error)
+          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_5); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 833, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 651, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 833, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         }
       } else {
         __pyx_t_5 = __pyx_t_11(__pyx_t_4);
         if (unlikely(!__pyx_t_5)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 651, __pyx_L1_error)
+            else __PYX_ERR(0, 833, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_5);
       }
       __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_5);
       __pyx_t_5 = 0;
 
-      /* "plumed.pyx":652
+      /* "plumed.pyx":834
  *         string+="      allowed=[]\n"
  *         for x in dictionary[action]:
  *           string+="      allowed.append(\"" + x + "\")\n"             # <<<<<<<<<<<<<<
  *         string+="      if not re.sub(\"[0-9]*$\",\"\",arg) in allowed:\n"
  *         string+="         raise TypeError(\"unknown arg \" + arg)\n"
  */
-      __pyx_t_5 = PyNumber_Add(__pyx_kp_u_allowed_append, __pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 652, __pyx_L1_error)
+      __pyx_t_5 = PyNumber_Add(__pyx_kp_u_allowed_append, __pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 834, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_12 = PyNumber_Add(__pyx_t_5, __pyx_kp_u__46); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 652, __pyx_L1_error)
+      __pyx_t_12 = PyNumber_Add(__pyx_t_5, __pyx_kp_u__49); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 834, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_12); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 652, __pyx_L1_error)
+      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_12); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 834, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_5);
       __pyx_t_5 = 0;
 
-      /* "plumed.pyx":651
+      /* "plumed.pyx":833
  *         string+="      import re\n"
  *         string+="      allowed=[]\n"
  *         for x in dictionary[action]:             # <<<<<<<<<<<<<<
  *           string+="      allowed.append(\"" + x + "\")\n"
  *         string+="      if not re.sub(\"[0-9]*$\",\"\",arg) in allowed:\n"
  */
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "plumed.pyx":653
+    /* "plumed.pyx":835
  *         for x in dictionary[action]:
  *           string+="      allowed.append(\"" + x + "\")\n"
  *         string+="      if not re.sub(\"[0-9]*$\",\"\",arg) in allowed:\n"             # <<<<<<<<<<<<<<
  *         string+="         raise TypeError(\"unknown arg \" + arg)\n"
  *         string+="      retlist.append(_format_anything(self,arg,kwargs[arg]))\n"
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_if_not_re_sub_0_9_arg_in_allowe); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 653, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_if_not_re_sub_0_9_arg_in_allowe); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 835, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":654
+    /* "plumed.pyx":836
  *           string+="      allowed.append(\"" + x + "\")\n"
  *         string+="      if not re.sub(\"[0-9]*$\",\"\",arg) in allowed:\n"
  *         string+="         raise TypeError(\"unknown arg \" + arg)\n"             # <<<<<<<<<<<<<<
  *         string+="      retlist.append(_format_anything(self,arg,kwargs[arg]))\n"
  * # sorting is necessary to make the line reproducible in regtests
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_raise_TypeError_unknown_arg_arg); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 654, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_raise_TypeError_unknown_arg_arg); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 836, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":655
+    /* "plumed.pyx":837
  *         string+="      if not re.sub(\"[0-9]*$\",\"\",arg) in allowed:\n"
  *         string+="         raise TypeError(\"unknown arg \" + arg)\n"
  *         string+="      retlist.append(_format_anything(self,arg,kwargs[arg]))\n"             # <<<<<<<<<<<<<<
  * # sorting is necessary to make the line reproducible in regtests
  *         string+="  retlist.sort()\n"
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_retlist_append__format_anything); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 655, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_retlist_append__format_anything); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 837, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":657
+    /* "plumed.pyx":839
  *         string+="      retlist.append(_format_anything(self,arg,kwargs[arg]))\n"
  * # sorting is necessary to make the line reproducible in regtests
  *         string+="  retlist.sort()\n"             # <<<<<<<<<<<<<<
  *         string+="  for x in retlist:\n"
  *         string+="      if(len(x)>0):\n"
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_retlist_sort); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 657, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_retlist_sort); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 839, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":658
+    /* "plumed.pyx":840
  * # sorting is necessary to make the line reproducible in regtests
  *         string+="  retlist.sort()\n"
  *         string+="  for x in retlist:\n"             # <<<<<<<<<<<<<<
  *         string+="      if(len(x)>0):\n"
  *         string+="          ret+=x\n"
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_for_x_in_retlist); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 658, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_for_x_in_retlist); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 840, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":659
+    /* "plumed.pyx":841
  *         string+="  retlist.sort()\n"
  *         string+="  for x in retlist:\n"
  *         string+="      if(len(x)>0):\n"             # <<<<<<<<<<<<<<
  *         string+="          ret+=x\n"
  *         string+="  ret+=_format_verbatim(self,verbatim)\n"
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_if_len_x_0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 659, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_if_len_x_0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 841, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":660
+    /* "plumed.pyx":842
  *         string+="  for x in retlist:\n"
  *         string+="      if(len(x)>0):\n"
  *         string+="          ret+=x\n"             # <<<<<<<<<<<<<<
  *         string+="  ret+=_format_verbatim(self,verbatim)\n"
  *         string+="  return _format_return(self,ret)\n"
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_ret_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 660, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_ret_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 842, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":661
+    /* "plumed.pyx":843
  *         string+="      if(len(x)>0):\n"
  *         string+="          ret+=x\n"
  *         string+="  ret+=_format_verbatim(self,verbatim)\n"             # <<<<<<<<<<<<<<
  *         string+="  return _format_return(self,ret)\n"
  * # set docstring
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_ret__format_verbatim_self_verba); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 661, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_ret__format_verbatim_self_verba); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 843, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":662
+    /* "plumed.pyx":844
  *         string+="          ret+=x\n"
  *         string+="  ret+=_format_verbatim(self,verbatim)\n"
  *         string+="  return _format_return(self,ret)\n"             # <<<<<<<<<<<<<<
  * # set docstring
  *         if doc is not None:
  */
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_return__format_return_self_ret); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 662, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u_return__format_return_self_ret); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 844, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":664
+    /* "plumed.pyx":846
  *         string+="  return _format_return(self,ret)\n"
  * # set docstring
  *         if doc is not None:             # <<<<<<<<<<<<<<
  *            string+=fname + ".__doc__ = \"\"\"\n"
  *            string+=doc[action]
  */
     __pyx_t_9 = (__pyx_v_doc != Py_None);
     __pyx_t_13 = (__pyx_t_9 != 0);
     if (__pyx_t_13) {
 
-      /* "plumed.pyx":665
+      /* "plumed.pyx":847
  * # set docstring
  *         if doc is not None:
  *            string+=fname + ".__doc__ = \"\"\"\n"             # <<<<<<<<<<<<<<
  *            string+=doc[action]
  *            string+="\"\"\"\n"
  */
-      __pyx_t_4 = PyNumber_Add(__pyx_v_fname, __pyx_kp_u_doc_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 665, __pyx_L1_error)
+      __pyx_t_4 = PyNumber_Add(__pyx_v_fname, __pyx_kp_u_doc_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 847, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 665, __pyx_L1_error)
+      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 847, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_5);
       __pyx_t_5 = 0;
 
-      /* "plumed.pyx":666
+      /* "plumed.pyx":848
  *         if doc is not None:
  *            string+=fname + ".__doc__ = \"\"\"\n"
  *            string+=doc[action]             # <<<<<<<<<<<<<<
  *            string+="\"\"\"\n"
  *         functions[fname]=string
  */
-      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_doc, __pyx_v_action); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 666, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_doc, __pyx_v_action); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 848, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 666, __pyx_L1_error)
+      __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 848, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "plumed.pyx":667
+      /* "plumed.pyx":849
  *            string+=fname + ".__doc__ = \"\"\"\n"
  *            string+=doc[action]
  *            string+="\"\"\"\n"             # <<<<<<<<<<<<<<
  *         functions[fname]=string
  *     return functions
  */
-      __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u__47); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 667, __pyx_L1_error)
+      __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_kp_u__50); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 849, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "plumed.pyx":664
+      /* "plumed.pyx":846
  *         string+="  return _format_return(self,ret)\n"
  * # set docstring
  *         if doc is not None:             # <<<<<<<<<<<<<<
  *            string+=fname + ".__doc__ = \"\"\"\n"
  *            string+=doc[action]
  */
     }
 
-    /* "plumed.pyx":668
+    /* "plumed.pyx":850
  *            string+=doc[action]
  *            string+="\"\"\"\n"
  *         functions[fname]=string             # <<<<<<<<<<<<<<
  *     return functions
  * 
  */
-    if (unlikely(PyDict_SetItem(__pyx_v_functions, __pyx_v_fname, __pyx_v_string) < 0)) __PYX_ERR(0, 668, __pyx_L1_error)
+    if (unlikely(PyDict_SetItem(__pyx_v_functions, __pyx_v_fname, __pyx_v_string) < 0)) __PYX_ERR(0, 850, __pyx_L1_error)
 
-    /* "plumed.pyx":609
+    /* "plumed.pyx":791
  *     """
  *     functions={}
  *     for action in dictionary:             # <<<<<<<<<<<<<<
  *         # skip actions with incorrect name
  *         if re.match(".*-.*",action):
  */
     __pyx_L3_continue:;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":669
+  /* "plumed.pyx":851
  *            string+="\"\"\"\n"
  *         functions[fname]=string
  *     return functions             # <<<<<<<<<<<<<<
  * 
  * # formatting tools
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_functions);
   __pyx_r = __pyx_v_functions;
   goto __pyx_L0;
 
-  /* "plumed.pyx":599
+  /* "plumed.pyx":781
  *     return ret,doc
  * 
  * def _create_functions(dictionary,*,doc=None,append_underscores=False):             # <<<<<<<<<<<<<<
  *     """Create functions given dictionary and, optionally, documentation.
  * 
  */
 
@@ -14535,15 +16877,15 @@
   __Pyx_XDECREF(__pyx_v_t);
   __Pyx_XDECREF(__pyx_v_x);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":674
+/* "plumed.pyx":856
  * 
  * class _numbered():
  *     def __init__(self,*args):             # <<<<<<<<<<<<<<
  * # this is experimental:
  * # it allows calling _numbered(arg1,arg2,arg3)
  */
 
@@ -14585,26 +16927,26 @@
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t used_pos_args = (pos_args < 1) ? pos_args : 1;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, used_pos_args, "__init__") < 0)) __PYX_ERR(0, 674, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, used_pos_args, "__init__") < 0)) __PYX_ERR(0, 856, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) < 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_self = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 674, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 856, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_DECREF(__pyx_v_args); __pyx_v_args = 0;
   __Pyx_AddTraceback("plumed._numbered.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_9_numbered___init__(__pyx_self, __pyx_v_self, __pyx_v_args);
@@ -14627,298 +16969,298 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *(*__pyx_t_6)(PyObject *);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "plumed.pyx":678
+  /* "plumed.pyx":860
  * # it allows calling _numbered(arg1,arg2,arg3)
  * # it is however on purpose not implemented in the numbered() method below
  *         if(len(args)==1):             # <<<<<<<<<<<<<<
  *             if isinstance(args[0],dict):
  *                 self.arg=args[0]
  */
-  __pyx_t_1 = PyTuple_GET_SIZE(__pyx_v_args); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 678, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_GET_SIZE(__pyx_v_args); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 860, __pyx_L1_error)
   __pyx_t_2 = ((__pyx_t_1 == 1) != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":679
+    /* "plumed.pyx":861
  * # it is however on purpose not implemented in the numbered() method below
  *         if(len(args)==1):
  *             if isinstance(args[0],dict):             # <<<<<<<<<<<<<<
  *                 self.arg=args[0]
  *             elif hasattr(args[0],'__iter__'):
  */
-    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 679, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 861, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_2 = PyDict_Check(__pyx_t_3); 
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_4 = (__pyx_t_2 != 0);
     if (__pyx_t_4) {
 
-      /* "plumed.pyx":680
+      /* "plumed.pyx":862
  *         if(len(args)==1):
  *             if isinstance(args[0],dict):
  *                 self.arg=args[0]             # <<<<<<<<<<<<<<
  *             elif hasattr(args[0],'__iter__'):
  *                 self.arg={}
  */
-      __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 680, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 862, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_t_3) < 0) __PYX_ERR(0, 680, __pyx_L1_error)
+      if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_t_3) < 0) __PYX_ERR(0, 862, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-      /* "plumed.pyx":679
+      /* "plumed.pyx":861
  * # it is however on purpose not implemented in the numbered() method below
  *         if(len(args)==1):
  *             if isinstance(args[0],dict):             # <<<<<<<<<<<<<<
  *                 self.arg=args[0]
  *             elif hasattr(args[0],'__iter__'):
  */
       goto __pyx_L4;
     }
 
-    /* "plumed.pyx":681
+    /* "plumed.pyx":863
  *             if isinstance(args[0],dict):
  *                 self.arg=args[0]
  *             elif hasattr(args[0],'__iter__'):             # <<<<<<<<<<<<<<
  *                 self.arg={}
  *                 i=0
  */
-    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 681, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 863, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_HasAttr(__pyx_t_3, __pyx_n_u_iter); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 681, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_HasAttr(__pyx_t_3, __pyx_n_u_iter); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 863, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_2 = (__pyx_t_4 != 0);
     if (likely(__pyx_t_2)) {
 
-      /* "plumed.pyx":682
+      /* "plumed.pyx":864
  *                 self.arg=args[0]
  *             elif hasattr(args[0],'__iter__'):
  *                 self.arg={}             # <<<<<<<<<<<<<<
  *                 i=0
  *                 for x in args[0]:
  */
-      __pyx_t_3 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 682, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 864, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_t_3) < 0) __PYX_ERR(0, 682, __pyx_L1_error)
+      if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_t_3) < 0) __PYX_ERR(0, 864, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-      /* "plumed.pyx":683
+      /* "plumed.pyx":865
  *             elif hasattr(args[0],'__iter__'):
  *                 self.arg={}
  *                 i=0             # <<<<<<<<<<<<<<
  *                 for x in args[0]:
  *                      self.arg[i]=x
  */
       __Pyx_INCREF(__pyx_int_0);
       __pyx_v_i = __pyx_int_0;
 
-      /* "plumed.pyx":684
+      /* "plumed.pyx":866
  *                 self.arg={}
  *                 i=0
  *                 for x in args[0]:             # <<<<<<<<<<<<<<
  *                      self.arg[i]=x
  *                      i+=1
  */
-      __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 684, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 866, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
         __pyx_t_5 = __pyx_t_3; __Pyx_INCREF(__pyx_t_5); __pyx_t_1 = 0;
         __pyx_t_6 = NULL;
       } else {
-        __pyx_t_1 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 684, __pyx_L1_error)
+        __pyx_t_1 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 866, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_6 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 684, __pyx_L1_error)
+        __pyx_t_6 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 866, __pyx_L1_error)
       }
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       for (;;) {
         if (likely(!__pyx_t_6)) {
           if (likely(PyList_CheckExact(__pyx_t_5))) {
             if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_5)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_3 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_3); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 684, __pyx_L1_error)
+            __pyx_t_3 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_3); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 866, __pyx_L1_error)
             #else
-            __pyx_t_3 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 684, __pyx_L1_error)
+            __pyx_t_3 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 866, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
             #endif
           } else {
             if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_3); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 684, __pyx_L1_error)
+            __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_3); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 866, __pyx_L1_error)
             #else
-            __pyx_t_3 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 684, __pyx_L1_error)
+            __pyx_t_3 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 866, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
             #endif
           }
         } else {
           __pyx_t_3 = __pyx_t_6(__pyx_t_5);
           if (unlikely(!__pyx_t_3)) {
             PyObject* exc_type = PyErr_Occurred();
             if (exc_type) {
               if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-              else __PYX_ERR(0, 684, __pyx_L1_error)
+              else __PYX_ERR(0, 866, __pyx_L1_error)
             }
             break;
           }
           __Pyx_GOTREF(__pyx_t_3);
         }
         __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "plumed.pyx":685
+        /* "plumed.pyx":867
  *                 i=0
  *                 for x in args[0]:
  *                      self.arg[i]=x             # <<<<<<<<<<<<<<
  *                      i+=1
  *             else:
  */
-        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_arg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 685, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_arg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 867, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_i, __pyx_v_x) < 0)) __PYX_ERR(0, 685, __pyx_L1_error)
+        if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_i, __pyx_v_x) < 0)) __PYX_ERR(0, 867, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-        /* "plumed.pyx":686
+        /* "plumed.pyx":868
  *                 for x in args[0]:
  *                      self.arg[i]=x
  *                      i+=1             # <<<<<<<<<<<<<<
  *             else:
  *                 raise TypeError("when calling numbered with 1 argument, it should be a list/tuple/dictionary")
  */
-        __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 686, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 868, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF_SET(__pyx_v_i, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "plumed.pyx":684
+        /* "plumed.pyx":866
  *                 self.arg={}
  *                 i=0
  *                 for x in args[0]:             # <<<<<<<<<<<<<<
  *                      self.arg[i]=x
  *                      i+=1
  */
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-      /* "plumed.pyx":681
+      /* "plumed.pyx":863
  *             if isinstance(args[0],dict):
  *                 self.arg=args[0]
  *             elif hasattr(args[0],'__iter__'):             # <<<<<<<<<<<<<<
  *                 self.arg={}
  *                 i=0
  */
       goto __pyx_L4;
     }
 
-    /* "plumed.pyx":688
+    /* "plumed.pyx":870
  *                      i+=1
  *             else:
  *                 raise TypeError("when calling numbered with 1 argument, it should be a list/tuple/dictionary")             # <<<<<<<<<<<<<<
  *         else:
  *             self.arg={}
  */
     /*else*/ {
-      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__48, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 688, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__51, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 870, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_Raise(__pyx_t_5, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __PYX_ERR(0, 688, __pyx_L1_error)
+      __PYX_ERR(0, 870, __pyx_L1_error)
     }
     __pyx_L4:;
 
-    /* "plumed.pyx":678
+    /* "plumed.pyx":860
  * # it allows calling _numbered(arg1,arg2,arg3)
  * # it is however on purpose not implemented in the numbered() method below
  *         if(len(args)==1):             # <<<<<<<<<<<<<<
  *             if isinstance(args[0],dict):
  *                 self.arg=args[0]
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":690
+  /* "plumed.pyx":872
  *                 raise TypeError("when calling numbered with 1 argument, it should be a list/tuple/dictionary")
  *         else:
  *             self.arg={}             # <<<<<<<<<<<<<<
  *             i=0
  *             for x in args:
  */
   /*else*/ {
-    __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 690, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 872, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_t_5) < 0) __PYX_ERR(0, 690, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_t_5) < 0) __PYX_ERR(0, 872, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "plumed.pyx":691
+    /* "plumed.pyx":873
  *         else:
  *             self.arg={}
  *             i=0             # <<<<<<<<<<<<<<
  *             for x in args:
  *                  self.arg[i]=x
  */
     __Pyx_INCREF(__pyx_int_0);
     __pyx_v_i = __pyx_int_0;
 
-    /* "plumed.pyx":692
+    /* "plumed.pyx":874
  *             self.arg={}
  *             i=0
  *             for x in args:             # <<<<<<<<<<<<<<
  *                  self.arg[i]=x
  *                  i+=1
  */
     __pyx_t_5 = __pyx_v_args; __Pyx_INCREF(__pyx_t_5); __pyx_t_1 = 0;
     for (;;) {
       if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_3); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 692, __pyx_L1_error)
+      __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_3); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 874, __pyx_L1_error)
       #else
-      __pyx_t_3 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 692, __pyx_L1_error)
+      __pyx_t_3 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 874, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_3);
       __pyx_t_3 = 0;
 
-      /* "plumed.pyx":693
+      /* "plumed.pyx":875
  *             i=0
  *             for x in args:
  *                  self.arg[i]=x             # <<<<<<<<<<<<<<
  *                  i+=1
  * 
  */
-      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_arg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 693, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_arg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 875, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_i, __pyx_v_x) < 0)) __PYX_ERR(0, 693, __pyx_L1_error)
+      if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_i, __pyx_v_x) < 0)) __PYX_ERR(0, 875, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-      /* "plumed.pyx":694
+      /* "plumed.pyx":876
  *             for x in args:
  *                  self.arg[i]=x
  *                  i+=1             # <<<<<<<<<<<<<<
  * 
  * class _replicas():
  */
-      __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 694, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 876, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF_SET(__pyx_v_i, __pyx_t_3);
       __pyx_t_3 = 0;
 
-      /* "plumed.pyx":692
+      /* "plumed.pyx":874
  *             self.arg={}
  *             i=0
  *             for x in args:             # <<<<<<<<<<<<<<
  *                  self.arg[i]=x
  *                  i+=1
  */
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __pyx_L3:;
 
-  /* "plumed.pyx":674
+  /* "plumed.pyx":856
  * 
  * class _numbered():
  *     def __init__(self,*args):             # <<<<<<<<<<<<<<
  * # this is experimental:
  * # it allows calling _numbered(arg1,arg2,arg3)
  */
 
@@ -14934,15 +17276,15 @@
   __Pyx_XDECREF(__pyx_v_i);
   __Pyx_XDECREF(__pyx_v_x);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":697
+/* "plumed.pyx":879
  * 
  * class _replicas():
  *     def __init__(self,*args):             # <<<<<<<<<<<<<<
  * # this is experimental:
  * # it allows calling _replicas(arg1,arg2,arg3)
  */
 
@@ -14984,26 +17326,26 @@
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t used_pos_args = (pos_args < 1) ? pos_args : 1;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, used_pos_args, "__init__") < 0)) __PYX_ERR(0, 697, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, used_pos_args, "__init__") < 0)) __PYX_ERR(0, 879, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) < 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_self = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 697, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 879, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_DECREF(__pyx_v_args); __pyx_v_args = 0;
   __Pyx_AddTraceback("plumed._replicas.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_9_replicas___init__(__pyx_self, __pyx_v_self, __pyx_v_args);
@@ -15022,100 +17364,100 @@
   PyObject *__pyx_t_3 = NULL;
   int __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "plumed.pyx":701
+  /* "plumed.pyx":883
  * # it allows calling _replicas(arg1,arg2,arg3)
  * # it is however on purpose not implemented in the replicas() method below
  *         if(len(args)==1):             # <<<<<<<<<<<<<<
  *           if hasattr(args[0],'__iter__'):
  *             self.arg=args[0]
  */
-  __pyx_t_1 = PyTuple_GET_SIZE(__pyx_v_args); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 701, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_GET_SIZE(__pyx_v_args); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 883, __pyx_L1_error)
   __pyx_t_2 = ((__pyx_t_1 == 1) != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":702
+    /* "plumed.pyx":884
  * # it is however on purpose not implemented in the replicas() method below
  *         if(len(args)==1):
  *           if hasattr(args[0],'__iter__'):             # <<<<<<<<<<<<<<
  *             self.arg=args[0]
  *           else:
  */
-    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 702, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 884, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = __Pyx_HasAttr(__pyx_t_3, __pyx_n_u_iter); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 702, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_HasAttr(__pyx_t_3, __pyx_n_u_iter); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 884, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_4 = (__pyx_t_2 != 0);
     if (likely(__pyx_t_4)) {
 
-      /* "plumed.pyx":703
+      /* "plumed.pyx":885
  *         if(len(args)==1):
  *           if hasattr(args[0],'__iter__'):
  *             self.arg=args[0]             # <<<<<<<<<<<<<<
  *           else:
  *             raise TypeError("when calling replicas with 1 argument, it should be a list/tuple")
  */
-      __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 703, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt_Tuple(__pyx_v_args, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 885, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_t_3) < 0) __PYX_ERR(0, 703, __pyx_L1_error)
+      if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_t_3) < 0) __PYX_ERR(0, 885, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-      /* "plumed.pyx":702
+      /* "plumed.pyx":884
  * # it is however on purpose not implemented in the replicas() method below
  *         if(len(args)==1):
  *           if hasattr(args[0],'__iter__'):             # <<<<<<<<<<<<<<
  *             self.arg=args[0]
  *           else:
  */
       goto __pyx_L4;
     }
 
-    /* "plumed.pyx":705
+    /* "plumed.pyx":887
  *             self.arg=args[0]
  *           else:
  *             raise TypeError("when calling replicas with 1 argument, it should be a list/tuple")             # <<<<<<<<<<<<<<
  *         else:
  *           self.arg=args
  */
     /*else*/ {
-      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__49, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 705, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__52, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 887, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_Raise(__pyx_t_3, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __PYX_ERR(0, 705, __pyx_L1_error)
+      __PYX_ERR(0, 887, __pyx_L1_error)
     }
     __pyx_L4:;
 
-    /* "plumed.pyx":701
+    /* "plumed.pyx":883
  * # it allows calling _replicas(arg1,arg2,arg3)
  * # it is however on purpose not implemented in the replicas() method below
  *         if(len(args)==1):             # <<<<<<<<<<<<<<
  *           if hasattr(args[0],'__iter__'):
  *             self.arg=args[0]
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":707
+  /* "plumed.pyx":889
  *             raise TypeError("when calling replicas with 1 argument, it should be a list/tuple")
  *         else:
  *           self.arg=args             # <<<<<<<<<<<<<<
  * 
  * ## tool to format at strings (optional)
  */
   /*else*/ {
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_v_args) < 0) __PYX_ERR(0, 707, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_arg, __pyx_v_args) < 0) __PYX_ERR(0, 889, __pyx_L1_error)
   }
   __pyx_L3:;
 
-  /* "plumed.pyx":697
+  /* "plumed.pyx":879
  * 
  * class _replicas():
  *     def __init__(self,*args):             # <<<<<<<<<<<<<<
  * # this is experimental:
  * # it allows calling _replicas(arg1,arg2,arg3)
  */
 
@@ -15128,26 +17470,26 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":711
+/* "plumed.pyx":893
  * ## tool to format at strings (optional)
  * 
  * def _format_at_one_residue(builder,name,residue,chain):             # <<<<<<<<<<<<<<
  *       if isinstance(chain,int):
  *         chain=str(chain)
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_15_format_at_one_residue(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_6plumed_15_format_at_one_residue = {"_format_at_one_residue", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_15_format_at_one_residue, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_6plumed_15_format_at_one_residue(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_17_format_at_one_residue(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_6plumed_17_format_at_one_residue = {"_format_at_one_residue", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_17_format_at_one_residue, METH_VARARGS|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_6plumed_17_format_at_one_residue(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   CYTHON_UNUSED PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_name = 0;
   PyObject *__pyx_v_residue = 0;
   PyObject *__pyx_v_chain = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
@@ -15177,31 +17519,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_at_one_residue", 1, 4, 4, 1); __PYX_ERR(0, 711, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_at_one_residue", 1, 4, 4, 1); __PYX_ERR(0, 893, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_residue)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_at_one_residue", 1, 4, 4, 2); __PYX_ERR(0, 711, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_at_one_residue", 1, 4, 4, 2); __PYX_ERR(0, 893, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_chain)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_at_one_residue", 1, 4, 4, 3); __PYX_ERR(0, 711, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_at_one_residue", 1, 4, 4, 3); __PYX_ERR(0, 893, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_at_one_residue") < 0)) __PYX_ERR(0, 711, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_at_one_residue") < 0)) __PYX_ERR(0, 893, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -15210,28 +17552,28 @@
     __pyx_v_builder = values[0];
     __pyx_v_name = values[1];
     __pyx_v_residue = values[2];
     __pyx_v_chain = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_at_one_residue", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 711, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_at_one_residue", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 893, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_at_one_residue", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_14_format_at_one_residue(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain);
+  __pyx_r = __pyx_pf_6plumed_16_format_at_one_residue(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_14_format_at_one_residue(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain) {
+static PyObject *__pyx_pf_6plumed_16_format_at_one_residue(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain) {
   int __pyx_v_digit;
   PyObject *__pyx_v_i = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
@@ -15243,192 +17585,192 @@
   int __pyx_t_9;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_at_one_residue", 0);
   __Pyx_INCREF(__pyx_v_chain);
 
-  /* "plumed.pyx":712
+  /* "plumed.pyx":894
  * 
  * def _format_at_one_residue(builder,name,residue,chain):
  *       if isinstance(chain,int):             # <<<<<<<<<<<<<<
  *         chain=str(chain)
  *       digit=False
  */
   __pyx_t_1 = PyInt_Check(__pyx_v_chain); 
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":713
+    /* "plumed.pyx":895
  * def _format_at_one_residue(builder,name,residue,chain):
  *       if isinstance(chain,int):
  *         chain=str(chain)             # <<<<<<<<<<<<<<
  *       digit=False
  *       for i in chain:
  */
-    __pyx_t_3 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_chain); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 713, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_chain); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 895, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF_SET(__pyx_v_chain, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "plumed.pyx":712
+    /* "plumed.pyx":894
  * 
  * def _format_at_one_residue(builder,name,residue,chain):
  *       if isinstance(chain,int):             # <<<<<<<<<<<<<<
  *         chain=str(chain)
  *       digit=False
  */
   }
 
-  /* "plumed.pyx":714
+  /* "plumed.pyx":896
  *       if isinstance(chain,int):
  *         chain=str(chain)
  *       digit=False             # <<<<<<<<<<<<<<
  *       for i in chain:
  *         if i.isdigit():
  */
   __pyx_v_digit = 0;
 
-  /* "plumed.pyx":715
+  /* "plumed.pyx":897
  *         chain=str(chain)
  *       digit=False
  *       for i in chain:             # <<<<<<<<<<<<<<
  *         if i.isdigit():
  *            digit=True
  */
   if (likely(PyList_CheckExact(__pyx_v_chain)) || PyTuple_CheckExact(__pyx_v_chain)) {
     __pyx_t_3 = __pyx_v_chain; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
     __pyx_t_5 = NULL;
   } else {
-    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_chain); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 715, __pyx_L1_error)
+    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_chain); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 897, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 715, __pyx_L1_error)
+    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 897, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_5)) {
       if (likely(PyList_CheckExact(__pyx_t_3))) {
         if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 715, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 897, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 715, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 897, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       } else {
         if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 715, __pyx_L1_error)
+        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 897, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 715, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 897, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       }
     } else {
       __pyx_t_6 = __pyx_t_5(__pyx_t_3);
       if (unlikely(!__pyx_t_6)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 715, __pyx_L1_error)
+          else __PYX_ERR(0, 897, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_6);
     }
     __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_6);
     __pyx_t_6 = 0;
 
-    /* "plumed.pyx":716
+    /* "plumed.pyx":898
  *       digit=False
  *       for i in chain:
  *         if i.isdigit():             # <<<<<<<<<<<<<<
  *            digit=True
  *       if digit:
  */
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_i, __pyx_n_s_isdigit); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 716, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_i, __pyx_n_s_isdigit); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 898, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __pyx_t_8 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
       __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
       if (likely(__pyx_t_8)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
         __Pyx_INCREF(__pyx_t_8);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_6 = (__pyx_t_8) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 716, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 898, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 716, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 898, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     if (__pyx_t_2) {
 
-      /* "plumed.pyx":717
+      /* "plumed.pyx":899
  *       for i in chain:
  *         if i.isdigit():
  *            digit=True             # <<<<<<<<<<<<<<
  *       if digit:
  *         chain=chain+"_"
  */
       __pyx_v_digit = 1;
 
-      /* "plumed.pyx":716
+      /* "plumed.pyx":898
  *       digit=False
  *       for i in chain:
  *         if i.isdigit():             # <<<<<<<<<<<<<<
  *            digit=True
  *       if digit:
  */
     }
 
-    /* "plumed.pyx":715
+    /* "plumed.pyx":897
  *         chain=str(chain)
  *       digit=False
  *       for i in chain:             # <<<<<<<<<<<<<<
  *         if i.isdigit():
  *            digit=True
  */
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "plumed.pyx":718
+  /* "plumed.pyx":900
  *         if i.isdigit():
  *            digit=True
  *       if digit:             # <<<<<<<<<<<<<<
  *         chain=chain+"_"
  *       if isinstance(residue,int) or isinstance(residue,str):
  */
   __pyx_t_2 = (__pyx_v_digit != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":719
+    /* "plumed.pyx":901
  *            digit=True
  *       if digit:
  *         chain=chain+"_"             # <<<<<<<<<<<<<<
  *       if isinstance(residue,int) or isinstance(residue,str):
  *         return "@" + name + "-" + chain + str(residue)
  */
-    __pyx_t_3 = PyNumber_Add(__pyx_v_chain, __pyx_n_u__50); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 719, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_v_chain, __pyx_n_u__53); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 901, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF_SET(__pyx_v_chain, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "plumed.pyx":718
+    /* "plumed.pyx":900
  *         if i.isdigit():
  *            digit=True
  *       if digit:             # <<<<<<<<<<<<<<
  *         chain=chain+"_"
  *       if isinstance(residue,int) or isinstance(residue,str):
  */
   }
 
-  /* "plumed.pyx":720
+  /* "plumed.pyx":902
  *       if digit:
  *         chain=chain+"_"
  *       if isinstance(residue,int) or isinstance(residue,str):             # <<<<<<<<<<<<<<
  *         return "@" + name + "-" + chain + str(residue)
  *       else:
  */
   __pyx_t_1 = PyInt_Check(__pyx_v_residue); 
@@ -15440,68 +17782,68 @@
   }
   __pyx_t_9 = PyUnicode_Check(__pyx_v_residue); 
   __pyx_t_1 = (__pyx_t_9 != 0);
   __pyx_t_2 = __pyx_t_1;
   __pyx_L9_bool_binop_done:;
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":721
+    /* "plumed.pyx":903
  *         chain=chain+"_"
  *       if isinstance(residue,int) or isinstance(residue,str):
  *         return "@" + name + "-" + chain + str(residue)             # <<<<<<<<<<<<<<
  *       else:
  *         assert False
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = PyNumber_Add(__pyx_kp_u__51, __pyx_v_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 721, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_kp_u__54, __pyx_v_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 903, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = PyNumber_Add(__pyx_t_3, __pyx_kp_u__52); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 721, __pyx_L1_error)
+    __pyx_t_6 = PyNumber_Add(__pyx_t_3, __pyx_kp_u__55); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 903, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = PyNumber_Add(__pyx_t_6, __pyx_v_chain); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 721, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_6, __pyx_v_chain); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 903, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_residue); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 721, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_residue); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 903, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_7 = PyNumber_Add(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 721, __pyx_L1_error)
+    __pyx_t_7 = PyNumber_Add(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 903, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_r = __pyx_t_7;
     __pyx_t_7 = 0;
     goto __pyx_L0;
 
-    /* "plumed.pyx":720
+    /* "plumed.pyx":902
  *       if digit:
  *         chain=chain+"_"
  *       if isinstance(residue,int) or isinstance(residue,str):             # <<<<<<<<<<<<<<
  *         return "@" + name + "-" + chain + str(residue)
  *       else:
  */
   }
 
-  /* "plumed.pyx":723
+  /* "plumed.pyx":905
  *         return "@" + name + "-" + chain + str(residue)
  *       else:
  *         assert False             # <<<<<<<<<<<<<<
  * 
  * def _format_at_one_chain(builder,name,residue,chain):
  */
   /*else*/ {
     #ifndef CYTHON_WITHOUT_ASSERTIONS
     if (unlikely(!Py_OptimizeFlag)) {
       if (unlikely(!0)) {
         PyErr_SetNone(PyExc_AssertionError);
-        __PYX_ERR(0, 723, __pyx_L1_error)
+        __PYX_ERR(0, 905, __pyx_L1_error)
       }
     }
     #endif
   }
 
-  /* "plumed.pyx":711
+  /* "plumed.pyx":893
  * ## tool to format at strings (optional)
  * 
  * def _format_at_one_residue(builder,name,residue,chain):             # <<<<<<<<<<<<<<
  *       if isinstance(chain,int):
  *         chain=str(chain)
  */
 
@@ -15519,26 +17861,26 @@
   __Pyx_XDECREF(__pyx_v_i);
   __Pyx_XDECREF(__pyx_v_chain);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":725
+/* "plumed.pyx":907
  *         assert False
  * 
  * def _format_at_one_chain(builder,name,residue,chain):             # <<<<<<<<<<<<<<
  *       res=""
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_17_format_at_one_chain(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_6plumed_17_format_at_one_chain = {"_format_at_one_chain", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_17_format_at_one_chain, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_6plumed_17_format_at_one_chain(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_19_format_at_one_chain(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_6plumed_19_format_at_one_chain = {"_format_at_one_chain", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_19_format_at_one_chain, METH_VARARGS|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_6plumed_19_format_at_one_chain(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_name = 0;
   PyObject *__pyx_v_residue = 0;
   PyObject *__pyx_v_chain = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
@@ -15568,31 +17910,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_at_one_chain", 1, 4, 4, 1); __PYX_ERR(0, 725, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_at_one_chain", 1, 4, 4, 1); __PYX_ERR(0, 907, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_residue)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_at_one_chain", 1, 4, 4, 2); __PYX_ERR(0, 725, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_at_one_chain", 1, 4, 4, 2); __PYX_ERR(0, 907, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_chain)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_at_one_chain", 1, 4, 4, 3); __PYX_ERR(0, 725, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_at_one_chain", 1, 4, 4, 3); __PYX_ERR(0, 907, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_at_one_chain") < 0)) __PYX_ERR(0, 725, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_at_one_chain") < 0)) __PYX_ERR(0, 907, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -15601,28 +17943,28 @@
     __pyx_v_builder = values[0];
     __pyx_v_name = values[1];
     __pyx_v_residue = values[2];
     __pyx_v_chain = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_at_one_chain", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 725, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_at_one_chain", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 907, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_at_one_chain", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_16_format_at_one_chain(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain);
+  __pyx_r = __pyx_pf_6plumed_18_format_at_one_chain(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_16_format_at_one_chain(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain) {
+static PyObject *__pyx_pf_6plumed_18_format_at_one_chain(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain) {
   PyObject *__pyx_v_res = NULL;
   PyObject *__pyx_v_x = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   int __pyx_t_3;
@@ -15636,103 +17978,103 @@
   int __pyx_t_11;
   PyObject *__pyx_t_12 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_at_one_chain", 0);
 
-  /* "plumed.pyx":726
+  /* "plumed.pyx":908
  * 
  * def _format_at_one_chain(builder,name,residue,chain):
  *       res=""             # <<<<<<<<<<<<<<
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):
  *         for x in residue:
  */
-  __Pyx_INCREF(__pyx_kp_u__32);
-  __pyx_v_res = __pyx_kp_u__32;
+  __Pyx_INCREF(__pyx_kp_u__35);
+  __pyx_v_res = __pyx_kp_u__35;
 
-  /* "plumed.pyx":727
+  /* "plumed.pyx":909
  * def _format_at_one_chain(builder,name,residue,chain):
  *       res=""
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):             # <<<<<<<<<<<<<<
  *         for x in residue:
  *               res+=builder._separator + _format_at_one_residue(builder,name,x,chain)
  */
-  __pyx_t_2 = __Pyx_HasAttr(__pyx_v_residue, __pyx_n_u_iter); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_HasAttr(__pyx_v_residue, __pyx_n_u_iter); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 909, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_3 = PyUnicode_Check(__pyx_v_residue); 
   __pyx_t_2 = ((!(__pyx_t_3 != 0)) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":728
+    /* "plumed.pyx":910
  *       res=""
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):
  *         for x in residue:             # <<<<<<<<<<<<<<
  *               res+=builder._separator + _format_at_one_residue(builder,name,x,chain)
  *       else:
  */
     if (likely(PyList_CheckExact(__pyx_v_residue)) || PyTuple_CheckExact(__pyx_v_residue)) {
       __pyx_t_4 = __pyx_v_residue; __Pyx_INCREF(__pyx_t_4); __pyx_t_5 = 0;
       __pyx_t_6 = NULL;
     } else {
-      __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_residue); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 728, __pyx_L1_error)
+      __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_residue); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 728, __pyx_L1_error)
+      __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 910, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_6)) {
         if (likely(PyList_CheckExact(__pyx_t_4))) {
           if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 728, __pyx_L1_error)
+          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 910, __pyx_L1_error)
           #else
-          __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 728, __pyx_L1_error)
+          __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 910, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           #endif
         } else {
           if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 728, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 910, __pyx_L1_error)
           #else
-          __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 728, __pyx_L1_error)
+          __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 910, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           #endif
         }
       } else {
         __pyx_t_7 = __pyx_t_6(__pyx_t_4);
         if (unlikely(!__pyx_t_7)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 728, __pyx_L1_error)
+            else __PYX_ERR(0, 910, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_7);
       }
       __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_7);
       __pyx_t_7 = 0;
 
-      /* "plumed.pyx":729
+      /* "plumed.pyx":911
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):
  *         for x in residue:
  *               res+=builder._separator + _format_at_one_residue(builder,name,x,chain)             # <<<<<<<<<<<<<<
  *       else:
  *         res+=builder._separator + _format_at_one_residue(builder,name,residue,chain)
  */
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 729, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 911, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_format_at_one_residue); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 729, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_format_at_one_residue); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 911, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __pyx_t_10 = NULL;
       __pyx_t_11 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
         __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
         if (likely(__pyx_t_10)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
@@ -15741,29 +18083,29 @@
           __Pyx_DECREF_SET(__pyx_t_9, function);
           __pyx_t_11 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_9)) {
         PyObject *__pyx_temp[5] = {__pyx_t_10, __pyx_v_builder, __pyx_v_name, __pyx_v_x, __pyx_v_chain};
-        __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 4+__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 729, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 4+__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 911, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_GOTREF(__pyx_t_8);
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
         PyObject *__pyx_temp[5] = {__pyx_t_10, __pyx_v_builder, __pyx_v_name, __pyx_v_x, __pyx_v_chain};
-        __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 4+__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 729, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 4+__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 911, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_GOTREF(__pyx_t_8);
       } else
       #endif
       {
-        __pyx_t_12 = PyTuple_New(4+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 729, __pyx_L1_error)
+        __pyx_t_12 = PyTuple_New(4+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 911, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         if (__pyx_t_10) {
           __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_10); __pyx_t_10 = NULL;
         }
         __Pyx_INCREF(__pyx_v_builder);
         __Pyx_GIVEREF(__pyx_v_builder);
         PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_v_builder);
@@ -15772,60 +18114,60 @@
         PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, __pyx_v_name);
         __Pyx_INCREF(__pyx_v_x);
         __Pyx_GIVEREF(__pyx_v_x);
         PyTuple_SET_ITEM(__pyx_t_12, 2+__pyx_t_11, __pyx_v_x);
         __Pyx_INCREF(__pyx_v_chain);
         __Pyx_GIVEREF(__pyx_v_chain);
         PyTuple_SET_ITEM(__pyx_t_12, 3+__pyx_t_11, __pyx_v_chain);
-        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_12, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 729, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_12, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 911, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       }
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_9 = PyNumber_Add(__pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 729, __pyx_L1_error)
+      __pyx_t_9 = PyNumber_Add(__pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 911, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_res, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 729, __pyx_L1_error)
+      __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_res, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 911, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF_SET(__pyx_v_res, __pyx_t_8);
       __pyx_t_8 = 0;
 
-      /* "plumed.pyx":728
+      /* "plumed.pyx":910
  *       res=""
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):
  *         for x in residue:             # <<<<<<<<<<<<<<
  *               res+=builder._separator + _format_at_one_residue(builder,name,x,chain)
  *       else:
  */
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "plumed.pyx":727
+    /* "plumed.pyx":909
  * def _format_at_one_chain(builder,name,residue,chain):
  *       res=""
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):             # <<<<<<<<<<<<<<
  *         for x in residue:
  *               res+=builder._separator + _format_at_one_residue(builder,name,x,chain)
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":731
+  /* "plumed.pyx":913
  *               res+=builder._separator + _format_at_one_residue(builder,name,x,chain)
  *       else:
  *         res+=builder._separator + _format_at_one_residue(builder,name,residue,chain)             # <<<<<<<<<<<<<<
  * 
  *       return res
  */
   /*else*/ {
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 731, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 913, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_format_at_one_residue); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 731, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_format_at_one_residue); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 913, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __pyx_t_7 = NULL;
     __pyx_t_11 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_9);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
@@ -15834,29 +18176,29 @@
         __Pyx_DECREF_SET(__pyx_t_9, function);
         __pyx_t_11 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_9)) {
       PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain};
-      __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 4+__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 731, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 4+__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 913, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_GOTREF(__pyx_t_8);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
       PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain};
-      __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 4+__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 731, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 4+__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 913, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_GOTREF(__pyx_t_8);
     } else
     #endif
     {
-      __pyx_t_12 = PyTuple_New(4+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 731, __pyx_L1_error)
+      __pyx_t_12 = PyTuple_New(4+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 913, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       if (__pyx_t_7) {
         __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_7); __pyx_t_7 = NULL;
       }
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_v_builder);
@@ -15865,44 +18207,44 @@
       PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, __pyx_v_name);
       __Pyx_INCREF(__pyx_v_residue);
       __Pyx_GIVEREF(__pyx_v_residue);
       PyTuple_SET_ITEM(__pyx_t_12, 2+__pyx_t_11, __pyx_v_residue);
       __Pyx_INCREF(__pyx_v_chain);
       __Pyx_GIVEREF(__pyx_v_chain);
       PyTuple_SET_ITEM(__pyx_t_12, 3+__pyx_t_11, __pyx_v_chain);
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_12, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 731, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_12, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 913, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     }
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = PyNumber_Add(__pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 731, __pyx_L1_error)
+    __pyx_t_9 = PyNumber_Add(__pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 913, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_res, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 731, __pyx_L1_error)
+    __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_res, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 913, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_DECREF_SET(__pyx_v_res, __pyx_t_8);
     __pyx_t_8 = 0;
   }
   __pyx_L3:;
 
-  /* "plumed.pyx":733
+  /* "plumed.pyx":915
  *         res+=builder._separator + _format_at_one_residue(builder,name,residue,chain)
  * 
  *       return res             # <<<<<<<<<<<<<<
  * 
  * def _format_at(builder,name,residue,chain=""):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_res);
   __pyx_r = __pyx_v_res;
   goto __pyx_L0;
 
-  /* "plumed.pyx":725
+  /* "plumed.pyx":907
  *         assert False
  * 
  * def _format_at_one_chain(builder,name,residue,chain):             # <<<<<<<<<<<<<<
  *       res=""
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):
  */
 
@@ -15920,40 +18262,40 @@
   __Pyx_XDECREF(__pyx_v_res);
   __Pyx_XDECREF(__pyx_v_x);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":735
+/* "plumed.pyx":917
  *       return res
  * 
  * def _format_at(builder,name,residue,chain=""):             # <<<<<<<<<<<<<<
  *       res=""
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_19_format_at(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_6plumed_19_format_at = {"_format_at", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_19_format_at, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_6plumed_19_format_at(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_21_format_at(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_6plumed_21_format_at = {"_format_at", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_21_format_at, METH_VARARGS|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_6plumed_21_format_at(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_name = 0;
   PyObject *__pyx_v_residue = 0;
   PyObject *__pyx_v_chain = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_format_at (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_builder,&__pyx_n_s_name,&__pyx_n_s_residue,&__pyx_n_s_chain,0};
     PyObject* values[4] = {0,0,0,0};
-    values[3] = ((PyObject *)((PyObject*)__pyx_kp_u__32));
+    values[3] = ((PyObject *)((PyObject*)__pyx_kp_u__35));
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -15970,31 +18312,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_at", 0, 3, 4, 1); __PYX_ERR(0, 735, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_at", 0, 3, 4, 1); __PYX_ERR(0, 917, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_residue)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_at", 0, 3, 4, 2); __PYX_ERR(0, 735, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_at", 0, 3, 4, 2); __PYX_ERR(0, 917, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_chain);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_at") < 0)) __PYX_ERR(0, 735, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_at") < 0)) __PYX_ERR(0, 917, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
@@ -16006,28 +18348,28 @@
     __pyx_v_builder = values[0];
     __pyx_v_name = values[1];
     __pyx_v_residue = values[2];
     __pyx_v_chain = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_at", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 735, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_at", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 917, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_at", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_18_format_at(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain);
+  __pyx_r = __pyx_pf_6plumed_20_format_at(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_18_format_at(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain) {
+static PyObject *__pyx_pf_6plumed_20_format_at(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_residue, PyObject *__pyx_v_chain) {
   PyObject *__pyx_v_res = NULL;
   PyObject *__pyx_v_x = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   int __pyx_t_3;
@@ -16040,101 +18382,101 @@
   int __pyx_t_10;
   PyObject *__pyx_t_11 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_at", 0);
 
-  /* "plumed.pyx":736
+  /* "plumed.pyx":918
  * 
  * def _format_at(builder,name,residue,chain=""):
  *       res=""             # <<<<<<<<<<<<<<
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):
  *          for x in chain:
  */
-  __Pyx_INCREF(__pyx_kp_u__32);
-  __pyx_v_res = __pyx_kp_u__32;
+  __Pyx_INCREF(__pyx_kp_u__35);
+  __pyx_v_res = __pyx_kp_u__35;
 
-  /* "plumed.pyx":737
+  /* "plumed.pyx":919
  * def _format_at(builder,name,residue,chain=""):
  *       res=""
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):             # <<<<<<<<<<<<<<
  *          for x in chain:
  *              res+=_format_at_one_chain(builder,name,residue,x)
  */
-  __pyx_t_2 = __Pyx_HasAttr(__pyx_v_chain, __pyx_n_u_iter); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 737, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_HasAttr(__pyx_v_chain, __pyx_n_u_iter); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 919, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_3 = PyUnicode_Check(__pyx_v_chain); 
   __pyx_t_2 = ((!(__pyx_t_3 != 0)) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":738
+    /* "plumed.pyx":920
  *       res=""
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):
  *          for x in chain:             # <<<<<<<<<<<<<<
  *              res+=_format_at_one_chain(builder,name,residue,x)
  *       else:
  */
     if (likely(PyList_CheckExact(__pyx_v_chain)) || PyTuple_CheckExact(__pyx_v_chain)) {
       __pyx_t_4 = __pyx_v_chain; __Pyx_INCREF(__pyx_t_4); __pyx_t_5 = 0;
       __pyx_t_6 = NULL;
     } else {
-      __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_chain); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 738, __pyx_L1_error)
+      __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_chain); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 920, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 738, __pyx_L1_error)
+      __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 920, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_6)) {
         if (likely(PyList_CheckExact(__pyx_t_4))) {
           if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 738, __pyx_L1_error)
+          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 920, __pyx_L1_error)
           #else
-          __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 738, __pyx_L1_error)
+          __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 920, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           #endif
         } else {
           if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 738, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 920, __pyx_L1_error)
           #else
-          __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 738, __pyx_L1_error)
+          __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 920, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           #endif
         }
       } else {
         __pyx_t_7 = __pyx_t_6(__pyx_t_4);
         if (unlikely(!__pyx_t_7)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 738, __pyx_L1_error)
+            else __PYX_ERR(0, 920, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_7);
       }
       __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_7);
       __pyx_t_7 = 0;
 
-      /* "plumed.pyx":739
+      /* "plumed.pyx":921
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):
  *          for x in chain:
  *              res+=_format_at_one_chain(builder,name,residue,x)             # <<<<<<<<<<<<<<
  *       else:
  *          res+=_format_at_one_chain(builder,name,residue,chain)
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_at_one_chain); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 739, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_at_one_chain); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_9 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -16143,29 +18485,29 @@
           __Pyx_DECREF_SET(__pyx_t_8, function);
           __pyx_t_10 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_8)) {
         PyObject *__pyx_temp[5] = {__pyx_t_9, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_x};
-        __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 739, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 921, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_GOTREF(__pyx_t_7);
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
         PyObject *__pyx_temp[5] = {__pyx_t_9, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_x};
-        __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 739, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 921, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_GOTREF(__pyx_t_7);
       } else
       #endif
       {
-        __pyx_t_11 = PyTuple_New(4+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 739, __pyx_L1_error)
+        __pyx_t_11 = PyTuple_New(4+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 921, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         if (__pyx_t_9) {
           __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
         }
         __Pyx_INCREF(__pyx_v_builder);
         __Pyx_GIVEREF(__pyx_v_builder);
         PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, __pyx_v_builder);
@@ -16174,54 +18516,54 @@
         PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, __pyx_v_name);
         __Pyx_INCREF(__pyx_v_residue);
         __Pyx_GIVEREF(__pyx_v_residue);
         PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_10, __pyx_v_residue);
         __Pyx_INCREF(__pyx_v_x);
         __Pyx_GIVEREF(__pyx_v_x);
         PyTuple_SET_ITEM(__pyx_t_11, 3+__pyx_t_10, __pyx_v_x);
-        __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_11, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 739, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_11, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 921, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       }
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_res, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 739, __pyx_L1_error)
+      __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_res, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF_SET(__pyx_v_res, __pyx_t_8);
       __pyx_t_8 = 0;
 
-      /* "plumed.pyx":738
+      /* "plumed.pyx":920
  *       res=""
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):
  *          for x in chain:             # <<<<<<<<<<<<<<
  *              res+=_format_at_one_chain(builder,name,residue,x)
  *       else:
  */
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "plumed.pyx":737
+    /* "plumed.pyx":919
  * def _format_at(builder,name,residue,chain=""):
  *       res=""
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):             # <<<<<<<<<<<<<<
  *          for x in chain:
  *              res+=_format_at_one_chain(builder,name,residue,x)
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":741
+  /* "plumed.pyx":923
  *              res+=_format_at_one_chain(builder,name,residue,x)
  *       else:
  *          res+=_format_at_one_chain(builder,name,residue,chain)             # <<<<<<<<<<<<<<
  *       return res[len(builder._separator):]
  * 
  */
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_at_one_chain); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 741, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_at_one_chain); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 923, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = NULL;
     __pyx_t_10 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -16230,29 +18572,29 @@
         __Pyx_DECREF_SET(__pyx_t_8, function);
         __pyx_t_10 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_8)) {
       PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain};
-      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 741, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 923, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_GOTREF(__pyx_t_4);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
       PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_v_builder, __pyx_v_name, __pyx_v_residue, __pyx_v_chain};
-      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 741, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 923, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_GOTREF(__pyx_t_4);
     } else
     #endif
     {
-      __pyx_t_11 = PyTuple_New(4+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 741, __pyx_L1_error)
+      __pyx_t_11 = PyTuple_New(4+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 923, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       if (__pyx_t_7) {
         __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_7); __pyx_t_7 = NULL;
       }
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, __pyx_v_builder);
@@ -16261,46 +18603,46 @@
       PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, __pyx_v_name);
       __Pyx_INCREF(__pyx_v_residue);
       __Pyx_GIVEREF(__pyx_v_residue);
       PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_10, __pyx_v_residue);
       __Pyx_INCREF(__pyx_v_chain);
       __Pyx_GIVEREF(__pyx_v_chain);
       PyTuple_SET_ITEM(__pyx_t_11, 3+__pyx_t_10, __pyx_v_chain);
-      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_11, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 741, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_11, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 923, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     }
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_res, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 741, __pyx_L1_error)
+    __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_res, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 923, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_res, __pyx_t_8);
     __pyx_t_8 = 0;
   }
   __pyx_L3:;
 
-  /* "plumed.pyx":742
+  /* "plumed.pyx":924
  *       else:
  *          res+=_format_at_one_chain(builder,name,residue,chain)
  *       return res[len(builder._separator):]             # <<<<<<<<<<<<<<
  * 
  * class _at():
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 742, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_5 = PyObject_Length(__pyx_t_8); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 742, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_t_8); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 924, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_GetSlice(__pyx_v_res, __pyx_t_5, 0, NULL, NULL, NULL, 1, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 742, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetSlice(__pyx_v_res, __pyx_t_5, 0, NULL, NULL, NULL, 1, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":735
+  /* "plumed.pyx":917
  *       return res
  * 
  * def _format_at(builder,name,residue,chain=""):             # <<<<<<<<<<<<<<
  *       res=""
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):
  */
 
@@ -16317,15 +18659,15 @@
   __Pyx_XDECREF(__pyx_v_res);
   __Pyx_XDECREF(__pyx_v_x);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":745
+/* "plumed.pyx":927
  * 
  * class _at():
  *     def __init__(self,builder):             # <<<<<<<<<<<<<<
  *       import weakref
  *       self._builder=weakref.ref(builder)
  */
 
@@ -16360,32 +18702,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, 1); __PYX_ERR(0, 745, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, 1); __PYX_ERR(0, 927, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 745, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 927, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
     __pyx_v_builder = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 745, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 927, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._at.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_3_at___init__(__pyx_self, __pyx_v_self, __pyx_v_builder);
 
@@ -16408,61 +18750,61 @@
   Py_ssize_t __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "plumed.pyx":746
+  /* "plumed.pyx":928
  * class _at():
  *     def __init__(self,builder):
  *       import weakref             # <<<<<<<<<<<<<<
  *       self._builder=weakref.ref(builder)
  *       _at_global=["mdatoms","allatoms","water","nucleic","protein","water","ions","hydrogens","nonhydrogens"]
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_weakref, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 746, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_weakref, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 928, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_weakref = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":747
+  /* "plumed.pyx":929
  *     def __init__(self,builder):
  *       import weakref
  *       self._builder=weakref.ref(builder)             # <<<<<<<<<<<<<<
  *       _at_global=["mdatoms","allatoms","water","nucleic","protein","water","ions","hydrogens","nonhydrogens"]
  *       for x in _at_global:
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_weakref, __pyx_n_s_ref); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 747, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_weakref, __pyx_n_s_ref); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 929, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_builder) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_builder);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 747, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 929, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_builder_2, __pyx_t_1) < 0) __PYX_ERR(0, 747, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_builder_2, __pyx_t_1) < 0) __PYX_ERR(0, 929, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":748
+  /* "plumed.pyx":930
  *       import weakref
  *       self._builder=weakref.ref(builder)
  *       _at_global=["mdatoms","allatoms","water","nucleic","protein","water","ions","hydrogens","nonhydrogens"]             # <<<<<<<<<<<<<<
  *       for x in _at_global:
  *         exec("self." + x + "=\"@" + x + "\"",None,{"self":self})
  */
-  __pyx_t_1 = PyList_New(9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 748, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 930, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_n_u_mdatoms);
   __Pyx_GIVEREF(__pyx_n_u_mdatoms);
   PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_mdatoms);
   __Pyx_INCREF(__pyx_n_u_allatoms);
   __Pyx_GIVEREF(__pyx_n_u_allatoms);
   PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_allatoms);
@@ -16486,78 +18828,78 @@
   PyList_SET_ITEM(__pyx_t_1, 7, __pyx_n_u_hydrogens);
   __Pyx_INCREF(__pyx_n_u_nonhydrogens);
   __Pyx_GIVEREF(__pyx_n_u_nonhydrogens);
   PyList_SET_ITEM(__pyx_t_1, 8, __pyx_n_u_nonhydrogens);
   __pyx_v__at_global = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":749
+  /* "plumed.pyx":931
  *       self._builder=weakref.ref(builder)
  *       _at_global=["mdatoms","allatoms","water","nucleic","protein","water","ions","hydrogens","nonhydrogens"]
  *       for x in _at_global:             # <<<<<<<<<<<<<<
  *         exec("self." + x + "=\"@" + x + "\"",None,{"self":self})
  *       _at_residue=["phi","psi","omega","chi1","alpha","beta","gamma","delta","epsilon","zeta","v0","v1","v2","v3","v4","chi","back","sugar","base","lcs"]
  */
   __pyx_t_1 = __pyx_v__at_global; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
   for (;;) {
     if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 749, __pyx_L1_error)
+    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 931, __pyx_L1_error)
     #else
-    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 749, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 931, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "plumed.pyx":750
+    /* "plumed.pyx":932
  *       _at_global=["mdatoms","allatoms","water","nucleic","protein","water","ions","hydrogens","nonhydrogens"]
  *       for x in _at_global:
  *         exec("self." + x + "=\"@" + x + "\"",None,{"self":self})             # <<<<<<<<<<<<<<
  *       _at_residue=["phi","psi","omega","chi1","alpha","beta","gamma","delta","epsilon","zeta","v0","v1","v2","v3","v4","chi","back","sugar","base","lcs"]
  *       for x in _at_residue:
  */
-    __pyx_t_2 = PyNumber_Add(__pyx_kp_u_self_2, __pyx_v_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Add(__pyx_kp_u_self_2, __pyx_v_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 932, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_kp_u__53); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 750, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_kp_u__56); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 932, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_v_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_v_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 932, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_kp_u__54); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 750, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_kp_u__57); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 932, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 932, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_self, __pyx_v_self) < 0) __PYX_ERR(0, 750, __pyx_L1_error)
-    __pyx_t_5 = __Pyx_PyExec3(__pyx_t_3, Py_None, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 750, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_self, __pyx_v_self) < 0) __PYX_ERR(0, 932, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyExec3(__pyx_t_3, Py_None, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 932, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "plumed.pyx":749
+    /* "plumed.pyx":931
  *       self._builder=weakref.ref(builder)
  *       _at_global=["mdatoms","allatoms","water","nucleic","protein","water","ions","hydrogens","nonhydrogens"]
  *       for x in _at_global:             # <<<<<<<<<<<<<<
  *         exec("self." + x + "=\"@" + x + "\"",None,{"self":self})
  *       _at_residue=["phi","psi","omega","chi1","alpha","beta","gamma","delta","epsilon","zeta","v0","v1","v2","v3","v4","chi","back","sugar","base","lcs"]
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":751
+  /* "plumed.pyx":933
  *       for x in _at_global:
  *         exec("self." + x + "=\"@" + x + "\"",None,{"self":self})
  *       _at_residue=["phi","psi","omega","chi1","alpha","beta","gamma","delta","epsilon","zeta","v0","v1","v2","v3","v4","chi","back","sugar","base","lcs"]             # <<<<<<<<<<<<<<
  *       for x in _at_residue:
  *             ldict={}
  */
-  __pyx_t_1 = PyList_New(20); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 751, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(20); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 933, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_n_u_phi);
   __Pyx_GIVEREF(__pyx_n_u_phi);
   PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_phi);
   __Pyx_INCREF(__pyx_n_u_psi);
   __Pyx_GIVEREF(__pyx_n_u_psi);
   PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_psi);
@@ -16614,118 +18956,118 @@
   PyList_SET_ITEM(__pyx_t_1, 18, __pyx_n_u_base);
   __Pyx_INCREF(__pyx_n_u_lcs);
   __Pyx_GIVEREF(__pyx_n_u_lcs);
   PyList_SET_ITEM(__pyx_t_1, 19, __pyx_n_u_lcs);
   __pyx_v__at_residue = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":752
+  /* "plumed.pyx":934
  *         exec("self." + x + "=\"@" + x + "\"",None,{"self":self})
  *       _at_residue=["phi","psi","omega","chi1","alpha","beta","gamma","delta","epsilon","zeta","v0","v1","v2","v3","v4","chi","back","sugar","base","lcs"]
  *       for x in _at_residue:             # <<<<<<<<<<<<<<
  *             ldict={}
  *             exec("def " + x + "(self,residue,chain=\"\"):\n          return _format_at(self._builder(),\"" + x + "\",residue,chain)\n",{"_format_at":_format_at},ldict)
  */
   __pyx_t_1 = __pyx_v__at_residue; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
   for (;;) {
     if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_5 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_5); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 752, __pyx_L1_error)
+    __pyx_t_5 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_5); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 934, __pyx_L1_error)
     #else
-    __pyx_t_5 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 752, __pyx_L1_error)
+    __pyx_t_5 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 934, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "plumed.pyx":753
+    /* "plumed.pyx":935
  *       _at_residue=["phi","psi","omega","chi1","alpha","beta","gamma","delta","epsilon","zeta","v0","v1","v2","v3","v4","chi","back","sugar","base","lcs"]
  *       for x in _at_residue:
  *             ldict={}             # <<<<<<<<<<<<<<
  *             exec("def " + x + "(self,residue,chain=\"\"):\n          return _format_at(self._builder(),\"" + x + "\",residue,chain)\n",{"_format_at":_format_at},ldict)
  *             exec("self." + x + " = types.MethodType( ldict['" + x + "'],self)",None,{"self":self, "types":types, "ldict":ldict})
  */
-    __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 753, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 935, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_XDECREF_SET(__pyx_v_ldict, ((PyObject*)__pyx_t_5));
     __pyx_t_5 = 0;
 
-    /* "plumed.pyx":754
+    /* "plumed.pyx":936
  *       for x in _at_residue:
  *             ldict={}
  *             exec("def " + x + "(self,residue,chain=\"\"):\n          return _format_at(self._builder(),\"" + x + "\",residue,chain)\n",{"_format_at":_format_at},ldict)             # <<<<<<<<<<<<<<
  *             exec("self." + x + " = types.MethodType( ldict['" + x + "'],self)",None,{"self":self, "types":types, "ldict":ldict})
  *     def __call__(self,name,residue,chain=""):
  */
-    __pyx_t_5 = PyNumber_Add(__pyx_kp_u_def, __pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_kp_u_def, __pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 936, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_2 = PyNumber_Add(__pyx_t_5, __pyx_kp_u_self_residue_chain_return__form); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Add(__pyx_t_5, __pyx_kp_u_self_residue_chain_return__form); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 936, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_Add(__pyx_t_2, __pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_t_2, __pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 936, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyNumber_Add(__pyx_t_5, __pyx_kp_u_residue_chain); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Add(__pyx_t_5, __pyx_kp_u_residue_chain); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 936, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 936, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_format_at); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_format_at); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 936, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    if (PyDict_SetItem(__pyx_t_5, __pyx_n_u_format_at, __pyx_t_3) < 0) __PYX_ERR(0, 754, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_5, __pyx_n_u_format_at, __pyx_t_3) < 0) __PYX_ERR(0, 936, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyExec3(__pyx_t_2, __pyx_t_5, __pyx_v_ldict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyExec3(__pyx_t_2, __pyx_t_5, __pyx_v_ldict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 936, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "plumed.pyx":755
+    /* "plumed.pyx":937
  *             ldict={}
  *             exec("def " + x + "(self,residue,chain=\"\"):\n          return _format_at(self._builder(),\"" + x + "\",residue,chain)\n",{"_format_at":_format_at},ldict)
  *             exec("self." + x + " = types.MethodType( ldict['" + x + "'],self)",None,{"self":self, "types":types, "ldict":ldict})             # <<<<<<<<<<<<<<
  *     def __call__(self,name,residue,chain=""):
  *        return _format_at(self._builder(),name,residue,chain)
  */
-    __pyx_t_3 = PyNumber_Add(__pyx_kp_u_self_2, __pyx_v_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 755, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_kp_u_self_2, __pyx_v_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 937, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_types_MethodType_ldict); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 755, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_types_MethodType_ldict); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 937, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = PyNumber_Add(__pyx_t_5, __pyx_v_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 755, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_5, __pyx_v_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 937, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_self_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 755, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_self_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 937, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 755, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 937, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_self, __pyx_v_self) < 0) __PYX_ERR(0, 755, __pyx_L1_error)
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_types); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 755, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_self, __pyx_v_self) < 0) __PYX_ERR(0, 937, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_types); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 937, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_types, __pyx_t_2) < 0) __PYX_ERR(0, 755, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_types, __pyx_t_2) < 0) __PYX_ERR(0, 937, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_ldict, __pyx_v_ldict) < 0) __PYX_ERR(0, 755, __pyx_L1_error)
-    __pyx_t_2 = __Pyx_PyExec3(__pyx_t_5, Py_None, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 755, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_ldict, __pyx_v_ldict) < 0) __PYX_ERR(0, 937, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyExec3(__pyx_t_5, Py_None, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 937, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":752
+    /* "plumed.pyx":934
  *         exec("self." + x + "=\"@" + x + "\"",None,{"self":self})
  *       _at_residue=["phi","psi","omega","chi1","alpha","beta","gamma","delta","epsilon","zeta","v0","v1","v2","v3","v4","chi","back","sugar","base","lcs"]
  *       for x in _at_residue:             # <<<<<<<<<<<<<<
  *             ldict={}
  *             exec("def " + x + "(self,residue,chain=\"\"):\n          return _format_at(self._builder(),\"" + x + "\",residue,chain)\n",{"_format_at":_format_at},ldict)
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":745
+  /* "plumed.pyx":927
  * 
  * class _at():
  *     def __init__(self,builder):             # <<<<<<<<<<<<<<
  *       import weakref
  *       self._builder=weakref.ref(builder)
  */
 
@@ -16746,15 +19088,15 @@
   __Pyx_XDECREF(__pyx_v__at_residue);
   __Pyx_XDECREF(__pyx_v_ldict);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":756
+/* "plumed.pyx":938
  *             exec("def " + x + "(self,residue,chain=\"\"):\n          return _format_at(self._builder(),\"" + x + "\",residue,chain)\n",{"_format_at":_format_at},ldict)
  *             exec("self." + x + " = types.MethodType( ldict['" + x + "'],self)",None,{"self":self, "types":types, "ldict":ldict})
  *     def __call__(self,name,residue,chain=""):             # <<<<<<<<<<<<<<
  *        return _format_at(self._builder(),name,residue,chain)
  * 
  */
 
@@ -16771,15 +19113,15 @@
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__call__ (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_name,&__pyx_n_s_residue,&__pyx_n_s_chain,0};
     PyObject* values[4] = {0,0,0,0};
-    values[3] = ((PyObject *)((PyObject*)__pyx_kp_u__32));
+    values[3] = ((PyObject *)((PyObject*)__pyx_kp_u__35));
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -16796,31 +19138,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__call__", 0, 3, 4, 1); __PYX_ERR(0, 756, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__call__", 0, 3, 4, 1); __PYX_ERR(0, 938, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_residue)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__call__", 0, 3, 4, 2); __PYX_ERR(0, 756, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__call__", 0, 3, 4, 2); __PYX_ERR(0, 938, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_chain);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 756, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 938, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
@@ -16832,15 +19174,15 @@
     __pyx_v_self = values[0];
     __pyx_v_name = values[1];
     __pyx_v_residue = values[2];
     __pyx_v_chain = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__call__", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 756, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__call__", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 938, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._at.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_3_at_2__call__(__pyx_self, __pyx_v_self, __pyx_v_name, __pyx_v_residue, __pyx_v_chain);
 
@@ -16859,39 +19201,39 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__call__", 0);
 
-  /* "plumed.pyx":757
+  /* "plumed.pyx":939
  *             exec("self." + x + " = types.MethodType( ldict['" + x + "'],self)",None,{"self":self, "types":types, "ldict":ldict})
  *     def __call__(self,name,residue,chain=""):
  *        return _format_at(self._builder(),name,residue,chain)             # <<<<<<<<<<<<<<
  * 
  * ## end of tool to format at strings
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 757, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_at); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 939, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_builder_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 757, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_builder_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 939, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 757, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 939, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   __pyx_t_6 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_4)) {
@@ -16901,31 +19243,31 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_6 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[5] = {__pyx_t_4, __pyx_t_3, __pyx_v_name, __pyx_v_residue, __pyx_v_chain};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 757, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 939, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[5] = {__pyx_t_4, __pyx_t_3, __pyx_v_name, __pyx_v_residue, __pyx_v_chain};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 757, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 939, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 757, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 939, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_4) {
       __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __pyx_t_4 = NULL;
     }
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_t_3);
     __Pyx_INCREF(__pyx_v_name);
@@ -16934,24 +19276,24 @@
     __Pyx_INCREF(__pyx_v_residue);
     __Pyx_GIVEREF(__pyx_v_residue);
     PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_6, __pyx_v_residue);
     __Pyx_INCREF(__pyx_v_chain);
     __Pyx_GIVEREF(__pyx_v_chain);
     PyTuple_SET_ITEM(__pyx_t_5, 3+__pyx_t_6, __pyx_v_chain);
     __pyx_t_3 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 757, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 939, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":756
+  /* "plumed.pyx":938
  *             exec("def " + x + "(self,residue,chain=\"\"):\n          return _format_at(self._builder(),\"" + x + "\",residue,chain)\n",{"_format_at":_format_at},ldict)
  *             exec("self." + x + " = types.MethodType( ldict['" + x + "'],self)",None,{"self":self, "types":types, "ldict":ldict})
  *     def __call__(self,name,residue,chain=""):             # <<<<<<<<<<<<<<
  *        return _format_at(self._builder(),name,residue,chain)
  * 
  */
 
@@ -16966,27 +19308,27 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":761
+/* "plumed.pyx":943
  * ## end of tool to format at strings
  * 
  * def _fix_braces(builder,arg,comma):             # <<<<<<<<<<<<<<
  *     """ Fix braces.
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_21_fix_braces(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_20_fix_braces[] = " Fix braces.\n\n        If comma is true, consider comma as a separator. Otherwise, only consider space as a separator.\n    ";
-static PyMethodDef __pyx_mdef_6plumed_21_fix_braces = {"_fix_braces", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_21_fix_braces, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_20_fix_braces};
-static PyObject *__pyx_pw_6plumed_21_fix_braces(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_23_fix_braces(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_22_fix_braces[] = " Fix braces.\n\n        If comma is true, consider comma as a separator. Otherwise, only consider space as a separator.\n    ";
+static PyMethodDef __pyx_mdef_6plumed_23_fix_braces = {"_fix_braces", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_23_fix_braces, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_22_fix_braces};
+static PyObject *__pyx_pw_6plumed_23_fix_braces(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_arg = 0;
   PyObject *__pyx_v_comma = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -17013,53 +19355,53 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_fix_braces", 1, 3, 3, 1); __PYX_ERR(0, 761, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_fix_braces", 1, 3, 3, 1); __PYX_ERR(0, 943, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_comma)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_fix_braces", 1, 3, 3, 2); __PYX_ERR(0, 761, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_fix_braces", 1, 3, 3, 2); __PYX_ERR(0, 943, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_fix_braces") < 0)) __PYX_ERR(0, 761, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_fix_braces") < 0)) __PYX_ERR(0, 943, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_builder = values[0];
     __pyx_v_arg = values[1];
     __pyx_v_comma = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_fix_braces", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 761, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_fix_braces", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 943, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._fix_braces", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_20_fix_braces(__pyx_self, __pyx_v_builder, __pyx_v_arg, __pyx_v_comma);
+  __pyx_r = __pyx_pf_6plumed_22_fix_braces(__pyx_self, __pyx_v_builder, __pyx_v_arg, __pyx_v_comma);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_20_fix_braces(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_arg, PyObject *__pyx_v_comma) {
+static PyObject *__pyx_pf_6plumed_22_fix_braces(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_arg, PyObject *__pyx_v_comma) {
   int __pyx_v_always;
   PyObject *__pyx_v_tmp = NULL;
   PyObject *__pyx_v_go = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
@@ -17071,70 +19413,70 @@
   int __pyx_t_8;
   int __pyx_t_9;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_fix_braces", 0);
 
-  /* "plumed.pyx":766
+  /* "plumed.pyx":948
  *         If comma is true, consider comma as a separator. Otherwise, only consider space as a separator.
  *     """
  *     always=not builder._minimize_braces             # <<<<<<<<<<<<<<
  *     # recursively remove braces to find non-matching ones
  *     tmp=arg
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_minimize_braces); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 766, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_minimize_braces); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 948, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 766, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 948, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_always = (!__pyx_t_2);
 
-  /* "plumed.pyx":768
+  /* "plumed.pyx":950
  *     always=not builder._minimize_braces
  *     # recursively remove braces to find non-matching ones
  *     tmp=arg             # <<<<<<<<<<<<<<
  *     go=1
  *     while go>0:
  */
   __Pyx_INCREF(__pyx_v_arg);
   __pyx_v_tmp = __pyx_v_arg;
 
-  /* "plumed.pyx":769
+  /* "plumed.pyx":951
  *     # recursively remove braces to find non-matching ones
  *     tmp=arg
  *     go=1             # <<<<<<<<<<<<<<
  *     while go>0:
  *       (tmp,go)=re.subn("{[^{}]*}","",tmp)
  */
   __Pyx_INCREF(__pyx_int_1);
   __pyx_v_go = __pyx_int_1;
 
-  /* "plumed.pyx":770
+  /* "plumed.pyx":952
  *     tmp=arg
  *     go=1
  *     while go>0:             # <<<<<<<<<<<<<<
  *       (tmp,go)=re.subn("{[^{}]*}","",tmp)
  *     if re.match(".*[{}]",tmp):
  */
   while (1) {
-    __pyx_t_1 = PyObject_RichCompare(__pyx_v_go, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 770, __pyx_L1_error)
-    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 770, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_v_go, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 952, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (!__pyx_t_2) break;
 
-    /* "plumed.pyx":771
+    /* "plumed.pyx":953
  *     go=1
  *     while go>0:
  *       (tmp,go)=re.subn("{[^{}]*}","",tmp)             # <<<<<<<<<<<<<<
  *     if re.match(".*[{}]",tmp):
  *         raise ValueError("option \"" + arg + "\" contains nonmatching braces")
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_re); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 771, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_re); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_subn); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 771, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_subn); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     __pyx_t_5 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
@@ -17143,110 +19485,110 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
         __pyx_t_5 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_4)) {
-      PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_kp_u__55, __pyx_kp_u__32, __pyx_v_tmp};
-      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 771, __pyx_L1_error)
+      PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_kp_u__58, __pyx_kp_u__35, __pyx_v_tmp};
+      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 953, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
-      PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_kp_u__55, __pyx_kp_u__32, __pyx_v_tmp};
-      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 771, __pyx_L1_error)
+      PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_kp_u__58, __pyx_kp_u__35, __pyx_v_tmp};
+      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 953, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     {
-      __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 771, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 953, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       if (__pyx_t_3) {
         __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3); __pyx_t_3 = NULL;
       }
-      __Pyx_INCREF(__pyx_kp_u__55);
-      __Pyx_GIVEREF(__pyx_kp_u__55);
-      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_kp_u__55);
-      __Pyx_INCREF(__pyx_kp_u__32);
-      __Pyx_GIVEREF(__pyx_kp_u__32);
-      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_kp_u__32);
+      __Pyx_INCREF(__pyx_kp_u__58);
+      __Pyx_GIVEREF(__pyx_kp_u__58);
+      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_kp_u__58);
+      __Pyx_INCREF(__pyx_kp_u__35);
+      __Pyx_GIVEREF(__pyx_kp_u__35);
+      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_kp_u__35);
       __Pyx_INCREF(__pyx_v_tmp);
       __Pyx_GIVEREF(__pyx_v_tmp);
       PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_5, __pyx_v_tmp);
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 771, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 953, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
       PyObject* sequence = __pyx_t_1;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 2)) {
         if (size > 2) __Pyx_RaiseTooManyValuesError(2);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 771, __pyx_L1_error)
+        __PYX_ERR(0, 953, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
       } else {
         __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
         __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
       }
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_6);
       #else
-      __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 771, __pyx_L1_error)
+      __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 953, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 771, __pyx_L1_error)
+      __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 953, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 771, __pyx_L1_error)
+      __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 953, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_7 = Py_TYPE(__pyx_t_3)->tp_iternext;
       index = 0; __pyx_t_4 = __pyx_t_7(__pyx_t_3); if (unlikely(!__pyx_t_4)) goto __pyx_L5_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_4);
       index = 1; __pyx_t_6 = __pyx_t_7(__pyx_t_3); if (unlikely(!__pyx_t_6)) goto __pyx_L5_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_6);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_3), 2) < 0) __PYX_ERR(0, 771, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_3), 2) < 0) __PYX_ERR(0, 953, __pyx_L1_error)
       __pyx_t_7 = NULL;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       goto __pyx_L6_unpacking_done;
       __pyx_L5_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_t_7 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 771, __pyx_L1_error)
+      __PYX_ERR(0, 953, __pyx_L1_error)
       __pyx_L6_unpacking_done:;
     }
     __Pyx_DECREF_SET(__pyx_v_tmp, __pyx_t_4);
     __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_go, __pyx_t_6);
     __pyx_t_6 = 0;
   }
 
-  /* "plumed.pyx":772
+  /* "plumed.pyx":954
  *     while go>0:
  *       (tmp,go)=re.subn("{[^{}]*}","",tmp)
  *     if re.match(".*[{}]",tmp):             # <<<<<<<<<<<<<<
  *         raise ValueError("option \"" + arg + "\" contains nonmatching braces")
  *     # @replicas: beginning strings are not treated.
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_re); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 772, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_re); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_match); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 772, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_match); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_5 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_6)) {
@@ -17255,87 +19597,87 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
       __pyx_t_5 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__56, __pyx_v_tmp};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 772, __pyx_L1_error)
+    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__59, __pyx_v_tmp};
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 954, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__56, __pyx_v_tmp};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 772, __pyx_L1_error)
+    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__59, __pyx_v_tmp};
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 954, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_3 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 772, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 954, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
-    __Pyx_INCREF(__pyx_kp_u__56);
-    __Pyx_GIVEREF(__pyx_kp_u__56);
-    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_5, __pyx_kp_u__56);
+    __Pyx_INCREF(__pyx_kp_u__59);
+    __Pyx_GIVEREF(__pyx_kp_u__59);
+    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_5, __pyx_kp_u__59);
     __Pyx_INCREF(__pyx_v_tmp);
     __Pyx_GIVEREF(__pyx_v_tmp);
     PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_5, __pyx_v_tmp);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 772, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 954, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 772, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (unlikely(__pyx_t_2)) {
 
-    /* "plumed.pyx":773
+    /* "plumed.pyx":955
  *       (tmp,go)=re.subn("{[^{}]*}","",tmp)
  *     if re.match(".*[{}]",tmp):
  *         raise ValueError("option \"" + arg + "\" contains nonmatching braces")             # <<<<<<<<<<<<<<
  *     # @replicas: beginning strings are not treated.
  *     # the reason is that these strings are expected to be already fixed by possibly adding braces after the :
  */
-    __pyx_t_1 = PyNumber_Add(__pyx_kp_u_option_2, __pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 773, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Add(__pyx_kp_u_option_2, __pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 955, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = PyNumber_Add(__pyx_t_1, __pyx_kp_u_contains_nonmatching_braces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 773, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_t_1, __pyx_kp_u_contains_nonmatching_braces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 955, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 773, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 955, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 773, __pyx_L1_error)
+    __PYX_ERR(0, 955, __pyx_L1_error)
 
-    /* "plumed.pyx":772
+    /* "plumed.pyx":954
  *     while go>0:
  *       (tmp,go)=re.subn("{[^{}]*}","",tmp)
  *     if re.match(".*[{}]",tmp):             # <<<<<<<<<<<<<<
  *         raise ValueError("option \"" + arg + "\" contains nonmatching braces")
  *     # @replicas: beginning strings are not treated.
  */
   }
 
-  /* "plumed.pyx":776
+  /* "plumed.pyx":958
  *     # @replicas: beginning strings are not treated.
  *     # the reason is that these strings are expected to be already fixed by possibly adding braces after the :
  *     if re.match("@replicas:",arg):             # <<<<<<<<<<<<<<
  *         return arg
  *     if always or arg=="" or (not comma and re.match(".*[ {}]",arg)) or ( comma and re.match(".*[ {},]",arg) ):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_re); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 776, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_re); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_match); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_match); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   __pyx_t_5 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
@@ -17345,97 +19687,97 @@
       __Pyx_DECREF_SET(__pyx_t_3, function);
       __pyx_t_5 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_replicas, __pyx_v_arg};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 958, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
     PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_replicas, __pyx_v_arg};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 958, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 776, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 958, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     if (__pyx_t_4) {
       __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
     }
     __Pyx_INCREF(__pyx_kp_u_replicas);
     __Pyx_GIVEREF(__pyx_kp_u_replicas);
     PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_kp_u_replicas);
     __Pyx_INCREF(__pyx_v_arg);
     __Pyx_GIVEREF(__pyx_v_arg);
     PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_arg);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 958, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 776, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":777
+    /* "plumed.pyx":959
  *     # the reason is that these strings are expected to be already fixed by possibly adding braces after the :
  *     if re.match("@replicas:",arg):
  *         return arg             # <<<<<<<<<<<<<<
  *     if always or arg=="" or (not comma and re.match(".*[ {}]",arg)) or ( comma and re.match(".*[ {},]",arg) ):
  *         return "{" + arg + "}"
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_arg);
     __pyx_r = __pyx_v_arg;
     goto __pyx_L0;
 
-    /* "plumed.pyx":776
+    /* "plumed.pyx":958
  *     # @replicas: beginning strings are not treated.
  *     # the reason is that these strings are expected to be already fixed by possibly adding braces after the :
  *     if re.match("@replicas:",arg):             # <<<<<<<<<<<<<<
  *         return arg
  *     if always or arg=="" or (not comma and re.match(".*[ {}]",arg)) or ( comma and re.match(".*[ {},]",arg) ):
  */
   }
 
-  /* "plumed.pyx":778
+  /* "plumed.pyx":960
  *     if re.match("@replicas:",arg):
  *         return arg
  *     if always or arg=="" or (not comma and re.match(".*[ {}]",arg)) or ( comma and re.match(".*[ {},]",arg) ):             # <<<<<<<<<<<<<<
  *         return "{" + arg + "}"
  *     return arg
  */
   __pyx_t_8 = (__pyx_v_always != 0);
   if (!__pyx_t_8) {
   } else {
     __pyx_t_2 = __pyx_t_8;
     goto __pyx_L10_bool_binop_done;
   }
-  __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_arg, __pyx_kp_u__32, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 778, __pyx_L1_error)
+  __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_arg, __pyx_kp_u__35, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 960, __pyx_L1_error)
   if (!__pyx_t_8) {
   } else {
     __pyx_t_2 = __pyx_t_8;
     goto __pyx_L10_bool_binop_done;
   }
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_comma); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 778, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_comma); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 960, __pyx_L1_error)
   __pyx_t_9 = ((!__pyx_t_8) != 0);
   if (!__pyx_t_9) {
     goto __pyx_L13_next_or;
   } else {
   }
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_re); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 778, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_re); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 960, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_match); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 778, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_match); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 960, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   __pyx_t_5 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_3)) {
@@ -17444,62 +19786,62 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
       __pyx_t_5 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_6)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u__57, __pyx_v_arg};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 778, __pyx_L1_error)
+    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u__60, __pyx_v_arg};
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 960, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u__57, __pyx_v_arg};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 778, __pyx_L1_error)
+    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u__60, __pyx_v_arg};
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 960, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_4 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 778, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 960, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
-    __Pyx_INCREF(__pyx_kp_u__57);
-    __Pyx_GIVEREF(__pyx_kp_u__57);
-    PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_5, __pyx_kp_u__57);
+    __Pyx_INCREF(__pyx_kp_u__60);
+    __Pyx_GIVEREF(__pyx_kp_u__60);
+    PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_5, __pyx_kp_u__60);
     __Pyx_INCREF(__pyx_v_arg);
     __Pyx_GIVEREF(__pyx_v_arg);
     PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_5, __pyx_v_arg);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 778, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 960, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 778, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 960, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (!__pyx_t_9) {
   } else {
     __pyx_t_2 = __pyx_t_9;
     goto __pyx_L10_bool_binop_done;
   }
   __pyx_L13_next_or:;
-  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_comma); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 778, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_comma); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 960, __pyx_L1_error)
   if (__pyx_t_9) {
   } else {
     __pyx_t_2 = __pyx_t_9;
     goto __pyx_L10_bool_binop_done;
   }
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_re); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 778, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_re); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 960, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_match); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 778, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_match); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 960, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_5 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_6)) {
@@ -17508,90 +19850,90 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
       __pyx_t_5 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__58, __pyx_v_arg};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 778, __pyx_L1_error)
+    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__61, __pyx_v_arg};
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 960, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__58, __pyx_v_arg};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 778, __pyx_L1_error)
+    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_kp_u__61, __pyx_v_arg};
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 960, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_3 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 778, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 960, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
-    __Pyx_INCREF(__pyx_kp_u__58);
-    __Pyx_GIVEREF(__pyx_kp_u__58);
-    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_5, __pyx_kp_u__58);
+    __Pyx_INCREF(__pyx_kp_u__61);
+    __Pyx_GIVEREF(__pyx_kp_u__61);
+    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_5, __pyx_kp_u__61);
     __Pyx_INCREF(__pyx_v_arg);
     __Pyx_GIVEREF(__pyx_v_arg);
     PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_5, __pyx_v_arg);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 778, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 960, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 778, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 960, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_2 = __pyx_t_9;
   __pyx_L10_bool_binop_done:;
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":779
+    /* "plumed.pyx":961
  *         return arg
  *     if always or arg=="" or (not comma and re.match(".*[ {}]",arg)) or ( comma and re.match(".*[ {},]",arg) ):
  *         return "{" + arg + "}"             # <<<<<<<<<<<<<<
  *     return arg
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = PyNumber_Add(__pyx_kp_u__59, __pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 779, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Add(__pyx_kp_u__62, __pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 961, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = PyNumber_Add(__pyx_t_1, __pyx_kp_u__60); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 779, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_t_1, __pyx_kp_u__63); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 961, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_r = __pyx_t_4;
     __pyx_t_4 = 0;
     goto __pyx_L0;
 
-    /* "plumed.pyx":778
+    /* "plumed.pyx":960
  *     if re.match("@replicas:",arg):
  *         return arg
  *     if always or arg=="" or (not comma and re.match(".*[ {}]",arg)) or ( comma and re.match(".*[ {},]",arg) ):             # <<<<<<<<<<<<<<
  *         return "{" + arg + "}"
  *     return arg
  */
   }
 
-  /* "plumed.pyx":780
+  /* "plumed.pyx":962
  *     if always or arg=="" or (not comma and re.match(".*[ {}]",arg)) or ( comma and re.match(".*[ {},]",arg) ):
  *         return "{" + arg + "}"
  *     return arg             # <<<<<<<<<<<<<<
  * 
  * def _format_single(builder,arg,level=0):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_arg);
   __pyx_r = __pyx_v_arg;
   goto __pyx_L0;
 
-  /* "plumed.pyx":761
+  /* "plumed.pyx":943
  * ## end of tool to format at strings
  * 
  * def _fix_braces(builder,arg,comma):             # <<<<<<<<<<<<<<
  *     """ Fix braces.
  * 
  */
 
@@ -17607,27 +19949,27 @@
   __Pyx_XDECREF(__pyx_v_tmp);
   __Pyx_XDECREF(__pyx_v_go);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":782
+/* "plumed.pyx":964
  *     return arg
  * 
  * def _format_single(builder,arg,level=0):             # <<<<<<<<<<<<<<
  *     """Format a single argument.
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_23_format_single(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_22_format_single[] = "Format a single argument.\n\n       Level keeps track of recursions.\n    ";
-static PyMethodDef __pyx_mdef_6plumed_23_format_single = {"_format_single", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_23_format_single, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_22_format_single};
-static PyObject *__pyx_pw_6plumed_23_format_single(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_25_format_single(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_24_format_single[] = "Format a single argument.\n\n       Level keeps track of recursions.\n    ";
+static PyMethodDef __pyx_mdef_6plumed_25_format_single = {"_format_single", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_25_format_single, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_24_format_single};
+static PyObject *__pyx_pw_6plumed_25_format_single(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_arg = 0;
   PyObject *__pyx_v_level = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -17655,25 +19997,25 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_single", 0, 2, 3, 1); __PYX_ERR(0, 782, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_single", 0, 2, 3, 1); __PYX_ERR(0, 964, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_level);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_single") < 0)) __PYX_ERR(0, 782, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_single") < 0)) __PYX_ERR(0, 964, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
@@ -17683,28 +20025,28 @@
     }
     __pyx_v_builder = values[0];
     __pyx_v_arg = values[1];
     __pyx_v_level = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_single", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 782, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_single", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 964, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_single", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_22_format_single(__pyx_self, __pyx_v_builder, __pyx_v_arg, __pyx_v_level);
+  __pyx_r = __pyx_pf_6plumed_24_format_single(__pyx_self, __pyx_v_builder, __pyx_v_arg, __pyx_v_level);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_22_format_single(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_arg, PyObject *__pyx_v_level) {
+static PyObject *__pyx_pf_6plumed_24_format_single(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_arg, PyObject *__pyx_v_level) {
   PyObject *__pyx_v_numbers = NULL;
   PyObject *__pyx_v_MDAnalysis = NULL;
   PyObject *__pyx_v_string = NULL;
   PyObject *__pyx_v_x = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
@@ -17723,191 +20065,191 @@
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_single", 0);
   __Pyx_INCREF(__pyx_v_arg);
 
-  /* "plumed.pyx":787
+  /* "plumed.pyx":969
  *        Level keeps track of recursions.
  *     """
  *     import numbers             # <<<<<<<<<<<<<<
  *     if builder._pre_format is not None:
  *        arg=builder._pre_format(arg)
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numbers, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 787, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numbers, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 969, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_numbers = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "plumed.pyx":788
+  /* "plumed.pyx":970
  *     """
  *     import numbers
  *     if builder._pre_format is not None:             # <<<<<<<<<<<<<<
  *        arg=builder._pre_format(arg)
  * # only import if already loaded
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_pre_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 788, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_pre_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = (__pyx_t_1 != Py_None);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":789
+    /* "plumed.pyx":971
  *     import numbers
  *     if builder._pre_format is not None:
  *        arg=builder._pre_format(arg)             # <<<<<<<<<<<<<<
  * # only import if already loaded
  * # this is to avoid slow startup times.
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_pre_format); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 789, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_pre_format); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 971, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_arg) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_arg);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 789, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 971, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "plumed.pyx":788
+    /* "plumed.pyx":970
  *     """
  *     import numbers
  *     if builder._pre_format is not None:             # <<<<<<<<<<<<<<
  *        arg=builder._pre_format(arg)
  * # only import if already loaded
  */
   }
 
-  /* "plumed.pyx":792
+  /* "plumed.pyx":974
  * # only import if already loaded
  * # this is to avoid slow startup times.
  *     if builder._enable_mda_groups and 'MDAnalysis' in sys.modules:             # <<<<<<<<<<<<<<
  *        import MDAnalysis
  *        if isinstance(arg,MDAnalysis.core.groups.AtomGroup):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_enable_mda_groups); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 792, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_enable_mda_groups); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 792, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
   } else {
     __pyx_t_3 = __pyx_t_2;
     goto __pyx_L5_bool_binop_done;
   }
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 792, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_modules); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 792, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_modules); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_MDAnalysis, __pyx_t_4, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 792, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_MDAnalysis, __pyx_t_4, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_6 = (__pyx_t_2 != 0);
   __pyx_t_3 = __pyx_t_6;
   __pyx_L5_bool_binop_done:;
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":793
+    /* "plumed.pyx":975
  * # this is to avoid slow startup times.
  *     if builder._enable_mda_groups and 'MDAnalysis' in sys.modules:
  *        import MDAnalysis             # <<<<<<<<<<<<<<
  *        if isinstance(arg,MDAnalysis.core.groups.AtomGroup):
  *          arg=arg.indices+1
  */
-    __pyx_t_4 = __Pyx_Import(__pyx_n_s_MDAnalysis, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 793, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_Import(__pyx_n_s_MDAnalysis, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 975, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_v_MDAnalysis = __pyx_t_4;
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":794
+    /* "plumed.pyx":976
  *     if builder._enable_mda_groups and 'MDAnalysis' in sys.modules:
  *        import MDAnalysis
  *        if isinstance(arg,MDAnalysis.core.groups.AtomGroup):             # <<<<<<<<<<<<<<
  *          arg=arg.indices+1
  *     if isinstance(arg,str):
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_MDAnalysis, __pyx_n_s_core); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 794, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_MDAnalysis, __pyx_n_s_core); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 976, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_groups); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 794, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_groups); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 976, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_AtomGroup); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 794, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_AtomGroup); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 976, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_3 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_4); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 794, __pyx_L1_error)
+    __pyx_t_3 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_4); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 976, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_6 = (__pyx_t_3 != 0);
     if (__pyx_t_6) {
 
-      /* "plumed.pyx":795
+      /* "plumed.pyx":977
  *        import MDAnalysis
  *        if isinstance(arg,MDAnalysis.core.groups.AtomGroup):
  *          arg=arg.indices+1             # <<<<<<<<<<<<<<
  *     if isinstance(arg,str):
  *         return re.sub("[\n\t]"," ",arg)
  */
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_indices); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 795, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_indices); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 977, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 795, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 977, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_1);
       __pyx_t_1 = 0;
 
-      /* "plumed.pyx":794
+      /* "plumed.pyx":976
  *     if builder._enable_mda_groups and 'MDAnalysis' in sys.modules:
  *        import MDAnalysis
  *        if isinstance(arg,MDAnalysis.core.groups.AtomGroup):             # <<<<<<<<<<<<<<
  *          arg=arg.indices+1
  *     if isinstance(arg,str):
  */
     }
 
-    /* "plumed.pyx":792
+    /* "plumed.pyx":974
  * # only import if already loaded
  * # this is to avoid slow startup times.
  *     if builder._enable_mda_groups and 'MDAnalysis' in sys.modules:             # <<<<<<<<<<<<<<
  *        import MDAnalysis
  *        if isinstance(arg,MDAnalysis.core.groups.AtomGroup):
  */
   }
 
-  /* "plumed.pyx":796
+  /* "plumed.pyx":978
  *        if isinstance(arg,MDAnalysis.core.groups.AtomGroup):
  *          arg=arg.indices+1
  *     if isinstance(arg,str):             # <<<<<<<<<<<<<<
  *         return re.sub("[\n\t]"," ",arg)
  *     if isinstance(arg,numbers.Number):
  */
   __pyx_t_6 = PyUnicode_Check(__pyx_v_arg); 
   __pyx_t_3 = (__pyx_t_6 != 0);
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":797
+    /* "plumed.pyx":979
  *          arg=arg.indices+1
  *     if isinstance(arg,str):
  *         return re.sub("[\n\t]"," ",arg)             # <<<<<<<<<<<<<<
  *     if isinstance(arg,numbers.Number):
  *         return str(arg)
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_re); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 797, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_re); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 979, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_sub); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 797, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_sub); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 979, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = NULL;
     __pyx_t_7 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_4)) {
@@ -17916,194 +20258,194 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
         __pyx_t_7 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_5)) {
-      PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_kp_u__61, __pyx_kp_u__22, __pyx_v_arg};
-      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 797, __pyx_L1_error)
+      PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_kp_u__64, __pyx_kp_u__24, __pyx_v_arg};
+      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 979, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
-      PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_kp_u__61, __pyx_kp_u__22, __pyx_v_arg};
-      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 797, __pyx_L1_error)
+      PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_kp_u__64, __pyx_kp_u__24, __pyx_v_arg};
+      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 979, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     {
-      __pyx_t_8 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 797, __pyx_L1_error)
+      __pyx_t_8 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 979, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       if (__pyx_t_4) {
         __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4); __pyx_t_4 = NULL;
       }
-      __Pyx_INCREF(__pyx_kp_u__61);
-      __Pyx_GIVEREF(__pyx_kp_u__61);
-      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_kp_u__61);
-      __Pyx_INCREF(__pyx_kp_u__22);
-      __Pyx_GIVEREF(__pyx_kp_u__22);
-      PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_kp_u__22);
+      __Pyx_INCREF(__pyx_kp_u__64);
+      __Pyx_GIVEREF(__pyx_kp_u__64);
+      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_kp_u__64);
+      __Pyx_INCREF(__pyx_kp_u__24);
+      __Pyx_GIVEREF(__pyx_kp_u__24);
+      PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_kp_u__24);
       __Pyx_INCREF(__pyx_v_arg);
       __Pyx_GIVEREF(__pyx_v_arg);
       PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, __pyx_v_arg);
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 797, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 979, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "plumed.pyx":796
+    /* "plumed.pyx":978
  *        if isinstance(arg,MDAnalysis.core.groups.AtomGroup):
  *          arg=arg.indices+1
  *     if isinstance(arg,str):             # <<<<<<<<<<<<<<
  *         return re.sub("[\n\t]"," ",arg)
  *     if isinstance(arg,numbers.Number):
  */
   }
 
-  /* "plumed.pyx":798
+  /* "plumed.pyx":980
  *     if isinstance(arg,str):
  *         return re.sub("[\n\t]"," ",arg)
  *     if isinstance(arg,numbers.Number):             # <<<<<<<<<<<<<<
  *         return str(arg)
  *     if isinstance(arg,dict):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_numbers, __pyx_n_s_Number); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 798, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_numbers, __pyx_n_s_Number); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 980, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_1); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 798, __pyx_L1_error)
+  __pyx_t_3 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_1); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 980, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_6 = (__pyx_t_3 != 0);
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":799
+    /* "plumed.pyx":981
  *         return re.sub("[\n\t]"," ",arg)
  *     if isinstance(arg,numbers.Number):
  *         return str(arg)             # <<<<<<<<<<<<<<
  *     if isinstance(arg,dict):
  *         raise TypeError("options cannot be a dictionary")
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 799, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 981, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "plumed.pyx":798
+    /* "plumed.pyx":980
  *     if isinstance(arg,str):
  *         return re.sub("[\n\t]"," ",arg)
  *     if isinstance(arg,numbers.Number):             # <<<<<<<<<<<<<<
  *         return str(arg)
  *     if isinstance(arg,dict):
  */
   }
 
-  /* "plumed.pyx":800
+  /* "plumed.pyx":982
  *     if isinstance(arg,numbers.Number):
  *         return str(arg)
  *     if isinstance(arg,dict):             # <<<<<<<<<<<<<<
  *         raise TypeError("options cannot be a dictionary")
  *     if isinstance(arg,_replicas):
  */
   __pyx_t_6 = PyDict_Check(__pyx_v_arg); 
   __pyx_t_3 = (__pyx_t_6 != 0);
   if (unlikely(__pyx_t_3)) {
 
-    /* "plumed.pyx":801
+    /* "plumed.pyx":983
  *         return str(arg)
  *     if isinstance(arg,dict):
  *         raise TypeError("options cannot be a dictionary")             # <<<<<<<<<<<<<<
  *     if isinstance(arg,_replicas):
  *         if level>1:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__62, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 801, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__65, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 983, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 801, __pyx_L1_error)
+    __PYX_ERR(0, 983, __pyx_L1_error)
 
-    /* "plumed.pyx":800
+    /* "plumed.pyx":982
  *     if isinstance(arg,numbers.Number):
  *         return str(arg)
  *     if isinstance(arg,dict):             # <<<<<<<<<<<<<<
  *         raise TypeError("options cannot be a dictionary")
  *     if isinstance(arg,_replicas):
  */
   }
 
-  /* "plumed.pyx":802
+  /* "plumed.pyx":984
  *     if isinstance(arg,dict):
  *         raise TypeError("options cannot be a dictionary")
  *     if isinstance(arg,_replicas):             # <<<<<<<<<<<<<<
  *         if level>1:
  *             raise TypeError("@replica syntax only allowed for scalar or rank 1 vectors")
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_replicas_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 802, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_replicas_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 984, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_1); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 802, __pyx_L1_error)
+  __pyx_t_3 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_1); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 984, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_6 = (__pyx_t_3 != 0);
   if (__pyx_t_6) {
 
-    /* "plumed.pyx":803
+    /* "plumed.pyx":985
  *         raise TypeError("options cannot be a dictionary")
  *     if isinstance(arg,_replicas):
  *         if level>1:             # <<<<<<<<<<<<<<
  *             raise TypeError("@replica syntax only allowed for scalar or rank 1 vectors")
  *         return "@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg,level+1),comma=True)
  */
-    __pyx_t_1 = PyObject_RichCompare(__pyx_v_level, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 803, __pyx_L1_error)
-    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 803, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_v_level, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 985, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 985, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (unlikely(__pyx_t_6)) {
 
-      /* "plumed.pyx":804
+      /* "plumed.pyx":986
  *     if isinstance(arg,_replicas):
  *         if level>1:
  *             raise TypeError("@replica syntax only allowed for scalar or rank 1 vectors")             # <<<<<<<<<<<<<<
  *         return "@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg,level+1),comma=True)
  *     if hasattr(arg,'__iter__'):
  */
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__63, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 804, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__66, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 986, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_Raise(__pyx_t_1, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __PYX_ERR(0, 804, __pyx_L1_error)
+      __PYX_ERR(0, 986, __pyx_L1_error)
 
-      /* "plumed.pyx":803
+      /* "plumed.pyx":985
  *         raise TypeError("options cannot be a dictionary")
  *     if isinstance(arg,_replicas):
  *         if level>1:             # <<<<<<<<<<<<<<
  *             raise TypeError("@replica syntax only allowed for scalar or rank 1 vectors")
  *         return "@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg,level+1),comma=True)
  */
     }
 
-    /* "plumed.pyx":805
+    /* "plumed.pyx":987
  *         if level>1:
  *             raise TypeError("@replica syntax only allowed for scalar or rank 1 vectors")
  *         return "@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg,level+1),comma=True)             # <<<<<<<<<<<<<<
  *     if hasattr(arg,'__iter__'):
  *         string=""
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_fix_braces); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 805, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_fix_braces); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 987, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_single); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 805, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_single); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 987, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_arg); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 805, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_arg); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 987, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyInt_AddObjC(__pyx_v_level, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 805, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_AddObjC(__pyx_v_level, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 987, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __pyx_t_10 = NULL;
     __pyx_t_7 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_10)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -18112,167 +20454,167 @@
         __Pyx_DECREF_SET(__pyx_t_8, function);
         __pyx_t_7 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_8)) {
       PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_v_builder, __pyx_t_4, __pyx_t_9};
-      __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 805, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 987, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
       PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_v_builder, __pyx_t_4, __pyx_t_9};
-      __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 805, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 987, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     } else
     #endif
     {
-      __pyx_t_11 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 805, __pyx_L1_error)
+      __pyx_t_11 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 987, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       if (__pyx_t_10) {
         __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_10); __pyx_t_10 = NULL;
       }
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_7, __pyx_v_builder);
       __Pyx_GIVEREF(__pyx_t_4);
       PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_7, __pyx_t_4);
       __Pyx_GIVEREF(__pyx_t_9);
       PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_7, __pyx_t_9);
       __pyx_t_4 = 0;
       __pyx_t_9 = 0;
-      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_11, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 805, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_11, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 987, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     }
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 805, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 987, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_v_builder);
     __Pyx_GIVEREF(__pyx_v_builder);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_builder);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_5);
     __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 805, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 987, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_comma, Py_True) < 0) __PYX_ERR(0, 805, __pyx_L1_error)
-    __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 805, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_comma, Py_True) < 0) __PYX_ERR(0, 987, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 987, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_Add(__pyx_kp_u_replicas, __pyx_t_11); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 805, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_kp_u_replicas, __pyx_t_11); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 987, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     __pyx_r = __pyx_t_5;
     __pyx_t_5 = 0;
     goto __pyx_L0;
 
-    /* "plumed.pyx":802
+    /* "plumed.pyx":984
  *     if isinstance(arg,dict):
  *         raise TypeError("options cannot be a dictionary")
  *     if isinstance(arg,_replicas):             # <<<<<<<<<<<<<<
  *         if level>1:
  *             raise TypeError("@replica syntax only allowed for scalar or rank 1 vectors")
  */
   }
 
-  /* "plumed.pyx":806
+  /* "plumed.pyx":988
  *             raise TypeError("@replica syntax only allowed for scalar or rank 1 vectors")
  *         return "@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg,level+1),comma=True)
  *     if hasattr(arg,'__iter__'):             # <<<<<<<<<<<<<<
  *         string=""
  *         for x in arg:
  */
-  __pyx_t_6 = __Pyx_HasAttr(__pyx_v_arg, __pyx_n_u_iter); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 806, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_HasAttr(__pyx_v_arg, __pyx_n_u_iter); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 988, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_6 != 0);
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":807
+    /* "plumed.pyx":989
  *         return "@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg,level+1),comma=True)
  *     if hasattr(arg,'__iter__'):
  *         string=""             # <<<<<<<<<<<<<<
  *         for x in arg:
  *             string+=builder._separator + _fix_braces(builder,_format_single(builder,x,level+1),comma=True)
  */
-    __Pyx_INCREF(__pyx_kp_u__32);
-    __pyx_v_string = __pyx_kp_u__32;
+    __Pyx_INCREF(__pyx_kp_u__35);
+    __pyx_v_string = __pyx_kp_u__35;
 
-    /* "plumed.pyx":808
+    /* "plumed.pyx":990
  *     if hasattr(arg,'__iter__'):
  *         string=""
  *         for x in arg:             # <<<<<<<<<<<<<<
  *             string+=builder._separator + _fix_braces(builder,_format_single(builder,x,level+1),comma=True)
  *         return string[len(builder._separator):]
  */
     if (likely(PyList_CheckExact(__pyx_v_arg)) || PyTuple_CheckExact(__pyx_v_arg)) {
       __pyx_t_5 = __pyx_v_arg; __Pyx_INCREF(__pyx_t_5); __pyx_t_12 = 0;
       __pyx_t_13 = NULL;
     } else {
-      __pyx_t_12 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_arg); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 808, __pyx_L1_error)
+      __pyx_t_12 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_arg); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 990, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_13 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 808, __pyx_L1_error)
+      __pyx_t_13 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 990, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_13)) {
         if (likely(PyList_CheckExact(__pyx_t_5))) {
           if (__pyx_t_12 >= PyList_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_11 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_12); __Pyx_INCREF(__pyx_t_11); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 808, __pyx_L1_error)
+          __pyx_t_11 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_12); __Pyx_INCREF(__pyx_t_11); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 990, __pyx_L1_error)
           #else
-          __pyx_t_11 = PySequence_ITEM(__pyx_t_5, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 808, __pyx_L1_error)
+          __pyx_t_11 = PySequence_ITEM(__pyx_t_5, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 990, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           #endif
         } else {
           if (__pyx_t_12 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_11 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_12); __Pyx_INCREF(__pyx_t_11); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 808, __pyx_L1_error)
+          __pyx_t_11 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_12); __Pyx_INCREF(__pyx_t_11); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 990, __pyx_L1_error)
           #else
-          __pyx_t_11 = PySequence_ITEM(__pyx_t_5, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 808, __pyx_L1_error)
+          __pyx_t_11 = PySequence_ITEM(__pyx_t_5, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 990, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           #endif
         }
       } else {
         __pyx_t_11 = __pyx_t_13(__pyx_t_5);
         if (unlikely(!__pyx_t_11)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 808, __pyx_L1_error)
+            else __PYX_ERR(0, 990, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_11);
       }
       __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_11);
       __pyx_t_11 = 0;
 
-      /* "plumed.pyx":809
+      /* "plumed.pyx":991
  *         string=""
  *         for x in arg:
  *             string+=builder._separator + _fix_braces(builder,_format_single(builder,x,level+1),comma=True)             # <<<<<<<<<<<<<<
  *         return string[len(builder._separator):]
  *     raise TypeError("options should be string, number or iterable")
  */
-      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 809, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 991, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_fix_braces); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 809, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_fix_braces); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 991, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_format_single); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 809, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_format_single); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 991, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_4 = __Pyx_PyInt_AddObjC(__pyx_v_level, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 809, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyInt_AddObjC(__pyx_v_level, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 991, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __pyx_t_10 = NULL;
       __pyx_t_7 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
         __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
         if (likely(__pyx_t_10)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
@@ -18281,126 +20623,126 @@
           __Pyx_DECREF_SET(__pyx_t_9, function);
           __pyx_t_7 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_9)) {
         PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_v_builder, __pyx_v_x, __pyx_t_4};
-        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 991, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
         PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_v_builder, __pyx_v_x, __pyx_t_4};
-        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 991, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       } else
       #endif
       {
-        __pyx_t_14 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 809, __pyx_L1_error)
+        __pyx_t_14 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 991, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_14);
         if (__pyx_t_10) {
           __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_10); __pyx_t_10 = NULL;
         }
         __Pyx_INCREF(__pyx_v_builder);
         __Pyx_GIVEREF(__pyx_v_builder);
         PyTuple_SET_ITEM(__pyx_t_14, 0+__pyx_t_7, __pyx_v_builder);
         __Pyx_INCREF(__pyx_v_x);
         __Pyx_GIVEREF(__pyx_v_x);
         PyTuple_SET_ITEM(__pyx_t_14, 1+__pyx_t_7, __pyx_v_x);
         __Pyx_GIVEREF(__pyx_t_4);
         PyTuple_SET_ITEM(__pyx_t_14, 2+__pyx_t_7, __pyx_t_4);
         __pyx_t_4 = 0;
-        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_14, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_14, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 991, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
       }
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 809, __pyx_L1_error)
+      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 991, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_builder);
       __Pyx_GIVEREF(__pyx_t_1);
       PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_1);
       __pyx_t_1 = 0;
-      __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 991, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_comma, Py_True) < 0) __PYX_ERR(0, 809, __pyx_L1_error)
-      __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_9, __pyx_t_1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 809, __pyx_L1_error)
+      if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_comma, Py_True) < 0) __PYX_ERR(0, 991, __pyx_L1_error)
+      __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_9, __pyx_t_1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 991, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_14);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_1 = PyNumber_Add(__pyx_t_11, __pyx_t_14); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
+      __pyx_t_1 = PyNumber_Add(__pyx_t_11, __pyx_t_14); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 991, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      __pyx_t_14 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 809, __pyx_L1_error)
+      __pyx_t_14 = PyNumber_InPlaceAdd(__pyx_v_string, __pyx_t_1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 991, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_14);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_DECREF_SET(__pyx_v_string, __pyx_t_14);
       __pyx_t_14 = 0;
 
-      /* "plumed.pyx":808
+      /* "plumed.pyx":990
  *     if hasattr(arg,'__iter__'):
  *         string=""
  *         for x in arg:             # <<<<<<<<<<<<<<
  *             string+=builder._separator + _fix_braces(builder,_format_single(builder,x,level+1),comma=True)
  *         return string[len(builder._separator):]
  */
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "plumed.pyx":810
+    /* "plumed.pyx":992
  *         for x in arg:
  *             string+=builder._separator + _fix_braces(builder,_format_single(builder,x,level+1),comma=True)
  *         return string[len(builder._separator):]             # <<<<<<<<<<<<<<
  *     raise TypeError("options should be string, number or iterable")
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 810, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_separator); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 992, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_12 = PyObject_Length(__pyx_t_5); if (unlikely(__pyx_t_12 == ((Py_ssize_t)-1))) __PYX_ERR(0, 810, __pyx_L1_error)
+    __pyx_t_12 = PyObject_Length(__pyx_t_5); if (unlikely(__pyx_t_12 == ((Py_ssize_t)-1))) __PYX_ERR(0, 992, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyObject_GetSlice(__pyx_v_string, __pyx_t_12, 0, NULL, NULL, NULL, 1, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 810, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetSlice(__pyx_v_string, __pyx_t_12, 0, NULL, NULL, NULL, 1, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 992, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_r = __pyx_t_5;
     __pyx_t_5 = 0;
     goto __pyx_L0;
 
-    /* "plumed.pyx":806
+    /* "plumed.pyx":988
  *             raise TypeError("@replica syntax only allowed for scalar or rank 1 vectors")
  *         return "@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg,level+1),comma=True)
  *     if hasattr(arg,'__iter__'):             # <<<<<<<<<<<<<<
  *         string=""
  *         for x in arg:
  */
   }
 
-  /* "plumed.pyx":811
+  /* "plumed.pyx":993
  *             string+=builder._separator + _fix_braces(builder,_format_single(builder,x,level+1),comma=True)
  *         return string[len(builder._separator):]
  *     raise TypeError("options should be string, number or iterable")             # <<<<<<<<<<<<<<
  * 
  * def _format_numbered(builder,name,arg):
  */
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__64, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 811, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__67, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 993, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_Raise(__pyx_t_5, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __PYX_ERR(0, 811, __pyx_L1_error)
+  __PYX_ERR(0, 993, __pyx_L1_error)
 
-  /* "plumed.pyx":782
+  /* "plumed.pyx":964
  *     return arg
  * 
  * def _format_single(builder,arg,level=0):             # <<<<<<<<<<<<<<
  *     """Format a single argument.
  * 
  */
 
@@ -18423,27 +20765,27 @@
   __Pyx_XDECREF(__pyx_v_x);
   __Pyx_XDECREF(__pyx_v_arg);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":813
+/* "plumed.pyx":995
  *     raise TypeError("options should be string, number or iterable")
  * 
  * def _format_numbered(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format a numbered argument."""
  *     if isinstance(arg,_numbered):
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_25_format_numbered(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_24_format_numbered[] = "Format a numbered argument.";
-static PyMethodDef __pyx_mdef_6plumed_25_format_numbered = {"_format_numbered", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_25_format_numbered, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_24_format_numbered};
-static PyObject *__pyx_pw_6plumed_25_format_numbered(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_27_format_numbered(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_26_format_numbered[] = "Format a numbered argument.";
+static PyMethodDef __pyx_mdef_6plumed_27_format_numbered = {"_format_numbered", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_27_format_numbered, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_26_format_numbered};
+static PyObject *__pyx_pw_6plumed_27_format_numbered(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_name = 0;
   PyObject *__pyx_v_arg = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -18470,53 +20812,53 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_numbered", 1, 3, 3, 1); __PYX_ERR(0, 813, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_numbered", 1, 3, 3, 1); __PYX_ERR(0, 995, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_numbered", 1, 3, 3, 2); __PYX_ERR(0, 813, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_numbered", 1, 3, 3, 2); __PYX_ERR(0, 995, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_numbered") < 0)) __PYX_ERR(0, 813, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_numbered") < 0)) __PYX_ERR(0, 995, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_builder = values[0];
     __pyx_v_name = values[1];
     __pyx_v_arg = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_numbered", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 813, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_numbered", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 995, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_numbered", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_24_format_numbered(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_arg);
+  __pyx_r = __pyx_pf_6plumed_26_format_numbered(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_arg);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_24_format_numbered(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg) {
+static PyObject *__pyx_pf_6plumed_26_format_numbered(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg) {
   PyObject *__pyx_v_ret = NULL;
   PyObject *__pyx_v_x = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_t_3;
@@ -18531,147 +20873,147 @@
   PyObject *__pyx_t_12 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_numbered", 0);
   __Pyx_INCREF(__pyx_v_arg);
 
-  /* "plumed.pyx":815
+  /* "plumed.pyx":997
  * def _format_numbered(builder,name,arg):
  *     """Format a numbered argument."""
  *     if isinstance(arg,_numbered):             # <<<<<<<<<<<<<<
  *         arg=arg.arg
  *         ret=""
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_numbered_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 815, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_numbered_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 997, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_1); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 815, __pyx_L1_error)
+  __pyx_t_2 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_1); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 997, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":816
+    /* "plumed.pyx":998
  *     """Format a numbered argument."""
  *     if isinstance(arg,_numbered):
  *         arg=arg.arg             # <<<<<<<<<<<<<<
  *         ret=""
  *         for x in arg:
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 816, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 998, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "plumed.pyx":817
+    /* "plumed.pyx":999
  *     if isinstance(arg,_numbered):
  *         arg=arg.arg
  *         ret=""             # <<<<<<<<<<<<<<
  *         for x in arg:
  *             if not isinstance(x,int):
  */
-    __Pyx_INCREF(__pyx_kp_u__32);
-    __pyx_v_ret = __pyx_kp_u__32;
+    __Pyx_INCREF(__pyx_kp_u__35);
+    __pyx_v_ret = __pyx_kp_u__35;
 
-    /* "plumed.pyx":818
+    /* "plumed.pyx":1000
  *         arg=arg.arg
  *         ret=""
  *         for x in arg:             # <<<<<<<<<<<<<<
  *             if not isinstance(x,int):
  *                 raise TypeError("numbered types should have integer keys")
  */
     if (likely(PyList_CheckExact(__pyx_v_arg)) || PyTuple_CheckExact(__pyx_v_arg)) {
       __pyx_t_1 = __pyx_v_arg; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
       __pyx_t_5 = NULL;
     } else {
-      __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 818, __pyx_L1_error)
+      __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1000, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 818, __pyx_L1_error)
+      __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1000, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_5)) {
         if (likely(PyList_CheckExact(__pyx_t_1))) {
           if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 818, __pyx_L1_error)
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1000, __pyx_L1_error)
           #else
-          __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 818, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1000, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
         } else {
           if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 818, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 1000, __pyx_L1_error)
           #else
-          __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 818, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1000, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
         }
       } else {
         __pyx_t_6 = __pyx_t_5(__pyx_t_1);
         if (unlikely(!__pyx_t_6)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 818, __pyx_L1_error)
+            else __PYX_ERR(0, 1000, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_6);
       }
       __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "plumed.pyx":819
+      /* "plumed.pyx":1001
  *         ret=""
  *         for x in arg:
  *             if not isinstance(x,int):             # <<<<<<<<<<<<<<
  *                 raise TypeError("numbered types should have integer keys")
  *             ret+=_format_opt(builder,name+str(x),arg[x])
  */
       __pyx_t_3 = PyInt_Check(__pyx_v_x); 
       __pyx_t_2 = ((!(__pyx_t_3 != 0)) != 0);
       if (unlikely(__pyx_t_2)) {
 
-        /* "plumed.pyx":820
+        /* "plumed.pyx":1002
  *         for x in arg:
  *             if not isinstance(x,int):
  *                 raise TypeError("numbered types should have integer keys")             # <<<<<<<<<<<<<<
  *             ret+=_format_opt(builder,name+str(x),arg[x])
  *         return ret
  */
-        __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__65, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 820, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__68, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1002, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_Raise(__pyx_t_6, 0, 0, 0);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __PYX_ERR(0, 820, __pyx_L1_error)
+        __PYX_ERR(0, 1002, __pyx_L1_error)
 
-        /* "plumed.pyx":819
+        /* "plumed.pyx":1001
  *         ret=""
  *         for x in arg:
  *             if not isinstance(x,int):             # <<<<<<<<<<<<<<
  *                 raise TypeError("numbered types should have integer keys")
  *             ret+=_format_opt(builder,name+str(x),arg[x])
  */
       }
 
-      /* "plumed.pyx":821
+      /* "plumed.pyx":1003
  *             if not isinstance(x,int):
  *                 raise TypeError("numbered types should have integer keys")
  *             ret+=_format_opt(builder,name+str(x),arg[x])             # <<<<<<<<<<<<<<
  *         return ret
  *     return _format_opt(builder,name,arg)
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_format_opt); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 821, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_format_opt); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1003, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_8 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 821, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_v_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1003, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_9 = PyNumber_Add(__pyx_v_name, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 821, __pyx_L1_error)
+      __pyx_t_9 = PyNumber_Add(__pyx_v_name, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1003, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_arg, __pyx_v_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 821, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_arg, __pyx_v_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1003, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_10 = NULL;
       __pyx_t_11 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
         __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_7);
         if (likely(__pyx_t_10)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
@@ -18680,97 +21022,97 @@
           __Pyx_DECREF_SET(__pyx_t_7, function);
           __pyx_t_11 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_7)) {
         PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_v_builder, __pyx_t_9, __pyx_t_8};
-        __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_11, 3+__pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 821, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_11, 3+__pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1003, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
         PyObject *__pyx_temp[4] = {__pyx_t_10, __pyx_v_builder, __pyx_t_9, __pyx_t_8};
-        __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_11, 3+__pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 821, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_11, 3+__pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1003, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       {
-        __pyx_t_12 = PyTuple_New(3+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 821, __pyx_L1_error)
+        __pyx_t_12 = PyTuple_New(3+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1003, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         if (__pyx_t_10) {
           __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_10); __pyx_t_10 = NULL;
         }
         __Pyx_INCREF(__pyx_v_builder);
         __Pyx_GIVEREF(__pyx_v_builder);
         PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_v_builder);
         __Pyx_GIVEREF(__pyx_t_9);
         PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, __pyx_t_9);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_12, 2+__pyx_t_11, __pyx_t_8);
         __pyx_t_9 = 0;
         __pyx_t_8 = 0;
-        __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 821, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1003, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       }
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 821, __pyx_L1_error)
+      __pyx_t_7 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1003, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_7);
       __pyx_t_7 = 0;
 
-      /* "plumed.pyx":818
+      /* "plumed.pyx":1000
  *         arg=arg.arg
  *         ret=""
  *         for x in arg:             # <<<<<<<<<<<<<<
  *             if not isinstance(x,int):
  *                 raise TypeError("numbered types should have integer keys")
  */
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "plumed.pyx":822
+    /* "plumed.pyx":1004
  *                 raise TypeError("numbered types should have integer keys")
  *             ret+=_format_opt(builder,name+str(x),arg[x])
  *         return ret             # <<<<<<<<<<<<<<
  *     return _format_opt(builder,name,arg)
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_ret);
     __pyx_r = __pyx_v_ret;
     goto __pyx_L0;
 
-    /* "plumed.pyx":815
+    /* "plumed.pyx":997
  * def _format_numbered(builder,name,arg):
  *     """Format a numbered argument."""
  *     if isinstance(arg,_numbered):             # <<<<<<<<<<<<<<
  *         arg=arg.arg
  *         ret=""
  */
   }
 
-  /* "plumed.pyx":823
+  /* "plumed.pyx":1005
  *             ret+=_format_opt(builder,name+str(x),arg[x])
  *         return ret
  *     return _format_opt(builder,name,arg)             # <<<<<<<<<<<<<<
  * 
  * def _format_flag(builder,name,arg):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_format_opt); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 823, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_format_opt); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   __pyx_t_11 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
@@ -18779,52 +21121,52 @@
       __Pyx_DECREF_SET(__pyx_t_7, function);
       __pyx_t_11 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_7)) {
     PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_builder, __pyx_v_name, __pyx_v_arg};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_11, 3+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_11, 3+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1005, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
     PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_builder, __pyx_v_name, __pyx_v_arg};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_11, 3+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_11, 3+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1005, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_12 = PyTuple_New(3+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_12 = PyTuple_New(3+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1005, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_builder);
     __Pyx_GIVEREF(__pyx_v_builder);
     PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_v_builder);
     __Pyx_INCREF(__pyx_v_name);
     __Pyx_GIVEREF(__pyx_v_name);
     PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, __pyx_v_name);
     __Pyx_INCREF(__pyx_v_arg);
     __Pyx_GIVEREF(__pyx_v_arg);
     PyTuple_SET_ITEM(__pyx_t_12, 2+__pyx_t_11, __pyx_v_arg);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_12, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_12, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1005, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
   }
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":813
+  /* "plumed.pyx":995
  *     raise TypeError("options should be string, number or iterable")
  * 
  * def _format_numbered(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format a numbered argument."""
  *     if isinstance(arg,_numbered):
  */
 
@@ -18844,27 +21186,27 @@
   __Pyx_XDECREF(__pyx_v_x);
   __Pyx_XDECREF(__pyx_v_arg);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":825
+/* "plumed.pyx":1007
  *     return _format_opt(builder,name,arg)
  * 
  * def _format_flag(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format a flag."""
  *     if arg is None:
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_27_format_flag(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_26_format_flag[] = "Format a flag.";
-static PyMethodDef __pyx_mdef_6plumed_27_format_flag = {"_format_flag", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_27_format_flag, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_26_format_flag};
-static PyObject *__pyx_pw_6plumed_27_format_flag(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_29_format_flag(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_28_format_flag[] = "Format a flag.";
+static PyMethodDef __pyx_mdef_6plumed_29_format_flag = {"_format_flag", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_29_format_flag, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_28_format_flag};
+static PyObject *__pyx_pw_6plumed_29_format_flag(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   CYTHON_UNUSED PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_name = 0;
   PyObject *__pyx_v_arg = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -18891,183 +21233,183 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_flag", 1, 3, 3, 1); __PYX_ERR(0, 825, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_flag", 1, 3, 3, 1); __PYX_ERR(0, 1007, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_flag", 1, 3, 3, 2); __PYX_ERR(0, 825, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_flag", 1, 3, 3, 2); __PYX_ERR(0, 1007, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_flag") < 0)) __PYX_ERR(0, 825, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_flag") < 0)) __PYX_ERR(0, 1007, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_builder = values[0];
     __pyx_v_name = values[1];
     __pyx_v_arg = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_flag", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 825, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_flag", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1007, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_flag", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_26_format_flag(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_arg);
+  __pyx_r = __pyx_pf_6plumed_28_format_flag(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_arg);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_26_format_flag(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg) {
+static PyObject *__pyx_pf_6plumed_28_format_flag(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_flag", 0);
 
-  /* "plumed.pyx":827
+  /* "plumed.pyx":1009
  * def _format_flag(builder,name,arg):
  *     """Format a flag."""
  *     if arg is None:             # <<<<<<<<<<<<<<
  *         return ""
  *     if isinstance(arg,bool):
  */
   __pyx_t_1 = (__pyx_v_arg == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":828
+    /* "plumed.pyx":1010
  *     """Format a flag."""
  *     if arg is None:
  *         return ""             # <<<<<<<<<<<<<<
  *     if isinstance(arg,bool):
  *         if arg:
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_kp_u__32);
-    __pyx_r = __pyx_kp_u__32;
+    __Pyx_INCREF(__pyx_kp_u__35);
+    __pyx_r = __pyx_kp_u__35;
     goto __pyx_L0;
 
-    /* "plumed.pyx":827
+    /* "plumed.pyx":1009
  * def _format_flag(builder,name,arg):
  *     """Format a flag."""
  *     if arg is None:             # <<<<<<<<<<<<<<
  *         return ""
  *     if isinstance(arg,bool):
  */
   }
 
-  /* "plumed.pyx":829
+  /* "plumed.pyx":1011
  *     if arg is None:
  *         return ""
  *     if isinstance(arg,bool):             # <<<<<<<<<<<<<<
  *         if arg:
  *             return " " + name
  */
   __pyx_t_3 = ((PyObject*)&PyBool_Type);
   __Pyx_INCREF(__pyx_t_3);
-  __pyx_t_2 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_3); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 829, __pyx_L1_error)
+  __pyx_t_2 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_3); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 1011, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":830
+    /* "plumed.pyx":1012
  *         return ""
  *     if isinstance(arg,bool):
  *         if arg:             # <<<<<<<<<<<<<<
  *             return " " + name
  *         else:
  */
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_arg); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 830, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_arg); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1012, __pyx_L1_error)
     if (__pyx_t_1) {
 
-      /* "plumed.pyx":831
+      /* "plumed.pyx":1013
  *     if isinstance(arg,bool):
  *         if arg:
  *             return " " + name             # <<<<<<<<<<<<<<
  *         else:
  *             return ""
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_3 = PyNumber_Add(__pyx_kp_u__22, __pyx_v_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 831, __pyx_L1_error)
+      __pyx_t_3 = PyNumber_Add(__pyx_kp_u__24, __pyx_v_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1013, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __pyx_r = __pyx_t_3;
       __pyx_t_3 = 0;
       goto __pyx_L0;
 
-      /* "plumed.pyx":830
+      /* "plumed.pyx":1012
  *         return ""
  *     if isinstance(arg,bool):
  *         if arg:             # <<<<<<<<<<<<<<
  *             return " " + name
  *         else:
  */
     }
 
-    /* "plumed.pyx":833
+    /* "plumed.pyx":1015
  *             return " " + name
  *         else:
  *             return ""             # <<<<<<<<<<<<<<
  *     raise TypeError(name + " should be of bool type")
  * 
  */
     /*else*/ {
       __Pyx_XDECREF(__pyx_r);
-      __Pyx_INCREF(__pyx_kp_u__32);
-      __pyx_r = __pyx_kp_u__32;
+      __Pyx_INCREF(__pyx_kp_u__35);
+      __pyx_r = __pyx_kp_u__35;
       goto __pyx_L0;
     }
 
-    /* "plumed.pyx":829
+    /* "plumed.pyx":1011
  *     if arg is None:
  *         return ""
  *     if isinstance(arg,bool):             # <<<<<<<<<<<<<<
  *         if arg:
  *             return " " + name
  */
   }
 
-  /* "plumed.pyx":834
+  /* "plumed.pyx":1016
  *         else:
  *             return ""
  *     raise TypeError(name + " should be of bool type")             # <<<<<<<<<<<<<<
  * 
  * def _format_label(builder,label):
  */
-  __pyx_t_3 = PyNumber_Add(__pyx_v_name, __pyx_kp_u_should_be_of_bool_type); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 834, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Add(__pyx_v_name, __pyx_kp_u_should_be_of_bool_type); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1016, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 834, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1016, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_Raise(__pyx_t_4, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __PYX_ERR(0, 834, __pyx_L1_error)
+  __PYX_ERR(0, 1016, __pyx_L1_error)
 
-  /* "plumed.pyx":825
+  /* "plumed.pyx":1007
  *     return _format_opt(builder,name,arg)
  * 
  * def _format_flag(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format a flag."""
  *     if arg is None:
  */
 
@@ -19079,27 +21421,27 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":836
+/* "plumed.pyx":1018
  *     raise TypeError(name + " should be of bool type")
  * 
  * def _format_label(builder,label):             # <<<<<<<<<<<<<<
  *     """Format a label."""
  *     if label is None:
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_29_format_label(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_28_format_label[] = "Format a label.";
-static PyMethodDef __pyx_mdef_6plumed_29_format_label = {"_format_label", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_29_format_label, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_28_format_label};
-static PyObject *__pyx_pw_6plumed_29_format_label(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_31_format_label(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_30_format_label[] = "Format a label.";
+static PyMethodDef __pyx_mdef_6plumed_31_format_label = {"_format_label", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_31_format_label, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_30_format_label};
+static PyObject *__pyx_pw_6plumed_31_format_label(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   CYTHON_UNUSED PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_label = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
@@ -19123,168 +21465,168 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_label_2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_label", 1, 2, 2, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_label", 1, 2, 2, 1); __PYX_ERR(0, 1018, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_label") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_label") < 0)) __PYX_ERR(0, 1018, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_builder = values[0];
     __pyx_v_label = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_label", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_label", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1018, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_label", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_28_format_label(__pyx_self, __pyx_v_builder, __pyx_v_label);
+  __pyx_r = __pyx_pf_6plumed_30_format_label(__pyx_self, __pyx_v_builder, __pyx_v_label);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_28_format_label(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_label) {
+static PyObject *__pyx_pf_6plumed_30_format_label(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_label) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   Py_ssize_t __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_label", 0);
 
-  /* "plumed.pyx":838
+  /* "plumed.pyx":1020
  * def _format_label(builder,label):
  *     """Format a label."""
  *     if label is None:             # <<<<<<<<<<<<<<
  *         return ""
  *     if isinstance(label,str):
  */
   __pyx_t_1 = (__pyx_v_label == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":839
+    /* "plumed.pyx":1021
  *     """Format a label."""
  *     if label is None:
  *         return ""             # <<<<<<<<<<<<<<
  *     if isinstance(label,str):
  *         if len(label)==0:
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_kp_u__32);
-    __pyx_r = __pyx_kp_u__32;
+    __Pyx_INCREF(__pyx_kp_u__35);
+    __pyx_r = __pyx_kp_u__35;
     goto __pyx_L0;
 
-    /* "plumed.pyx":838
+    /* "plumed.pyx":1020
  * def _format_label(builder,label):
  *     """Format a label."""
  *     if label is None:             # <<<<<<<<<<<<<<
  *         return ""
  *     if isinstance(label,str):
  */
   }
 
-  /* "plumed.pyx":840
+  /* "plumed.pyx":1022
  *     if label is None:
  *         return ""
  *     if isinstance(label,str):             # <<<<<<<<<<<<<<
  *         if len(label)==0:
  *             return ""
  */
   __pyx_t_2 = PyUnicode_Check(__pyx_v_label); 
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":841
+    /* "plumed.pyx":1023
  *         return ""
  *     if isinstance(label,str):
  *         if len(label)==0:             # <<<<<<<<<<<<<<
  *             return ""
  *         return label+": "
  */
-    __pyx_t_3 = PyObject_Length(__pyx_v_label); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 841, __pyx_L1_error)
+    __pyx_t_3 = PyObject_Length(__pyx_v_label); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1023, __pyx_L1_error)
     __pyx_t_1 = ((__pyx_t_3 == 0) != 0);
     if (__pyx_t_1) {
 
-      /* "plumed.pyx":842
+      /* "plumed.pyx":1024
  *     if isinstance(label,str):
  *         if len(label)==0:
  *             return ""             # <<<<<<<<<<<<<<
  *         return label+": "
  *     raise TypeError("label should be of str type")
  */
       __Pyx_XDECREF(__pyx_r);
-      __Pyx_INCREF(__pyx_kp_u__32);
-      __pyx_r = __pyx_kp_u__32;
+      __Pyx_INCREF(__pyx_kp_u__35);
+      __pyx_r = __pyx_kp_u__35;
       goto __pyx_L0;
 
-      /* "plumed.pyx":841
+      /* "plumed.pyx":1023
  *         return ""
  *     if isinstance(label,str):
  *         if len(label)==0:             # <<<<<<<<<<<<<<
  *             return ""
  *         return label+": "
  */
     }
 
-    /* "plumed.pyx":843
+    /* "plumed.pyx":1025
  *         if len(label)==0:
  *             return ""
  *         return label+": "             # <<<<<<<<<<<<<<
  *     raise TypeError("label should be of str type")
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_4 = PyNumber_Add(__pyx_v_label, __pyx_kp_u__66); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 843, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_v_label, __pyx_kp_u__69); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1025, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_r = __pyx_t_4;
     __pyx_t_4 = 0;
     goto __pyx_L0;
 
-    /* "plumed.pyx":840
+    /* "plumed.pyx":1022
  *     if label is None:
  *         return ""
  *     if isinstance(label,str):             # <<<<<<<<<<<<<<
  *         if len(label)==0:
  *             return ""
  */
   }
 
-  /* "plumed.pyx":844
+  /* "plumed.pyx":1026
  *             return ""
  *         return label+": "
  *     raise TypeError("label should be of str type")             # <<<<<<<<<<<<<<
  * 
  * def _format_opt(builder,name,arg):
  */
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__67, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 844, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__70, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_Raise(__pyx_t_4, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __PYX_ERR(0, 844, __pyx_L1_error)
+  __PYX_ERR(0, 1026, __pyx_L1_error)
 
-  /* "plumed.pyx":836
+  /* "plumed.pyx":1018
  *     raise TypeError(name + " should be of bool type")
  * 
  * def _format_label(builder,label):             # <<<<<<<<<<<<<<
  *     """Format a label."""
  *     if label is None:
  */
 
@@ -19295,27 +21637,27 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":846
+/* "plumed.pyx":1028
  *     raise TypeError("label should be of str type")
  * 
  * def _format_opt(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format an option."""
  *     if arg is None:
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_31_format_opt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_30_format_opt[] = "Format an option.";
-static PyMethodDef __pyx_mdef_6plumed_31_format_opt = {"_format_opt", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_31_format_opt, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_30_format_opt};
-static PyObject *__pyx_pw_6plumed_31_format_opt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_33_format_opt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_32_format_opt[] = "Format an option.";
+static PyMethodDef __pyx_mdef_6plumed_33_format_opt = {"_format_opt", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_33_format_opt, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_32_format_opt};
+static PyObject *__pyx_pw_6plumed_33_format_opt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_name = 0;
   PyObject *__pyx_v_arg = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -19342,53 +21684,53 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_opt", 1, 3, 3, 1); __PYX_ERR(0, 846, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_opt", 1, 3, 3, 1); __PYX_ERR(0, 1028, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_opt", 1, 3, 3, 2); __PYX_ERR(0, 846, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_opt", 1, 3, 3, 2); __PYX_ERR(0, 1028, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_opt") < 0)) __PYX_ERR(0, 846, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_opt") < 0)) __PYX_ERR(0, 1028, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_builder = values[0];
     __pyx_v_name = values[1];
     __pyx_v_arg = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_opt", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 846, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_opt", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1028, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_opt", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_30_format_opt(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_arg);
+  __pyx_r = __pyx_pf_6plumed_32_format_opt(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_arg);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_30_format_opt(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg) {
+static PyObject *__pyx_pf_6plumed_32_format_opt(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg) {
   PyObject *__pyx_v_string = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
@@ -19398,72 +21740,72 @@
   int __pyx_t_8;
   PyObject *__pyx_t_9 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_opt", 0);
 
-  /* "plumed.pyx":848
+  /* "plumed.pyx":1030
  * def _format_opt(builder,name,arg):
  *     """Format an option."""
  *     if arg is None:             # <<<<<<<<<<<<<<
  *         return ""
  *     if isinstance(arg,_replicas):
  */
   __pyx_t_1 = (__pyx_v_arg == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":849
+    /* "plumed.pyx":1031
  *     """Format an option."""
  *     if arg is None:
  *         return ""             # <<<<<<<<<<<<<<
  *     if isinstance(arg,_replicas):
  *         string="@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg),comma=False)
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_kp_u__32);
-    __pyx_r = __pyx_kp_u__32;
+    __Pyx_INCREF(__pyx_kp_u__35);
+    __pyx_r = __pyx_kp_u__35;
     goto __pyx_L0;
 
-    /* "plumed.pyx":848
+    /* "plumed.pyx":1030
  * def _format_opt(builder,name,arg):
  *     """Format an option."""
  *     if arg is None:             # <<<<<<<<<<<<<<
  *         return ""
  *     if isinstance(arg,_replicas):
  */
   }
 
-  /* "plumed.pyx":850
+  /* "plumed.pyx":1032
  *     if arg is None:
  *         return ""
  *     if isinstance(arg,_replicas):             # <<<<<<<<<<<<<<
  *         string="@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg),comma=False)
  *     else:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_replicas_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 850, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_replicas_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1032, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_3); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 850, __pyx_L1_error)
+  __pyx_t_2 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_3); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 1032, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":851
+    /* "plumed.pyx":1033
  *         return ""
  *     if isinstance(arg,_replicas):
  *         string="@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg),comma=False)             # <<<<<<<<<<<<<<
  *     else:
  *         string=_fix_braces(builder,_format_single(builder,arg),comma=False)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_fix_braces); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 851, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_fix_braces); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1033, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_format_single); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 851, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_format_single); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1033, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 851, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1033, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_7 = NULL;
     __pyx_t_8 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -19472,89 +21814,89 @@
         __Pyx_DECREF_SET(__pyx_t_5, function);
         __pyx_t_8 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_5)) {
       PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_v_builder, __pyx_t_6};
-      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 851, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1033, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
       PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_v_builder, __pyx_t_6};
-      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 851, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1033, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     } else
     #endif
     {
-      __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 851, __pyx_L1_error)
+      __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1033, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       if (__pyx_t_7) {
         __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
       }
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_v_builder);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_6);
       __pyx_t_6 = 0;
-      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 851, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1033, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 851, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1033, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_INCREF(__pyx_v_builder);
     __Pyx_GIVEREF(__pyx_v_builder);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_builder);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 851, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1033, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_comma, Py_False) < 0) __PYX_ERR(0, 851, __pyx_L1_error)
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 851, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_comma, Py_False) < 0) __PYX_ERR(0, 1033, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1033, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_Add(__pyx_kp_u_replicas, __pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 851, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_kp_u_replicas, __pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1033, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_v_string = __pyx_t_4;
     __pyx_t_4 = 0;
 
-    /* "plumed.pyx":850
+    /* "plumed.pyx":1032
  *     if arg is None:
  *         return ""
  *     if isinstance(arg,_replicas):             # <<<<<<<<<<<<<<
  *         string="@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg),comma=False)
  *     else:
  */
     goto __pyx_L4;
   }
 
-  /* "plumed.pyx":853
+  /* "plumed.pyx":1035
  *         string="@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg),comma=False)
  *     else:
  *         string=_fix_braces(builder,_format_single(builder,arg),comma=False)             # <<<<<<<<<<<<<<
  *     return " " + name + "=" + string
  * 
  */
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_fix_braces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_fix_braces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1035, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_format_single); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_format_single); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1035, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_3 = NULL;
     __pyx_t_8 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -19563,86 +21905,86 @@
         __Pyx_DECREF_SET(__pyx_t_5, function);
         __pyx_t_8 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_5)) {
       PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_builder, __pyx_v_arg};
-      __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 853, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1035, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_GOTREF(__pyx_t_9);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
       PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_builder, __pyx_v_arg};
-      __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 853, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1035, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_GOTREF(__pyx_t_9);
     } else
     #endif
     {
-      __pyx_t_6 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 853, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1035, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       if (__pyx_t_3) {
         __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3); __pyx_t_3 = NULL;
       }
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_8, __pyx_v_builder);
       __Pyx_INCREF(__pyx_v_arg);
       __Pyx_GIVEREF(__pyx_v_arg);
       PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_8, __pyx_v_arg);
-      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 853, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1035, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1035, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_INCREF(__pyx_v_builder);
     __Pyx_GIVEREF(__pyx_v_builder);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_builder);
     __Pyx_GIVEREF(__pyx_t_9);
     PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_9);
     __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1035, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_comma, Py_False) < 0) __PYX_ERR(0, 853, __pyx_L1_error)
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 853, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_comma, Py_False) < 0) __PYX_ERR(0, 1035, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1035, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_v_string = __pyx_t_6;
     __pyx_t_6 = 0;
   }
   __pyx_L4:;
 
-  /* "plumed.pyx":854
+  /* "plumed.pyx":1036
  *     else:
  *         string=_fix_braces(builder,_format_single(builder,arg),comma=False)
  *     return " " + name + "=" + string             # <<<<<<<<<<<<<<
  * 
  * def _format_return(builder,ret):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_6 = PyNumber_Add(__pyx_kp_u__22, __pyx_v_name); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 854, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Add(__pyx_kp_u__24, __pyx_v_name); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1036, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_9 = PyNumber_Add(__pyx_t_6, __pyx_kp_u__68); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 854, __pyx_L1_error)
+  __pyx_t_9 = PyNumber_Add(__pyx_t_6, __pyx_kp_u__71); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1036, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Add(__pyx_t_9, __pyx_v_string); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 854, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Add(__pyx_t_9, __pyx_v_string); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1036, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __pyx_r = __pyx_t_6;
   __pyx_t_6 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":846
+  /* "plumed.pyx":1028
  *     raise TypeError("label should be of str type")
  * 
  * def _format_opt(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format an option."""
  *     if arg is None:
  */
 
@@ -19659,27 +22001,27 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_string);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":856
+/* "plumed.pyx":1038
  *     return " " + name + "=" + string
  * 
  * def _format_return(builder,ret):             # <<<<<<<<<<<<<<
  *     """Format the return statement"""
  *     if not builder._toplumed is None :
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_33_format_return(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_32_format_return[] = "Format the return statement";
-static PyMethodDef __pyx_mdef_6plumed_33_format_return = {"_format_return", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_33_format_return, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_32_format_return};
-static PyObject *__pyx_pw_6plumed_33_format_return(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_35_format_return(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_34_format_return[] = "Format the return statement";
+static PyMethodDef __pyx_mdef_6plumed_35_format_return = {"_format_return", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_35_format_return, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_34_format_return};
+static PyObject *__pyx_pw_6plumed_35_format_return(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_ret = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
@@ -19703,45 +22045,45 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ret_3)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_return", 1, 2, 2, 1); __PYX_ERR(0, 856, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_return", 1, 2, 2, 1); __PYX_ERR(0, 1038, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_return") < 0)) __PYX_ERR(0, 856, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_return") < 0)) __PYX_ERR(0, 1038, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_builder = values[0];
     __pyx_v_ret = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_return", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 856, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_return", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1038, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_return", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_32_format_return(__pyx_self, __pyx_v_builder, __pyx_v_ret);
+  __pyx_r = __pyx_pf_6plumed_34_format_return(__pyx_self, __pyx_v_builder, __pyx_v_ret);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_32_format_return(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_ret) {
+static PyObject *__pyx_pf_6plumed_34_format_return(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_ret) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -19752,29 +22094,29 @@
   PyObject *__pyx_t_10 = NULL;
   int __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_return", 0);
 
-  /* "plumed.pyx":858
+  /* "plumed.pyx":1040
  * def _format_return(builder,ret):
  *     """Format the return statement"""
  *     if not builder._toplumed is None :             # <<<<<<<<<<<<<<
  *         try:
  *           builder._toplumed.cmd("readInputLine",ret)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_toplumed); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 858, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_toplumed); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1040, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = (__pyx_t_1 != Py_None);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":859
+    /* "plumed.pyx":1041
  *     """Format the return statement"""
  *     if not builder._toplumed is None :
  *         try:             # <<<<<<<<<<<<<<
  *           builder._toplumed.cmd("readInputLine",ret)
  *         except:
  */
     {
@@ -19782,24 +22124,24 @@
       __Pyx_PyThreadState_assign
       __Pyx_ExceptionSave(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
       __Pyx_XGOTREF(__pyx_t_4);
       __Pyx_XGOTREF(__pyx_t_5);
       __Pyx_XGOTREF(__pyx_t_6);
       /*try:*/ {
 
-        /* "plumed.pyx":860
+        /* "plumed.pyx":1042
  *     if not builder._toplumed is None :
  *         try:
  *           builder._toplumed.cmd("readInputLine",ret)             # <<<<<<<<<<<<<<
  *         except:
  *           builder.last_failure=ret
  */
-        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_toplumed); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 860, __pyx_L4_error)
+        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_toplumed); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1042, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_cmd); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L4_error)
+        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_cmd); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1042, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __pyx_t_7 = NULL;
         __pyx_t_9 = 0;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
           __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
           if (likely(__pyx_t_7)) {
@@ -19809,47 +22151,47 @@
             __Pyx_DECREF_SET(__pyx_t_8, function);
             __pyx_t_9 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_8)) {
           PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_n_u_readInputLine, __pyx_v_ret};
-          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 860, __pyx_L4_error)
+          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1042, __pyx_L4_error)
           __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
           __Pyx_GOTREF(__pyx_t_1);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
           PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_n_u_readInputLine, __pyx_v_ret};
-          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 860, __pyx_L4_error)
+          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1042, __pyx_L4_error)
           __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
           __Pyx_GOTREF(__pyx_t_1);
         } else
         #endif
         {
-          __pyx_t_10 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 860, __pyx_L4_error)
+          __pyx_t_10 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1042, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_10);
           if (__pyx_t_7) {
             __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_7); __pyx_t_7 = NULL;
           }
           __Pyx_INCREF(__pyx_n_u_readInputLine);
           __Pyx_GIVEREF(__pyx_n_u_readInputLine);
           PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_n_u_readInputLine);
           __Pyx_INCREF(__pyx_v_ret);
           __Pyx_GIVEREF(__pyx_v_ret);
           PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_v_ret);
-          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 860, __pyx_L4_error)
+          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1042, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
         }
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-        /* "plumed.pyx":859
+        /* "plumed.pyx":1041
  *     """Format the return statement"""
  *     if not builder._toplumed is None :
  *         try:             # <<<<<<<<<<<<<<
  *           builder._toplumed.cmd("readInputLine",ret)
  *         except:
  */
       }
@@ -19859,211 +22201,211 @@
       goto __pyx_L9_try_end;
       __pyx_L4_error:;
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "plumed.pyx":861
+      /* "plumed.pyx":1043
  *         try:
  *           builder._toplumed.cmd("readInputLine",ret)
  *         except:             # <<<<<<<<<<<<<<
  *           builder.last_failure=ret
  *           raise
  */
       /*except:*/ {
         __Pyx_AddTraceback("plumed._format_return", __pyx_clineno, __pyx_lineno, __pyx_filename);
-        if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_8, &__pyx_t_10) < 0) __PYX_ERR(0, 861, __pyx_L6_except_error)
+        if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_8, &__pyx_t_10) < 0) __PYX_ERR(0, 1043, __pyx_L6_except_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_GOTREF(__pyx_t_10);
 
-        /* "plumed.pyx":862
+        /* "plumed.pyx":1044
  *           builder._toplumed.cmd("readInputLine",ret)
  *         except:
  *           builder.last_failure=ret             # <<<<<<<<<<<<<<
  *           raise
  *     if not builder._tofile is None:
  */
-        if (__Pyx_PyObject_SetAttrStr(__pyx_v_builder, __pyx_n_s_last_failure, __pyx_v_ret) < 0) __PYX_ERR(0, 862, __pyx_L6_except_error)
+        if (__Pyx_PyObject_SetAttrStr(__pyx_v_builder, __pyx_n_s_last_failure, __pyx_v_ret) < 0) __PYX_ERR(0, 1044, __pyx_L6_except_error)
 
-        /* "plumed.pyx":863
+        /* "plumed.pyx":1045
  *         except:
  *           builder.last_failure=ret
  *           raise             # <<<<<<<<<<<<<<
  *     if not builder._tofile is None:
  *         builder._tofile.write(ret + "\n")
  */
         __Pyx_GIVEREF(__pyx_t_1);
         __Pyx_GIVEREF(__pyx_t_8);
         __Pyx_XGIVEREF(__pyx_t_10);
         __Pyx_ErrRestoreWithState(__pyx_t_1, __pyx_t_8, __pyx_t_10);
         __pyx_t_1 = 0; __pyx_t_8 = 0; __pyx_t_10 = 0; 
-        __PYX_ERR(0, 863, __pyx_L6_except_error)
+        __PYX_ERR(0, 1045, __pyx_L6_except_error)
       }
       __pyx_L6_except_error:;
 
-      /* "plumed.pyx":859
+      /* "plumed.pyx":1041
  *     """Format the return statement"""
  *     if not builder._toplumed is None :
  *         try:             # <<<<<<<<<<<<<<
  *           builder._toplumed.cmd("readInputLine",ret)
  *         except:
  */
       __Pyx_XGIVEREF(__pyx_t_4);
       __Pyx_XGIVEREF(__pyx_t_5);
       __Pyx_XGIVEREF(__pyx_t_6);
       __Pyx_ExceptionReset(__pyx_t_4, __pyx_t_5, __pyx_t_6);
       goto __pyx_L1_error;
       __pyx_L9_try_end:;
     }
 
-    /* "plumed.pyx":858
+    /* "plumed.pyx":1040
  * def _format_return(builder,ret):
  *     """Format the return statement"""
  *     if not builder._toplumed is None :             # <<<<<<<<<<<<<<
  *         try:
  *           builder._toplumed.cmd("readInputLine",ret)
  */
   }
 
-  /* "plumed.pyx":864
+  /* "plumed.pyx":1046
  *           builder.last_failure=ret
  *           raise
  *     if not builder._tofile is None:             # <<<<<<<<<<<<<<
  *         builder._tofile.write(ret + "\n")
  *     builder.history.append(ret)
  */
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_tofile); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 864, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_tofile_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1046, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __pyx_t_3 = (__pyx_t_10 != Py_None);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_t_2 = (__pyx_t_3 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":865
+    /* "plumed.pyx":1047
  *           raise
  *     if not builder._tofile is None:
  *         builder._tofile.write(ret + "\n")             # <<<<<<<<<<<<<<
  *     builder.history.append(ret)
  *     if builder._post_format is not None:
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_tofile); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 865, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_tofile_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1047, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 865, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1047, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = PyNumber_Add(__pyx_v_ret, __pyx_kp_u__30); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 865, __pyx_L1_error)
+    __pyx_t_8 = PyNumber_Add(__pyx_v_ret, __pyx_kp_u__32); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1047, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
         __Pyx_INCREF(__pyx_t_7);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_10 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_7, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_8);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 865, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1047, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-    /* "plumed.pyx":864
+    /* "plumed.pyx":1046
  *           builder.last_failure=ret
  *           raise
  *     if not builder._tofile is None:             # <<<<<<<<<<<<<<
  *         builder._tofile.write(ret + "\n")
  *     builder.history.append(ret)
  */
   }
 
-  /* "plumed.pyx":866
+  /* "plumed.pyx":1048
  *     if not builder._tofile is None:
  *         builder._tofile.write(ret + "\n")
  *     builder.history.append(ret)             # <<<<<<<<<<<<<<
  *     if builder._post_format is not None:
  *         return builder._post_format(ret)
  */
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_history); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 866, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_history); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_11 = __Pyx_PyObject_Append(__pyx_t_10, __pyx_v_ret); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 866, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_Append(__pyx_t_10, __pyx_v_ret); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 1048, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-  /* "plumed.pyx":867
+  /* "plumed.pyx":1049
  *         builder._tofile.write(ret + "\n")
  *     builder.history.append(ret)
  *     if builder._post_format is not None:             # <<<<<<<<<<<<<<
  *         return builder._post_format(ret)
  *     return ret + "\n"
  */
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_post_format); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 867, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_post_format); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __pyx_t_2 = (__pyx_t_10 != Py_None);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "plumed.pyx":868
+    /* "plumed.pyx":1050
  *     builder.history.append(ret)
  *     if builder._post_format is not None:
  *         return builder._post_format(ret)             # <<<<<<<<<<<<<<
  *     return ret + "\n"
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_post_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 868, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_builder, __pyx_n_s_post_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1050, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_8 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_8)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
         __Pyx_INCREF(__pyx_t_8);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_10 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_8, __pyx_v_ret) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_ret);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 868, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1050, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_r = __pyx_t_10;
     __pyx_t_10 = 0;
     goto __pyx_L0;
 
-    /* "plumed.pyx":867
+    /* "plumed.pyx":1049
  *         builder._tofile.write(ret + "\n")
  *     builder.history.append(ret)
  *     if builder._post_format is not None:             # <<<<<<<<<<<<<<
  *         return builder._post_format(ret)
  *     return ret + "\n"
  */
   }
 
-  /* "plumed.pyx":869
+  /* "plumed.pyx":1051
  *     if builder._post_format is not None:
  *         return builder._post_format(ret)
  *     return ret + "\n"             # <<<<<<<<<<<<<<
  * 
  * def _format_verbatim(builder,verbatim):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_10 = PyNumber_Add(__pyx_v_ret, __pyx_kp_u__30); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 869, __pyx_L1_error)
+  __pyx_t_10 = PyNumber_Add(__pyx_v_ret, __pyx_kp_u__32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1051, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __pyx_r = __pyx_t_10;
   __pyx_t_10 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":856
+  /* "plumed.pyx":1038
  *     return " " + name + "=" + string
  * 
  * def _format_return(builder,ret):             # <<<<<<<<<<<<<<
  *     """Format the return statement"""
  *     if not builder._toplumed is None :
  */
 
@@ -20077,26 +22419,26 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":871
+/* "plumed.pyx":1053
  *     return ret + "\n"
  * 
  * def _format_verbatim(builder,verbatim):             # <<<<<<<<<<<<<<
  *   if not verbatim is None:
  *     if(len(verbatim)>0):
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_35_format_verbatim(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_6plumed_35_format_verbatim = {"_format_verbatim", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_35_format_verbatim, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_6plumed_35_format_verbatim(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_37_format_verbatim(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_6plumed_37_format_verbatim = {"_format_verbatim", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_37_format_verbatim, METH_VARARGS|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_6plumed_37_format_verbatim(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   CYTHON_UNUSED PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_verbatim = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
@@ -20120,45 +22462,45 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_verbatim)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_verbatim", 1, 2, 2, 1); __PYX_ERR(0, 871, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_verbatim", 1, 2, 2, 1); __PYX_ERR(0, 1053, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_verbatim") < 0)) __PYX_ERR(0, 871, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_verbatim") < 0)) __PYX_ERR(0, 1053, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_builder = values[0];
     __pyx_v_verbatim = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_verbatim", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 871, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_verbatim", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1053, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_verbatim", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_34_format_verbatim(__pyx_self, __pyx_v_builder, __pyx_v_verbatim);
+  __pyx_r = __pyx_pf_6plumed_36_format_verbatim(__pyx_self, __pyx_v_builder, __pyx_v_verbatim);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_34_format_verbatim(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_verbatim) {
+static PyObject *__pyx_pf_6plumed_36_format_verbatim(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_builder, PyObject *__pyx_v_verbatim) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   Py_ssize_t __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -20166,47 +22508,47 @@
   int __pyx_t_7;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_verbatim", 0);
 
-  /* "plumed.pyx":872
+  /* "plumed.pyx":1054
  * 
  * def _format_verbatim(builder,verbatim):
  *   if not verbatim is None:             # <<<<<<<<<<<<<<
  *     if(len(verbatim)>0):
  *       return " "+re.sub("[\n\t]"," ",verbatim)
  */
   __pyx_t_1 = (__pyx_v_verbatim != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":873
+    /* "plumed.pyx":1055
  * def _format_verbatim(builder,verbatim):
  *   if not verbatim is None:
  *     if(len(verbatim)>0):             # <<<<<<<<<<<<<<
  *       return " "+re.sub("[\n\t]"," ",verbatim)
  *   return ""
  */
-    __pyx_t_3 = PyObject_Length(__pyx_v_verbatim); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 873, __pyx_L1_error)
+    __pyx_t_3 = PyObject_Length(__pyx_v_verbatim); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1055, __pyx_L1_error)
     __pyx_t_2 = ((__pyx_t_3 > 0) != 0);
     if (__pyx_t_2) {
 
-      /* "plumed.pyx":874
+      /* "plumed.pyx":1056
  *   if not verbatim is None:
  *     if(len(verbatim)>0):
  *       return " "+re.sub("[\n\t]"," ",verbatim)             # <<<<<<<<<<<<<<
  *   return ""
  * 
  */
       __Pyx_XDECREF(__pyx_r);
-      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 874, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1056, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_sub); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 874, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_sub); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1056, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_t_5 = NULL;
       __pyx_t_7 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
         __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
         if (likely(__pyx_t_5)) {
@@ -20215,86 +22557,86 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_6, function);
           __pyx_t_7 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_6)) {
-        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u__61, __pyx_kp_u__22, __pyx_v_verbatim};
-        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 874, __pyx_L1_error)
+        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u__64, __pyx_kp_u__24, __pyx_v_verbatim};
+        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1056, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_GOTREF(__pyx_t_4);
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
-        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u__61, __pyx_kp_u__22, __pyx_v_verbatim};
-        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 874, __pyx_L1_error)
+        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u__64, __pyx_kp_u__24, __pyx_v_verbatim};
+        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1056, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_GOTREF(__pyx_t_4);
       } else
       #endif
       {
-        __pyx_t_8 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 874, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1056, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         if (__pyx_t_5) {
           __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
         }
-        __Pyx_INCREF(__pyx_kp_u__61);
-        __Pyx_GIVEREF(__pyx_kp_u__61);
-        PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_kp_u__61);
-        __Pyx_INCREF(__pyx_kp_u__22);
-        __Pyx_GIVEREF(__pyx_kp_u__22);
-        PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_kp_u__22);
+        __Pyx_INCREF(__pyx_kp_u__64);
+        __Pyx_GIVEREF(__pyx_kp_u__64);
+        PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_kp_u__64);
+        __Pyx_INCREF(__pyx_kp_u__24);
+        __Pyx_GIVEREF(__pyx_kp_u__24);
+        PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_kp_u__24);
         __Pyx_INCREF(__pyx_v_verbatim);
         __Pyx_GIVEREF(__pyx_v_verbatim);
         PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, __pyx_v_verbatim);
-        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 874, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1056, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       }
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_6 = PyNumber_Add(__pyx_kp_u__22, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 874, __pyx_L1_error)
+      __pyx_t_6 = PyNumber_Add(__pyx_kp_u__24, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1056, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_r = __pyx_t_6;
       __pyx_t_6 = 0;
       goto __pyx_L0;
 
-      /* "plumed.pyx":873
+      /* "plumed.pyx":1055
  * def _format_verbatim(builder,verbatim):
  *   if not verbatim is None:
  *     if(len(verbatim)>0):             # <<<<<<<<<<<<<<
  *       return " "+re.sub("[\n\t]"," ",verbatim)
  *   return ""
  */
     }
 
-    /* "plumed.pyx":872
+    /* "plumed.pyx":1054
  * 
  * def _format_verbatim(builder,verbatim):
  *   if not verbatim is None:             # <<<<<<<<<<<<<<
  *     if(len(verbatim)>0):
  *       return " "+re.sub("[\n\t]"," ",verbatim)
  */
   }
 
-  /* "plumed.pyx":875
+  /* "plumed.pyx":1057
  *     if(len(verbatim)>0):
  *       return " "+re.sub("[\n\t]"," ",verbatim)
  *   return ""             # <<<<<<<<<<<<<<
  * 
  * def _format_anything(builder,name,arg):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(__pyx_kp_u__32);
-  __pyx_r = __pyx_kp_u__32;
+  __Pyx_INCREF(__pyx_kp_u__35);
+  __pyx_r = __pyx_kp_u__35;
   goto __pyx_L0;
 
-  /* "plumed.pyx":871
+  /* "plumed.pyx":1053
  *     return ret + "\n"
  * 
  * def _format_verbatim(builder,verbatim):             # <<<<<<<<<<<<<<
  *   if not verbatim is None:
  *     if(len(verbatim)>0):
  */
 
@@ -20308,27 +22650,27 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":877
+/* "plumed.pyx":1059
  *   return ""
  * 
  * def _format_anything(builder,name,arg):             # <<<<<<<<<<<<<<
  *    """Choose format based on arg type"""
  *    ret=""
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6plumed_37_format_anything(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6plumed_36_format_anything[] = "Choose format based on arg type";
-static PyMethodDef __pyx_mdef_6plumed_37_format_anything = {"_format_anything", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_37_format_anything, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_36_format_anything};
-static PyObject *__pyx_pw_6plumed_37_format_anything(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6plumed_39_format_anything(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_6plumed_38_format_anything[] = "Choose format based on arg type";
+static PyMethodDef __pyx_mdef_6plumed_39_format_anything = {"_format_anything", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_39_format_anything, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6plumed_38_format_anything};
+static PyObject *__pyx_pw_6plumed_39_format_anything(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_builder = 0;
   PyObject *__pyx_v_name = 0;
   PyObject *__pyx_v_arg = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -20355,53 +22697,53 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_anything", 1, 3, 3, 1); __PYX_ERR(0, 877, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_anything", 1, 3, 3, 1); __PYX_ERR(0, 1059, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_format_anything", 1, 3, 3, 2); __PYX_ERR(0, 877, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_format_anything", 1, 3, 3, 2); __PYX_ERR(0, 1059, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_anything") < 0)) __PYX_ERR(0, 877, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_format_anything") < 0)) __PYX_ERR(0, 1059, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_builder = values[0];
     __pyx_v_name = values[1];
     __pyx_v_arg = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_format_anything", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 877, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_format_anything", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1059, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed._format_anything", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6plumed_36_format_anything(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_arg);
+  __pyx_r = __pyx_pf_6plumed_38_format_anything(__pyx_self, __pyx_v_builder, __pyx_v_name, __pyx_v_arg);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6plumed_36_format_anything(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg) {
+static PyObject *__pyx_pf_6plumed_38_format_anything(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_builder, PyObject *__pyx_v_name, PyObject *__pyx_v_arg) {
   PyObject *__pyx_v_ret = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
@@ -20409,42 +22751,42 @@
   PyObject *__pyx_t_6 = NULL;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_format_anything", 0);
 
-  /* "plumed.pyx":879
+  /* "plumed.pyx":1061
  * def _format_anything(builder,name,arg):
  *    """Choose format based on arg type"""
  *    ret=""             # <<<<<<<<<<<<<<
  *    if name == "verbatim":
  *        ret+=_format_verbatim(builder,arg)
  */
-  __Pyx_INCREF(__pyx_kp_u__32);
-  __pyx_v_ret = __pyx_kp_u__32;
+  __Pyx_INCREF(__pyx_kp_u__35);
+  __pyx_v_ret = __pyx_kp_u__35;
 
-  /* "plumed.pyx":880
+  /* "plumed.pyx":1062
  *    """Choose format based on arg type"""
  *    ret=""
  *    if name == "verbatim":             # <<<<<<<<<<<<<<
  *        ret+=_format_verbatim(builder,arg)
  *    elif isinstance(arg,bool) :
  */
-  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_name, __pyx_n_u_verbatim, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 880, __pyx_L1_error)
+  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_name, __pyx_n_u_verbatim, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1062, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":881
+    /* "plumed.pyx":1063
  *    ret=""
  *    if name == "verbatim":
  *        ret+=_format_verbatim(builder,arg)             # <<<<<<<<<<<<<<
  *    elif isinstance(arg,bool) :
  *        ret+=_format_flag(builder,name,arg)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_format_verbatim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 881, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_format_verbatim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1063, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     __pyx_t_5 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -20453,82 +22795,82 @@
         __Pyx_DECREF_SET(__pyx_t_3, function);
         __pyx_t_5 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_builder, __pyx_v_arg};
-      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 881, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1063, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_2);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_builder, __pyx_v_arg};
-      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 881, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1063, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_2);
     } else
     #endif
     {
-      __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 881, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1063, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       if (__pyx_t_4) {
         __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
       }
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_builder);
       __Pyx_INCREF(__pyx_v_arg);
       __Pyx_GIVEREF(__pyx_v_arg);
       PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_arg);
-      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 881, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1063, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 881, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1063, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "plumed.pyx":880
+    /* "plumed.pyx":1062
  *    """Choose format based on arg type"""
  *    ret=""
  *    if name == "verbatim":             # <<<<<<<<<<<<<<
  *        ret+=_format_verbatim(builder,arg)
  *    elif isinstance(arg,bool) :
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":882
+  /* "plumed.pyx":1064
  *    if name == "verbatim":
  *        ret+=_format_verbatim(builder,arg)
  *    elif isinstance(arg,bool) :             # <<<<<<<<<<<<<<
  *        ret+=_format_flag(builder,name,arg)
  *    elif isinstance(arg,_numbered):
  */
   __pyx_t_3 = ((PyObject*)&PyBool_Type);
   __Pyx_INCREF(__pyx_t_3);
-  __pyx_t_1 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_3); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 882, __pyx_L1_error)
+  __pyx_t_1 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_3); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 1064, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_7 = (__pyx_t_1 != 0);
   if (__pyx_t_7) {
 
-    /* "plumed.pyx":883
+    /* "plumed.pyx":1065
  *        ret+=_format_verbatim(builder,arg)
  *    elif isinstance(arg,bool) :
  *        ret+=_format_flag(builder,name,arg)             # <<<<<<<<<<<<<<
  *    elif isinstance(arg,_numbered):
  *        ret+=_format_numbered(builder,name,arg)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_flag); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 883, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_flag); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1065, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_6 = NULL;
     __pyx_t_5 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -20537,85 +22879,85 @@
         __Pyx_DECREF_SET(__pyx_t_2, function);
         __pyx_t_5 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_builder, __pyx_v_name, __pyx_v_arg};
-      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 883, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1065, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_GOTREF(__pyx_t_3);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_builder, __pyx_v_name, __pyx_v_arg};
-      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 883, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1065, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_GOTREF(__pyx_t_3);
     } else
     #endif
     {
-      __pyx_t_4 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 883, __pyx_L1_error)
+      __pyx_t_4 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1065, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       if (__pyx_t_6) {
         __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6); __pyx_t_6 = NULL;
       }
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_5, __pyx_v_builder);
       __Pyx_INCREF(__pyx_v_name);
       __Pyx_GIVEREF(__pyx_v_name);
       PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_5, __pyx_v_name);
       __Pyx_INCREF(__pyx_v_arg);
       __Pyx_GIVEREF(__pyx_v_arg);
       PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_5, __pyx_v_arg);
-      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 883, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1065, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 883, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1065, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "plumed.pyx":882
+    /* "plumed.pyx":1064
  *    if name == "verbatim":
  *        ret+=_format_verbatim(builder,arg)
  *    elif isinstance(arg,bool) :             # <<<<<<<<<<<<<<
  *        ret+=_format_flag(builder,name,arg)
  *    elif isinstance(arg,_numbered):
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":884
+  /* "plumed.pyx":1066
  *    elif isinstance(arg,bool) :
  *        ret+=_format_flag(builder,name,arg)
  *    elif isinstance(arg,_numbered):             # <<<<<<<<<<<<<<
  *        ret+=_format_numbered(builder,name,arg)
  *    else:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_numbered_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 884, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_numbered_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1066, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_7 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_2); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 884, __pyx_L1_error)
+  __pyx_t_7 = PyObject_IsInstance(__pyx_v_arg, __pyx_t_2); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 1066, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_1 = (__pyx_t_7 != 0);
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":885
+    /* "plumed.pyx":1067
  *        ret+=_format_flag(builder,name,arg)
  *    elif isinstance(arg,_numbered):
  *        ret+=_format_numbered(builder,name,arg)             # <<<<<<<<<<<<<<
  *    else:
  *        ret+=_format_opt(builder,name,arg)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_format_numbered); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 885, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_format_numbered); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1067, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     __pyx_t_5 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -20624,72 +22966,72 @@
         __Pyx_DECREF_SET(__pyx_t_3, function);
         __pyx_t_5 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_builder, __pyx_v_name, __pyx_v_arg};
-      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 885, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1067, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_2);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_builder, __pyx_v_name, __pyx_v_arg};
-      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 885, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1067, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_2);
     } else
     #endif
     {
-      __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 885, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1067, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       if (__pyx_t_4) {
         __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
       }
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_builder);
       __Pyx_INCREF(__pyx_v_name);
       __Pyx_GIVEREF(__pyx_v_name);
       PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_name);
       __Pyx_INCREF(__pyx_v_arg);
       __Pyx_GIVEREF(__pyx_v_arg);
       PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_5, __pyx_v_arg);
-      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 885, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1067, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 885, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1067, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "plumed.pyx":884
+    /* "plumed.pyx":1066
  *    elif isinstance(arg,bool) :
  *        ret+=_format_flag(builder,name,arg)
  *    elif isinstance(arg,_numbered):             # <<<<<<<<<<<<<<
  *        ret+=_format_numbered(builder,name,arg)
  *    else:
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":887
+  /* "plumed.pyx":1069
  *        ret+=_format_numbered(builder,name,arg)
  *    else:
  *        ret+=_format_opt(builder,name,arg)             # <<<<<<<<<<<<<<
  *    return ret
  * 
  */
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_opt); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 887, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_opt); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1069, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_6 = NULL;
     __pyx_t_5 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -20698,68 +23040,68 @@
         __Pyx_DECREF_SET(__pyx_t_2, function);
         __pyx_t_5 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_builder, __pyx_v_name, __pyx_v_arg};
-      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1069, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_GOTREF(__pyx_t_3);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_v_builder, __pyx_v_name, __pyx_v_arg};
-      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 3+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1069, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_GOTREF(__pyx_t_3);
     } else
     #endif
     {
-      __pyx_t_4 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_4 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1069, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       if (__pyx_t_6) {
         __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6); __pyx_t_6 = NULL;
       }
       __Pyx_INCREF(__pyx_v_builder);
       __Pyx_GIVEREF(__pyx_v_builder);
       PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_5, __pyx_v_builder);
       __Pyx_INCREF(__pyx_v_name);
       __Pyx_GIVEREF(__pyx_v_name);
       PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_5, __pyx_v_name);
       __Pyx_INCREF(__pyx_v_arg);
       __Pyx_GIVEREF(__pyx_v_arg);
       PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_5, __pyx_v_arg);
-      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1069, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 887, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1069, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_2);
     __pyx_t_2 = 0;
   }
   __pyx_L3:;
 
-  /* "plumed.pyx":888
+  /* "plumed.pyx":1070
  *    else:
  *        ret+=_format_opt(builder,name,arg)
  *    return ret             # <<<<<<<<<<<<<<
  * 
  * # this functions are made available for the exec commands
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_ret);
   __pyx_r = __pyx_v_ret;
   goto __pyx_L0;
 
-  /* "plumed.pyx":877
+  /* "plumed.pyx":1059
  *   return ""
  * 
  * def _format_anything(builder,name,arg):             # <<<<<<<<<<<<<<
  *    """Choose format based on arg type"""
  *    ret=""
  */
 
@@ -20774,15 +23116,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_ret);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":907
+/* "plumed.pyx":1089
  *        Check the constructor to see all the available options.
  *     """
  *     def __init__(self,             # <<<<<<<<<<<<<<
  *                  *,
  *                  tofile=None,
  */
 
@@ -20806,108 +23148,108 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tofile_2,&__pyx_n_s_toplumed_2,&__pyx_n_s_kernel,&__pyx_n_s_append_underscores,&__pyx_n_s_comma_separator,&__pyx_n_s_minimize_braces_2,&__pyx_n_s_enable_at,&__pyx_n_s_load_dict,&__pyx_n_s_enable_mda_groups_2,&__pyx_n_s_post_format_2,&__pyx_n_s_pre_format_2,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tofile,&__pyx_n_s_toplumed_2,&__pyx_n_s_kernel,&__pyx_n_s_append_underscores,&__pyx_n_s_comma_separator,&__pyx_n_s_minimize_braces_2,&__pyx_n_s_enable_at,&__pyx_n_s_load_dict,&__pyx_n_s_enable_mda_groups_2,&__pyx_n_s_post_format_2,&__pyx_n_s_pre_format_2,0};
     PyObject* values[12] = {0,0,0,0,0,0,0,0,0,0,0,0};
 
-    /* "plumed.pyx":909
+    /* "plumed.pyx":1091
  *     def __init__(self,
  *                  *,
  *                  tofile=None,             # <<<<<<<<<<<<<<
  *                  toplumed=None,
  *                  kernel=None,
  */
     values[1] = ((PyObject *)((PyObject *)Py_None));
 
-    /* "plumed.pyx":910
+    /* "plumed.pyx":1092
  *                  *,
  *                  tofile=None,
  *                  toplumed=None,             # <<<<<<<<<<<<<<
  *                  kernel=None,
  *                  append_underscores=False,
  */
     values[2] = ((PyObject *)((PyObject *)Py_None));
 
-    /* "plumed.pyx":911
+    /* "plumed.pyx":1093
  *                  tofile=None,
  *                  toplumed=None,
  *                  kernel=None,             # <<<<<<<<<<<<<<
  *                  append_underscores=False,
  *                  comma_separator=False,
  */
     values[3] = ((PyObject *)((PyObject *)Py_None));
 
-    /* "plumed.pyx":912
+    /* "plumed.pyx":1094
  *                  toplumed=None,
  *                  kernel=None,
  *                  append_underscores=False,             # <<<<<<<<<<<<<<
  *                  comma_separator=False,
  *                  minimize_braces=True,
  */
     values[4] = ((PyObject *)((PyObject *)Py_False));
 
-    /* "plumed.pyx":913
+    /* "plumed.pyx":1095
  *                  kernel=None,
  *                  append_underscores=False,
  *                  comma_separator=False,             # <<<<<<<<<<<<<<
  *                  minimize_braces=True,
  *                  enable_at=True,
  */
     values[5] = ((PyObject *)((PyObject *)Py_False));
 
-    /* "plumed.pyx":914
+    /* "plumed.pyx":1096
  *                  append_underscores=False,
  *                  comma_separator=False,
  *                  minimize_braces=True,             # <<<<<<<<<<<<<<
  *                  enable_at=True,
  *                  load_dict=True,
  */
     values[6] = ((PyObject *)((PyObject *)Py_True));
 
-    /* "plumed.pyx":915
+    /* "plumed.pyx":1097
  *                  comma_separator=False,
  *                  minimize_braces=True,
  *                  enable_at=True,             # <<<<<<<<<<<<<<
  *                  load_dict=True,
  *                  enable_mda_groups=True,
  */
     values[7] = ((PyObject *)((PyObject *)Py_True));
 
-    /* "plumed.pyx":916
+    /* "plumed.pyx":1098
  *                  minimize_braces=True,
  *                  enable_at=True,
  *                  load_dict=True,             # <<<<<<<<<<<<<<
  *                  enable_mda_groups=True,
  *                  post_format=None,
  */
     values[8] = ((PyObject *)((PyObject *)Py_True));
 
-    /* "plumed.pyx":917
+    /* "plumed.pyx":1099
  *                  enable_at=True,
  *                  load_dict=True,
  *                  enable_mda_groups=True,             # <<<<<<<<<<<<<<
  *                  post_format=None,
  *                  pre_format=None):
  */
     values[9] = ((PyObject *)((PyObject *)Py_True));
 
-    /* "plumed.pyx":918
+    /* "plumed.pyx":1100
  *                  load_dict=True,
  *                  enable_mda_groups=True,
  *                  post_format=None,             # <<<<<<<<<<<<<<
  *                  pre_format=None):
  *         """Constructor.
  */
     values[10] = ((PyObject *)((PyObject *)Py_None));
 
-    /* "plumed.pyx":919
+    /* "plumed.pyx":1101
  *                  enable_mda_groups=True,
  *                  post_format=None,
  *                  pre_format=None):             # <<<<<<<<<<<<<<
  *         """Constructor.
  * 
  */
     values[11] = ((PyObject *)((PyObject *)Py_None));
@@ -20930,15 +23272,15 @@
         Py_ssize_t index;
         for (index = 1; index < 12 && kw_args > 0; index++) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 907, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1089, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_self = values[0];
@@ -20952,23 +23294,23 @@
     __pyx_v_load_dict = values[8];
     __pyx_v_enable_mda_groups = values[9];
     __pyx_v_post_format = values[10];
     __pyx_v_pre_format = values[11];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 907, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1089, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.InputBuilder.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder___init__(__pyx_self, __pyx_v_self, __pyx_v_tofile, __pyx_v_toplumed, __pyx_v_kernel, __pyx_v_append_underscores, __pyx_v_comma_separator, __pyx_v_minimize_braces, __pyx_v_enable_at, __pyx_v_load_dict, __pyx_v_enable_mda_groups, __pyx_v_post_format, __pyx_v_pre_format);
 
-  /* "plumed.pyx":907
+  /* "plumed.pyx":1089
  *        Check the constructor to see all the available options.
  *     """
  *     def __init__(self,             # <<<<<<<<<<<<<<
  *                  *,
  *                  tofile=None,
  */
 
@@ -20996,321 +23338,321 @@
   PyObject *__pyx_t_12 = NULL;
   PyObject *__pyx_t_13 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "plumed.pyx":945
+  /* "plumed.pyx":1127
  *              have a non-working MDAnalysis module installed.
  *         """
  *         self._toplumed=toplumed             # <<<<<<<<<<<<<<
  *         self._tofile=tofile
  *         if comma_separator:
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_toplumed, __pyx_v_toplumed) < 0) __PYX_ERR(0, 945, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_toplumed, __pyx_v_toplumed) < 0) __PYX_ERR(0, 1127, __pyx_L1_error)
 
-  /* "plumed.pyx":946
+  /* "plumed.pyx":1128
  *         """
  *         self._toplumed=toplumed
  *         self._tofile=tofile             # <<<<<<<<<<<<<<
  *         if comma_separator:
  *           self._separator=","
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_tofile, __pyx_v_tofile) < 0) __PYX_ERR(0, 946, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_tofile_2, __pyx_v_tofile) < 0) __PYX_ERR(0, 1128, __pyx_L1_error)
 
-  /* "plumed.pyx":947
+  /* "plumed.pyx":1129
  *         self._toplumed=toplumed
  *         self._tofile=tofile
  *         if comma_separator:             # <<<<<<<<<<<<<<
  *           self._separator=","
  *         else:
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_comma_separator); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 947, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_comma_separator); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1129, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":948
+    /* "plumed.pyx":1130
  *         self._tofile=tofile
  *         if comma_separator:
  *           self._separator=","             # <<<<<<<<<<<<<<
  *         else:
  *           self._separator=" "
  */
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_separator, __pyx_kp_u__42) < 0) __PYX_ERR(0, 948, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_separator, __pyx_kp_u__45) < 0) __PYX_ERR(0, 1130, __pyx_L1_error)
 
-    /* "plumed.pyx":947
+    /* "plumed.pyx":1129
  *         self._toplumed=toplumed
  *         self._tofile=tofile
  *         if comma_separator:             # <<<<<<<<<<<<<<
  *           self._separator=","
  *         else:
  */
     goto __pyx_L3;
   }
 
-  /* "plumed.pyx":950
+  /* "plumed.pyx":1132
  *           self._separator=","
  *         else:
  *           self._separator=" "             # <<<<<<<<<<<<<<
  *         self._minimize_braces=minimize_braces
  *         self._append_underscores=append_underscores
  */
   /*else*/ {
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_separator, __pyx_kp_u__22) < 0) __PYX_ERR(0, 950, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_separator, __pyx_kp_u__24) < 0) __PYX_ERR(0, 1132, __pyx_L1_error)
   }
   __pyx_L3:;
 
-  /* "plumed.pyx":951
+  /* "plumed.pyx":1133
  *         else:
  *           self._separator=" "
  *         self._minimize_braces=minimize_braces             # <<<<<<<<<<<<<<
  *         self._append_underscores=append_underscores
  *         # history of plumed lines
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_minimize_braces, __pyx_v_minimize_braces) < 0) __PYX_ERR(0, 951, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_minimize_braces, __pyx_v_minimize_braces) < 0) __PYX_ERR(0, 1133, __pyx_L1_error)
 
-  /* "plumed.pyx":952
+  /* "plumed.pyx":1134
  *           self._separator=" "
  *         self._minimize_braces=minimize_braces
  *         self._append_underscores=append_underscores             # <<<<<<<<<<<<<<
  *         # history of plumed lines
  *         self.history=[]
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_append_underscores_2, __pyx_v_append_underscores) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_append_underscores_2, __pyx_v_append_underscores) < 0) __PYX_ERR(0, 1134, __pyx_L1_error)
 
-  /* "plumed.pyx":954
+  /* "plumed.pyx":1136
  *         self._append_underscores=append_underscores
  *         # history of plumed lines
  *         self.history=[]             # <<<<<<<<<<<<<<
  *         # last line leading to a failure in a Plumed object
  *         self.last_failure=""
  */
-  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_history, __pyx_t_2) < 0) __PYX_ERR(0, 954, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_history, __pyx_t_2) < 0) __PYX_ERR(0, 1136, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":956
+  /* "plumed.pyx":1138
  *         self.history=[]
  *         # last line leading to a failure in a Plumed object
  *         self.last_failure=""             # <<<<<<<<<<<<<<
  *         self._has_dict=False
  *         self._enable_mda_groups=enable_mda_groups
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_last_failure, __pyx_kp_u__32) < 0) __PYX_ERR(0, 956, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_last_failure, __pyx_kp_u__35) < 0) __PYX_ERR(0, 1138, __pyx_L1_error)
 
-  /* "plumed.pyx":957
+  /* "plumed.pyx":1139
  *         # last line leading to a failure in a Plumed object
  *         self.last_failure=""
  *         self._has_dict=False             # <<<<<<<<<<<<<<
  *         self._enable_mda_groups=enable_mda_groups
  *         self._pre_format=pre_format
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_has_dict, Py_False) < 0) __PYX_ERR(0, 957, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_has_dict, Py_False) < 0) __PYX_ERR(0, 1139, __pyx_L1_error)
 
-  /* "plumed.pyx":958
+  /* "plumed.pyx":1140
  *         self.last_failure=""
  *         self._has_dict=False
  *         self._enable_mda_groups=enable_mda_groups             # <<<<<<<<<<<<<<
  *         self._pre_format=pre_format
  *         self._post_format=post_format
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_enable_mda_groups, __pyx_v_enable_mda_groups) < 0) __PYX_ERR(0, 958, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_enable_mda_groups, __pyx_v_enable_mda_groups) < 0) __PYX_ERR(0, 1140, __pyx_L1_error)
 
-  /* "plumed.pyx":959
+  /* "plumed.pyx":1141
  *         self._has_dict=False
  *         self._enable_mda_groups=enable_mda_groups
  *         self._pre_format=pre_format             # <<<<<<<<<<<<<<
  *         self._post_format=post_format
  *         if load_dict:
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_pre_format, __pyx_v_pre_format) < 0) __PYX_ERR(0, 959, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_pre_format, __pyx_v_pre_format) < 0) __PYX_ERR(0, 1141, __pyx_L1_error)
 
-  /* "plumed.pyx":960
+  /* "plumed.pyx":1142
  *         self._enable_mda_groups=enable_mda_groups
  *         self._pre_format=pre_format
  *         self._post_format=post_format             # <<<<<<<<<<<<<<
  *         if load_dict:
  *             # stored for debugging:
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_post_format, __pyx_v_post_format) < 0) __PYX_ERR(0, 960, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_post_format, __pyx_v_post_format) < 0) __PYX_ERR(0, 1142, __pyx_L1_error)
 
-  /* "plumed.pyx":961
+  /* "plumed.pyx":1143
  *         self._pre_format=pre_format
  *         self._post_format=post_format
  *         if load_dict:             # <<<<<<<<<<<<<<
  *             # stored for debugging:
  *             self._vimdict,self._doc=_readvimdict(kernel=kernel)
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_load_dict); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 961, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_load_dict); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1143, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":963
+    /* "plumed.pyx":1145
  *         if load_dict:
  *             # stored for debugging:
  *             self._vimdict,self._doc=_readvimdict(kernel=kernel)             # <<<<<<<<<<<<<<
  *             # stored for debugging:
  *             self._functions=_create_functions(self._vimdict,doc=self._doc,append_underscores=append_underscores)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_readvimdict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 963, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_readvimdict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1145, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 963, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1145, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_kernel, __pyx_v_kernel) < 0) __PYX_ERR(0, 963, __pyx_L1_error)
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_empty_tuple, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 963, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_kernel, __pyx_v_kernel) < 0) __PYX_ERR(0, 1145, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_empty_tuple, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1145, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
       PyObject* sequence = __pyx_t_4;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 2)) {
         if (size > 2) __Pyx_RaiseTooManyValuesError(2);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 963, __pyx_L1_error)
+        __PYX_ERR(0, 1145, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
       } else {
         __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
         __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
       }
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       #else
-      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 963, __pyx_L1_error)
+      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1145, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 963, __pyx_L1_error)
+      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1145, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       #endif
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 963, __pyx_L1_error)
+      __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1145, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_t_6 = Py_TYPE(__pyx_t_5)->tp_iternext;
       index = 0; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L5_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_3);
       index = 1; __pyx_t_2 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L5_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_2);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 2) < 0) __PYX_ERR(0, 963, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 2) < 0) __PYX_ERR(0, 1145, __pyx_L1_error)
       __pyx_t_6 = NULL;
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       goto __pyx_L6_unpacking_done;
       __pyx_L5_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_t_6 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 963, __pyx_L1_error)
+      __PYX_ERR(0, 1145, __pyx_L1_error)
       __pyx_L6_unpacking_done:;
     }
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vimdict, __pyx_t_3) < 0) __PYX_ERR(0, 963, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vimdict, __pyx_t_3) < 0) __PYX_ERR(0, 1145, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_doc_4, __pyx_t_2) < 0) __PYX_ERR(0, 963, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_doc_4, __pyx_t_2) < 0) __PYX_ERR(0, 1145, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":965
+    /* "plumed.pyx":1147
  *             self._vimdict,self._doc=_readvimdict(kernel=kernel)
  *             # stored for debugging:
  *             self._functions=_create_functions(self._vimdict,doc=self._doc,append_underscores=append_underscores)             # <<<<<<<<<<<<<<
  *             for action in self._functions:
  *                 ldict={}
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_create_functions); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 965, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_create_functions); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_vimdict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 965, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_vimdict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 965, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_2);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
     __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 965, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_doc_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 965, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_doc_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_doc_2, __pyx_t_5) < 0) __PYX_ERR(0, 965, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_doc_2, __pyx_t_5) < 0) __PYX_ERR(0, 1147, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_append_underscores, __pyx_v_append_underscores) < 0) __PYX_ERR(0, 965, __pyx_L1_error)
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 965, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_append_underscores, __pyx_v_append_underscores) < 0) __PYX_ERR(0, 1147, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_functions, __pyx_t_5) < 0) __PYX_ERR(0, 965, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_functions, __pyx_t_5) < 0) __PYX_ERR(0, 1147, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "plumed.pyx":966
+    /* "plumed.pyx":1148
  *             # stored for debugging:
  *             self._functions=_create_functions(self._vimdict,doc=self._doc,append_underscores=append_underscores)
  *             for action in self._functions:             # <<<<<<<<<<<<<<
  *                 ldict={}
  *                 try:
  */
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 966, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1148, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
       __pyx_t_2 = __pyx_t_5; __Pyx_INCREF(__pyx_t_2); __pyx_t_7 = 0;
       __pyx_t_8 = NULL;
     } else {
-      __pyx_t_7 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 966, __pyx_L1_error)
+      __pyx_t_7 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1148, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_8 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 966, __pyx_L1_error)
+      __pyx_t_8 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1148, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     for (;;) {
       if (likely(!__pyx_t_8)) {
         if (likely(PyList_CheckExact(__pyx_t_2))) {
           if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 966, __pyx_L1_error)
+          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1148, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 966, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1148, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         } else {
           if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 966, __pyx_L1_error)
+          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1148, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 966, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1148, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         }
       } else {
         __pyx_t_5 = __pyx_t_8(__pyx_t_2);
         if (unlikely(!__pyx_t_5)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 966, __pyx_L1_error)
+            else __PYX_ERR(0, 1148, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_5);
       }
       __Pyx_XDECREF_SET(__pyx_v_action, __pyx_t_5);
       __pyx_t_5 = 0;
 
-      /* "plumed.pyx":967
+      /* "plumed.pyx":1149
  *             self._functions=_create_functions(self._vimdict,doc=self._doc,append_underscores=append_underscores)
  *             for action in self._functions:
  *                 ldict={}             # <<<<<<<<<<<<<<
  *                 try:
  *                     # create free-standing functions
  */
-      __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 967, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1149, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_XDECREF_SET(__pyx_v_ldict, ((PyObject*)__pyx_t_5));
       __pyx_t_5 = 0;
 
-      /* "plumed.pyx":968
+      /* "plumed.pyx":1150
  *             for action in self._functions:
  *                 ldict={}
  *                 try:             # <<<<<<<<<<<<<<
  *                     # create free-standing functions
  *                     exec(self._functions[action],_format_tools,ldict)
  */
       {
@@ -21318,35 +23660,35 @@
         __Pyx_PyThreadState_assign
         __Pyx_ExceptionSave(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
         __Pyx_XGOTREF(__pyx_t_9);
         __Pyx_XGOTREF(__pyx_t_10);
         __Pyx_XGOTREF(__pyx_t_11);
         /*try:*/ {
 
-          /* "plumed.pyx":970
+          /* "plumed.pyx":1152
  *                 try:
  *                     # create free-standing functions
  *                     exec(self._functions[action],_format_tools,ldict)             # <<<<<<<<<<<<<<
  *                 except:
  *                     print("ERROR interpreting " + action)
  */
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 970, __pyx_L9_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1152, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 970, __pyx_L9_error)
+          __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1152, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_format_tools); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 970, __pyx_L9_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_format_tools); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1152, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_4 = __Pyx_PyExec3(__pyx_t_3, __pyx_t_5, __pyx_v_ldict); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 970, __pyx_L9_error)
+          __pyx_t_4 = __Pyx_PyExec3(__pyx_t_3, __pyx_t_5, __pyx_v_ldict); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1152, __pyx_L9_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-          /* "plumed.pyx":968
+          /* "plumed.pyx":1150
  *             for action in self._functions:
  *                 ldict={}
  *                 try:             # <<<<<<<<<<<<<<
  *                     # create free-standing functions
  *                     exec(self._functions[action],_format_tools,ldict)
  */
         }
@@ -21355,197 +23697,197 @@
         __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
         goto __pyx_L16_try_end;
         __pyx_L9_error:;
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "plumed.pyx":971
+        /* "plumed.pyx":1153
  *                     # create free-standing functions
  *                     exec(self._functions[action],_format_tools,ldict)
  *                 except:             # <<<<<<<<<<<<<<
  *                     print("ERROR interpreting " + action)
  *                     print(self._functions[action])
  */
         /*except:*/ {
           __Pyx_AddTraceback("plumed.InputBuilder.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_3) < 0) __PYX_ERR(0, 971, __pyx_L11_except_error)
+          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_5, &__pyx_t_3) < 0) __PYX_ERR(0, 1153, __pyx_L11_except_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_GOTREF(__pyx_t_3);
 
-          /* "plumed.pyx":972
+          /* "plumed.pyx":1154
  *                     exec(self._functions[action],_format_tools,ldict)
  *                 except:
  *                     print("ERROR interpreting " + action)             # <<<<<<<<<<<<<<
  *                     print(self._functions[action])
  *                     raise
  */
-          __pyx_t_12 = PyNumber_Add(__pyx_kp_u_ERROR_interpreting, __pyx_v_action); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 972, __pyx_L11_except_error)
+          __pyx_t_12 = PyNumber_Add(__pyx_kp_u_ERROR_interpreting, __pyx_v_action); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1154, __pyx_L11_except_error)
           __Pyx_GOTREF(__pyx_t_12);
-          __pyx_t_13 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_12); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 972, __pyx_L11_except_error)
+          __pyx_t_13 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_12); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1154, __pyx_L11_except_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-          /* "plumed.pyx":973
+          /* "plumed.pyx":1155
  *                 except:
  *                     print("ERROR interpreting " + action)
  *                     print(self._functions[action])             # <<<<<<<<<<<<<<
  *                     raise
  *                 # create the object method
  */
-          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 973, __pyx_L11_except_error)
+          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1155, __pyx_L11_except_error)
           __Pyx_GOTREF(__pyx_t_13);
-          __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_13, __pyx_v_action); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 973, __pyx_L11_except_error)
+          __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_13, __pyx_v_action); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1155, __pyx_L11_except_error)
           __Pyx_GOTREF(__pyx_t_12);
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          __pyx_t_13 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_12); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 973, __pyx_L11_except_error)
+          __pyx_t_13 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_12); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1155, __pyx_L11_except_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-          /* "plumed.pyx":974
+          /* "plumed.pyx":1156
  *                     print("ERROR interpreting " + action)
  *                     print(self._functions[action])
  *                     raise             # <<<<<<<<<<<<<<
  *                 # create the object method
  *                 exec("self." + action + " = types.MethodType( ldict['" + action + "'],self)",None,{"self":self, "types":types, "ldict":ldict})
  */
           __Pyx_GIVEREF(__pyx_t_4);
           __Pyx_GIVEREF(__pyx_t_5);
           __Pyx_XGIVEREF(__pyx_t_3);
           __Pyx_ErrRestoreWithState(__pyx_t_4, __pyx_t_5, __pyx_t_3);
           __pyx_t_4 = 0; __pyx_t_5 = 0; __pyx_t_3 = 0; 
-          __PYX_ERR(0, 974, __pyx_L11_except_error)
+          __PYX_ERR(0, 1156, __pyx_L11_except_error)
         }
         __pyx_L11_except_error:;
 
-        /* "plumed.pyx":968
+        /* "plumed.pyx":1150
  *             for action in self._functions:
  *                 ldict={}
  *                 try:             # <<<<<<<<<<<<<<
  *                     # create free-standing functions
  *                     exec(self._functions[action],_format_tools,ldict)
  */
         __Pyx_XGIVEREF(__pyx_t_9);
         __Pyx_XGIVEREF(__pyx_t_10);
         __Pyx_XGIVEREF(__pyx_t_11);
         __Pyx_ExceptionReset(__pyx_t_9, __pyx_t_10, __pyx_t_11);
         goto __pyx_L1_error;
         __pyx_L16_try_end:;
       }
 
-      /* "plumed.pyx":976
+      /* "plumed.pyx":1158
  *                     raise
  *                 # create the object method
  *                 exec("self." + action + " = types.MethodType( ldict['" + action + "'],self)",None,{"self":self, "types":types, "ldict":ldict})             # <<<<<<<<<<<<<<
  *             self._has_dict=True
  * 
  */
-      __pyx_t_3 = PyNumber_Add(__pyx_kp_u_self_2, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 976, __pyx_L1_error)
+      __pyx_t_3 = PyNumber_Add(__pyx_kp_u_self_2, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1158, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_types_MethodType_ldict); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 976, __pyx_L1_error)
+      __pyx_t_5 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_types_MethodType_ldict); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1158, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_3 = PyNumber_Add(__pyx_t_5, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 976, __pyx_L1_error)
+      __pyx_t_3 = PyNumber_Add(__pyx_t_5, __pyx_v_action); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1158, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_5 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_self_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 976, __pyx_L1_error)
+      __pyx_t_5 = PyNumber_Add(__pyx_t_3, __pyx_kp_u_self_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1158, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 976, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1158, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_self, __pyx_v_self) < 0) __PYX_ERR(0, 976, __pyx_L1_error)
-      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_types); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 976, __pyx_L1_error)
+      if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_self, __pyx_v_self) < 0) __PYX_ERR(0, 1158, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_types); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1158, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_types, __pyx_t_4) < 0) __PYX_ERR(0, 976, __pyx_L1_error)
+      if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_types, __pyx_t_4) < 0) __PYX_ERR(0, 1158, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_ldict, __pyx_v_ldict) < 0) __PYX_ERR(0, 976, __pyx_L1_error)
-      __pyx_t_4 = __Pyx_PyExec3(__pyx_t_5, Py_None, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 976, __pyx_L1_error)
+      if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_ldict, __pyx_v_ldict) < 0) __PYX_ERR(0, 1158, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyExec3(__pyx_t_5, Py_None, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1158, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-      /* "plumed.pyx":966
+      /* "plumed.pyx":1148
  *             # stored for debugging:
  *             self._functions=_create_functions(self._vimdict,doc=self._doc,append_underscores=append_underscores)
  *             for action in self._functions:             # <<<<<<<<<<<<<<
  *                 ldict={}
  *                 try:
  */
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":977
+    /* "plumed.pyx":1159
  *                 # create the object method
  *                 exec("self." + action + " = types.MethodType( ldict['" + action + "'],self)",None,{"self":self, "types":types, "ldict":ldict})
  *             self._has_dict=True             # <<<<<<<<<<<<<<
  * 
  *         if enable_at:
  */
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_has_dict, Py_True) < 0) __PYX_ERR(0, 977, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_has_dict, Py_True) < 0) __PYX_ERR(0, 1159, __pyx_L1_error)
 
-    /* "plumed.pyx":961
+    /* "plumed.pyx":1143
  *         self._pre_format=pre_format
  *         self._post_format=post_format
  *         if load_dict:             # <<<<<<<<<<<<<<
  *             # stored for debugging:
  *             self._vimdict,self._doc=_readvimdict(kernel=kernel)
  */
   }
 
-  /* "plumed.pyx":979
+  /* "plumed.pyx":1161
  *             self._has_dict=True
  * 
  *         if enable_at:             # <<<<<<<<<<<<<<
  *             self.at=_at(self)
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_enable_at); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 979, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_enable_at); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1161, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "plumed.pyx":980
+    /* "plumed.pyx":1162
  * 
  *         if enable_at:
  *             self.at=_at(self)             # <<<<<<<<<<<<<<
  * 
  *     def __call__(self,action,LABEL="",verbatim=None,**kwargs):
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_at); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 980, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_at); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_self) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_self);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 980, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_at_2, __pyx_t_2) < 0) __PYX_ERR(0, 980, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_at_2, __pyx_t_2) < 0) __PYX_ERR(0, 1162, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":979
+    /* "plumed.pyx":1161
  *             self._has_dict=True
  * 
  *         if enable_at:             # <<<<<<<<<<<<<<
  *             self.at=_at(self)
  * 
  */
   }
 
-  /* "plumed.pyx":907
+  /* "plumed.pyx":1089
  *        Check the constructor to see all the available options.
  *     """
  *     def __init__(self,             # <<<<<<<<<<<<<<
  *                  *,
  *                  tofile=None,
  */
 
@@ -21565,15 +23907,15 @@
   __Pyx_XDECREF(__pyx_v_action);
   __Pyx_XDECREF(__pyx_v_ldict);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":982
+/* "plumed.pyx":1164
  *             self.at=_at(self)
  * 
  *     def __call__(self,action,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *         ret=""
  *         ret+=_format_label(self,LABEL)
  */
 
@@ -21593,15 +23935,15 @@
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__call__ (wrapper)", 0);
   __pyx_v_kwargs = PyDict_New(); if (unlikely(!__pyx_v_kwargs)) return NULL;
   __Pyx_GOTREF(__pyx_v_kwargs);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_action,&__pyx_n_s_LABEL,&__pyx_n_s_verbatim,0};
     PyObject* values[4] = {0,0,0,0};
-    values[2] = ((PyObject *)((PyObject*)__pyx_kp_u__32));
+    values[2] = ((PyObject *)((PyObject*)__pyx_kp_u__35));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
@@ -21619,15 +23961,15 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_action)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__call__", 0, 2, 4, 1); __PYX_ERR(0, 982, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__call__", 0, 2, 4, 1); __PYX_ERR(0, 1164, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_LABEL);
           if (value) { values[2] = value; kw_args--; }
         }
@@ -21635,15 +23977,15 @@
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_verbatim);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, __pyx_v_kwargs, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 982, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, __pyx_v_kwargs, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 1164, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -21656,15 +23998,15 @@
     __pyx_v_self = values[0];
     __pyx_v_action = values[1];
     __pyx_v_LABEL = values[2];
     __pyx_v_verbatim = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__call__", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 982, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__call__", 0, 2, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1164, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_DECREF(__pyx_v_kwargs); __pyx_v_kwargs = 0;
   __Pyx_AddTraceback("plumed.InputBuilder.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder_2__call__(__pyx_self, __pyx_v_self, __pyx_v_action, __pyx_v_LABEL, __pyx_v_verbatim, __pyx_v_kwargs);
@@ -21694,32 +24036,32 @@
   Py_ssize_t __pyx_t_10;
   int __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__call__", 0);
 
-  /* "plumed.pyx":983
+  /* "plumed.pyx":1165
  * 
  *     def __call__(self,action,LABEL="",verbatim=None,**kwargs):
  *         ret=""             # <<<<<<<<<<<<<<
  *         ret+=_format_label(self,LABEL)
  *         ret+=action
  */
-  __Pyx_INCREF(__pyx_kp_u__32);
-  __pyx_v_ret = __pyx_kp_u__32;
+  __Pyx_INCREF(__pyx_kp_u__35);
+  __pyx_v_ret = __pyx_kp_u__35;
 
-  /* "plumed.pyx":984
+  /* "plumed.pyx":1166
  *     def __call__(self,action,LABEL="",verbatim=None,**kwargs):
  *         ret=""
  *         ret+=_format_label(self,LABEL)             # <<<<<<<<<<<<<<
  *         ret+=action
  *         retlist=[]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_label); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 984, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_label); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -21728,113 +24070,113 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_self, __pyx_v_LABEL};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 984, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1166, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_self, __pyx_v_LABEL};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 984, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1166, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 984, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1166, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_INCREF(__pyx_v_self);
     __Pyx_GIVEREF(__pyx_v_self);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_self);
     __Pyx_INCREF(__pyx_v_LABEL);
     __Pyx_GIVEREF(__pyx_v_LABEL);
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_LABEL);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 984, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1166, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 984, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "plumed.pyx":985
+  /* "plumed.pyx":1167
  *         ret=""
  *         ret+=_format_label(self,LABEL)
  *         ret+=action             # <<<<<<<<<<<<<<
  *         retlist=[]
  *         for arg in sorted(kwargs):
  */
-  __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_v_action); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 985, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_v_action); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "plumed.pyx":986
+  /* "plumed.pyx":1168
  *         ret+=_format_label(self,LABEL)
  *         ret+=action
  *         retlist=[]             # <<<<<<<<<<<<<<
  *         for arg in sorted(kwargs):
  *             retlist.append(_format_anything(self,arg,kwargs[arg]))
  */
-  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 986, __pyx_L1_error)
+  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_retlist = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "plumed.pyx":987
+  /* "plumed.pyx":1169
  *         ret+=action
  *         retlist=[]
  *         for arg in sorted(kwargs):             # <<<<<<<<<<<<<<
  *             retlist.append(_format_anything(self,arg,kwargs[arg]))
  *         retlist.sort()
  */
-  __pyx_t_1 = PySequence_List(__pyx_v_kwargs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 987, __pyx_L1_error)
+  __pyx_t_1 = PySequence_List(__pyx_v_kwargs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_6 = PyList_Sort(__pyx_t_2); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 987, __pyx_L1_error)
+  __pyx_t_6 = PyList_Sort(__pyx_t_2); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1169, __pyx_L1_error)
   if (unlikely(__pyx_t_2 == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 987, __pyx_L1_error)
+    __PYX_ERR(0, 1169, __pyx_L1_error)
   }
   __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   for (;;) {
     if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 987, __pyx_L1_error)
+    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1169, __pyx_L1_error)
     #else
-    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 987, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1169, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_arg, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "plumed.pyx":988
+    /* "plumed.pyx":1170
  *         retlist=[]
  *         for arg in sorted(kwargs):
  *             retlist.append(_format_anything(self,arg,kwargs[arg]))             # <<<<<<<<<<<<<<
  *         retlist.sort()
  *         for x in retlist:
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_format_anything); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 988, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_format_anything); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1170, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_kwargs, __pyx_v_arg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 988, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_kwargs, __pyx_v_arg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1170, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_8 = NULL;
     __pyx_t_4 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_8)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -21843,140 +24185,140 @@
         __Pyx_DECREF_SET(__pyx_t_5, function);
         __pyx_t_4 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_5)) {
       PyObject *__pyx_temp[4] = {__pyx_t_8, __pyx_v_self, __pyx_v_arg, __pyx_t_3};
-      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 988, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1170, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
       PyObject *__pyx_temp[4] = {__pyx_t_8, __pyx_v_self, __pyx_v_arg, __pyx_t_3};
-      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 988, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1170, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     } else
     #endif
     {
-      __pyx_t_9 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 988, __pyx_L1_error)
+      __pyx_t_9 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1170, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       if (__pyx_t_8) {
         __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_8); __pyx_t_8 = NULL;
       }
       __Pyx_INCREF(__pyx_v_self);
       __Pyx_GIVEREF(__pyx_v_self);
       PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_4, __pyx_v_self);
       __Pyx_INCREF(__pyx_v_arg);
       __Pyx_GIVEREF(__pyx_v_arg);
       PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_4, __pyx_v_arg);
       __Pyx_GIVEREF(__pyx_t_3);
       PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_4, __pyx_t_3);
       __pyx_t_3 = 0;
-      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 988, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1170, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_retlist, __pyx_t_2); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 988, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_retlist, __pyx_t_2); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1170, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "plumed.pyx":987
+    /* "plumed.pyx":1169
  *         ret+=action
  *         retlist=[]
  *         for arg in sorted(kwargs):             # <<<<<<<<<<<<<<
  *             retlist.append(_format_anything(self,arg,kwargs[arg]))
  *         retlist.sort()
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":989
+  /* "plumed.pyx":1171
  *         for arg in sorted(kwargs):
  *             retlist.append(_format_anything(self,arg,kwargs[arg]))
  *         retlist.sort()             # <<<<<<<<<<<<<<
  *         for x in retlist:
  *             if(len(x)>0):
  */
-  __pyx_t_6 = PyList_Sort(__pyx_v_retlist); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 989, __pyx_L1_error)
+  __pyx_t_6 = PyList_Sort(__pyx_v_retlist); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1171, __pyx_L1_error)
 
-  /* "plumed.pyx":990
+  /* "plumed.pyx":1172
  *             retlist.append(_format_anything(self,arg,kwargs[arg]))
  *         retlist.sort()
  *         for x in retlist:             # <<<<<<<<<<<<<<
  *             if(len(x)>0):
  *                 ret+=x
  */
   __pyx_t_1 = __pyx_v_retlist; __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
   for (;;) {
     if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 990, __pyx_L1_error)
+    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 1172, __pyx_L1_error)
     #else
-    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 990, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1172, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_x, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "plumed.pyx":991
+    /* "plumed.pyx":1173
  *         retlist.sort()
  *         for x in retlist:
  *             if(len(x)>0):             # <<<<<<<<<<<<<<
  *                 ret+=x
  *         ret+=_format_verbatim(self,verbatim)
  */
-    __pyx_t_10 = PyObject_Length(__pyx_v_x); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 991, __pyx_L1_error)
+    __pyx_t_10 = PyObject_Length(__pyx_v_x); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1173, __pyx_L1_error)
     __pyx_t_11 = ((__pyx_t_10 > 0) != 0);
     if (__pyx_t_11) {
 
-      /* "plumed.pyx":992
+      /* "plumed.pyx":1174
  *         for x in retlist:
  *             if(len(x)>0):
  *                 ret+=x             # <<<<<<<<<<<<<<
  *         ret+=_format_verbatim(self,verbatim)
  *         return _format_return(self,ret)
  */
-      __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_v_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 992, __pyx_L1_error)
+      __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_v_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1174, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_2);
       __pyx_t_2 = 0;
 
-      /* "plumed.pyx":991
+      /* "plumed.pyx":1173
  *         retlist.sort()
  *         for x in retlist:
  *             if(len(x)>0):             # <<<<<<<<<<<<<<
  *                 ret+=x
  *         ret+=_format_verbatim(self,verbatim)
  */
     }
 
-    /* "plumed.pyx":990
+    /* "plumed.pyx":1172
  *             retlist.append(_format_anything(self,arg,kwargs[arg]))
  *         retlist.sort()
  *         for x in retlist:             # <<<<<<<<<<<<<<
  *             if(len(x)>0):
  *                 ret+=x
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":993
+  /* "plumed.pyx":1175
  *             if(len(x)>0):
  *                 ret+=x
  *         ret+=_format_verbatim(self,verbatim)             # <<<<<<<<<<<<<<
  *         return _format_return(self,ret)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_verbatim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 993, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_verbatim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1175, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -21985,59 +24327,59 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_self, __pyx_v_verbatim};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 993, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1175, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_self, __pyx_v_verbatim};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 993, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1175, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_9 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 993, __pyx_L1_error)
+    __pyx_t_9 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1175, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     if (__pyx_t_5) {
       __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_5); __pyx_t_5 = NULL;
     }
     __Pyx_INCREF(__pyx_v_self);
     __Pyx_GIVEREF(__pyx_v_self);
     PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_4, __pyx_v_self);
     __Pyx_INCREF(__pyx_v_verbatim);
     __Pyx_GIVEREF(__pyx_v_verbatim);
     PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_4, __pyx_v_verbatim);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 993, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1175, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 993, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1175, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "plumed.pyx":994
+  /* "plumed.pyx":1176
  *                 ret+=x
  *         ret+=_format_verbatim(self,verbatim)
  *         return _format_return(self,ret)             # <<<<<<<<<<<<<<
  * 
  *     def __getattr__(self, name):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_format_return); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 994, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_format_return); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1176, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_9 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_9)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
@@ -22046,49 +24388,49 @@
       __Pyx_DECREF_SET(__pyx_t_1, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_1)) {
     PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_v_self, __pyx_v_ret};
-    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 994, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1176, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_GOTREF(__pyx_t_2);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
     PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_v_self, __pyx_v_ret};
-    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 994, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1176, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_GOTREF(__pyx_t_2);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 994, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1176, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_9) {
       __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_9); __pyx_t_9 = NULL;
     }
     __Pyx_INCREF(__pyx_v_self);
     __Pyx_GIVEREF(__pyx_v_self);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_self);
     __Pyx_INCREF(__pyx_v_ret);
     __Pyx_GIVEREF(__pyx_v_ret);
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_ret);
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 994, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1176, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":982
+  /* "plumed.pyx":1164
  *             self.at=_at(self)
  * 
  *     def __call__(self,action,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *         ret=""
  *         ret+=_format_label(self,LABEL)
  */
 
@@ -22108,15 +24450,15 @@
   __Pyx_XDECREF(__pyx_v_arg);
   __Pyx_XDECREF(__pyx_v_x);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":996
+/* "plumed.pyx":1178
  *         return _format_return(self,ret)
  * 
  *     def __getattr__(self, name):             # <<<<<<<<<<<<<<
  *        if self._has_dict:
  *            class _callme:
  */
 
@@ -22151,45 +24493,45 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__getattr__", 1, 2, 2, 1); __PYX_ERR(0, 996, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__getattr__", 1, 2, 2, 1); __PYX_ERR(0, 1178, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__getattr__") < 0)) __PYX_ERR(0, 996, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__getattr__") < 0)) __PYX_ERR(0, 1178, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
     __pyx_v_name = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__getattr__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 996, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__getattr__", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1178, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.InputBuilder.__getattr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder_4__getattr__(__pyx_self, __pyx_v_self, __pyx_v_name);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":999
+/* "plumed.pyx":1181
  *        if self._has_dict:
  *            class _callme:
  *                def __init__(self,builder,name):             # <<<<<<<<<<<<<<
  *                    self._builder=builder
  *                    self._name=name
  */
 
@@ -22227,40 +24569,40 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(0, 999, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(0, 1181, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(0, 999, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(0, 1181, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 999, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1181, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_self = values[0];
     __pyx_v_builder = values[1];
     __pyx_v_name = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 999, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1181, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.InputBuilder.__getattr__._callme.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder_11__getattr___7_callme___init__(__pyx_self, __pyx_v_self, __pyx_v_builder, __pyx_v_name);
 
@@ -22275,51 +24617,51 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "plumed.pyx":1000
+  /* "plumed.pyx":1182
  *            class _callme:
  *                def __init__(self,builder,name):
  *                    self._builder=builder             # <<<<<<<<<<<<<<
  *                    self._name=name
  *                    self.__doc__=getattr(self._builder,name).__doc__
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_builder_2, __pyx_v_builder) < 0) __PYX_ERR(0, 1000, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_builder_2, __pyx_v_builder) < 0) __PYX_ERR(0, 1182, __pyx_L1_error)
 
-  /* "plumed.pyx":1001
+  /* "plumed.pyx":1183
  *                def __init__(self,builder,name):
  *                    self._builder=builder
  *                    self._name=name             # <<<<<<<<<<<<<<
  *                    self.__doc__=getattr(self._builder,name).__doc__
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_name_2, __pyx_v_name) < 0) __PYX_ERR(0, 1001, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_name_2, __pyx_v_name) < 0) __PYX_ERR(0, 1183, __pyx_L1_error)
 
-  /* "plumed.pyx":1002
+  /* "plumed.pyx":1184
  *                    self._builder=builder
  *                    self._name=name
  *                    self.__doc__=getattr(self._builder,name).__doc__             # <<<<<<<<<<<<<<
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):
  *                    func=getattr(self._builder,self._name)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_builder_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1002, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_builder_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1184, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_GetAttr(__pyx_t_1, __pyx_v_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1002, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_GetAttr(__pyx_t_1, __pyx_v_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1184, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_doc); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1002, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_doc); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1184, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_doc, __pyx_t_1) < 0) __PYX_ERR(0, 1002, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_doc, __pyx_t_1) < 0) __PYX_ERR(0, 1184, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":999
+  /* "plumed.pyx":1181
  *        if self._has_dict:
  *            class _callme:
  *                def __init__(self,builder,name):             # <<<<<<<<<<<<<<
  *                    self._builder=builder
  *                    self._name=name
  */
 
@@ -22333,15 +24675,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":1003
+/* "plumed.pyx":1185
  *                    self._name=name
  *                    self.__doc__=getattr(self._builder,name).__doc__
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *                    func=getattr(self._builder,self._name)
  *                    return func(LABEL,verbatim,**kwargs)
  */
 
@@ -22360,15 +24702,15 @@
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__call__ (wrapper)", 0);
   __pyx_v_kwargs = PyDict_New(); if (unlikely(!__pyx_v_kwargs)) return NULL;
   __Pyx_GOTREF(__pyx_v_kwargs);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_LABEL,&__pyx_n_s_verbatim,0};
     PyObject* values[3] = {0,0,0};
-    values[1] = ((PyObject *)((PyObject*)__pyx_kp_u__32));
+    values[1] = ((PyObject *)((PyObject*)__pyx_kp_u__35));
     values[2] = ((PyObject *)((PyObject *)Py_None));
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -22394,15 +24736,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_verbatim);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, __pyx_v_kwargs, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 1003, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, __pyx_v_kwargs, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 1185, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -22413,15 +24755,15 @@
     }
     __pyx_v_self = values[0];
     __pyx_v_LABEL = values[1];
     __pyx_v_verbatim = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__call__", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1003, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__call__", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1185, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_DECREF(__pyx_v_kwargs); __pyx_v_kwargs = 0;
   __Pyx_AddTraceback("plumed.InputBuilder.__getattr__._callme.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder_11__getattr___7_callme_2__call__(__pyx_self, __pyx_v_self, __pyx_v_LABEL, __pyx_v_verbatim, __pyx_v_kwargs);
@@ -22440,59 +24782,59 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__call__", 0);
 
-  /* "plumed.pyx":1004
+  /* "plumed.pyx":1186
  *                    self.__doc__=getattr(self._builder,name).__doc__
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):
  *                    func=getattr(self._builder,self._name)             # <<<<<<<<<<<<<<
  *                    return func(LABEL,verbatim,**kwargs)
  *            if self._append_underscores and not re.match(".*__$",name):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_builder_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1004, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_builder_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1186, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_name_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1004, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_name_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1186, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_GetAttr(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1004, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_GetAttr(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1186, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_func = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "plumed.pyx":1005
+  /* "plumed.pyx":1187
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):
  *                    func=getattr(self._builder,self._name)
  *                    return func(LABEL,verbatim,**kwargs)             # <<<<<<<<<<<<<<
  *            if self._append_underscores and not re.match(".*__$",name):
  *                 name__=name+"__"
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1005, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1187, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_v_LABEL);
   __Pyx_GIVEREF(__pyx_v_LABEL);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_LABEL);
   __Pyx_INCREF(__pyx_v_verbatim);
   __Pyx_GIVEREF(__pyx_v_verbatim);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_verbatim);
-  __pyx_t_2 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1005, __pyx_L1_error)
+  __pyx_t_2 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1187, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_v_func, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1005, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_v_func, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1187, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":1003
+  /* "plumed.pyx":1185
  *                    self._name=name
  *                    self.__doc__=getattr(self._builder,name).__doc__
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *                    func=getattr(self._builder,self._name)
  *                    return func(LABEL,verbatim,**kwargs)
  */
 
@@ -22506,15 +24848,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_func);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":1017
+/* "plumed.pyx":1199
  *        else:
  *            class _callme:
  *                def __init__(self,builder,name):             # <<<<<<<<<<<<<<
  *                    self._builder=builder
  *                    self._name=name
  */
 
@@ -22552,40 +24894,40 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_builder)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(0, 1017, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(0, 1199, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(0, 1017, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(0, 1199, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1017, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1199, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_self = values[0];
     __pyx_v_builder = values[1];
     __pyx_v_name = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1017, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1199, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.InputBuilder.__getattr__._callme.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder_11__getattr___7_callme_4__init__(__pyx_self, __pyx_v_self, __pyx_v_builder, __pyx_v_name);
 
@@ -22599,45 +24941,45 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "plumed.pyx":1018
+  /* "plumed.pyx":1200
  *            class _callme:
  *                def __init__(self,builder,name):
  *                    self._builder=builder             # <<<<<<<<<<<<<<
  *                    self._name=name
  *                    self.__doc__="dynamic method printing " + name
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_builder_2, __pyx_v_builder) < 0) __PYX_ERR(0, 1018, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_builder_2, __pyx_v_builder) < 0) __PYX_ERR(0, 1200, __pyx_L1_error)
 
-  /* "plumed.pyx":1019
+  /* "plumed.pyx":1201
  *                def __init__(self,builder,name):
  *                    self._builder=builder
  *                    self._name=name             # <<<<<<<<<<<<<<
  *                    self.__doc__="dynamic method printing " + name
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_name_2, __pyx_v_name) < 0) __PYX_ERR(0, 1019, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_name_2, __pyx_v_name) < 0) __PYX_ERR(0, 1201, __pyx_L1_error)
 
-  /* "plumed.pyx":1020
+  /* "plumed.pyx":1202
  *                    self._builder=builder
  *                    self._name=name
  *                    self.__doc__="dynamic method printing " + name             # <<<<<<<<<<<<<<
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)
  */
-  __pyx_t_1 = PyNumber_Add(__pyx_kp_u_dynamic_method_printing, __pyx_v_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1020, __pyx_L1_error)
+  __pyx_t_1 = PyNumber_Add(__pyx_kp_u_dynamic_method_printing, __pyx_v_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1202, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_doc, __pyx_t_1) < 0) __PYX_ERR(0, 1020, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_doc, __pyx_t_1) < 0) __PYX_ERR(0, 1202, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":1017
+  /* "plumed.pyx":1199
  *        else:
  *            class _callme:
  *                def __init__(self,builder,name):             # <<<<<<<<<<<<<<
  *                    self._builder=builder
  *                    self._name=name
  */
 
@@ -22650,15 +24992,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":1021
+/* "plumed.pyx":1203
  *                    self._name=name
  *                    self.__doc__="dynamic method printing " + name
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)
  *            if re.match(".*[^_]__$",name):
  */
 
@@ -22677,15 +25019,15 @@
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__call__ (wrapper)", 0);
   __pyx_v_kwargs = PyDict_New(); if (unlikely(!__pyx_v_kwargs)) return NULL;
   __Pyx_GOTREF(__pyx_v_kwargs);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_LABEL,&__pyx_n_s_verbatim,0};
     PyObject* values[3] = {0,0,0};
-    values[1] = ((PyObject *)((PyObject*)__pyx_kp_u__32));
+    values[1] = ((PyObject *)((PyObject*)__pyx_kp_u__35));
     values[2] = ((PyObject *)((PyObject *)Py_None));
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -22711,15 +25053,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_verbatim);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, __pyx_v_kwargs, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 1021, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, __pyx_v_kwargs, values, pos_args, "__call__") < 0)) __PYX_ERR(0, 1203, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -22730,15 +25072,15 @@
     }
     __pyx_v_self = values[0];
     __pyx_v_LABEL = values[1];
     __pyx_v_verbatim = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__call__", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1021, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__call__", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1203, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_DECREF(__pyx_v_kwargs); __pyx_v_kwargs = 0;
   __Pyx_AddTraceback("plumed.InputBuilder.__getattr__._callme.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder_11__getattr___7_callme_6__call__(__pyx_self, __pyx_v_self, __pyx_v_LABEL, __pyx_v_verbatim, __pyx_v_kwargs);
@@ -22757,49 +25099,49 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__call__", 0);
 
-  /* "plumed.pyx":1022
+  /* "plumed.pyx":1204
  *                    self.__doc__="dynamic method printing " + name
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)             # <<<<<<<<<<<<<<
  *            if re.match(".*[^_]__$",name):
  *                name=name[:-2]
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_builder_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1022, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_builder_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_name_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1022, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_name_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1022, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
   __Pyx_INCREF(__pyx_v_LABEL);
   __Pyx_GIVEREF(__pyx_v_LABEL);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_LABEL);
   __Pyx_INCREF(__pyx_v_verbatim);
   __Pyx_GIVEREF(__pyx_v_verbatim);
   PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_verbatim);
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1022, __pyx_L1_error)
+  __pyx_t_2 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1022, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1204, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":1021
+  /* "plumed.pyx":1203
  *                    self._name=name
  *                    self.__doc__="dynamic method printing " + name
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)
  *            if re.match(".*[^_]__$",name):
  */
 
@@ -22813,15 +25155,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":996
+/* "plumed.pyx":1178
  *         return _format_return(self,ret)
  * 
  *     def __getattr__(self, name):             # <<<<<<<<<<<<<<
  *        if self._has_dict:
  *            class _callme:
  */
 
@@ -22840,94 +25182,94 @@
   int __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__getattr__", 0);
   __Pyx_INCREF(__pyx_v_name);
 
-  /* "plumed.pyx":997
+  /* "plumed.pyx":1179
  * 
  *     def __getattr__(self, name):
  *        if self._has_dict:             # <<<<<<<<<<<<<<
  *            class _callme:
  *                def __init__(self,builder,name):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_has_dict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 997, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_has_dict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1179, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 997, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1179, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
 
-    /* "plumed.pyx":998
+    /* "plumed.pyx":1180
  *     def __getattr__(self, name):
  *        if self._has_dict:
  *            class _callme:             # <<<<<<<<<<<<<<
  *                def __init__(self,builder,name):
  *                    self._builder=builder
  */
-    __pyx_t_1 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_callme, __pyx_n_s_InputBuilder___getattr___locals, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 998, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_callme, __pyx_n_s_InputBuilder___getattr___locals, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1180, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
 
-    /* "plumed.pyx":999
+    /* "plumed.pyx":1181
  *        if self._has_dict:
  *            class _callme:
  *                def __init__(self,builder,name):             # <<<<<<<<<<<<<<
  *                    self._builder=builder
  *                    self._name=name
  */
-    __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11__getattr___7_callme_1__init__, 0, __pyx_n_s_InputBuilder___getattr___locals_2, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__70)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 999, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11__getattr___7_callme_1__init__, 0, __pyx_n_s_InputBuilder___getattr___locals_2, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__73)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1181, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 999, __pyx_L1_error)
+    if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 1181, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "plumed.pyx":1003
+    /* "plumed.pyx":1185
  *                    self._name=name
  *                    self.__doc__=getattr(self._builder,name).__doc__
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *                    func=getattr(self._builder,self._name)
  *                    return func(LABEL,verbatim,**kwargs)
  */
-    __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11__getattr___7_callme_3__call__, 0, __pyx_n_s_InputBuilder___getattr___locals_3, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__72)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1003, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11__getattr___7_callme_3__call__, 0, __pyx_n_s_InputBuilder___getattr___locals_3, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__75)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1185, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__73);
-    if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_call, __pyx_t_3) < 0) __PYX_ERR(0, 1003, __pyx_L1_error)
+    __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__76);
+    if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_call, __pyx_t_3) < 0) __PYX_ERR(0, 1185, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "plumed.pyx":998
+    /* "plumed.pyx":1180
  *     def __getattr__(self, name):
  *        if self._has_dict:
  *            class _callme:             # <<<<<<<<<<<<<<
  *                def __init__(self,builder,name):
  *                    self._builder=builder
  */
-    __pyx_t_3 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_callme, __pyx_empty_tuple, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 998, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_callme, __pyx_empty_tuple, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1180, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_v__callme = __pyx_t_3;
     __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "plumed.pyx":1006
+    /* "plumed.pyx":1188
  *                    func=getattr(self._builder,self._name)
  *                    return func(LABEL,verbatim,**kwargs)
  *            if self._append_underscores and not re.match(".*__$",name):             # <<<<<<<<<<<<<<
  *                 name__=name+"__"
  *                 if name__ in self._functions.keys():
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_append_underscores_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_append_underscores_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1188, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (__pyx_t_4) {
     } else {
       __pyx_t_2 = __pyx_t_4;
       goto __pyx_L5_bool_binop_done;
     }
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_re); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_re); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     __pyx_t_6 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_3)) {
@@ -22936,157 +25278,157 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
         __pyx_t_6 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_5)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u__74, __pyx_v_name};
-      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1006, __pyx_L1_error)
+      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u__77, __pyx_v_name};
+      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1188, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u__74, __pyx_v_name};
-      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1006, __pyx_L1_error)
+      PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u__77, __pyx_v_name};
+      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1188, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     {
-      __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1006, __pyx_L1_error)
+      __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1188, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       if (__pyx_t_3) {
         __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __pyx_t_3 = NULL;
       }
-      __Pyx_INCREF(__pyx_kp_u__74);
-      __Pyx_GIVEREF(__pyx_kp_u__74);
-      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_kp_u__74);
+      __Pyx_INCREF(__pyx_kp_u__77);
+      __Pyx_GIVEREF(__pyx_kp_u__77);
+      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_kp_u__77);
       __Pyx_INCREF(__pyx_v_name);
       __Pyx_GIVEREF(__pyx_v_name);
       PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_v_name);
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1006, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1188, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1188, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_8 = ((!__pyx_t_4) != 0);
     __pyx_t_2 = __pyx_t_8;
     __pyx_L5_bool_binop_done:;
     if (__pyx_t_2) {
 
-      /* "plumed.pyx":1007
+      /* "plumed.pyx":1189
  *                    return func(LABEL,verbatim,**kwargs)
  *            if self._append_underscores and not re.match(".*__$",name):
  *                 name__=name+"__"             # <<<<<<<<<<<<<<
  *                 if name__ in self._functions.keys():
  *                     return _callme(self,name__)
  */
-      __pyx_t_1 = PyNumber_Add(__pyx_v_name, __pyx_n_u__40); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1007, __pyx_L1_error)
+      __pyx_t_1 = PyNumber_Add(__pyx_v_name, __pyx_n_u__43); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1189, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __pyx_v_name__ = __pyx_t_1;
       __pyx_t_1 = 0;
 
-      /* "plumed.pyx":1008
+      /* "plumed.pyx":1190
  *            if self._append_underscores and not re.match(".*__$",name):
  *                 name__=name+"__"
  *                 if name__ in self._functions.keys():             # <<<<<<<<<<<<<<
  *                     return _callme(self,name__)
  *            if not self._append_underscores and re.match(".*__$",name):
  */
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1008, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1190, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_keys); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1008, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_keys); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1190, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_t_5 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
         __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
         if (likely(__pyx_t_5)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
           __Pyx_INCREF(__pyx_t_5);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_7, function);
         }
       }
       __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1008, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1190, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_name__, __pyx_t_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1008, __pyx_L1_error)
+      __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_name__, __pyx_t_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1190, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_8 = (__pyx_t_2 != 0);
       if (__pyx_t_8) {
 
-        /* "plumed.pyx":1009
+        /* "plumed.pyx":1191
  *                 name__=name+"__"
  *                 if name__ in self._functions.keys():
  *                     return _callme(self,name__)             # <<<<<<<<<<<<<<
  *            if not self._append_underscores and re.match(".*__$",name):
  *                 name__=re.sub("__$","",name)
  */
         __Pyx_XDECREF(__pyx_r);
-        __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1191, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_INCREF(__pyx_v_self);
         __Pyx_GIVEREF(__pyx_v_self);
         PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_self);
         __Pyx_INCREF(__pyx_v_name__);
         __Pyx_GIVEREF(__pyx_v_name__);
         PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_name__);
-        __pyx_t_7 = __Pyx_PyObject_Call(__pyx_v__callme, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1009, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Call(__pyx_v__callme, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1191, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_r = __pyx_t_7;
         __pyx_t_7 = 0;
         goto __pyx_L0;
 
-        /* "plumed.pyx":1008
+        /* "plumed.pyx":1190
  *            if self._append_underscores and not re.match(".*__$",name):
  *                 name__=name+"__"
  *                 if name__ in self._functions.keys():             # <<<<<<<<<<<<<<
  *                     return _callme(self,name__)
  *            if not self._append_underscores and re.match(".*__$",name):
  */
       }
 
-      /* "plumed.pyx":1006
+      /* "plumed.pyx":1188
  *                    func=getattr(self._builder,self._name)
  *                    return func(LABEL,verbatim,**kwargs)
  *            if self._append_underscores and not re.match(".*__$",name):             # <<<<<<<<<<<<<<
  *                 name__=name+"__"
  *                 if name__ in self._functions.keys():
  */
     }
 
-    /* "plumed.pyx":1010
+    /* "plumed.pyx":1192
  *                 if name__ in self._functions.keys():
  *                     return _callme(self,name__)
  *            if not self._append_underscores and re.match(".*__$",name):             # <<<<<<<<<<<<<<
  *                 name__=re.sub("__$","",name)
  *                 if name__ in self._functions.keys():
  */
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_append_underscores_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1010, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_append_underscores_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1192, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1010, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1192, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_4 = ((!__pyx_t_2) != 0);
     if (__pyx_t_4) {
     } else {
       __pyx_t_8 = __pyx_t_4;
       goto __pyx_L9_bool_binop_done;
     }
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1010, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1192, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1010, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_match); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1192, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_1 = NULL;
     __pyx_t_6 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_1)) {
@@ -23095,61 +25437,61 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
         __pyx_t_6 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_5)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_kp_u__74, __pyx_v_name};
-      __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1010, __pyx_L1_error)
+      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_kp_u__77, __pyx_v_name};
+      __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1192, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_GOTREF(__pyx_t_7);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_kp_u__74, __pyx_v_name};
-      __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1010, __pyx_L1_error)
+      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_kp_u__77, __pyx_v_name};
+      __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1192, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_GOTREF(__pyx_t_7);
     } else
     #endif
     {
-      __pyx_t_3 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1010, __pyx_L1_error)
+      __pyx_t_3 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1192, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       if (__pyx_t_1) {
         __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1); __pyx_t_1 = NULL;
       }
-      __Pyx_INCREF(__pyx_kp_u__74);
-      __Pyx_GIVEREF(__pyx_kp_u__74);
-      PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_6, __pyx_kp_u__74);
+      __Pyx_INCREF(__pyx_kp_u__77);
+      __Pyx_GIVEREF(__pyx_kp_u__77);
+      PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_6, __pyx_kp_u__77);
       __Pyx_INCREF(__pyx_v_name);
       __Pyx_GIVEREF(__pyx_v_name);
       PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_6, __pyx_v_name);
-      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1010, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1192, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1010, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1192, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_8 = __pyx_t_4;
     __pyx_L9_bool_binop_done:;
     if (__pyx_t_8) {
 
-      /* "plumed.pyx":1011
+      /* "plumed.pyx":1193
  *                     return _callme(self,name__)
  *            if not self._append_underscores and re.match(".*__$",name):
  *                 name__=re.sub("__$","",name)             # <<<<<<<<<<<<<<
  *                 if name__ in self._functions.keys():
  *                     return _callme(self,name__)
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1011, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_re); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1193, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_sub); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1011, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_sub); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1193, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_t_5 = NULL;
       __pyx_t_6 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
         __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
         if (likely(__pyx_t_5)) {
@@ -23158,208 +25500,208 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_3, function);
           __pyx_t_6 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_3)) {
-        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u__75, __pyx_kp_u__32, __pyx_v_name};
-        __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1011, __pyx_L1_error)
+        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u__78, __pyx_kp_u__35, __pyx_v_name};
+        __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1193, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_GOTREF(__pyx_t_7);
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
-        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u__75, __pyx_kp_u__32, __pyx_v_name};
-        __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1011, __pyx_L1_error)
+        PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_kp_u__78, __pyx_kp_u__35, __pyx_v_name};
+        __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1193, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_GOTREF(__pyx_t_7);
       } else
       #endif
       {
-        __pyx_t_1 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1011, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1193, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         if (__pyx_t_5) {
           __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5); __pyx_t_5 = NULL;
         }
-        __Pyx_INCREF(__pyx_kp_u__75);
-        __Pyx_GIVEREF(__pyx_kp_u__75);
-        PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_6, __pyx_kp_u__75);
-        __Pyx_INCREF(__pyx_kp_u__32);
-        __Pyx_GIVEREF(__pyx_kp_u__32);
-        PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_6, __pyx_kp_u__32);
+        __Pyx_INCREF(__pyx_kp_u__78);
+        __Pyx_GIVEREF(__pyx_kp_u__78);
+        PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_6, __pyx_kp_u__78);
+        __Pyx_INCREF(__pyx_kp_u__35);
+        __Pyx_GIVEREF(__pyx_kp_u__35);
+        PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_6, __pyx_kp_u__35);
         __Pyx_INCREF(__pyx_v_name);
         __Pyx_GIVEREF(__pyx_v_name);
         PyTuple_SET_ITEM(__pyx_t_1, 2+__pyx_t_6, __pyx_v_name);
-        __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1011, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1193, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       }
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_XDECREF_SET(__pyx_v_name__, __pyx_t_7);
       __pyx_t_7 = 0;
 
-      /* "plumed.pyx":1012
+      /* "plumed.pyx":1194
  *            if not self._append_underscores and re.match(".*__$",name):
  *                 name__=re.sub("__$","",name)
  *                 if name__ in self._functions.keys():             # <<<<<<<<<<<<<<
  *                     return _callme(self,name__)
  *            raise AttributeError("unknown method " + name)
  */
-      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1012, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_functions); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1194, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_keys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1012, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_keys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1194, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_t_3 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
         __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
         if (likely(__pyx_t_3)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
           __Pyx_INCREF(__pyx_t_3);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_1, function);
         }
       }
       __pyx_t_7 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1012, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1194, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_8 = (__Pyx_PySequence_ContainsTF(__pyx_v_name__, __pyx_t_7, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 1012, __pyx_L1_error)
+      __pyx_t_8 = (__Pyx_PySequence_ContainsTF(__pyx_v_name__, __pyx_t_7, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 1194, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __pyx_t_4 = (__pyx_t_8 != 0);
       if (__pyx_t_4) {
 
-        /* "plumed.pyx":1013
+        /* "plumed.pyx":1195
  *                 name__=re.sub("__$","",name)
  *                 if name__ in self._functions.keys():
  *                     return _callme(self,name__)             # <<<<<<<<<<<<<<
  *            raise AttributeError("unknown method " + name)
  *        else:
  */
         __Pyx_XDECREF(__pyx_r);
-        __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1013, __pyx_L1_error)
+        __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1195, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_INCREF(__pyx_v_self);
         __Pyx_GIVEREF(__pyx_v_self);
         PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_self);
         __Pyx_INCREF(__pyx_v_name__);
         __Pyx_GIVEREF(__pyx_v_name__);
         PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_name__);
-        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_v__callme, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1013, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_v__callme, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1195, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __pyx_r = __pyx_t_1;
         __pyx_t_1 = 0;
         goto __pyx_L0;
 
-        /* "plumed.pyx":1012
+        /* "plumed.pyx":1194
  *            if not self._append_underscores and re.match(".*__$",name):
  *                 name__=re.sub("__$","",name)
  *                 if name__ in self._functions.keys():             # <<<<<<<<<<<<<<
  *                     return _callme(self,name__)
  *            raise AttributeError("unknown method " + name)
  */
       }
 
-      /* "plumed.pyx":1010
+      /* "plumed.pyx":1192
  *                 if name__ in self._functions.keys():
  *                     return _callme(self,name__)
  *            if not self._append_underscores and re.match(".*__$",name):             # <<<<<<<<<<<<<<
  *                 name__=re.sub("__$","",name)
  *                 if name__ in self._functions.keys():
  */
     }
 
-    /* "plumed.pyx":1014
+    /* "plumed.pyx":1196
  *                 if name__ in self._functions.keys():
  *                     return _callme(self,name__)
  *            raise AttributeError("unknown method " + name)             # <<<<<<<<<<<<<<
  *        else:
  *            class _callme:
  */
-    __pyx_t_1 = PyNumber_Add(__pyx_kp_u_unknown_method, __pyx_v_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1014, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Add(__pyx_kp_u_unknown_method, __pyx_v_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1196, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_AttributeError, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1014, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_AttributeError, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1196, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 1014, __pyx_L1_error)
+    __PYX_ERR(0, 1196, __pyx_L1_error)
 
-    /* "plumed.pyx":997
+    /* "plumed.pyx":1179
  * 
  *     def __getattr__(self, name):
  *        if self._has_dict:             # <<<<<<<<<<<<<<
  *            class _callme:
  *                def __init__(self,builder,name):
  */
   }
 
-  /* "plumed.pyx":1016
+  /* "plumed.pyx":1198
  *            raise AttributeError("unknown method " + name)
  *        else:
  *            class _callme:             # <<<<<<<<<<<<<<
  *                def __init__(self,builder,name):
  *                    self._builder=builder
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_callme, __pyx_n_s_InputBuilder___getattr___locals, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1016, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_callme, __pyx_n_s_InputBuilder___getattr___locals, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1198, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
 
-    /* "plumed.pyx":1017
+    /* "plumed.pyx":1199
  *        else:
  *            class _callme:
  *                def __init__(self,builder,name):             # <<<<<<<<<<<<<<
  *                    self._builder=builder
  *                    self._name=name
  */
-    __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11__getattr___7_callme_5__init__, 0, __pyx_n_s_InputBuilder___getattr___locals_2, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__77)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1017, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11__getattr___7_callme_5__init__, 0, __pyx_n_s_InputBuilder___getattr___locals_2, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__80)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_init, __pyx_t_1) < 0) __PYX_ERR(0, 1017, __pyx_L1_error)
+    if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_init, __pyx_t_1) < 0) __PYX_ERR(0, 1199, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "plumed.pyx":1021
+    /* "plumed.pyx":1203
  *                    self._name=name
  *                    self.__doc__="dynamic method printing " + name
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)
  *            if re.match(".*[^_]__$",name):
  */
-    __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11__getattr___7_callme_7__call__, 0, __pyx_n_s_InputBuilder___getattr___locals_3, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__79)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1021, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11__getattr___7_callme_7__call__, 0, __pyx_n_s_InputBuilder___getattr___locals_3, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__82)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1203, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_tuple__80);
-    if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_call, __pyx_t_1) < 0) __PYX_ERR(0, 1021, __pyx_L1_error)
+    __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_tuple__83);
+    if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_call, __pyx_t_1) < 0) __PYX_ERR(0, 1203, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "plumed.pyx":1016
+    /* "plumed.pyx":1198
  *            raise AttributeError("unknown method " + name)
  *        else:
  *            class _callme:             # <<<<<<<<<<<<<<
  *                def __init__(self,builder,name):
  *                    self._builder=builder
  */
-    __pyx_t_1 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_callme, __pyx_empty_tuple, __pyx_t_7, NULL, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1016, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_callme, __pyx_empty_tuple, __pyx_t_7, NULL, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1198, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v__callme = __pyx_t_1;
     __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-    /* "plumed.pyx":1023
+    /* "plumed.pyx":1205
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)
  *            if re.match(".*[^_]__$",name):             # <<<<<<<<<<<<<<
  *                name=name[:-2]
  *            return _callme(self,name)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1023, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_re); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1205, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_match); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1023, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_match); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1205, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_1 = NULL;
     __pyx_t_6 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_1)) {
@@ -23368,95 +25710,95 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
         __pyx_t_6 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_3)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_kp_u__81, __pyx_v_name};
-      __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1023, __pyx_L1_error)
+      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_kp_u__84, __pyx_v_name};
+      __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1205, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_GOTREF(__pyx_t_7);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_kp_u__81, __pyx_v_name};
-      __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1023, __pyx_L1_error)
+      PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_kp_u__84, __pyx_v_name};
+      __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1205, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_GOTREF(__pyx_t_7);
     } else
     #endif
     {
-      __pyx_t_5 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1023, __pyx_L1_error)
+      __pyx_t_5 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1205, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       if (__pyx_t_1) {
         __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1); __pyx_t_1 = NULL;
       }
-      __Pyx_INCREF(__pyx_kp_u__81);
-      __Pyx_GIVEREF(__pyx_kp_u__81);
-      PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_kp_u__81);
+      __Pyx_INCREF(__pyx_kp_u__84);
+      __Pyx_GIVEREF(__pyx_kp_u__84);
+      PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_kp_u__84);
       __Pyx_INCREF(__pyx_v_name);
       __Pyx_GIVEREF(__pyx_v_name);
       PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, __pyx_v_name);
-      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1023, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1205, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1023, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 1205, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     if (__pyx_t_4) {
 
-      /* "plumed.pyx":1024
+      /* "plumed.pyx":1206
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)
  *            if re.match(".*[^_]__$",name):
  *                name=name[:-2]             # <<<<<<<<<<<<<<
  *            return _callme(self,name)
  * 
  */
-      __pyx_t_7 = __Pyx_PyObject_GetSlice(__pyx_v_name, 0, -2L, NULL, NULL, &__pyx_slice__82, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1024, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_GetSlice(__pyx_v_name, 0, -2L, NULL, NULL, &__pyx_slice__85, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1206, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF_SET(__pyx_v_name, __pyx_t_7);
       __pyx_t_7 = 0;
 
-      /* "plumed.pyx":1023
+      /* "plumed.pyx":1205
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)
  *            if re.match(".*[^_]__$",name):             # <<<<<<<<<<<<<<
  *                name=name[:-2]
  *            return _callme(self,name)
  */
     }
 
-    /* "plumed.pyx":1025
+    /* "plumed.pyx":1207
  *            if re.match(".*[^_]__$",name):
  *                name=name[:-2]
  *            return _callme(self,name)             # <<<<<<<<<<<<<<
  * 
  *     def verbatim(self,line):
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1025, __pyx_L1_error)
+    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1207, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_INCREF(__pyx_v_self);
     __Pyx_GIVEREF(__pyx_v_self);
     PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_self);
     __Pyx_INCREF(__pyx_v_name);
     __Pyx_GIVEREF(__pyx_v_name);
     PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_name);
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_v__callme, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1025, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_v__callme, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1207, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
   }
 
-  /* "plumed.pyx":996
+  /* "plumed.pyx":1178
  *         return _format_return(self,ret)
  * 
  *     def __getattr__(self, name):             # <<<<<<<<<<<<<<
  *        if self._has_dict:
  *            class _callme:
  */
 
@@ -23473,15 +25815,15 @@
   __Pyx_XDECREF(__pyx_v_name__);
   __Pyx_XDECREF(__pyx_v_name);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":1027
+/* "plumed.pyx":1209
  *            return _callme(self,name)
  * 
  *     def verbatim(self,line):             # <<<<<<<<<<<<<<
  *         """Create an arbitrary line."""
  *         return _format_return(self,re.sub("[\n\t]"," ",line))
  */
 
@@ -23517,32 +25859,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_line)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("verbatim", 1, 2, 2, 1); __PYX_ERR(0, 1027, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("verbatim", 1, 2, 2, 1); __PYX_ERR(0, 1209, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "verbatim") < 0)) __PYX_ERR(0, 1027, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "verbatim") < 0)) __PYX_ERR(0, 1209, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
     __pyx_v_line = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("verbatim", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1027, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("verbatim", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1209, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.InputBuilder.verbatim", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder_6verbatim(__pyx_self, __pyx_v_self, __pyx_v_line);
 
@@ -23562,27 +25904,27 @@
   int __pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("verbatim", 0);
 
-  /* "plumed.pyx":1029
+  /* "plumed.pyx":1211
  *     def verbatim(self,line):
  *         """Create an arbitrary line."""
  *         return _format_return(self,re.sub("[\n\t]"," ",line))             # <<<<<<<<<<<<<<
  * 
  *     def numbered(self,arg):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_return); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1029, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_return); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1211, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_re); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1029, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_re); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1211, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_sub); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1029, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_sub); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1211, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   __pyx_t_6 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_4)) {
@@ -23591,44 +25933,44 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
       __pyx_t_6 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_5)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_kp_u__61, __pyx_kp_u__22, __pyx_v_line};
-    __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1029, __pyx_L1_error)
+    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_kp_u__64, __pyx_kp_u__24, __pyx_v_line};
+    __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1211, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_3);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_kp_u__61, __pyx_kp_u__22, __pyx_v_line};
-    __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1029, __pyx_L1_error)
+    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_kp_u__64, __pyx_kp_u__24, __pyx_v_line};
+    __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1211, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_3);
   } else
   #endif
   {
-    __pyx_t_7 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1029, __pyx_L1_error)
+    __pyx_t_7 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1211, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     if (__pyx_t_4) {
       __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
     }
-    __Pyx_INCREF(__pyx_kp_u__61);
-    __Pyx_GIVEREF(__pyx_kp_u__61);
-    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_kp_u__61);
-    __Pyx_INCREF(__pyx_kp_u__22);
-    __Pyx_GIVEREF(__pyx_kp_u__22);
-    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_kp_u__22);
+    __Pyx_INCREF(__pyx_kp_u__64);
+    __Pyx_GIVEREF(__pyx_kp_u__64);
+    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_kp_u__64);
+    __Pyx_INCREF(__pyx_kp_u__24);
+    __Pyx_GIVEREF(__pyx_kp_u__24);
+    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_kp_u__24);
     __Pyx_INCREF(__pyx_v_line);
     __Pyx_GIVEREF(__pyx_v_line);
     PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, __pyx_v_line);
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1029, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1211, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   }
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   __pyx_t_6 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
@@ -23640,51 +25982,51 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_6 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_self, __pyx_t_3};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1029, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1211, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_self, __pyx_t_3};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1029, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1211, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else
   #endif
   {
-    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1029, __pyx_L1_error)
+    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1211, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     if (__pyx_t_5) {
       __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
     }
     __Pyx_INCREF(__pyx_v_self);
     __Pyx_GIVEREF(__pyx_v_self);
     PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_self);
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
     __pyx_t_3 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1029, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1211, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":1027
+  /* "plumed.pyx":1209
  *            return _callme(self,name)
  * 
  *     def verbatim(self,line):             # <<<<<<<<<<<<<<
  *         """Create an arbitrary line."""
  *         return _format_return(self,re.sub("[\n\t]"," ",line))
  */
 
@@ -23700,15 +26042,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":1031
+/* "plumed.pyx":1213
  *         return _format_return(self,re.sub("[\n\t]"," ",line))
  * 
  *     def numbered(self,arg):             # <<<<<<<<<<<<<<
  *         """Shortcut for numbered syntax.
  * 
  */
 
@@ -23744,32 +26086,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("numbered", 1, 2, 2, 1); __PYX_ERR(0, 1031, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("numbered", 1, 2, 2, 1); __PYX_ERR(0, 1213, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "numbered") < 0)) __PYX_ERR(0, 1031, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "numbered") < 0)) __PYX_ERR(0, 1213, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
     __pyx_v_arg = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("numbered", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1031, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("numbered", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1213, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.InputBuilder.numbered", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder_8numbered(__pyx_self, __pyx_v_self, __pyx_v_arg);
 
@@ -23785,44 +26127,44 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("numbered", 0);
 
-  /* "plumed.pyx":1036
+  /* "plumed.pyx":1218
  *         Accepts either a list/tuple or a dictionary with integer keys.
  *         """
  *         return _numbered(arg)             # <<<<<<<<<<<<<<
  * 
  *     def replicas(self,arg):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_numbered_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1036, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_numbered_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_arg) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_arg);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1036, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":1031
+  /* "plumed.pyx":1213
  *         return _format_return(self,re.sub("[\n\t]"," ",line))
  * 
  *     def numbered(self,arg):             # <<<<<<<<<<<<<<
  *         """Shortcut for numbered syntax.
  * 
  */
 
@@ -23835,15 +26177,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "plumed.pyx":1038
+/* "plumed.pyx":1220
  *         return _numbered(arg)
  * 
  *     def replicas(self,arg):             # <<<<<<<<<<<<<<
  *         """Shortcut for replica syntax.
  * 
  */
 
@@ -23879,32 +26221,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_arg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("replicas", 1, 2, 2, 1); __PYX_ERR(0, 1038, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("replicas", 1, 2, 2, 1); __PYX_ERR(0, 1220, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "replicas") < 0)) __PYX_ERR(0, 1038, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "replicas") < 0)) __PYX_ERR(0, 1220, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
     __pyx_v_arg = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("replicas", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1038, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("replicas", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1220, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("plumed.InputBuilder.replicas", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6plumed_12InputBuilder_10replicas(__pyx_self, __pyx_v_self, __pyx_v_arg);
 
@@ -23920,44 +26262,44 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("replicas", 0);
 
-  /* "plumed.pyx":1043
+  /* "plumed.pyx":1225
  *         Accepts a list/tuple.
  *         """
  *         return _replicas(arg)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_replicas_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1043, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_replicas_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_arg) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_arg);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1043, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "plumed.pyx":1038
+  /* "plumed.pyx":1220
  *         return _numbered(arg)
  * 
  *     def replicas(self,arg):             # <<<<<<<<<<<<<<
  *         """Shortcut for replica syntax.
  * 
  */
 
@@ -24173,15 +26515,15 @@
     /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if itemsize <= 0:
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__83, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 134, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__86, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 134, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 134, __pyx_L1_error)
 
     /* "View.MemoryView":133
  *         self.itemsize = itemsize
@@ -24205,15 +26547,15 @@
     /* "View.MemoryView":137
  * 
  *         if itemsize <= 0:
  *             raise ValueError("itemsize <= 0 for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if not isinstance(format, bytes):
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__84, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 137, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__87, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 137, __pyx_L1_error)
 
     /* "View.MemoryView":136
  *             raise ValueError("Empty shape tuple for cython.array")
@@ -24332,15 +26674,15 @@
     /* "View.MemoryView":149
  * 
  *         if not self._shape:
  *             raise MemoryError("unable to allocate shape and strides.")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__85, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 149, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__88, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 149, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 149, __pyx_L1_error)
 
     /* "View.MemoryView":148
  *         self._strides = self._shape + self.ndim
@@ -24606,15 +26948,15 @@
       /* "View.MemoryView":177
  *             self.data = <char *>malloc(self.len)
  *             if not self.data:
  *                 raise MemoryError("unable to allocate array data.")             # <<<<<<<<<<<<<<
  * 
  *             if self.dtype_is_object:
  */
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__86, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 177, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__89, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 177, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_Raise(__pyx_t_10, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __PYX_ERR(1, 177, __pyx_L1_error)
 
       /* "View.MemoryView":176
  * 
@@ -24850,15 +27192,15 @@
     /* "View.MemoryView":193
  *             bufmode = PyBUF_F_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         if not (flags & bufmode):
  *             raise ValueError("Can only create a buffer that is contiguous in memory.")             # <<<<<<<<<<<<<<
  *         info.buf = self.data
  *         info.len = self.len
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__87, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 193, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__90, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 193, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 193, __pyx_L1_error)
 
     /* "View.MemoryView":192
  *         elif self.mode == u"fortran":
@@ -25585,15 +27927,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__88, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__91, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -25642,15 +27984,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__89, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__92, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -27373,15 +29715,15 @@
     /* "View.MemoryView":420
  *     def __setitem__(memoryview self, object index, object value):
  *         if self.view.readonly:
  *             raise TypeError("Cannot assign to read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         have_slices, index = _unellipsify(index, self.view.ndim)
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__90, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 420, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__93, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 420, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __PYX_ERR(1, 420, __pyx_L1_error)
 
     /* "View.MemoryView":419
  * 
@@ -28421,15 +30763,15 @@
       /* "View.MemoryView":497
  *             result = struct.unpack(self.view.format, bytesitem)
  *         except struct.error:
  *             raise ValueError("Unable to convert item to object")             # <<<<<<<<<<<<<<
  *         else:
  *             if len(self.view.format) == 1:
  */
-      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__91, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 497, __pyx_L5_except_error)
+      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__94, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 497, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_Raise(__pyx_t_6, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __PYX_ERR(1, 497, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
@@ -28783,15 +31125,15 @@
     /* "View.MemoryView":522
  *     def __getbuffer__(self, Py_buffer *info, int flags):
  *         if flags & PyBUF_WRITABLE and self.view.readonly:
  *             raise ValueError("Cannot create writable memory view from read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         if flags & PyBUF_ND:
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__92, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 522, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__95, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 522, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __PYX_ERR(1, 522, __pyx_L1_error)
 
     /* "View.MemoryView":521
  *     @cname('getbuffer')
@@ -29332,15 +31674,15 @@
     /* "View.MemoryView":572
  *         if self.view.strides == NULL:
  * 
  *             raise ValueError("Buffer view does not expose strides")             # <<<<<<<<<<<<<<
  * 
  *         return tuple([stride for stride in self.view.strides[:self.view.ndim]])
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__93, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 572, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__96, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 572, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __PYX_ERR(1, 572, __pyx_L1_error)
 
     /* "View.MemoryView":570
  *     @property
@@ -29449,15 +31791,15 @@
  *             return (-1,) * self.view.ndim             # <<<<<<<<<<<<<<
  * 
  *         return tuple([suboffset for suboffset in self.view.suboffsets[:self.view.ndim]])
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->view.ndim); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 579, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyNumber_Multiply(__pyx_tuple__94, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 579, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Multiply(__pyx_tuple__97, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 579, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
     /* "View.MemoryView":578
@@ -30492,15 +32834,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__95, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__98, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -30549,15 +32891,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__96, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__99, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -30906,17 +33248,17 @@
  *             else:
  */
         __pyx_t_8 = PyObject_Length(__pyx_v_tup); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(1, 684, __pyx_L1_error)
         __pyx_t_7 = PyList_New(1 * ((((__pyx_v_ndim - __pyx_t_8) + 1)<0) ? 0:((__pyx_v_ndim - __pyx_t_8) + 1))); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 684, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         { Py_ssize_t __pyx_temp;
           for (__pyx_temp=0; __pyx_temp < ((__pyx_v_ndim - __pyx_t_8) + 1); __pyx_temp++) {
-            __Pyx_INCREF(__pyx_slice__97);
-            __Pyx_GIVEREF(__pyx_slice__97);
-            PyList_SET_ITEM(__pyx_t_7, __pyx_temp, __pyx_slice__97);
+            __Pyx_INCREF(__pyx_slice__100);
+            __Pyx_GIVEREF(__pyx_slice__100);
+            PyList_SET_ITEM(__pyx_t_7, __pyx_temp, __pyx_slice__100);
           }
         }
         __pyx_t_9 = __Pyx_PyList_Extend(__pyx_v_result, __pyx_t_7); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 684, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
         /* "View.MemoryView":685
  *             if not seen_ellipsis:
@@ -30941,15 +33283,15 @@
  *                 seen_ellipsis = True
  *             else:
  *                 result.append(slice(None))             # <<<<<<<<<<<<<<
  *             have_slices = True
  *         else:
  */
       /*else*/ {
-        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_result, __pyx_slice__97); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 687, __pyx_L1_error)
+        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_result, __pyx_slice__100); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 687, __pyx_L1_error)
       }
       __pyx_L7:;
 
       /* "View.MemoryView":688
  *             else:
  *                 result.append(slice(None))
  *             have_slices = True             # <<<<<<<<<<<<<<
@@ -31081,17 +33423,17 @@
  * 
  *     return have_slices or nslices, tuple(result)
  */
     __pyx_t_3 = PyList_New(1 * ((__pyx_v_nslices<0) ? 0:__pyx_v_nslices)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 698, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     { Py_ssize_t __pyx_temp;
       for (__pyx_temp=0; __pyx_temp < __pyx_v_nslices; __pyx_temp++) {
-        __Pyx_INCREF(__pyx_slice__97);
-        __Pyx_GIVEREF(__pyx_slice__97);
-        PyList_SET_ITEM(__pyx_t_3, __pyx_temp, __pyx_slice__97);
+        __Pyx_INCREF(__pyx_slice__100);
+        __Pyx_GIVEREF(__pyx_slice__100);
+        PyList_SET_ITEM(__pyx_t_3, __pyx_temp, __pyx_slice__100);
       }
     }
     __pyx_t_9 = __Pyx_PyList_Extend(__pyx_v_result, __pyx_t_3); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 698, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
     /* "View.MemoryView":697
  * 
@@ -31210,15 +33552,15 @@
       /* "View.MemoryView":705
  *     for suboffset in suboffsets[:ndim]:
  *         if suboffset >= 0:
  *             raise ValueError("Indirect dimensions not supported")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__98, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 705, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__101, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 705, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_Raise(__pyx_t_5, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __PYX_ERR(1, 705, __pyx_L1_error)
 
       /* "View.MemoryView":704
  * cdef assert_direct_dimensions(Py_ssize_t *suboffsets, int ndim):
@@ -33395,15 +35737,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__99, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__102, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -33452,15 +35794,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__100, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__103, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -36729,15 +39071,15 @@
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xb068931, 0x82a3537, 0x6ae9995):             # <<<<<<<<<<<<<<
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))" % __pyx_checksum)
  */
   __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__101, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__104, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
     /* "(tree fragment)":5
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xb068931, 0x82a3537, 0x6ae9995):
@@ -37024,51 +39366,56 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static struct __pyx_vtabstruct_6plumed_Plumed __pyx_vtable_6plumed_Plumed;
 
-static PyObject *__pyx_tp_new_6plumed_Plumed(PyTypeObject *t, PyObject *a, PyObject *k) {
+static PyObject *__pyx_tp_new_6plumed_Plumed(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_obj_6plumed_Plumed *p;
   PyObject *o;
   if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
     o = (*t->tp_alloc)(t, 0);
   } else {
     o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
   }
   if (unlikely(!o)) return 0;
   p = ((struct __pyx_obj_6plumed_Plumed *)o);
   p->__pyx_vtab = __pyx_vtabptr_6plumed_Plumed;
-  new((void*)&(p->c_plumed)) PLMD::Plumed();
-  if (unlikely(__pyx_pw_6plumed_6Plumed_1__cinit__(o, a, k) < 0)) goto bad;
+  if (unlikely(__pyx_pw_6plumed_6Plumed_1__cinit__(o, __pyx_empty_tuple, NULL) < 0)) goto bad;
   return o;
   bad:
   Py_DECREF(o); o = 0;
   return NULL;
 }
 
 static void __pyx_tp_dealloc_6plumed_Plumed(PyObject *o) {
-  struct __pyx_obj_6plumed_Plumed *p = (struct __pyx_obj_6plumed_Plumed *)o;
   #if CYTHON_USE_TP_FINALIZE
   if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
-  __Pyx_call_destructor(p->c_plumed);
+  {
+    PyObject *etype, *eval, *etb;
+    PyErr_Fetch(&etype, &eval, &etb);
+    __Pyx_SET_REFCNT(o, Py_REFCNT(o) + 1);
+    __pyx_pw_6plumed_6Plumed_3__dealloc__(o);
+    __Pyx_SET_REFCNT(o, Py_REFCNT(o) - 1);
+    PyErr_Restore(etype, eval, etb);
+  }
   (*Py_TYPE(o)->tp_free)(o);
 }
 
 static PyMethodDef __pyx_methods_6plumed_Plumed[] = {
-  {"finalize", (PyCFunction)__pyx_pw_6plumed_6Plumed_3finalize, METH_NOARGS, __pyx_doc_6plumed_6Plumed_2finalize},
-  {"__enter__", (PyCFunction)__pyx_pw_6plumed_6Plumed_5__enter__, METH_NOARGS, 0},
-  {"__exit__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_6Plumed_7__exit__, METH_VARARGS|METH_KEYWORDS, 0},
-  {"cmd", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_6Plumed_9cmd, METH_VARARGS|METH_KEYWORDS, 0},
-  {"__reduce_cython__", (PyCFunction)__pyx_pw_6plumed_6Plumed_11__reduce_cython__, METH_NOARGS, 0},
-  {"__setstate_cython__", (PyCFunction)__pyx_pw_6plumed_6Plumed_13__setstate_cython__, METH_O, 0},
+  {"finalize", (PyCFunction)__pyx_pw_6plumed_6Plumed_7finalize, METH_NOARGS, __pyx_doc_6plumed_6Plumed_6finalize},
+  {"__enter__", (PyCFunction)__pyx_pw_6plumed_6Plumed_9__enter__, METH_NOARGS, 0},
+  {"__exit__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_6Plumed_11__exit__, METH_VARARGS|METH_KEYWORDS, 0},
+  {"cmd", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6plumed_6Plumed_13cmd, METH_VARARGS|METH_KEYWORDS, 0},
+  {"__reduce_cython__", (PyCFunction)__pyx_pw_6plumed_6Plumed_15__reduce_cython__, METH_NOARGS, 0},
+  {"__setstate_cython__", (PyCFunction)__pyx_pw_6plumed_6Plumed_17__setstate_cython__, METH_O, 0},
   {0, 0, 0, 0}
 };
 
 static PyTypeObject __pyx_type_6plumed_Plumed = {
   PyVarObject_HEAD_INIT(0, 0)
   "plumed.Plumed", /*tp_name*/
   sizeof(struct __pyx_obj_6plumed_Plumed), /*tp_basicsize*/
@@ -37110,15 +39457,15 @@
   0, /*tp_members*/
   0, /*tp_getset*/
   0, /*tp_base*/
   0, /*tp_dict*/
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   0, /*tp_dictoffset*/
-  0, /*tp_init*/
+  __pyx_pw_6plumed_6Plumed_5__init__, /*tp_init*/
   0, /*tp_alloc*/
   __pyx_tp_new_6plumed_Plumed, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
@@ -38160,14 +40507,15 @@
 #else
     #define CYTHON_SMALL_CODE
 #endif
 #endif
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s_ASCII, __pyx_k_ASCII, sizeof(__pyx_k_ASCII), 0, 0, 1, 1},
+  {&__pyx_n_s_ArithmeticError, __pyx_k_ArithmeticError, sizeof(__pyx_k_ArithmeticError), 0, 0, 1, 1},
   {&__pyx_n_s_AtomGroup, __pyx_k_AtomGroup, sizeof(__pyx_k_AtomGroup), 0, 0, 1, 1},
   {&__pyx_n_s_AttributeError, __pyx_k_AttributeError, sizeof(__pyx_k_AttributeError), 0, 0, 1, 1},
   {&__pyx_kp_s_Buffer_view_does_not_expose_stri, __pyx_k_Buffer_view_does_not_expose_stri, sizeof(__pyx_k_Buffer_view_does_not_expose_stri), 0, 0, 1, 0},
   {&__pyx_kp_s_Can_only_create_a_buffer_that_is, __pyx_k_Can_only_create_a_buffer_that_is, sizeof(__pyx_k_Can_only_create_a_buffer_that_is), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_assign_to_read_only_memor, __pyx_k_Cannot_assign_to_read_only_memor, sizeof(__pyx_k_Cannot_assign_to_read_only_memor), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_create_writable_memory_vi, __pyx_k_Cannot_create_writable_memory_vi, sizeof(__pyx_k_Cannot_create_writable_memory_vi), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_index_with_type_s, __pyx_k_Cannot_index_with_type_s, sizeof(__pyx_k_Cannot_index_with_type_s), 0, 0, 1, 0},
@@ -38187,14 +40535,15 @@
   {&__pyx_kp_u_Error_reading_PLUMED_file_2, __pyx_k_Error_reading_PLUMED_file_2, sizeof(__pyx_k_Error_reading_PLUMED_file_2), 0, 1, 0, 0},
   {&__pyx_n_u_FIELDS, __pyx_k_FIELDS, sizeof(__pyx_k_FIELDS), 0, 1, 0, 1},
   {&__pyx_kp_u_FIELDS_2, __pyx_k_FIELDS_2, sizeof(__pyx_k_FIELDS_2), 0, 1, 0, 0},
   {&__pyx_kp_u_False, __pyx_k_False, sizeof(__pyx_k_False), 0, 1, 0, 0},
   {&__pyx_n_s_FormatError, __pyx_k_FormatError, sizeof(__pyx_k_FormatError), 0, 0, 1, 1},
   {&__pyx_n_s_HAS_NUMPY, __pyx_k_HAS_NUMPY, sizeof(__pyx_k_HAS_NUMPY), 0, 0, 1, 1},
   {&__pyx_n_u_I, __pyx_k_I, sizeof(__pyx_k_I), 0, 1, 0, 1},
+  {&__pyx_n_s_IOError, __pyx_k_IOError, sizeof(__pyx_k_IOError), 0, 0, 1, 1},
   {&__pyx_n_s_ImportError, __pyx_k_ImportError, sizeof(__pyx_k_ImportError), 0, 0, 1, 1},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_k_Incompatible_checksums_0x_x_vs_0, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0), 0, 0, 1, 0},
   {&__pyx_n_s_IndexError, __pyx_k_IndexError, sizeof(__pyx_k_IndexError), 0, 0, 1, 1},
   {&__pyx_kp_s_Indirect_dimensions_not_supporte, __pyx_k_Indirect_dimensions_not_supporte, sizeof(__pyx_k_Indirect_dimensions_not_supporte), 0, 0, 1, 0},
   {&__pyx_n_s_InputBuilder, __pyx_k_InputBuilder, sizeof(__pyx_k_InputBuilder), 0, 0, 1, 1},
   {&__pyx_n_s_InputBuilder___call, __pyx_k_InputBuilder___call, sizeof(__pyx_k_InputBuilder___call), 0, 0, 1, 1},
   {&__pyx_n_s_InputBuilder___getattr, __pyx_k_InputBuilder___getattr, sizeof(__pyx_k_InputBuilder___getattr), 0, 0, 1, 1},
@@ -38205,34 +40554,37 @@
   {&__pyx_n_s_InputBuilder_numbered, __pyx_k_InputBuilder_numbered, sizeof(__pyx_k_InputBuilder_numbered), 0, 0, 1, 1},
   {&__pyx_n_s_InputBuilder_replicas, __pyx_k_InputBuilder_replicas, sizeof(__pyx_k_InputBuilder_replicas), 0, 0, 1, 1},
   {&__pyx_n_s_InputBuilder_verbatim, __pyx_k_InputBuilder_verbatim, sizeof(__pyx_k_InputBuilder_verbatim), 0, 0, 1, 1},
   {&__pyx_kp_s_Invalid_mode_expected_c_or_fortr, __pyx_k_Invalid_mode_expected_c_or_fortr, sizeof(__pyx_k_Invalid_mode_expected_c_or_fortr), 0, 0, 1, 0},
   {&__pyx_kp_s_Invalid_shape_in_axis_d_d, __pyx_k_Invalid_shape_in_axis_d_d, sizeof(__pyx_k_Invalid_shape_in_axis_d_d), 0, 0, 1, 0},
   {&__pyx_n_u_L, __pyx_k_L, sizeof(__pyx_k_L), 0, 1, 0, 1},
   {&__pyx_n_s_LABEL, __pyx_k_LABEL, sizeof(__pyx_k_LABEL), 0, 0, 1, 1},
+  {&__pyx_n_s_LeptonError, __pyx_k_LeptonError, sizeof(__pyx_k_LeptonError), 0, 0, 1, 1},
   {&__pyx_n_s_MDAnalysis, __pyx_k_MDAnalysis, sizeof(__pyx_k_MDAnalysis), 0, 0, 1, 1},
   {&__pyx_n_u_MDAnalysis, __pyx_k_MDAnalysis, sizeof(__pyx_k_MDAnalysis), 0, 1, 0, 1},
   {&__pyx_n_s_MPI, __pyx_k_MPI, sizeof(__pyx_k_MPI), 0, 0, 1, 1},
   {&__pyx_n_s_MemoryError, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
   {&__pyx_kp_s_MemoryView_of_r_at_0x_x, __pyx_k_MemoryView_of_r_at_0x_x, sizeof(__pyx_k_MemoryView_of_r_at_0x_x), 0, 0, 1, 0},
   {&__pyx_kp_s_MemoryView_of_r_object, __pyx_k_MemoryView_of_r_object, sizeof(__pyx_k_MemoryView_of_r_object), 0, 0, 1, 0},
   {&__pyx_kp_u_None, __pyx_k_None, sizeof(__pyx_k_None), 0, 1, 0, 0},
   {&__pyx_kp_u_Not_enough_columns, __pyx_k_Not_enough_columns, sizeof(__pyx_k_Not_enough_columns), 0, 1, 0, 0},
   {&__pyx_n_s_Number, __pyx_k_Number, sizeof(__pyx_k_Number), 0, 0, 1, 1},
   {&__pyx_n_b_O, __pyx_k_O, sizeof(__pyx_k_O), 0, 0, 0, 1},
   {&__pyx_kp_s_Object_used_to_construct_plumed, __pyx_k_Object_used_to_construct_plumed, sizeof(__pyx_k_Object_used_to_construct_plumed), 0, 0, 1, 0},
   {&__pyx_kp_s_Out_of_bounds_on_buffer_access_a, __pyx_k_Out_of_bounds_on_buffer_access_a, sizeof(__pyx_k_Out_of_bounds_on_buffer_access_a), 0, 0, 1, 0},
+  {&__pyx_n_s_OverflowError, __pyx_k_OverflowError, sizeof(__pyx_k_OverflowError), 0, 0, 1, 1},
   {&__pyx_kp_u_PLUMED_2_6_only_supports_Python, __pyx_k_PLUMED_2_6_only_supports_Python, sizeof(__pyx_k_PLUMED_2_6_only_supports_Python), 0, 1, 0, 0},
   {&__pyx_kp_u_PLUMED_Root, __pyx_k_PLUMED_Root, sizeof(__pyx_k_PLUMED_Root), 0, 1, 0, 0},
   {&__pyx_kp_u_PLUMED_instance_is_too_old_conve, __pyx_k_PLUMED_instance_is_too_old_conve, sizeof(__pyx_k_PLUMED_instance_is_too_old_conve), 0, 1, 0, 0},
   {&__pyx_kp_u_PLUMED_instance_seems_to_have_a, __pyx_k_PLUMED_instance_seems_to_have_a, sizeof(__pyx_k_PLUMED_instance_seems_to_have_a), 0, 1, 0, 0},
   {&__pyx_kp_u_PLUMED_not_available_check_your, __pyx_k_PLUMED_not_available_check_your, sizeof(__pyx_k_PLUMED_not_available_check_your), 0, 1, 0, 0},
   {&__pyx_n_s_PickleError, __pyx_k_PickleError, sizeof(__pyx_k_PickleError), 0, 0, 1, 1},
   {&__pyx_n_s_Plumed, __pyx_k_Plumed, sizeof(__pyx_k_Plumed), 0, 0, 1, 1},
   {&__pyx_n_s_PlumedDataFrame, __pyx_k_PlumedDataFrame, sizeof(__pyx_k_PlumedDataFrame), 0, 0, 1, 1},
+  {&__pyx_n_s_PlumedError, __pyx_k_PlumedError, sizeof(__pyx_k_PlumedError), 0, 0, 1, 1},
   {&__pyx_n_s_PlumedSeries, __pyx_k_PlumedSeries, sizeof(__pyx_k_PlumedSeries), 0, 0, 1, 1},
   {&__pyx_n_s_Plumed___enter, __pyx_k_Plumed___enter, sizeof(__pyx_k_Plumed___enter), 0, 0, 1, 1},
   {&__pyx_n_s_Plumed___exit, __pyx_k_Plumed___exit, sizeof(__pyx_k_Plumed___exit), 0, 0, 1, 1},
   {&__pyx_n_s_Plumed___reduce_cython, __pyx_k_Plumed___reduce_cython, sizeof(__pyx_k_Plumed___reduce_cython), 0, 0, 1, 1},
   {&__pyx_n_s_Plumed___setstate_cython, __pyx_k_Plumed___setstate_cython, sizeof(__pyx_k_Plumed___setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_s_Plumed_cmd, __pyx_k_Plumed_cmd, sizeof(__pyx_k_Plumed_cmd), 0, 0, 1, 1},
   {&__pyx_n_s_Plumed_finalize, __pyx_k_Plumed_finalize, sizeof(__pyx_k_Plumed_finalize), 0, 0, 1, 1},
@@ -38244,50 +40596,50 @@
   {&__pyx_n_s_TextFileReader, __pyx_k_TextFileReader, sizeof(__pyx_k_TextFileReader), 0, 0, 1, 1},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
   {&__pyx_kp_s_Unable_to_convert_item_to_object, __pyx_k_Unable_to_convert_item_to_object, sizeof(__pyx_k_Unable_to_convert_item_to_object), 0, 0, 1, 0},
   {&__pyx_kp_u_Unknown_value_type, __pyx_k_Unknown_value_type, sizeof(__pyx_k_Unknown_value_type), 0, 1, 0, 0},
   {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
   {&__pyx_n_s_View_MemoryView, __pyx_k_View_MemoryView, sizeof(__pyx_k_View_MemoryView), 0, 0, 1, 1},
   {&__pyx_kp_u_Writing_dataframes_with_MultiInd, __pyx_k_Writing_dataframes_with_MultiInd, sizeof(__pyx_k_Writing_dataframes_with_MultiInd), 0, 1, 0, 0},
-  {&__pyx_n_s__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 0, 1, 1},
-  {&__pyx_kp_u__21, __pyx_k__21, sizeof(__pyx_k__21), 0, 1, 0, 0},
-  {&__pyx_kp_u__22, __pyx_k__22, sizeof(__pyx_k__22), 0, 1, 0, 0},
+  {&__pyx_kp_u__23, __pyx_k__23, sizeof(__pyx_k__23), 0, 1, 0, 0},
   {&__pyx_kp_u__24, __pyx_k__24, sizeof(__pyx_k__24), 0, 1, 0, 0},
-  {&__pyx_kp_u__30, __pyx_k__30, sizeof(__pyx_k__30), 0, 1, 0, 0},
+  {&__pyx_kp_u__26, __pyx_k__26, sizeof(__pyx_k__26), 0, 1, 0, 0},
   {&__pyx_kp_u__32, __pyx_k__32, sizeof(__pyx_k__32), 0, 1, 0, 0},
-  {&__pyx_kp_u__33, __pyx_k__33, sizeof(__pyx_k__33), 0, 1, 0, 0},
-  {&__pyx_kp_u__34, __pyx_k__34, sizeof(__pyx_k__34), 0, 1, 0, 0},
+  {&__pyx_kp_u__35, __pyx_k__35, sizeof(__pyx_k__35), 0, 1, 0, 0},
   {&__pyx_kp_u__36, __pyx_k__36, sizeof(__pyx_k__36), 0, 1, 0, 0},
-  {&__pyx_kp_u__38, __pyx_k__38, sizeof(__pyx_k__38), 0, 1, 0, 0},
+  {&__pyx_kp_u__37, __pyx_k__37, sizeof(__pyx_k__37), 0, 1, 0, 0},
   {&__pyx_kp_u__39, __pyx_k__39, sizeof(__pyx_k__39), 0, 1, 0, 0},
-  {&__pyx_n_u__40, __pyx_k__40, sizeof(__pyx_k__40), 0, 1, 0, 1},
+  {&__pyx_n_s__4, __pyx_k__4, sizeof(__pyx_k__4), 0, 0, 1, 1},
   {&__pyx_kp_u__41, __pyx_k__41, sizeof(__pyx_k__41), 0, 1, 0, 0},
   {&__pyx_kp_u__42, __pyx_k__42, sizeof(__pyx_k__42), 0, 1, 0, 0},
-  {&__pyx_kp_u__43, __pyx_k__43, sizeof(__pyx_k__43), 0, 1, 0, 0},
+  {&__pyx_n_u__43, __pyx_k__43, sizeof(__pyx_k__43), 0, 1, 0, 1},
   {&__pyx_kp_u__44, __pyx_k__44, sizeof(__pyx_k__44), 0, 1, 0, 0},
   {&__pyx_kp_u__45, __pyx_k__45, sizeof(__pyx_k__45), 0, 1, 0, 0},
   {&__pyx_kp_u__46, __pyx_k__46, sizeof(__pyx_k__46), 0, 1, 0, 0},
   {&__pyx_kp_u__47, __pyx_k__47, sizeof(__pyx_k__47), 0, 1, 0, 0},
-  {&__pyx_n_u__50, __pyx_k__50, sizeof(__pyx_k__50), 0, 1, 0, 1},
-  {&__pyx_kp_u__51, __pyx_k__51, sizeof(__pyx_k__51), 0, 1, 0, 0},
-  {&__pyx_kp_u__52, __pyx_k__52, sizeof(__pyx_k__52), 0, 1, 0, 0},
-  {&__pyx_kp_u__53, __pyx_k__53, sizeof(__pyx_k__53), 0, 1, 0, 0},
+  {&__pyx_kp_u__48, __pyx_k__48, sizeof(__pyx_k__48), 0, 1, 0, 0},
+  {&__pyx_kp_u__49, __pyx_k__49, sizeof(__pyx_k__49), 0, 1, 0, 0},
+  {&__pyx_kp_u__50, __pyx_k__50, sizeof(__pyx_k__50), 0, 1, 0, 0},
+  {&__pyx_n_u__53, __pyx_k__53, sizeof(__pyx_k__53), 0, 1, 0, 1},
   {&__pyx_kp_u__54, __pyx_k__54, sizeof(__pyx_k__54), 0, 1, 0, 0},
   {&__pyx_kp_u__55, __pyx_k__55, sizeof(__pyx_k__55), 0, 1, 0, 0},
   {&__pyx_kp_u__56, __pyx_k__56, sizeof(__pyx_k__56), 0, 1, 0, 0},
   {&__pyx_kp_u__57, __pyx_k__57, sizeof(__pyx_k__57), 0, 1, 0, 0},
   {&__pyx_kp_u__58, __pyx_k__58, sizeof(__pyx_k__58), 0, 1, 0, 0},
   {&__pyx_kp_u__59, __pyx_k__59, sizeof(__pyx_k__59), 0, 1, 0, 0},
   {&__pyx_kp_u__60, __pyx_k__60, sizeof(__pyx_k__60), 0, 1, 0, 0},
   {&__pyx_kp_u__61, __pyx_k__61, sizeof(__pyx_k__61), 0, 1, 0, 0},
-  {&__pyx_kp_u__66, __pyx_k__66, sizeof(__pyx_k__66), 0, 1, 0, 0},
-  {&__pyx_kp_u__68, __pyx_k__68, sizeof(__pyx_k__68), 0, 1, 0, 0},
-  {&__pyx_kp_u__74, __pyx_k__74, sizeof(__pyx_k__74), 0, 1, 0, 0},
-  {&__pyx_kp_u__75, __pyx_k__75, sizeof(__pyx_k__75), 0, 1, 0, 0},
-  {&__pyx_kp_u__81, __pyx_k__81, sizeof(__pyx_k__81), 0, 1, 0, 0},
+  {&__pyx_kp_u__62, __pyx_k__62, sizeof(__pyx_k__62), 0, 1, 0, 0},
+  {&__pyx_kp_u__63, __pyx_k__63, sizeof(__pyx_k__63), 0, 1, 0, 0},
+  {&__pyx_kp_u__64, __pyx_k__64, sizeof(__pyx_k__64), 0, 1, 0, 0},
+  {&__pyx_kp_u__69, __pyx_k__69, sizeof(__pyx_k__69), 0, 1, 0, 0},
+  {&__pyx_kp_u__71, __pyx_k__71, sizeof(__pyx_k__71), 0, 1, 0, 0},
+  {&__pyx_kp_u__77, __pyx_k__77, sizeof(__pyx_k__77), 0, 1, 0, 0},
+  {&__pyx_kp_u__78, __pyx_k__78, sizeof(__pyx_k__78), 0, 1, 0, 0},
+  {&__pyx_kp_u__84, __pyx_k__84, sizeof(__pyx_k__84), 0, 1, 0, 0},
   {&__pyx_n_s_a, __pyx_k_a, sizeof(__pyx_k_a), 0, 0, 1, 1},
   {&__pyx_n_s_action, __pyx_k_action, sizeof(__pyx_k_action), 0, 0, 1, 1},
   {&__pyx_n_s_addressof, __pyx_k_addressof, sizeof(__pyx_k_addressof), 0, 0, 1, 1},
   {&__pyx_n_u_all, __pyx_k_all, sizeof(__pyx_k_all), 0, 1, 0, 1},
   {&__pyx_n_u_allatoms, __pyx_k_allatoms, sizeof(__pyx_k_allatoms), 0, 1, 0, 1},
   {&__pyx_n_s_allocate_buffer, __pyx_k_allocate_buffer, sizeof(__pyx_k_allocate_buffer), 0, 0, 1, 1},
   {&__pyx_kp_u_allowed, __pyx_k_allowed, sizeof(__pyx_k_allowed), 0, 1, 0, 0},
@@ -38297,14 +40649,15 @@
   {&__pyx_n_s_append, __pyx_k_append, sizeof(__pyx_k_append), 0, 0, 1, 1},
   {&__pyx_n_s_append_underscores, __pyx_k_append_underscores, sizeof(__pyx_k_append_underscores), 0, 0, 1, 1},
   {&__pyx_n_s_append_underscores_2, __pyx_k_append_underscores_2, sizeof(__pyx_k_append_underscores_2), 0, 0, 1, 1},
   {&__pyx_n_s_applymap, __pyx_k_applymap, sizeof(__pyx_k_applymap), 0, 0, 1, 1},
   {&__pyx_n_s_arg, __pyx_k_arg, sizeof(__pyx_k_arg), 0, 0, 1, 1},
   {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
   {&__pyx_n_s_array, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
+  {&__pyx_kp_u_arrays_should_be_type_double_siz, __pyx_k_arrays_should_be_type_double_siz, sizeof(__pyx_k_arrays_should_be_type_double_siz), 0, 1, 0, 0},
   {&__pyx_n_s_at, __pyx_k_at, sizeof(__pyx_k_at), 0, 0, 1, 1},
   {&__pyx_n_s_at_2, __pyx_k_at_2, sizeof(__pyx_k_at_2), 0, 0, 1, 1},
   {&__pyx_n_s_at___call, __pyx_k_at___call, sizeof(__pyx_k_at___call), 0, 0, 1, 1},
   {&__pyx_n_s_at___init, __pyx_k_at___init, sizeof(__pyx_k_at___init), 0, 0, 1, 1},
   {&__pyx_n_s_at_global, __pyx_k_at_global, sizeof(__pyx_k_at_global), 0, 0, 1, 1},
   {&__pyx_n_s_at_residue, __pyx_k_at_residue, sizeof(__pyx_k_at_residue), 0, 0, 1, 1},
   {&__pyx_n_u_back, __pyx_k_back, sizeof(__pyx_k_back), 0, 1, 0, 1},
@@ -38318,22 +40671,24 @@
   {&__pyx_n_s_builtins, __pyx_k_builtins, sizeof(__pyx_k_builtins), 0, 0, 1, 1},
   {&__pyx_n_u_builtins, __pyx_k_builtins, sizeof(__pyx_k_builtins), 0, 1, 0, 1},
   {&__pyx_n_s_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 0, 1, 1},
   {&__pyx_n_u_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 1, 0, 1},
   {&__pyx_n_s_call, __pyx_k_call, sizeof(__pyx_k_call), 0, 0, 1, 1},
   {&__pyx_n_s_callme, __pyx_k_callme, sizeof(__pyx_k_callme), 0, 0, 1, 1},
   {&__pyx_kp_u_cannot_load_PLUMED_instance_conv, __pyx_k_cannot_load_PLUMED_instance_conv, sizeof(__pyx_k_cannot_load_PLUMED_instance_conv), 0, 1, 0, 0},
+  {&__pyx_kp_u_cannot_use_simultaneously_time_a, __pyx_k_cannot_use_simultaneously_time_a, sizeof(__pyx_k_cannot_use_simultaneously_time_a), 0, 1, 0, 0},
   {&__pyx_n_s_chain, __pyx_k_chain, sizeof(__pyx_k_chain), 0, 0, 1, 1},
   {&__pyx_n_s_check_output, __pyx_k_check_output, sizeof(__pyx_k_check_output), 0, 0, 1, 1},
   {&__pyx_n_u_chi, __pyx_k_chi, sizeof(__pyx_k_chi), 0, 1, 0, 1},
   {&__pyx_n_u_chi1, __pyx_k_chi1, sizeof(__pyx_k_chi1), 0, 1, 0, 1},
   {&__pyx_n_s_chunksize, __pyx_k_chunksize, sizeof(__pyx_k_chunksize), 0, 0, 1, 1},
   {&__pyx_n_s_ckey, __pyx_k_ckey, sizeof(__pyx_k_ckey), 0, 0, 1, 1},
   {&__pyx_n_s_class, __pyx_k_class, sizeof(__pyx_k_class), 0, 0, 1, 1},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
+  {&__pyx_n_s_clip, __pyx_k_clip, sizeof(__pyx_k_clip), 0, 0, 1, 1},
   {&__pyx_n_s_cmd, __pyx_k_cmd, sizeof(__pyx_k_cmd), 0, 0, 1, 1},
   {&__pyx_n_s_columns, __pyx_k_columns, sizeof(__pyx_k_columns), 0, 0, 1, 1},
   {&__pyx_n_u_columns, __pyx_k_columns, sizeof(__pyx_k_columns), 0, 1, 0, 1},
   {&__pyx_n_s_comma, __pyx_k_comma, sizeof(__pyx_k_comma), 0, 0, 1, 1},
   {&__pyx_n_s_comma_separator, __pyx_k_comma_separator, sizeof(__pyx_k_comma_separator), 0, 0, 1, 1},
   {&__pyx_n_s_comment, __pyx_k_comment, sizeof(__pyx_k_comment), 0, 0, 1, 1},
   {&__pyx_n_s_compile, __pyx_k_compile, sizeof(__pyx_k_compile), 0, 0, 1, 1},
@@ -38345,17 +40700,17 @@
   {&__pyx_kp_u_contains_nonmatching_braces, __pyx_k_contains_nonmatching_braces, sizeof(__pyx_k_contains_nonmatching_braces), 0, 1, 0, 0},
   {&__pyx_kp_s_contiguous_and_direct, __pyx_k_contiguous_and_direct, sizeof(__pyx_k_contiguous_and_direct), 0, 0, 1, 0},
   {&__pyx_kp_s_contiguous_and_indirect, __pyx_k_contiguous_and_indirect, sizeof(__pyx_k_contiguous_and_indirect), 0, 0, 1, 0},
   {&__pyx_kp_u_convert, __pyx_k_convert, sizeof(__pyx_k_convert), 0, 1, 0, 0},
   {&__pyx_n_s_convert_2, __pyx_k_convert_2, sizeof(__pyx_k_convert_2), 0, 0, 1, 1},
   {&__pyx_n_s_convert_all, __pyx_k_convert_all, sizeof(__pyx_k_convert_all), 0, 0, 1, 1},
   {&__pyx_n_s_convert_func, __pyx_k_convert_func, sizeof(__pyx_k_convert_func), 0, 0, 1, 1},
+  {&__pyx_n_s_copy, __pyx_k_copy, sizeof(__pyx_k_copy), 0, 0, 1, 1},
   {&__pyx_n_s_core, __pyx_k_core, sizeof(__pyx_k_core), 0, 0, 1, 1},
   {&__pyx_n_s_create_functions, __pyx_k_create_functions, sizeof(__pyx_k_create_functions), 0, 0, 1, 1},
-  {&__pyx_n_s_ctypes, __pyx_k_ctypes, sizeof(__pyx_k_ctypes), 0, 0, 1, 1},
   {&__pyx_n_s_cval, __pyx_k_cval, sizeof(__pyx_k_cval), 0, 0, 1, 1},
   {&__pyx_n_u_d, __pyx_k_d, sizeof(__pyx_k_d), 0, 1, 0, 1},
   {&__pyx_n_s_decode, __pyx_k_decode, sizeof(__pyx_k_decode), 0, 0, 1, 1},
   {&__pyx_kp_u_def, __pyx_k_def, sizeof(__pyx_k_def), 0, 1, 0, 0},
   {&__pyx_n_s_delim_whitespace, __pyx_k_delim_whitespace, sizeof(__pyx_k_delim_whitespace), 0, 0, 1, 1},
   {&__pyx_n_u_delta, __pyx_k_delta, sizeof(__pyx_k_delta), 0, 1, 0, 1},
   {&__pyx_n_s_df, __pyx_k_df, sizeof(__pyx_k_df), 0, 0, 1, 1},
@@ -38416,46 +40771,56 @@
   {&__pyx_n_u_format_return, __pyx_k_format_return, sizeof(__pyx_k_format_return), 0, 1, 0, 1},
   {&__pyx_n_s_format_single, __pyx_k_format_single, sizeof(__pyx_k_format_single), 0, 0, 1, 1},
   {&__pyx_n_s_format_tools, __pyx_k_format_tools, sizeof(__pyx_k_format_tools), 0, 0, 1, 1},
   {&__pyx_n_s_format_verbatim, __pyx_k_format_verbatim, sizeof(__pyx_k_format_verbatim), 0, 0, 1, 1},
   {&__pyx_n_u_format_verbatim, __pyx_k_format_verbatim, sizeof(__pyx_k_format_verbatim), 0, 1, 0, 1},
   {&__pyx_n_s_fortran, __pyx_k_fortran, sizeof(__pyx_k_fortran), 0, 0, 1, 1},
   {&__pyx_n_u_fortran, __pyx_k_fortran, sizeof(__pyx_k_fortran), 0, 1, 0, 1},
+  {&__pyx_n_s_frac0, __pyx_k_frac0, sizeof(__pyx_k_frac0), 0, 0, 1, 1},
+  {&__pyx_n_s_frac1, __pyx_k_frac1, sizeof(__pyx_k_frac1), 0, 0, 1, 1},
   {&__pyx_n_s_func, __pyx_k_func, sizeof(__pyx_k_func), 0, 0, 1, 1},
   {&__pyx_n_s_functions, __pyx_k_functions, sizeof(__pyx_k_functions), 0, 0, 1, 1},
   {&__pyx_n_s_functions_2, __pyx_k_functions_2, sizeof(__pyx_k_functions_2), 0, 0, 1, 1},
   {&__pyx_n_u_gamma, __pyx_k_gamma, sizeof(__pyx_k_gamma), 0, 1, 0, 1},
+  {&__pyx_n_u_getApiVersion, __pyx_k_getApiVersion, sizeof(__pyx_k_getApiVersion), 0, 1, 0, 1},
   {&__pyx_n_s_getattr, __pyx_k_getattr, sizeof(__pyx_k_getattr), 0, 0, 1, 1},
   {&__pyx_n_s_getstate, __pyx_k_getstate, sizeof(__pyx_k_getstate), 0, 0, 1, 1},
   {&__pyx_n_s_go, __pyx_k_go, sizeof(__pyx_k_go), 0, 0, 1, 1},
   {&__pyx_kp_s_got_differing_extents_in_dimensi, __pyx_k_got_differing_extents_in_dimensi, sizeof(__pyx_k_got_differing_extents_in_dimensi), 0, 0, 1, 0},
   {&__pyx_n_s_groups, __pyx_k_groups, sizeof(__pyx_k_groups), 0, 0, 1, 1},
   {&__pyx_n_s_guessplumedroot, __pyx_k_guessplumedroot, sizeof(__pyx_k_guessplumedroot), 0, 0, 1, 1},
   {&__pyx_kp_u_gz, __pyx_k_gz, sizeof(__pyx_k_gz), 0, 1, 0, 0},
   {&__pyx_n_s_gzip, __pyx_k_gzip, sizeof(__pyx_k_gzip), 0, 0, 1, 1},
   {&__pyx_n_s_has_dict, __pyx_k_has_dict, sizeof(__pyx_k_has_dict), 0, 0, 1, 1},
   {&__pyx_n_s_has_index, __pyx_k_has_index, sizeof(__pyx_k_has_index), 0, 0, 1, 1},
   {&__pyx_n_s_has_mindex, __pyx_k_has_mindex, sizeof(__pyx_k_has_mindex), 0, 0, 1, 1},
   {&__pyx_n_s_header, __pyx_k_header, sizeof(__pyx_k_header), 0, 0, 1, 1},
+  {&__pyx_n_s_height, __pyx_k_height, sizeof(__pyx_k_height), 0, 0, 1, 1},
   {&__pyx_n_s_help_dir, __pyx_k_help_dir, sizeof(__pyx_k_help_dir), 0, 0, 1, 1},
+  {&__pyx_n_s_hills, __pyx_k_hills, sizeof(__pyx_k_hills), 0, 0, 1, 1},
+  {&__pyx_n_s_hills_time_average, __pyx_k_hills_time_average, sizeof(__pyx_k_hills_time_average), 0, 0, 1, 1},
   {&__pyx_n_s_history, __pyx_k_history, sizeof(__pyx_k_history), 0, 0, 1, 1},
+  {&__pyx_n_s_hstack, __pyx_k_hstack, sizeof(__pyx_k_hstack), 0, 0, 1, 1},
   {&__pyx_n_u_hydrogens, __pyx_k_hydrogens, sizeof(__pyx_k_hydrogens), 0, 1, 0, 1},
   {&__pyx_n_s_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 0, 1, 1},
   {&__pyx_n_u_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 1, 0, 1},
+  {&__pyx_n_s_i0, __pyx_k_i0, sizeof(__pyx_k_i0), 0, 0, 1, 1},
+  {&__pyx_n_s_i1, __pyx_k_i1, sizeof(__pyx_k_i1), 0, 0, 1, 1},
   {&__pyx_n_s_id, __pyx_k_id, sizeof(__pyx_k_id), 0, 0, 1, 1},
   {&__pyx_kp_u_if_len_x_0, __pyx_k_if_len_x_0, sizeof(__pyx_k_if_len_x_0), 0, 1, 0, 0},
   {&__pyx_kp_u_if_not_re_sub_0_9_arg_in_allowe, __pyx_k_if_not_re_sub_0_9_arg_in_allowe, sizeof(__pyx_k_if_not_re_sub_0_9_arg_in_allowe), 0, 1, 0, 0},
   {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
   {&__pyx_kp_u_import_re, __pyx_k_import_re, sizeof(__pyx_k_import_re), 0, 1, 0, 0},
   {&__pyx_n_s_index, __pyx_k_index, sizeof(__pyx_k_index), 0, 0, 1, 1},
   {&__pyx_n_s_index_col, __pyx_k_index_col, sizeof(__pyx_k_index_col), 0, 0, 1, 1},
   {&__pyx_n_s_indices, __pyx_k_indices, sizeof(__pyx_k_indices), 0, 0, 1, 1},
   {&__pyx_n_u_info, __pyx_k_info, sizeof(__pyx_k_info), 0, 1, 0, 1},
   {&__pyx_n_s_init, __pyx_k_init, sizeof(__pyx_k_init), 0, 0, 1, 1},
   {&__pyx_n_u_init_2, __pyx_k_init_2, sizeof(__pyx_k_init_2), 0, 1, 0, 1},
+  {&__pyx_n_s_inplace, __pyx_k_inplace, sizeof(__pyx_k_inplace), 0, 0, 1, 1},
   {&__pyx_n_s_int, __pyx_k_int, sizeof(__pyx_k_int), 0, 0, 1, 1},
   {&__pyx_n_s_intc, __pyx_k_intc, sizeof(__pyx_k_intc), 0, 0, 1, 1},
   {&__pyx_n_u_ions, __pyx_k_ions, sizeof(__pyx_k_ions), 0, 1, 0, 1},
   {&__pyx_n_s_isdigit, __pyx_k_isdigit, sizeof(__pyx_k_isdigit), 0, 0, 1, 1},
   {&__pyx_n_s_isnan, __pyx_k_isnan, sizeof(__pyx_k_isnan), 0, 0, 1, 1},
   {&__pyx_n_s_itemsize, __pyx_k_itemsize, sizeof(__pyx_k_itemsize), 0, 0, 1, 1},
   {&__pyx_kp_s_itemsize_0_for_cython_array, __pyx_k_itemsize_0_for_cython_array, sizeof(__pyx_k_itemsize_0_for_cython_array), 0, 0, 1, 0},
@@ -38476,25 +40841,28 @@
   {&__pyx_n_u_lcs, __pyx_k_lcs, sizeof(__pyx_k_lcs), 0, 1, 0, 1},
   {&__pyx_n_s_ldict, __pyx_k_ldict, sizeof(__pyx_k_ldict), 0, 0, 1, 1},
   {&__pyx_n_u_ldict, __pyx_k_ldict, sizeof(__pyx_k_ldict), 0, 1, 0, 1},
   {&__pyx_kp_u_let_b, __pyx_k_let_b, sizeof(__pyx_k_let_b), 0, 1, 0, 0},
   {&__pyx_kp_u_let_b_plumedDictionary, __pyx_k_let_b_plumedDictionary, sizeof(__pyx_k_let_b_plumedDictionary), 0, 1, 0, 0},
   {&__pyx_n_s_level, __pyx_k_level, sizeof(__pyx_k_level), 0, 0, 1, 1},
   {&__pyx_n_s_line, __pyx_k_line, sizeof(__pyx_k_line), 0, 0, 1, 1},
+  {&__pyx_n_s_linspace, __pyx_k_linspace, sizeof(__pyx_k_linspace), 0, 0, 1, 1},
   {&__pyx_n_s_load_dict, __pyx_k_load_dict, sizeof(__pyx_k_load_dict), 0, 0, 1, 1},
   {&__pyx_n_s_log, __pyx_k_log, sizeof(__pyx_k_log), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_match, __pyx_k_match, sizeof(__pyx_k_match), 0, 0, 1, 1},
   {&__pyx_n_s_math, __pyx_k_math, sizeof(__pyx_k_math), 0, 0, 1, 1},
+  {&__pyx_n_s_max, __pyx_k_max, sizeof(__pyx_k_max), 0, 0, 1, 1},
   {&__pyx_n_u_mdatoms, __pyx_k_mdatoms, sizeof(__pyx_k_mdatoms), 0, 1, 0, 1},
   {&__pyx_n_s_memview, __pyx_k_memview, sizeof(__pyx_k_memview), 0, 0, 1, 1},
   {&__pyx_n_u_menu, __pyx_k_menu, sizeof(__pyx_k_menu), 0, 1, 0, 1},
   {&__pyx_n_s_metaclass, __pyx_k_metaclass, sizeof(__pyx_k_metaclass), 0, 0, 1, 1},
   {&__pyx_n_u_metadata, __pyx_k_metadata, sizeof(__pyx_k_metadata), 0, 1, 0, 1},
   {&__pyx_n_s_metadata_2, __pyx_k_metadata_2, sizeof(__pyx_k_metadata_2), 0, 0, 1, 1},
+  {&__pyx_n_s_min, __pyx_k_min, sizeof(__pyx_k_min), 0, 0, 1, 1},
   {&__pyx_n_s_minimize_braces, __pyx_k_minimize_braces, sizeof(__pyx_k_minimize_braces), 0, 0, 1, 1},
   {&__pyx_n_s_minimize_braces_2, __pyx_k_minimize_braces_2, sizeof(__pyx_k_minimize_braces_2), 0, 0, 1, 1},
   {&__pyx_n_s_mkstemp, __pyx_k_mkstemp, sizeof(__pyx_k_mkstemp), 0, 0, 1, 1},
   {&__pyx_n_s_mode, __pyx_k_mode, sizeof(__pyx_k_mode), 0, 0, 1, 1},
   {&__pyx_n_s_module, __pyx_k_module, sizeof(__pyx_k_module), 0, 0, 1, 1},
   {&__pyx_n_s_modules, __pyx_k_modules, sizeof(__pyx_k_modules), 0, 0, 1, 1},
   {&__pyx_n_u_mpi4py, __pyx_k_mpi4py, sizeof(__pyx_k_mpi4py), 0, 1, 0, 1},
@@ -38505,16 +40873,15 @@
   {&__pyx_n_s_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
   {&__pyx_n_s_name_3, __pyx_k_name_3, sizeof(__pyx_k_name_3), 0, 0, 1, 1},
   {&__pyx_n_s_name_4, __pyx_k_name_4, sizeof(__pyx_k_name_4), 0, 0, 1, 1},
   {&__pyx_n_s_names, __pyx_k_names, sizeof(__pyx_k_names), 0, 0, 1, 1},
   {&__pyx_n_u_names, __pyx_k_names, sizeof(__pyx_k_names), 0, 1, 0, 1},
   {&__pyx_n_u_nan, __pyx_k_nan, sizeof(__pyx_k_nan), 0, 1, 0, 1},
   {&__pyx_n_s_ndarray, __pyx_k_ndarray, sizeof(__pyx_k_ndarray), 0, 0, 1, 1},
-  {&__pyx_kp_u_ndarrays_should_be_double_size_8, __pyx_k_ndarrays_should_be_double_size_8, sizeof(__pyx_k_ndarrays_should_be_double_size_8), 0, 1, 0, 0},
-  {&__pyx_kp_u_ndarrys_should_be_np_double_np_i, __pyx_k_ndarrys_should_be_np_double_np_i, sizeof(__pyx_k_ndarrys_should_be_np_double_np_i), 0, 1, 0, 0},
+  {&__pyx_kp_u_ndarrays_should_be_type_np_doubl, __pyx_k_ndarrays_should_be_type_np_doubl, sizeof(__pyx_k_ndarrays_should_be_type_np_doubl), 0, 1, 0, 0},
   {&__pyx_n_s_ndim, __pyx_k_ndim, sizeof(__pyx_k_ndim), 0, 0, 1, 1},
   {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
   {&__pyx_n_s_next, __pyx_k_next, sizeof(__pyx_k_next), 0, 0, 1, 1},
   {&__pyx_n_u_no, __pyx_k_no, sizeof(__pyx_k_no), 0, 1, 0, 1},
   {&__pyx_kp_s_no_default___reduce___due_to_non, __pyx_k_no_default___reduce___due_to_non, sizeof(__pyx_k_no_default___reduce___due_to_non), 0, 0, 1, 0},
   {&__pyx_kp_u_no_mpi, __pyx_k_no_mpi, sizeof(__pyx_k_no_mpi), 0, 1, 0, 0},
   {&__pyx_n_u_nonhydrogens, __pyx_k_nonhydrogens, sizeof(__pyx_k_nonhydrogens), 0, 1, 0, 1},
@@ -38526,14 +40893,15 @@
   {&__pyx_n_s_numbered_3, __pyx_k_numbered_3, sizeof(__pyx_k_numbered_3), 0, 0, 1, 1},
   {&__pyx_n_s_numbered___init, __pyx_k_numbered___init, sizeof(__pyx_k_numbered___init), 0, 0, 1, 1},
   {&__pyx_kp_u_numbered_types_should_have_integ, __pyx_k_numbered_types_should_have_integ, sizeof(__pyx_k_numbered_types_should_have_integ), 0, 1, 0, 0},
   {&__pyx_n_s_numbers, __pyx_k_numbers, sizeof(__pyx_k_numbers), 0, 0, 1, 1},
   {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
   {&__pyx_n_s_obj, __pyx_k_obj, sizeof(__pyx_k_obj), 0, 0, 1, 1},
   {&__pyx_n_u_omega, __pyx_k_omega, sizeof(__pyx_k_omega), 0, 1, 0, 1},
+  {&__pyx_n_s_ones, __pyx_k_ones, sizeof(__pyx_k_ones), 0, 0, 1, 1},
   {&__pyx_n_s_open, __pyx_k_open, sizeof(__pyx_k_open), 0, 0, 1, 1},
   {&__pyx_n_s_opt, __pyx_k_opt, sizeof(__pyx_k_opt), 0, 0, 1, 1},
   {&__pyx_kp_u_option, __pyx_k_option, sizeof(__pyx_k_option), 0, 1, 0, 0},
   {&__pyx_kp_u_option_2, __pyx_k_option_2, sizeof(__pyx_k_option_2), 0, 1, 0, 0},
   {&__pyx_kp_u_options_cannot_be_a_dictionary, __pyx_k_options_cannot_be_a_dictionary, sizeof(__pyx_k_options_cannot_be_a_dictionary), 0, 1, 0, 0},
   {&__pyx_kp_u_options_should_be_string_number, __pyx_k_options_should_be_string_number, sizeof(__pyx_k_options_should_be_string_number), 0, 1, 0, 0},
   {&__pyx_n_s_p, __pyx_k_p, sizeof(__pyx_k_p), 0, 0, 1, 1},
@@ -38631,14 +40999,16 @@
   {&__pyx_n_u_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 1, 0, 1},
   {&__pyx_kp_u_self_2, __pyx_k_self_2, sizeof(__pyx_k_self_2), 0, 1, 0, 0},
   {&__pyx_kp_u_self_3, __pyx_k_self_3, sizeof(__pyx_k_self_3), 0, 1, 0, 0},
   {&__pyx_kp_u_self_LABEL_verbatim_None, __pyx_k_self_LABEL_verbatim_None, sizeof(__pyx_k_self_LABEL_verbatim_None), 0, 1, 0, 0},
   {&__pyx_kp_u_self_residue_chain_return__form, __pyx_k_self_residue_chain_return__form, sizeof(__pyx_k_self_residue_chain_return__form), 0, 1, 0, 0},
   {&__pyx_n_s_separator, __pyx_k_separator, sizeof(__pyx_k_separator), 0, 0, 1, 1},
   {&__pyx_n_u_setLogFile, __pyx_k_setLogFile, sizeof(__pyx_k_setLogFile), 0, 1, 0, 1},
+  {&__pyx_n_u_setNestedExceptions, __pyx_k_setNestedExceptions, sizeof(__pyx_k_setNestedExceptions), 0, 1, 0, 1},
+  {&__pyx_n_u_setRealPrecision, __pyx_k_setRealPrecision, sizeof(__pyx_k_setRealPrecision), 0, 1, 0, 1},
   {&__pyx_n_s_sets, __pyx_k_sets, sizeof(__pyx_k_sets), 0, 0, 1, 1},
   {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
   {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_s_shape, __pyx_k_shape, sizeof(__pyx_k_shape), 0, 0, 1, 1},
   {&__pyx_kp_u_should_be_of_bool_type, __pyx_k_should_be_of_bool_type, sizeof(__pyx_k_should_be_of_bool_type), 0, 1, 0, 0},
   {&__pyx_n_s_size, __pyx_k_size, sizeof(__pyx_k_size), 0, 0, 1, 1},
   {&__pyx_n_s_skiprows, __pyx_k_skiprows, sizeof(__pyx_k_skiprows), 0, 0, 1, 1},
@@ -38656,18 +41026,21 @@
   {&__pyx_n_s_sub, __pyx_k_sub, sizeof(__pyx_k_sub), 0, 0, 1, 1},
   {&__pyx_n_s_subn, __pyx_k_subn, sizeof(__pyx_k_subn), 0, 0, 1, 1},
   {&__pyx_n_s_subprocess, __pyx_k_subprocess, sizeof(__pyx_k_subprocess), 0, 0, 1, 1},
   {&__pyx_n_u_sugar, __pyx_k_sugar, sizeof(__pyx_k_sugar), 0, 1, 0, 1},
   {&__pyx_n_s_syntax_file, __pyx_k_syntax_file, sizeof(__pyx_k_syntax_file), 0, 0, 1, 1},
   {&__pyx_n_s_sys, __pyx_k_sys, sizeof(__pyx_k_sys), 0, 0, 1, 1},
   {&__pyx_n_s_t, __pyx_k_t, sizeof(__pyx_k_t), 0, 0, 1, 1},
+  {&__pyx_n_s_t0, __pyx_k_t0, sizeof(__pyx_k_t0), 0, 0, 1, 1},
+  {&__pyx_n_s_t1, __pyx_k_t1, sizeof(__pyx_k_t1), 0, 0, 1, 1},
   {&__pyx_n_s_tell, __pyx_k_tell, sizeof(__pyx_k_tell), 0, 0, 1, 1},
   {&__pyx_n_s_tempfile, __pyx_k_tempfile, sizeof(__pyx_k_tempfile), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {&__pyx_n_s_thisdoc, __pyx_k_thisdoc, sizeof(__pyx_k_thisdoc), 0, 0, 1, 1},
+  {&__pyx_n_s_time, __pyx_k_time, sizeof(__pyx_k_time), 0, 0, 1, 1},
   {&__pyx_n_s_tmp, __pyx_k_tmp, sizeof(__pyx_k_tmp), 0, 0, 1, 1},
   {&__pyx_n_s_tofile, __pyx_k_tofile, sizeof(__pyx_k_tofile), 0, 0, 1, 1},
   {&__pyx_n_s_tofile_2, __pyx_k_tofile_2, sizeof(__pyx_k_tofile_2), 0, 0, 1, 1},
   {&__pyx_n_s_toplumed, __pyx_k_toplumed, sizeof(__pyx_k_toplumed), 0, 0, 1, 1},
   {&__pyx_n_s_toplumed_2, __pyx_k_toplumed_2, sizeof(__pyx_k_toplumed_2), 0, 0, 1, 1},
   {&__pyx_n_s_traceback, __pyx_k_traceback, sizeof(__pyx_k_traceback), 0, 0, 1, 1},
   {&__pyx_kp_u_txt, __pyx_k_txt, sizeof(__pyx_k_txt), 0, 1, 0, 0},
@@ -38677,14 +41050,16 @@
   {&__pyx_n_u_types, __pyx_k_types, sizeof(__pyx_k_types), 0, 1, 0, 1},
   {&__pyx_kp_u_types_MethodType_ldict, __pyx_k_types_MethodType_ldict, sizeof(__pyx_k_types_MethodType_ldict), 0, 1, 0, 0},
   {&__pyx_kp_s_unable_to_allocate_array_data, __pyx_k_unable_to_allocate_array_data, sizeof(__pyx_k_unable_to_allocate_array_data), 0, 0, 1, 0},
   {&__pyx_kp_s_unable_to_allocate_shape_and_str, __pyx_k_unable_to_allocate_shape_and_str, sizeof(__pyx_k_unable_to_allocate_shape_and_str), 0, 0, 1, 0},
   {&__pyx_kp_u_unknown_method, __pyx_k_unknown_method, sizeof(__pyx_k_unknown_method), 0, 1, 0, 0},
   {&__pyx_n_s_unpack, __pyx_k_unpack, sizeof(__pyx_k_unpack), 0, 0, 1, 1},
   {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
+  {&__pyx_n_s_use_index, __pyx_k_use_index, sizeof(__pyx_k_use_index), 0, 0, 1, 1},
+  {&__pyx_n_s_use_time, __pyx_k_use_time, sizeof(__pyx_k_use_time), 0, 0, 1, 1},
   {&__pyx_n_s_usecols, __pyx_k_usecols, sizeof(__pyx_k_usecols), 0, 0, 1, 1},
   {&__pyx_kp_u_utf_8, __pyx_k_utf_8, sizeof(__pyx_k_utf_8), 0, 1, 0, 0},
   {&__pyx_n_s_v, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
   {&__pyx_n_u_v0, __pyx_k_v0, sizeof(__pyx_k_v0), 0, 1, 0, 1},
   {&__pyx_n_u_v1, __pyx_k_v1, sizeof(__pyx_k_v1), 0, 1, 0, 1},
   {&__pyx_n_u_v2, __pyx_k_v2, sizeof(__pyx_k_v2), 0, 1, 0, 1},
   {&__pyx_n_u_v3, __pyx_k_v3, sizeof(__pyx_k_v3), 0, 1, 0, 1},
@@ -38705,1154 +41080,1231 @@
   {&__pyx_kp_u_when_calling_numbered_with_1_arg, __pyx_k_when_calling_numbered_with_1_arg, sizeof(__pyx_k_when_calling_numbered_with_1_arg), 0, 1, 0, 0},
   {&__pyx_kp_u_when_calling_replicas_with_1_arg, __pyx_k_when_calling_replicas_with_1_arg, sizeof(__pyx_k_when_calling_replicas_with_1_arg), 0, 1, 0, 0},
   {&__pyx_n_u_word, __pyx_k_word, sizeof(__pyx_k_word), 0, 1, 0, 1},
   {&__pyx_n_s_write, __pyx_k_write, sizeof(__pyx_k_write), 0, 0, 1, 1},
   {&__pyx_n_s_write_pandas, __pyx_k_write_pandas, sizeof(__pyx_k_write_pandas), 0, 0, 1, 1},
   {&__pyx_n_u_wt, __pyx_k_wt, sizeof(__pyx_k_wt), 0, 1, 0, 1},
   {&__pyx_n_s_x, __pyx_k_x, sizeof(__pyx_k_x), 0, 0, 1, 1},
+  {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
   {&__pyx_n_u_zeta, __pyx_k_zeta, sizeof(__pyx_k_zeta), 0, 1, 0, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
   __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(0, 42, __pyx_L1_error)
-  __pyx_builtin_RuntimeError = __Pyx_GetBuiltinName(__pyx_n_s_RuntimeError); if (!__pyx_builtin_RuntimeError) __PYX_ERR(0, 58, __pyx_L1_error)
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 94, __pyx_L1_error)
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 155, __pyx_L1_error)
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 2, __pyx_L1_error)
-  __pyx_builtin_open = __Pyx_GetBuiltinName(__pyx_n_s_open); if (!__pyx_builtin_open) __PYX_ERR(0, 192, __pyx_L1_error)
-  __pyx_builtin_property = __Pyx_GetBuiltinName(__pyx_n_s_property); if (!__pyx_builtin_property) __PYX_ERR(0, 353, __pyx_L1_error)
-  __pyx_builtin_print = __Pyx_GetBuiltinName(__pyx_n_s_print); if (!__pyx_builtin_print) __PYX_ERR(0, 972, __pyx_L1_error)
-  __pyx_builtin_AttributeError = __Pyx_GetBuiltinName(__pyx_n_s_AttributeError); if (!__pyx_builtin_AttributeError) __PYX_ERR(0, 1014, __pyx_L1_error)
-  __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 149, __pyx_L1_error)
+  __pyx_builtin_RuntimeError = __Pyx_GetBuiltinName(__pyx_n_s_RuntimeError); if (!__pyx_builtin_RuntimeError) __PYX_ERR(0, 62, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 135, __pyx_L1_error)
+  __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(0, 137, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 143, __pyx_L1_error)
+  __pyx_builtin_IOError = __Pyx_GetBuiltinName(__pyx_n_s_IOError); if (!__pyx_builtin_IOError) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_builtin_OverflowError = __Pyx_GetBuiltinName(__pyx_n_s_OverflowError); if (!__pyx_builtin_OverflowError) __PYX_ERR(0, 153, __pyx_L1_error)
+  __pyx_builtin_ArithmeticError = __Pyx_GetBuiltinName(__pyx_n_s_ArithmeticError); if (!__pyx_builtin_ArithmeticError) __PYX_ERR(0, 155, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 186, __pyx_L1_error)
+  __pyx_builtin_open = __Pyx_GetBuiltinName(__pyx_n_s_open); if (!__pyx_builtin_open) __PYX_ERR(0, 285, __pyx_L1_error)
+  __pyx_builtin_property = __Pyx_GetBuiltinName(__pyx_n_s_property); if (!__pyx_builtin_property) __PYX_ERR(0, 446, __pyx_L1_error)
+  __pyx_builtin_print = __Pyx_GetBuiltinName(__pyx_n_s_print); if (!__pyx_builtin_print) __PYX_ERR(0, 1154, __pyx_L1_error)
+  __pyx_builtin_AttributeError = __Pyx_GetBuiltinName(__pyx_n_s_AttributeError); if (!__pyx_builtin_AttributeError) __PYX_ERR(0, 1196, __pyx_L1_error)
   __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(1, 152, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(1, 406, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(1, 615, __pyx_L1_error)
-  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(1, 834, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "plumed.pyx":58
- *             self.c_plumed=cplumed.Plumed.makeValid()
- *             if not self.c_plumed.valid():
+  /* "plumed.pyx":87
+ *             self.c_plumed=cplumed.plumed_create()
+ *             if not cplumed.plumed_valid(self.c_plumed):
  *                  raise RuntimeError("PLUMED not available, check your PLUMED_KERNEL environment variable")             # <<<<<<<<<<<<<<
  *          else:
  *             py_kernel= kernel.encode()
  */
-  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_PLUMED_not_available_check_your); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 58, __pyx_L1_error)
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_PLUMED_not_available_check_your); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 87, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "plumed.pyx":155
+  /* "plumed.pyx":98
+ *          self.cmd( "getApiVersion", api)
+ *          if(api[0]>=10):
+ *            self.cmd("setNestedExceptions",1)             # <<<<<<<<<<<<<<
+ *          self.cmd( "setRealPrecision", 8)
+ *      def finalize(self):
+ */
+  __pyx_tuple__2 = PyTuple_Pack(2, __pyx_n_u_setNestedExceptions, __pyx_int_1); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 98, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__2);
+  __Pyx_GIVEREF(__pyx_tuple__2);
+
+  /* "plumed.pyx":99
+ *          if(api[0]>=10):
+ *            self.cmd("setNestedExceptions",1)
+ *          self.cmd( "setRealPrecision", 8)             # <<<<<<<<<<<<<<
+ *      def finalize(self):
+ *          """ Explicitly finalize a Plumed object.
+ */
+  __pyx_tuple__3 = PyTuple_Pack(2, __pyx_n_u_setRealPrecision, __pyx_int_8); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__3);
+  __Pyx_GIVEREF(__pyx_tuple__3);
+
+  /* "plumed.pyx":247
  *                self.cmd_ndarray_long(ckey, val)
  *             else :
- *                raise ValueError("ndarrys should be np.double, np.intc, or np.int_")             # <<<<<<<<<<<<<<
+ *                raise ValueError("ndarrays should be type np.double, np.intc, or np.int_")             # <<<<<<<<<<<<<<
  *             return
  *          if isinstance(val, array.array) :
  */
-  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_u_ndarrys_should_be_np_double_np_i); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 155, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__3);
-  __Pyx_GIVEREF(__pyx_tuple__3);
+  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_u_ndarrays_should_be_type_np_doubl); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 247, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__5);
+  __Pyx_GIVEREF(__pyx_tuple__5);
 
-  /* "plumed.pyx":165
+  /* "plumed.pyx":257
  *                self.cmd_array_long(ckey, val)
  *             else :
- *                raise ValueError("ndarrays should be double (size=8), int, or long")             # <<<<<<<<<<<<<<
+ *                raise ValueError("arrays should be type double (size=8), int, or long")             # <<<<<<<<<<<<<<
  *             return
  *          if isinstance(val, str ) :
  */
-  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_u_ndarrays_should_be_double_size_8); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 165, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__4);
-  __Pyx_GIVEREF(__pyx_tuple__4);
+  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_arrays_should_be_type_double_siz); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__6);
+  __Pyx_GIVEREF(__pyx_tuple__6);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__5);
-  __Pyx_GIVEREF(__pyx_tuple__5);
+  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__7);
+  __Pyx_GIVEREF(__pyx_tuple__7);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__6);
-  __Pyx_GIVEREF(__pyx_tuple__6);
+  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__8);
+  __Pyx_GIVEREF(__pyx_tuple__8);
 
-  /* "plumed.pyx":221
+  /* "plumed.pyx":314
  *     try:
  * # define a function to convert data
  *         def convert_func(a):             # <<<<<<<<<<<<<<
  *             r=array.array('d',[float('nan')])
  *             convert_func.kernel.cmd("convert "+str(a),r)
  */
-  __pyx_tuple__7 = PyTuple_Pack(2, __pyx_n_s_a, __pyx_n_s_r); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 221, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__7);
-  __Pyx_GIVEREF(__pyx_tuple__7);
-  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__7, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_convert_func, 221, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 221, __pyx_L1_error)
+  __pyx_tuple__9 = PyTuple_Pack(2, __pyx_n_s_a, __pyx_n_s_r); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 314, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__9);
+  __Pyx_GIVEREF(__pyx_tuple__9);
+  __pyx_codeobj__10 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__9, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_convert_func, 314, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 314, __pyx_L1_error)
 
-  /* "plumed.pyx":258
+  /* "plumed.pyx":351
  *                pass
  *            else:
  *                raise ValueError("plumed.Constants should be initialized with a list of 2- or 3-plets")             # <<<<<<<<<<<<<<
  * 
  * def read_as_pandas(file_or_path,enable_constants=True,enable_conversion=True,kernel=None,chunksize=None,usecols=None,skiprows=None,nrows=None,index_col=None):
  */
-  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_plumed_Constants_should_be_initi); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 258, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__9);
-  __Pyx_GIVEREF(__pyx_tuple__9);
+  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_u_plumed_Constants_should_be_initi); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 351, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__11);
+  __Pyx_GIVEREF(__pyx_tuple__11);
 
-  /* "plumed.pyx":354
+  /* "plumed.pyx":447
  *     class PlumedSeries(pd.Series):
  *         @property
  *         def _constructor(self):             # <<<<<<<<<<<<<<
  *             return PlumedSeries
  *         @property
  */
-  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 354, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__10);
-  __Pyx_GIVEREF(__pyx_tuple__10);
-  __pyx_codeobj__11 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__10, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_constructor, 354, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 447, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__12);
+  __Pyx_GIVEREF(__pyx_tuple__12);
+  __pyx_codeobj__13 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__12, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_constructor, 447, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__13)) __PYX_ERR(0, 447, __pyx_L1_error)
 
-  /* "plumed.pyx":357
+  /* "plumed.pyx":450
  *             return PlumedSeries
  *         @property
  *         def _constructor_expanddim(self):             # <<<<<<<<<<<<<<
  *             return PlumedDataFrame
  * 
  */
-  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 357, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__12);
-  __Pyx_GIVEREF(__pyx_tuple__12);
-  __pyx_codeobj__13 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__12, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_constructor_expanddim, 357, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__13)) __PYX_ERR(0, 357, __pyx_L1_error)
+  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 450, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__14);
+  __Pyx_GIVEREF(__pyx_tuple__14);
+  __pyx_codeobj__15 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_constructor_expanddim, 450, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 450, __pyx_L1_error)
 
-  /* "plumed.pyx":363
+  /* "plumed.pyx":456
  *         _metadata=["plumed_constants"]
  *         @property
  *         def _constructor(self):             # <<<<<<<<<<<<<<
  *             return PlumedDataFrame
  *         @property
  */
-  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 363, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__14);
-  __Pyx_GIVEREF(__pyx_tuple__14);
-  __pyx_codeobj__15 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_constructor, 363, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 363, __pyx_L1_error)
+  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 456, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__16);
+  __Pyx_GIVEREF(__pyx_tuple__16);
+  __pyx_codeobj__17 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_constructor, 456, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__17)) __PYX_ERR(0, 456, __pyx_L1_error)
 
-  /* "plumed.pyx":366
+  /* "plumed.pyx":459
  *             return PlumedDataFrame
  *         @property
  *         def _constructor_sliced(self):             # <<<<<<<<<<<<<<
  *             return PlumedSeries
  * 
  */
-  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 366, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__16);
-  __Pyx_GIVEREF(__pyx_tuple__16);
-  __pyx_codeobj__17 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_constructor_sliced, 366, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__17)) __PYX_ERR(0, 366, __pyx_L1_error)
+  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 459, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__18);
+  __Pyx_GIVEREF(__pyx_tuple__18);
+  __pyx_codeobj__19 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_constructor_sliced, 459, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__19)) __PYX_ERR(0, 459, __pyx_L1_error)
 
-  /* "plumed.pyx":371
+  /* "plumed.pyx":464
  * # auxiliary function to process a dataframe
  * # it is defined here since it requires PlumedDataFrame to be defined
  *     def process_dataframe(df,enable_constants,constants,convert_all):             # <<<<<<<<<<<<<<
  *         if convert_all: df=df.applymap(convert_all)
  *         if enable_constants=='columns':
  */
-  __pyx_tuple__18 = PyTuple_Pack(5, __pyx_n_s_df, __pyx_n_s_enable_constants, __pyx_n_s_constants, __pyx_n_s_convert_all, __pyx_n_s_c); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 371, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__18);
-  __Pyx_GIVEREF(__pyx_tuple__18);
-  __pyx_codeobj__19 = (PyObject*)__Pyx_PyCode_New(4, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_process_dataframe, 371, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__19)) __PYX_ERR(0, 371, __pyx_L1_error)
+  __pyx_tuple__20 = PyTuple_Pack(5, __pyx_n_s_df, __pyx_n_s_enable_constants, __pyx_n_s_constants, __pyx_n_s_convert_all, __pyx_n_s_c); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 464, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__20);
+  __Pyx_GIVEREF(__pyx_tuple__20);
+  __pyx_codeobj__21 = (PyObject*)__Pyx_PyCode_New(4, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__20, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_process_dataframe, 464, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__21)) __PYX_ERR(0, 464, __pyx_L1_error)
 
-  /* "plumed.pyx":392
+  /* "plumed.pyx":485
  * # check arguments:
  *     if not (enable_conversion=='no' or enable_conversion=='constants' or enable_conversion=='all'):
  *         raise ValueError("enable_conversion not valid")             # <<<<<<<<<<<<<<
  *     if not (enable_constants=='no' or enable_constants=='metadata' or enable_constants=='columns'):
  *         raise ValueError("enable_conversion not valid")
  */
-  __pyx_tuple__20 = PyTuple_Pack(1, __pyx_kp_u_enable_conversion_not_valid); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 392, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__20);
-  __Pyx_GIVEREF(__pyx_tuple__20);
+  __pyx_tuple__22 = PyTuple_Pack(1, __pyx_kp_u_enable_conversion_not_valid); if (unlikely(!__pyx_tuple__22)) __PYX_ERR(0, 485, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__22);
+  __Pyx_GIVEREF(__pyx_tuple__22);
 
-  /* "plumed.pyx":419
+  /* "plumed.pyx":512
  * 
  * # read column names
  *     columns = columns[2:]             # <<<<<<<<<<<<<<
  * 
  * # read constants
  */
-  __pyx_slice__23 = PySlice_New(__pyx_int_2, Py_None, Py_None); if (unlikely(!__pyx_slice__23)) __PYX_ERR(0, 419, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_slice__23);
-  __Pyx_GIVEREF(__pyx_slice__23);
+  __pyx_slice__25 = PySlice_New(__pyx_int_2, Py_None, Py_None); if (unlikely(!__pyx_slice__25)) __PYX_ERR(0, 512, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_slice__25);
+  __Pyx_GIVEREF(__pyx_slice__25);
 
-  /* "plumed.pyx":457
+  /* "plumed.pyx":550
  * # some information (constant values and conversion function)
  * # should be stored in the class to be used while iterating on it
  *             def __init__(self,reader,enable_constants,constants,convert_all):             # <<<<<<<<<<<<<<
  *                 self.TextFileReader=reader
  *                 self.enable_constants=enable_constants
  */
-  __pyx_tuple__25 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_reader, __pyx_n_s_enable_constants, __pyx_n_s_constants, __pyx_n_s_convert_all); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(0, 457, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__25);
-  __Pyx_GIVEREF(__pyx_tuple__25);
-  __pyx_codeobj__26 = (PyObject*)__Pyx_PyCode_New(5, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__25, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 457, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__26)) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_tuple__27 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_reader, __pyx_n_s_enable_constants, __pyx_n_s_constants, __pyx_n_s_convert_all); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 550, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__27);
+  __Pyx_GIVEREF(__pyx_tuple__27);
+  __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(5, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 550, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 550, __pyx_L1_error)
 
-  /* "plumed.pyx":462
+  /* "plumed.pyx":555
  *                 self.constants=constants
  *                 self.convert_all=convert_all
  *             def __next__(self):             # <<<<<<<<<<<<<<
  * # override __next__
  *                 df=self.TextFileReader.__next__()
  */
-  __pyx_tuple__27 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_df); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 462, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__27);
-  __Pyx_GIVEREF(__pyx_tuple__27);
-  __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_next, 462, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 462, __pyx_L1_error)
+  __pyx_tuple__29 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_df); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 555, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__29);
+  __Pyx_GIVEREF(__pyx_tuple__29);
+  __pyx_codeobj__30 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_next, 555, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 555, __pyx_L1_error)
 
-  /* "plumed.pyx":495
+  /* "plumed.pyx":588
  * # writing multiindex is currently not supported
  *     if has_mindex:
  *         raise TypeError("Writing dataframes with MultiIndexes is not supported at this time")             # <<<<<<<<<<<<<<
  * # handle file
  *     if file_or_path is None:
  */
-  __pyx_tuple__29 = PyTuple_Pack(1, __pyx_kp_u_Writing_dataframes_with_MultiInd); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 495, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__29);
-  __Pyx_GIVEREF(__pyx_tuple__29);
+  __pyx_tuple__31 = PyTuple_Pack(1, __pyx_kp_u_Writing_dataframes_with_MultiInd); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 588, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__31);
+  __Pyx_GIVEREF(__pyx_tuple__31);
 
-  /* "plumed.pyx":531
+  /* "plumed.pyx":676
+ * 
+ *     if use_time and use_index:
+ *         raise ValueError("cannot use simultaneously time and fraction")             # <<<<<<<<<<<<<<
+ * 
+ *     if not use_index and not use_time:
+ */
+  __pyx_tuple__33 = PyTuple_Pack(1, __pyx_kp_u_cannot_use_simultaneously_time_a); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 676, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__33);
+  __Pyx_GIVEREF(__pyx_tuple__33);
+
+  /* "plumed.pyx":713
  *         import tempfile
  *         log=tempfile.mkstemp()[1]
  *         with Plumed(kernel) as p:             # <<<<<<<<<<<<<<
  *             p.cmd("setLogFile",log)
  *             p.cmd("init")
  */
-  __pyx_tuple__31 = PyTuple_Pack(3, Py_None, Py_None, Py_None); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 531, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__31);
-  __Pyx_GIVEREF(__pyx_tuple__31);
+  __pyx_tuple__34 = PyTuple_Pack(3, Py_None, Py_None, Py_None); if (unlikely(!__pyx_tuple__34)) __PYX_ERR(0, 713, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__34);
+  __Pyx_GIVEREF(__pyx_tuple__34);
 
-  /* "plumed.pyx":591
+  /* "plumed.pyx":773
  *             doc[action]=thisdoc
  * # remove LaTex stuff
  *             doc[action]=doc[action].replace("\\f$","").replace("\\","")             # <<<<<<<<<<<<<<
  * # read dictionary
  *         for opt in plumedDictionary[action]:
  */
-  __pyx_tuple__35 = PyTuple_Pack(2, __pyx_kp_u_f_2, __pyx_kp_u__32); if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 591, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__35);
-  __Pyx_GIVEREF(__pyx_tuple__35);
-  __pyx_tuple__37 = PyTuple_Pack(2, __pyx_kp_u__36, __pyx_kp_u__32); if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 591, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__37);
-  __Pyx_GIVEREF(__pyx_tuple__37);
+  __pyx_tuple__38 = PyTuple_Pack(2, __pyx_kp_u_f_2, __pyx_kp_u__35); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 773, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__38);
+  __Pyx_GIVEREF(__pyx_tuple__38);
+  __pyx_tuple__40 = PyTuple_Pack(2, __pyx_kp_u__39, __pyx_kp_u__35); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 773, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__40);
+  __Pyx_GIVEREF(__pyx_tuple__40);
 
-  /* "plumed.pyx":688
+  /* "plumed.pyx":870
  *                      i+=1
  *             else:
  *                 raise TypeError("when calling numbered with 1 argument, it should be a list/tuple/dictionary")             # <<<<<<<<<<<<<<
  *         else:
  *             self.arg={}
  */
-  __pyx_tuple__48 = PyTuple_Pack(1, __pyx_kp_u_when_calling_numbered_with_1_arg); if (unlikely(!__pyx_tuple__48)) __PYX_ERR(0, 688, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__48);
-  __Pyx_GIVEREF(__pyx_tuple__48);
+  __pyx_tuple__51 = PyTuple_Pack(1, __pyx_kp_u_when_calling_numbered_with_1_arg); if (unlikely(!__pyx_tuple__51)) __PYX_ERR(0, 870, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__51);
+  __Pyx_GIVEREF(__pyx_tuple__51);
 
-  /* "plumed.pyx":705
+  /* "plumed.pyx":887
  *             self.arg=args[0]
  *           else:
  *             raise TypeError("when calling replicas with 1 argument, it should be a list/tuple")             # <<<<<<<<<<<<<<
  *         else:
  *           self.arg=args
  */
-  __pyx_tuple__49 = PyTuple_Pack(1, __pyx_kp_u_when_calling_replicas_with_1_arg); if (unlikely(!__pyx_tuple__49)) __PYX_ERR(0, 705, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__49);
-  __Pyx_GIVEREF(__pyx_tuple__49);
+  __pyx_tuple__52 = PyTuple_Pack(1, __pyx_kp_u_when_calling_replicas_with_1_arg); if (unlikely(!__pyx_tuple__52)) __PYX_ERR(0, 887, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__52);
+  __Pyx_GIVEREF(__pyx_tuple__52);
 
-  /* "plumed.pyx":801
+  /* "plumed.pyx":983
  *         return str(arg)
  *     if isinstance(arg,dict):
  *         raise TypeError("options cannot be a dictionary")             # <<<<<<<<<<<<<<
  *     if isinstance(arg,_replicas):
  *         if level>1:
  */
-  __pyx_tuple__62 = PyTuple_Pack(1, __pyx_kp_u_options_cannot_be_a_dictionary); if (unlikely(!__pyx_tuple__62)) __PYX_ERR(0, 801, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__62);
-  __Pyx_GIVEREF(__pyx_tuple__62);
+  __pyx_tuple__65 = PyTuple_Pack(1, __pyx_kp_u_options_cannot_be_a_dictionary); if (unlikely(!__pyx_tuple__65)) __PYX_ERR(0, 983, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__65);
+  __Pyx_GIVEREF(__pyx_tuple__65);
 
-  /* "plumed.pyx":804
+  /* "plumed.pyx":986
  *     if isinstance(arg,_replicas):
  *         if level>1:
  *             raise TypeError("@replica syntax only allowed for scalar or rank 1 vectors")             # <<<<<<<<<<<<<<
  *         return "@replicas:" + _fix_braces(builder,_format_single(builder,arg.arg,level+1),comma=True)
  *     if hasattr(arg,'__iter__'):
  */
-  __pyx_tuple__63 = PyTuple_Pack(1, __pyx_kp_u_replica_syntax_only_allowed_for); if (unlikely(!__pyx_tuple__63)) __PYX_ERR(0, 804, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__63);
-  __Pyx_GIVEREF(__pyx_tuple__63);
+  __pyx_tuple__66 = PyTuple_Pack(1, __pyx_kp_u_replica_syntax_only_allowed_for); if (unlikely(!__pyx_tuple__66)) __PYX_ERR(0, 986, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__66);
+  __Pyx_GIVEREF(__pyx_tuple__66);
 
-  /* "plumed.pyx":811
+  /* "plumed.pyx":993
  *             string+=builder._separator + _fix_braces(builder,_format_single(builder,x,level+1),comma=True)
  *         return string[len(builder._separator):]
  *     raise TypeError("options should be string, number or iterable")             # <<<<<<<<<<<<<<
  * 
  * def _format_numbered(builder,name,arg):
  */
-  __pyx_tuple__64 = PyTuple_Pack(1, __pyx_kp_u_options_should_be_string_number); if (unlikely(!__pyx_tuple__64)) __PYX_ERR(0, 811, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__64);
-  __Pyx_GIVEREF(__pyx_tuple__64);
+  __pyx_tuple__67 = PyTuple_Pack(1, __pyx_kp_u_options_should_be_string_number); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 993, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__67);
+  __Pyx_GIVEREF(__pyx_tuple__67);
 
-  /* "plumed.pyx":820
+  /* "plumed.pyx":1002
  *         for x in arg:
  *             if not isinstance(x,int):
  *                 raise TypeError("numbered types should have integer keys")             # <<<<<<<<<<<<<<
  *             ret+=_format_opt(builder,name+str(x),arg[x])
  *         return ret
  */
-  __pyx_tuple__65 = PyTuple_Pack(1, __pyx_kp_u_numbered_types_should_have_integ); if (unlikely(!__pyx_tuple__65)) __PYX_ERR(0, 820, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__65);
-  __Pyx_GIVEREF(__pyx_tuple__65);
+  __pyx_tuple__68 = PyTuple_Pack(1, __pyx_kp_u_numbered_types_should_have_integ); if (unlikely(!__pyx_tuple__68)) __PYX_ERR(0, 1002, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__68);
+  __Pyx_GIVEREF(__pyx_tuple__68);
 
-  /* "plumed.pyx":844
+  /* "plumed.pyx":1026
  *             return ""
  *         return label+": "
  *     raise TypeError("label should be of str type")             # <<<<<<<<<<<<<<
  * 
  * def _format_opt(builder,name,arg):
  */
-  __pyx_tuple__67 = PyTuple_Pack(1, __pyx_kp_u_label_should_be_of_str_type); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 844, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__67);
-  __Pyx_GIVEREF(__pyx_tuple__67);
+  __pyx_tuple__70 = PyTuple_Pack(1, __pyx_kp_u_label_should_be_of_str_type); if (unlikely(!__pyx_tuple__70)) __PYX_ERR(0, 1026, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__70);
+  __Pyx_GIVEREF(__pyx_tuple__70);
 
-  /* "plumed.pyx":999
+  /* "plumed.pyx":1181
  *        if self._has_dict:
  *            class _callme:
  *                def __init__(self,builder,name):             # <<<<<<<<<<<<<<
  *                    self._builder=builder
  *                    self._name=name
  */
-  __pyx_tuple__69 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_builder, __pyx_n_s_name); if (unlikely(!__pyx_tuple__69)) __PYX_ERR(0, 999, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__69);
-  __Pyx_GIVEREF(__pyx_tuple__69);
-  __pyx_codeobj__70 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__69, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 999, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__70)) __PYX_ERR(0, 999, __pyx_L1_error)
+  __pyx_tuple__72 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_builder, __pyx_n_s_name); if (unlikely(!__pyx_tuple__72)) __PYX_ERR(0, 1181, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__72);
+  __Pyx_GIVEREF(__pyx_tuple__72);
+  __pyx_codeobj__73 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__72, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 1181, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__73)) __PYX_ERR(0, 1181, __pyx_L1_error)
 
-  /* "plumed.pyx":1003
+  /* "plumed.pyx":1185
  *                    self._name=name
  *                    self.__doc__=getattr(self._builder,name).__doc__
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *                    func=getattr(self._builder,self._name)
  *                    return func(LABEL,verbatim,**kwargs)
  */
-  __pyx_tuple__71 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_LABEL, __pyx_n_s_verbatim, __pyx_n_s_kwargs_2, __pyx_n_s_func); if (unlikely(!__pyx_tuple__71)) __PYX_ERR(0, 1003, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__71);
-  __Pyx_GIVEREF(__pyx_tuple__71);
-  __pyx_codeobj__72 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__71, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_call, 1003, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__72)) __PYX_ERR(0, 1003, __pyx_L1_error)
-  __pyx_tuple__73 = PyTuple_Pack(2, ((PyObject*)__pyx_kp_u__32), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__73)) __PYX_ERR(0, 1003, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__73);
-  __Pyx_GIVEREF(__pyx_tuple__73);
+  __pyx_tuple__74 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_LABEL, __pyx_n_s_verbatim, __pyx_n_s_kwargs_2, __pyx_n_s_func); if (unlikely(!__pyx_tuple__74)) __PYX_ERR(0, 1185, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__74);
+  __Pyx_GIVEREF(__pyx_tuple__74);
+  __pyx_codeobj__75 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__74, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_call, 1185, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__75)) __PYX_ERR(0, 1185, __pyx_L1_error)
+  __pyx_tuple__76 = PyTuple_Pack(2, ((PyObject*)__pyx_kp_u__35), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__76)) __PYX_ERR(0, 1185, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__76);
+  __Pyx_GIVEREF(__pyx_tuple__76);
 
-  /* "plumed.pyx":1017
+  /* "plumed.pyx":1199
  *        else:
  *            class _callme:
  *                def __init__(self,builder,name):             # <<<<<<<<<<<<<<
  *                    self._builder=builder
  *                    self._name=name
  */
-  __pyx_tuple__76 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_builder, __pyx_n_s_name); if (unlikely(!__pyx_tuple__76)) __PYX_ERR(0, 1017, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__76);
-  __Pyx_GIVEREF(__pyx_tuple__76);
-  __pyx_codeobj__77 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__76, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 1017, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__77)) __PYX_ERR(0, 1017, __pyx_L1_error)
+  __pyx_tuple__79 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_builder, __pyx_n_s_name); if (unlikely(!__pyx_tuple__79)) __PYX_ERR(0, 1199, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__79);
+  __Pyx_GIVEREF(__pyx_tuple__79);
+  __pyx_codeobj__80 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__79, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 1199, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__80)) __PYX_ERR(0, 1199, __pyx_L1_error)
 
-  /* "plumed.pyx":1021
+  /* "plumed.pyx":1203
  *                    self._name=name
  *                    self.__doc__="dynamic method printing " + name
  *                def __call__(self,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)
  *            if re.match(".*[^_]__$",name):
  */
-  __pyx_tuple__78 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_LABEL, __pyx_n_s_verbatim, __pyx_n_s_kwargs_2); if (unlikely(!__pyx_tuple__78)) __PYX_ERR(0, 1021, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__78);
-  __Pyx_GIVEREF(__pyx_tuple__78);
-  __pyx_codeobj__79 = (PyObject*)__Pyx_PyCode_New(3, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__78, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_call, 1021, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__79)) __PYX_ERR(0, 1021, __pyx_L1_error)
-  __pyx_tuple__80 = PyTuple_Pack(2, ((PyObject*)__pyx_kp_u__32), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__80)) __PYX_ERR(0, 1021, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__80);
-  __Pyx_GIVEREF(__pyx_tuple__80);
+  __pyx_tuple__81 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_LABEL, __pyx_n_s_verbatim, __pyx_n_s_kwargs_2); if (unlikely(!__pyx_tuple__81)) __PYX_ERR(0, 1203, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__81);
+  __Pyx_GIVEREF(__pyx_tuple__81);
+  __pyx_codeobj__82 = (PyObject*)__Pyx_PyCode_New(3, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__81, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_call, 1203, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__82)) __PYX_ERR(0, 1203, __pyx_L1_error)
+  __pyx_tuple__83 = PyTuple_Pack(2, ((PyObject*)__pyx_kp_u__35), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__83)) __PYX_ERR(0, 1203, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__83);
+  __Pyx_GIVEREF(__pyx_tuple__83);
 
-  /* "plumed.pyx":1024
+  /* "plumed.pyx":1206
  *                    return self._builder(self._name,LABEL,verbatim,**kwargs)
  *            if re.match(".*[^_]__$",name):
  *                name=name[:-2]             # <<<<<<<<<<<<<<
  *            return _callme(self,name)
  * 
  */
-  __pyx_slice__82 = PySlice_New(Py_None, __pyx_int_neg_2, Py_None); if (unlikely(!__pyx_slice__82)) __PYX_ERR(0, 1024, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_slice__82);
-  __Pyx_GIVEREF(__pyx_slice__82);
+  __pyx_slice__85 = PySlice_New(Py_None, __pyx_int_neg_2, Py_None); if (unlikely(!__pyx_slice__85)) __PYX_ERR(0, 1206, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_slice__85);
+  __Pyx_GIVEREF(__pyx_slice__85);
 
   /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if itemsize <= 0:
  */
-  __pyx_tuple__83 = PyTuple_Pack(1, __pyx_kp_s_Empty_shape_tuple_for_cython_arr); if (unlikely(!__pyx_tuple__83)) __PYX_ERR(1, 134, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__83);
-  __Pyx_GIVEREF(__pyx_tuple__83);
+  __pyx_tuple__86 = PyTuple_Pack(1, __pyx_kp_s_Empty_shape_tuple_for_cython_arr); if (unlikely(!__pyx_tuple__86)) __PYX_ERR(1, 134, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__86);
+  __Pyx_GIVEREF(__pyx_tuple__86);
 
   /* "View.MemoryView":137
  * 
  *         if itemsize <= 0:
  *             raise ValueError("itemsize <= 0 for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if not isinstance(format, bytes):
  */
-  __pyx_tuple__84 = PyTuple_Pack(1, __pyx_kp_s_itemsize_0_for_cython_array); if (unlikely(!__pyx_tuple__84)) __PYX_ERR(1, 137, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__84);
-  __Pyx_GIVEREF(__pyx_tuple__84);
+  __pyx_tuple__87 = PyTuple_Pack(1, __pyx_kp_s_itemsize_0_for_cython_array); if (unlikely(!__pyx_tuple__87)) __PYX_ERR(1, 137, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__87);
+  __Pyx_GIVEREF(__pyx_tuple__87);
 
   /* "View.MemoryView":149
  * 
  *         if not self._shape:
  *             raise MemoryError("unable to allocate shape and strides.")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__85 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_shape_and_str); if (unlikely(!__pyx_tuple__85)) __PYX_ERR(1, 149, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__85);
-  __Pyx_GIVEREF(__pyx_tuple__85);
+  __pyx_tuple__88 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_shape_and_str); if (unlikely(!__pyx_tuple__88)) __PYX_ERR(1, 149, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__88);
+  __Pyx_GIVEREF(__pyx_tuple__88);
 
   /* "View.MemoryView":177
  *             self.data = <char *>malloc(self.len)
  *             if not self.data:
  *                 raise MemoryError("unable to allocate array data.")             # <<<<<<<<<<<<<<
  * 
  *             if self.dtype_is_object:
  */
-  __pyx_tuple__86 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_array_data); if (unlikely(!__pyx_tuple__86)) __PYX_ERR(1, 177, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__86);
-  __Pyx_GIVEREF(__pyx_tuple__86);
+  __pyx_tuple__89 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_array_data); if (unlikely(!__pyx_tuple__89)) __PYX_ERR(1, 177, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__89);
+  __Pyx_GIVEREF(__pyx_tuple__89);
 
   /* "View.MemoryView":193
  *             bufmode = PyBUF_F_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         if not (flags & bufmode):
  *             raise ValueError("Can only create a buffer that is contiguous in memory.")             # <<<<<<<<<<<<<<
  *         info.buf = self.data
  *         info.len = self.len
  */
-  __pyx_tuple__87 = PyTuple_Pack(1, __pyx_kp_s_Can_only_create_a_buffer_that_is); if (unlikely(!__pyx_tuple__87)) __PYX_ERR(1, 193, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__87);
-  __Pyx_GIVEREF(__pyx_tuple__87);
+  __pyx_tuple__90 = PyTuple_Pack(1, __pyx_kp_s_Can_only_create_a_buffer_that_is); if (unlikely(!__pyx_tuple__90)) __PYX_ERR(1, 193, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__90);
+  __Pyx_GIVEREF(__pyx_tuple__90);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__88 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__88)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__88);
-  __Pyx_GIVEREF(__pyx_tuple__88);
+  __pyx_tuple__91 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__91)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__91);
+  __Pyx_GIVEREF(__pyx_tuple__91);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__89 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__89)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__89);
-  __Pyx_GIVEREF(__pyx_tuple__89);
+  __pyx_tuple__92 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__92)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__92);
+  __Pyx_GIVEREF(__pyx_tuple__92);
 
   /* "View.MemoryView":420
  *     def __setitem__(memoryview self, object index, object value):
  *         if self.view.readonly:
  *             raise TypeError("Cannot assign to read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         have_slices, index = _unellipsify(index, self.view.ndim)
  */
-  __pyx_tuple__90 = PyTuple_Pack(1, __pyx_kp_s_Cannot_assign_to_read_only_memor); if (unlikely(!__pyx_tuple__90)) __PYX_ERR(1, 420, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__90);
-  __Pyx_GIVEREF(__pyx_tuple__90);
+  __pyx_tuple__93 = PyTuple_Pack(1, __pyx_kp_s_Cannot_assign_to_read_only_memor); if (unlikely(!__pyx_tuple__93)) __PYX_ERR(1, 420, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__93);
+  __Pyx_GIVEREF(__pyx_tuple__93);
 
   /* "View.MemoryView":497
  *             result = struct.unpack(self.view.format, bytesitem)
  *         except struct.error:
  *             raise ValueError("Unable to convert item to object")             # <<<<<<<<<<<<<<
  *         else:
  *             if len(self.view.format) == 1:
  */
-  __pyx_tuple__91 = PyTuple_Pack(1, __pyx_kp_s_Unable_to_convert_item_to_object); if (unlikely(!__pyx_tuple__91)) __PYX_ERR(1, 497, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__91);
-  __Pyx_GIVEREF(__pyx_tuple__91);
+  __pyx_tuple__94 = PyTuple_Pack(1, __pyx_kp_s_Unable_to_convert_item_to_object); if (unlikely(!__pyx_tuple__94)) __PYX_ERR(1, 497, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__94);
+  __Pyx_GIVEREF(__pyx_tuple__94);
 
   /* "View.MemoryView":522
  *     def __getbuffer__(self, Py_buffer *info, int flags):
  *         if flags & PyBUF_WRITABLE and self.view.readonly:
  *             raise ValueError("Cannot create writable memory view from read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         if flags & PyBUF_ND:
  */
-  __pyx_tuple__92 = PyTuple_Pack(1, __pyx_kp_s_Cannot_create_writable_memory_vi); if (unlikely(!__pyx_tuple__92)) __PYX_ERR(1, 522, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__92);
-  __Pyx_GIVEREF(__pyx_tuple__92);
+  __pyx_tuple__95 = PyTuple_Pack(1, __pyx_kp_s_Cannot_create_writable_memory_vi); if (unlikely(!__pyx_tuple__95)) __PYX_ERR(1, 522, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__95);
+  __Pyx_GIVEREF(__pyx_tuple__95);
 
   /* "View.MemoryView":572
  *         if self.view.strides == NULL:
  * 
  *             raise ValueError("Buffer view does not expose strides")             # <<<<<<<<<<<<<<
  * 
  *         return tuple([stride for stride in self.view.strides[:self.view.ndim]])
  */
-  __pyx_tuple__93 = PyTuple_Pack(1, __pyx_kp_s_Buffer_view_does_not_expose_stri); if (unlikely(!__pyx_tuple__93)) __PYX_ERR(1, 572, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__93);
-  __Pyx_GIVEREF(__pyx_tuple__93);
+  __pyx_tuple__96 = PyTuple_Pack(1, __pyx_kp_s_Buffer_view_does_not_expose_stri); if (unlikely(!__pyx_tuple__96)) __PYX_ERR(1, 572, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__96);
+  __Pyx_GIVEREF(__pyx_tuple__96);
 
   /* "View.MemoryView":579
  *     def suboffsets(self):
  *         if self.view.suboffsets == NULL:
  *             return (-1,) * self.view.ndim             # <<<<<<<<<<<<<<
  * 
  *         return tuple([suboffset for suboffset in self.view.suboffsets[:self.view.ndim]])
  */
-  __pyx_tuple__94 = PyTuple_New(1); if (unlikely(!__pyx_tuple__94)) __PYX_ERR(1, 579, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__94);
+  __pyx_tuple__97 = PyTuple_New(1); if (unlikely(!__pyx_tuple__97)) __PYX_ERR(1, 579, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__97);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
-  PyTuple_SET_ITEM(__pyx_tuple__94, 0, __pyx_int_neg_1);
-  __Pyx_GIVEREF(__pyx_tuple__94);
+  PyTuple_SET_ITEM(__pyx_tuple__97, 0, __pyx_int_neg_1);
+  __Pyx_GIVEREF(__pyx_tuple__97);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__95 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__95)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__95);
-  __Pyx_GIVEREF(__pyx_tuple__95);
+  __pyx_tuple__98 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__98)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__98);
+  __Pyx_GIVEREF(__pyx_tuple__98);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__96 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__96)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__96);
-  __Pyx_GIVEREF(__pyx_tuple__96);
+  __pyx_tuple__99 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__99)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__99);
+  __Pyx_GIVEREF(__pyx_tuple__99);
 
   /* "View.MemoryView":684
  *         if item is Ellipsis:
  *             if not seen_ellipsis:
  *                 result.extend([slice(None)] * (ndim - len(tup) + 1))             # <<<<<<<<<<<<<<
  *                 seen_ellipsis = True
  *             else:
  */
-  __pyx_slice__97 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__97)) __PYX_ERR(1, 684, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_slice__97);
-  __Pyx_GIVEREF(__pyx_slice__97);
+  __pyx_slice__100 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__100)) __PYX_ERR(1, 684, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_slice__100);
+  __Pyx_GIVEREF(__pyx_slice__100);
 
   /* "View.MemoryView":705
  *     for suboffset in suboffsets[:ndim]:
  *         if suboffset >= 0:
  *             raise ValueError("Indirect dimensions not supported")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__98 = PyTuple_Pack(1, __pyx_kp_s_Indirect_dimensions_not_supporte); if (unlikely(!__pyx_tuple__98)) __PYX_ERR(1, 705, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__98);
-  __Pyx_GIVEREF(__pyx_tuple__98);
+  __pyx_tuple__101 = PyTuple_Pack(1, __pyx_kp_s_Indirect_dimensions_not_supporte); if (unlikely(!__pyx_tuple__101)) __PYX_ERR(1, 705, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__101);
+  __Pyx_GIVEREF(__pyx_tuple__101);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__99 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__99)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__99);
-  __Pyx_GIVEREF(__pyx_tuple__99);
+  __pyx_tuple__102 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__102)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__102);
+  __Pyx_GIVEREF(__pyx_tuple__102);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__100 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__100)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__100);
-  __Pyx_GIVEREF(__pyx_tuple__100);
-  __pyx_tuple__101 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__101)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__101);
-  __Pyx_GIVEREF(__pyx_tuple__101);
+  __pyx_tuple__103 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__103)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__103);
+  __Pyx_GIVEREF(__pyx_tuple__103);
+  __pyx_tuple__104 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__104)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__104);
+  __Pyx_GIVEREF(__pyx_tuple__104);
 
   /* "plumed.pyx":41
- * import types
+ * from cython.operator import dereference
  * 
  * if sys.version_info < (3,):             # <<<<<<<<<<<<<<
- *     raise ImportError("PLUMED 2.6 only supports Python 3")
+ *     raise ImportError("PLUMED >=2.6 only supports Python 3")
  * 
  */
-  __pyx_tuple__102 = PyTuple_Pack(1, __pyx_int_3); if (unlikely(!__pyx_tuple__102)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__102);
-  __Pyx_GIVEREF(__pyx_tuple__102);
+  __pyx_tuple__105 = PyTuple_Pack(1, __pyx_int_3); if (unlikely(!__pyx_tuple__105)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__105);
+  __Pyx_GIVEREF(__pyx_tuple__105);
 
   /* "plumed.pyx":42
  * 
  * if sys.version_info < (3,):
- *     raise ImportError("PLUMED 2.6 only supports Python 3")             # <<<<<<<<<<<<<<
+ *     raise ImportError("PLUMED >=2.6 only supports Python 3")             # <<<<<<<<<<<<<<
  * 
  * try:
  */
-  __pyx_tuple__103 = PyTuple_Pack(1, __pyx_kp_u_PLUMED_2_6_only_supports_Python); if (unlikely(!__pyx_tuple__103)) __PYX_ERR(0, 42, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__103);
-  __Pyx_GIVEREF(__pyx_tuple__103);
+  __pyx_tuple__106 = PyTuple_Pack(1, __pyx_kp_u_PLUMED_2_6_only_supports_Python); if (unlikely(!__pyx_tuple__106)) __PYX_ERR(0, 42, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__106);
+  __Pyx_GIVEREF(__pyx_tuple__106);
 
-  /* "plumed.pyx":67
- *          cdef int pres = 8
- *          self.c_plumed.cmd_int( "setRealPrecision", pres)
+  /* "plumed.pyx":62
+ * DEF type_nocopy        = 0x10000000
+ * 
+ * class PlumedError(RuntimeError):             # <<<<<<<<<<<<<<
+ *   pass
+ * 
+ */
+  __pyx_tuple__107 = PyTuple_Pack(1, __pyx_builtin_RuntimeError); if (unlikely(!__pyx_tuple__107)) __PYX_ERR(0, 62, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__107);
+  __Pyx_GIVEREF(__pyx_tuple__107);
+
+  /* "plumed.pyx":65
+ *   pass
+ * 
+ * class LeptonError(RuntimeError):             # <<<<<<<<<<<<<<
+ *   pass
+ * 
+ */
+  __pyx_tuple__108 = PyTuple_Pack(1, __pyx_builtin_RuntimeError); if (unlikely(!__pyx_tuple__108)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__108);
+  __Pyx_GIVEREF(__pyx_tuple__108);
+
+  /* "plumed.pyx":100
+ *            self.cmd("setNestedExceptions",1)
+ *          self.cmd( "setRealPrecision", 8)
  *      def finalize(self):             # <<<<<<<<<<<<<<
  *          """ Explicitly finalize a Plumed object.
  * 
  */
-  __pyx_tuple__104 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__104)) __PYX_ERR(0, 67, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__104);
-  __Pyx_GIVEREF(__pyx_tuple__104);
-  __pyx_codeobj__105 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__104, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_finalize, 67, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__105)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_tuple__109 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__109)) __PYX_ERR(0, 100, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__109);
+  __Pyx_GIVEREF(__pyx_tuple__109);
+  __pyx_codeobj__110 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__109, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_finalize, 100, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__110)) __PYX_ERR(0, 100, __pyx_L1_error)
 
-  /* "plumed.pyx":85
- *          """
- *          self.c_plumed=cplumed.Plumed()
+  /* "plumed.pyx":119
+ *          cplumed.plumed_finalize(self.c_plumed)
+ *          self.c_plumed=cplumed.plumed_create_invalid()
  *      def __enter__(self):             # <<<<<<<<<<<<<<
  *          return self
  *      def __exit__(self, type, value, traceback):
  */
-  __pyx_tuple__106 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__106)) __PYX_ERR(0, 85, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__106);
-  __Pyx_GIVEREF(__pyx_tuple__106);
-  __pyx_codeobj__107 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__106, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_enter, 85, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__107)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_tuple__111 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__111)) __PYX_ERR(0, 119, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__111);
+  __Pyx_GIVEREF(__pyx_tuple__111);
+  __pyx_codeobj__112 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__111, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_enter, 119, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__112)) __PYX_ERR(0, 119, __pyx_L1_error)
 
-  /* "plumed.pyx":87
+  /* "plumed.pyx":121
  *      def __enter__(self):
  *          return self
  *      def __exit__(self, type, value, traceback):             # <<<<<<<<<<<<<<
  *         self.finalize()
- *      cdef cmd_ndarray_double(self, ckey, val):
+ *      cdef raise_exception(self,cplumed.plumed_error error):
  */
-  __pyx_tuple__108 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_type, __pyx_n_s_value, __pyx_n_s_traceback); if (unlikely(!__pyx_tuple__108)) __PYX_ERR(0, 87, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__108);
-  __Pyx_GIVEREF(__pyx_tuple__108);
-  __pyx_codeobj__109 = (PyObject*)__Pyx_PyCode_New(4, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__108, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_exit, 87, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__109)) __PYX_ERR(0, 87, __pyx_L1_error)
+  __pyx_tuple__113 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_type, __pyx_n_s_value, __pyx_n_s_traceback); if (unlikely(!__pyx_tuple__113)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__113);
+  __Pyx_GIVEREF(__pyx_tuple__113);
+  __pyx_codeobj__114 = (PyObject*)__Pyx_PyCode_New(4, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__113, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_exit, 121, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__114)) __PYX_ERR(0, 121, __pyx_L1_error)
 
-  /* "plumed.pyx":133
+  /* "plumed.pyx":225
  *          cdef size_t comm_addr = MPI._addressof(val)
- *          self.c_plumed.cmd_mpi( ckey, <const void*>comm_addr)
+ *          self.cmd_low_level(ckey,<void*>comm_addr, 0, NULL, type_void +  type_const_pointer)
  *      def cmd( self, key, val=None ):             # <<<<<<<<<<<<<<
  *          cdef bytes py_bytes = key.encode()
  *          cdef char* ckey = py_bytes
  */
-  __pyx_tuple__110 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_key, __pyx_n_s_val, __pyx_n_s_py_bytes, __pyx_n_s_ckey, __pyx_n_s_cval, __pyx_n_s_MPI); if (unlikely(!__pyx_tuple__110)) __PYX_ERR(0, 133, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__110);
-  __Pyx_GIVEREF(__pyx_tuple__110);
-  __pyx_codeobj__111 = (PyObject*)__Pyx_PyCode_New(3, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__110, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_cmd, 133, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__111)) __PYX_ERR(0, 133, __pyx_L1_error)
+  __pyx_tuple__115 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_key, __pyx_n_s_val, __pyx_n_s_py_bytes, __pyx_n_s_ckey, __pyx_n_s_cval, __pyx_n_s_MPI); if (unlikely(!__pyx_tuple__115)) __PYX_ERR(0, 225, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__115);
+  __Pyx_GIVEREF(__pyx_tuple__115);
+  __pyx_codeobj__116 = (PyObject*)__Pyx_PyCode_New(3, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__115, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_cmd, 225, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__116)) __PYX_ERR(0, 225, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  */
-  __pyx_tuple__112 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__112)) __PYX_ERR(1, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__112);
-  __Pyx_GIVEREF(__pyx_tuple__112);
-  __pyx_codeobj__113 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__112, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_reduce_cython, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__113)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __pyx_tuple__117 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__117)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__117);
+  __Pyx_GIVEREF(__pyx_tuple__117);
+  __pyx_codeobj__118 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__117, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_reduce_cython, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__118)) __PYX_ERR(1, 1, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__114 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_pyx_state); if (unlikely(!__pyx_tuple__114)) __PYX_ERR(1, 3, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__114);
-  __Pyx_GIVEREF(__pyx_tuple__114);
-  __pyx_codeobj__115 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__114, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_setstate_cython, 3, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__115)) __PYX_ERR(1, 3, __pyx_L1_error)
+  __pyx_tuple__119 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_pyx_state); if (unlikely(!__pyx_tuple__119)) __PYX_ERR(1, 3, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__119);
+  __Pyx_GIVEREF(__pyx_tuple__119);
+  __pyx_codeobj__120 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__119, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_setstate_cython, 3, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__120)) __PYX_ERR(1, 3, __pyx_L1_error)
 
-  /* "plumed.pyx":184
+  /* "plumed.pyx":277
  *     pass
  * 
  * def _fix_file(file,mode):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a file open with mode.
  * 
  */
-  __pyx_tuple__116 = PyTuple_Pack(2, __pyx_n_s_file, __pyx_n_s_mode); if (unlikely(!__pyx_tuple__116)) __PYX_ERR(0, 184, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__116);
-  __Pyx_GIVEREF(__pyx_tuple__116);
-  __pyx_codeobj__117 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__116, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_fix_file, 184, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__117)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_tuple__121 = PyTuple_Pack(2, __pyx_n_s_file, __pyx_n_s_mode); if (unlikely(!__pyx_tuple__121)) __PYX_ERR(0, 277, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__121);
+  __Pyx_GIVEREF(__pyx_tuple__121);
+  __pyx_codeobj__122 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__121, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_fix_file, 277, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__122)) __PYX_ERR(0, 277, __pyx_L1_error)
 
-  /* "plumed.pyx":198
+  /* "plumed.pyx":291
  *     return file
  * 
  * def _build_convert_function(kernel=None):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a function that can be used for conversions.
  * 
  */
-  __pyx_tuple__118 = PyTuple_Pack(3, __pyx_n_s_kernel, __pyx_n_s_convert_func, __pyx_n_s_convert_func); if (unlikely(!__pyx_tuple__118)) __PYX_ERR(0, 198, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__118);
-  __Pyx_GIVEREF(__pyx_tuple__118);
-  __pyx_codeobj__119 = (PyObject*)__Pyx_PyCode_New(1, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__118, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_build_convert_function, 198, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__119)) __PYX_ERR(0, 198, __pyx_L1_error)
-  __pyx_tuple__120 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__120)) __PYX_ERR(0, 198, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__120);
-  __Pyx_GIVEREF(__pyx_tuple__120);
+  __pyx_tuple__123 = PyTuple_Pack(3, __pyx_n_s_kernel, __pyx_n_s_convert_func, __pyx_n_s_convert_func); if (unlikely(!__pyx_tuple__123)) __PYX_ERR(0, 291, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__123);
+  __Pyx_GIVEREF(__pyx_tuple__123);
+  __pyx_codeobj__124 = (PyObject*)__Pyx_PyCode_New(1, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__123, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_build_convert_function, 291, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__124)) __PYX_ERR(0, 291, __pyx_L1_error)
+  __pyx_tuple__125 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__125)) __PYX_ERR(0, 291, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__125);
+  __Pyx_GIVEREF(__pyx_tuple__125);
 
-  /* "plumed.pyx":241
+  /* "plumed.pyx":334
  *    """Custom class used to store plumed constants.
  *    """
  *    def __init__(self,l,kernel=None,convert=None):             # <<<<<<<<<<<<<<
  *        if(isinstance(l,dict)):
  *            for k in l:
  */
-  __pyx_tuple__121 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_l, __pyx_n_s_kernel, __pyx_n_s_convert_2, __pyx_n_s_k, __pyx_n_s_i); if (unlikely(!__pyx_tuple__121)) __PYX_ERR(0, 241, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__121);
-  __Pyx_GIVEREF(__pyx_tuple__121);
-  __pyx_codeobj__122 = (PyObject*)__Pyx_PyCode_New(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__121, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 241, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__122)) __PYX_ERR(0, 241, __pyx_L1_error)
-  __pyx_tuple__123 = PyTuple_Pack(2, ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__123)) __PYX_ERR(0, 241, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__123);
-  __Pyx_GIVEREF(__pyx_tuple__123);
+  __pyx_tuple__126 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_l, __pyx_n_s_kernel, __pyx_n_s_convert_2, __pyx_n_s_k, __pyx_n_s_i); if (unlikely(!__pyx_tuple__126)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__126);
+  __Pyx_GIVEREF(__pyx_tuple__126);
+  __pyx_codeobj__127 = (PyObject*)__Pyx_PyCode_New(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__126, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 334, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__127)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __pyx_tuple__128 = PyTuple_Pack(2, ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__128)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__128);
+  __Pyx_GIVEREF(__pyx_tuple__128);
 
-  /* "plumed.pyx":260
+  /* "plumed.pyx":353
  *                raise ValueError("plumed.Constants should be initialized with a list of 2- or 3-plets")
  * 
  * def read_as_pandas(file_or_path,enable_constants=True,enable_conversion=True,kernel=None,chunksize=None,usecols=None,skiprows=None,nrows=None,index_col=None):             # <<<<<<<<<<<<<<
  *     """Import a plumed data file as a pandas dataset.
  * 
  */
-  __pyx_tuple__124 = PyTuple_Pack(24, __pyx_n_s_file_or_path, __pyx_n_s_enable_constants, __pyx_n_s_enable_conversion, __pyx_n_s_kernel, __pyx_n_s_chunksize, __pyx_n_s_usecols, __pyx_n_s_skiprows, __pyx_n_s_nrows, __pyx_n_s_index_col, __pyx_n_s_pd, __pyx_n_s_PlumedSeries, __pyx_n_s_PlumedDataFrame, __pyx_n_s_process_dataframe, __pyx_n_s_process_dataframe, __pyx_n_s_convert_2, __pyx_n_s_convert_all, __pyx_n_s_line, __pyx_n_s_columns, __pyx_n_s_constants, __pyx_n_s_pos, __pyx_n_s_sets, __pyx_n_s_v, __pyx_n_s_df, __pyx_n_s_TextFileReader); if (unlikely(!__pyx_tuple__124)) __PYX_ERR(0, 260, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__124);
-  __Pyx_GIVEREF(__pyx_tuple__124);
-  __pyx_codeobj__125 = (PyObject*)__Pyx_PyCode_New(9, 0, 24, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__124, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_read_as_pandas, 260, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__125)) __PYX_ERR(0, 260, __pyx_L1_error)
-  __pyx_tuple__126 = PyTuple_Pack(8, ((PyObject *)Py_True), ((PyObject *)Py_True), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__126)) __PYX_ERR(0, 260, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__126);
-  __Pyx_GIVEREF(__pyx_tuple__126);
+  __pyx_tuple__129 = PyTuple_Pack(24, __pyx_n_s_file_or_path, __pyx_n_s_enable_constants, __pyx_n_s_enable_conversion, __pyx_n_s_kernel, __pyx_n_s_chunksize, __pyx_n_s_usecols, __pyx_n_s_skiprows, __pyx_n_s_nrows, __pyx_n_s_index_col, __pyx_n_s_pd, __pyx_n_s_PlumedSeries, __pyx_n_s_PlumedDataFrame, __pyx_n_s_process_dataframe, __pyx_n_s_process_dataframe, __pyx_n_s_convert_2, __pyx_n_s_convert_all, __pyx_n_s_line, __pyx_n_s_columns, __pyx_n_s_constants, __pyx_n_s_pos, __pyx_n_s_sets, __pyx_n_s_v, __pyx_n_s_df, __pyx_n_s_TextFileReader); if (unlikely(!__pyx_tuple__129)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__129);
+  __Pyx_GIVEREF(__pyx_tuple__129);
+  __pyx_codeobj__130 = (PyObject*)__Pyx_PyCode_New(9, 0, 24, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__129, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_read_as_pandas, 353, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__130)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_tuple__131 = PyTuple_Pack(8, ((PyObject *)Py_True), ((PyObject *)Py_True), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__131)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__131);
+  __Pyx_GIVEREF(__pyx_tuple__131);
 
-  /* "plumed.pyx":468
+  /* "plumed.pyx":561
  *         return TextFileReader(df,enable_constants,constants,convert_all)
  * 
  * def write_pandas(df,file_or_path=None):             # <<<<<<<<<<<<<<
  *     """Save a pandas dataframe as a PLUMED file.
  * 
  */
-  __pyx_tuple__127 = PyTuple_Pack(9, __pyx_n_s_df, __pyx_n_s_file_or_path, __pyx_n_s_pd, __pyx_n_s_has_index, __pyx_n_s_has_mindex, __pyx_n_s_n, __pyx_n_s_c, __pyx_n_s_i, __pyx_n_s_j); if (unlikely(!__pyx_tuple__127)) __PYX_ERR(0, 468, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__127);
-  __Pyx_GIVEREF(__pyx_tuple__127);
-  __pyx_codeobj__128 = (PyObject*)__Pyx_PyCode_New(2, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__127, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_write_pandas, 468, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__128)) __PYX_ERR(0, 468, __pyx_L1_error)
-  __pyx_tuple__129 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__129)) __PYX_ERR(0, 468, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__129);
-  __Pyx_GIVEREF(__pyx_tuple__129);
+  __pyx_tuple__132 = PyTuple_Pack(9, __pyx_n_s_df, __pyx_n_s_file_or_path, __pyx_n_s_pd, __pyx_n_s_has_index, __pyx_n_s_has_mindex, __pyx_n_s_n, __pyx_n_s_c, __pyx_n_s_i, __pyx_n_s_j); if (unlikely(!__pyx_tuple__132)) __PYX_ERR(0, 561, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__132);
+  __Pyx_GIVEREF(__pyx_tuple__132);
+  __pyx_codeobj__133 = (PyObject*)__Pyx_PyCode_New(2, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__132, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_write_pandas, 561, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__133)) __PYX_ERR(0, 561, __pyx_L1_error)
+  __pyx_tuple__134 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__134)) __PYX_ERR(0, 561, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__134);
+  __Pyx_GIVEREF(__pyx_tuple__134);
 
-  /* "plumed.pyx":520
+  /* "plumed.pyx":613
  *         file_or_path.write("\n")
  * 
+ * def hills_time_average(hills, tofile=None, *, t0=None, t1=None, frac0=None, frac1=None, inplace=False):             # <<<<<<<<<<<<<<
+ *     """Compute a time-averaged hills file.
+ * 
+ */
+  __pyx_tuple__135 = PyTuple_Pack(13, __pyx_n_s_hills, __pyx_n_s_tofile, __pyx_n_s_t0, __pyx_n_s_t1, __pyx_n_s_frac0, __pyx_n_s_frac1, __pyx_n_s_inplace, __pyx_n_s_pd, __pyx_n_s_use_time, __pyx_n_s_use_index, __pyx_n_s_w, __pyx_n_s_i0, __pyx_n_s_i1); if (unlikely(!__pyx_tuple__135)) __PYX_ERR(0, 613, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__135);
+  __Pyx_GIVEREF(__pyx_tuple__135);
+  __pyx_codeobj__136 = (PyObject*)__Pyx_PyCode_New(2, 5, 13, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__135, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_hills_time_average, 613, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__136)) __PYX_ERR(0, 613, __pyx_L1_error)
+  __pyx_tuple__137 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__137)) __PYX_ERR(0, 613, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__137);
+  __Pyx_GIVEREF(__pyx_tuple__137);
+
+  /* "plumed.pyx":702
+ *         return hills
+ * 
  * def _guessplumedroot(kernel=None):             # <<<<<<<<<<<<<<
  *     """Guess plumed root.
  * 
  */
-  __pyx_tuple__130 = PyTuple_Pack(9, __pyx_n_s_kernel, __pyx_n_s_tempfile, __pyx_n_s_log, __pyx_n_s_p, __pyx_n_s_i, __pyx_n_s_root_2, __pyx_n_s_fin, __pyx_n_s_line, __pyx_n_s_subprocess); if (unlikely(!__pyx_tuple__130)) __PYX_ERR(0, 520, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__130);
-  __Pyx_GIVEREF(__pyx_tuple__130);
-  __pyx_codeobj__131 = (PyObject*)__Pyx_PyCode_New(1, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__130, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_guessplumedroot, 520, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__131)) __PYX_ERR(0, 520, __pyx_L1_error)
-  __pyx_tuple__132 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__132)) __PYX_ERR(0, 520, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__132);
-  __Pyx_GIVEREF(__pyx_tuple__132);
+  __pyx_tuple__138 = PyTuple_Pack(9, __pyx_n_s_kernel, __pyx_n_s_tempfile, __pyx_n_s_log, __pyx_n_s_p, __pyx_n_s_i, __pyx_n_s_root_2, __pyx_n_s_fin, __pyx_n_s_line, __pyx_n_s_subprocess); if (unlikely(!__pyx_tuple__138)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__138);
+  __Pyx_GIVEREF(__pyx_tuple__138);
+  __pyx_codeobj__139 = (PyObject*)__Pyx_PyCode_New(1, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__138, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_guessplumedroot, 702, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__139)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __pyx_tuple__140 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__140)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__140);
+  __Pyx_GIVEREF(__pyx_tuple__140);
 
-  /* "plumed.pyx":550
+  /* "plumed.pyx":732
  *     return subprocess.check_output(["plumed","--no-mpi","info","--root"]).decode("utf-8").rstrip()
  * 
  * def _readvimdict(plumedroot=None,kernel=None):             # <<<<<<<<<<<<<<
  *     """Read VIM dictionary given the path to PLUMED root and return (dictionary,doc).
  * 
  */
-  __pyx_tuple__133 = PyTuple_Pack(13, __pyx_n_s_plumedroot, __pyx_n_s_kernel, __pyx_n_s_syntax_file, __pyx_n_s_help_dir, __pyx_n_s_plumedDictionary, __pyx_n_s_pattern, __pyx_n_s_fin, __pyx_n_s_line, __pyx_n_s_ret_3, __pyx_n_s_doc_2, __pyx_n_s_action, __pyx_n_s_thisdoc, __pyx_n_s_opt); if (unlikely(!__pyx_tuple__133)) __PYX_ERR(0, 550, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__133);
-  __Pyx_GIVEREF(__pyx_tuple__133);
-  __pyx_codeobj__134 = (PyObject*)__Pyx_PyCode_New(2, 0, 13, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__133, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_readvimdict, 550, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__134)) __PYX_ERR(0, 550, __pyx_L1_error)
-  __pyx_tuple__135 = PyTuple_Pack(2, ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__135)) __PYX_ERR(0, 550, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__135);
-  __Pyx_GIVEREF(__pyx_tuple__135);
+  __pyx_tuple__141 = PyTuple_Pack(13, __pyx_n_s_plumedroot, __pyx_n_s_kernel, __pyx_n_s_syntax_file, __pyx_n_s_help_dir, __pyx_n_s_plumedDictionary, __pyx_n_s_pattern, __pyx_n_s_fin, __pyx_n_s_line, __pyx_n_s_ret_3, __pyx_n_s_doc_2, __pyx_n_s_action, __pyx_n_s_thisdoc, __pyx_n_s_opt); if (unlikely(!__pyx_tuple__141)) __PYX_ERR(0, 732, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__141);
+  __Pyx_GIVEREF(__pyx_tuple__141);
+  __pyx_codeobj__142 = (PyObject*)__Pyx_PyCode_New(2, 0, 13, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__141, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_readvimdict, 732, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__142)) __PYX_ERR(0, 732, __pyx_L1_error)
+  __pyx_tuple__143 = PyTuple_Pack(2, ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__143)) __PYX_ERR(0, 732, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__143);
+  __Pyx_GIVEREF(__pyx_tuple__143);
 
-  /* "plumed.pyx":599
+  /* "plumed.pyx":781
  *     return ret,doc
  * 
  * def _create_functions(dictionary,*,doc=None,append_underscores=False):             # <<<<<<<<<<<<<<
  *     """Create functions given dictionary and, optionally, documentation.
  * 
  */
-  __pyx_tuple__136 = PyTuple_Pack(10, __pyx_n_s_dictionary, __pyx_n_s_doc_2, __pyx_n_s_append_underscores, __pyx_n_s_functions_2, __pyx_n_s_action, __pyx_n_s_fname, __pyx_n_s_string, __pyx_n_s_w, __pyx_n_s_t, __pyx_n_s_x); if (unlikely(!__pyx_tuple__136)) __PYX_ERR(0, 599, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__136);
-  __Pyx_GIVEREF(__pyx_tuple__136);
-  __pyx_codeobj__137 = (PyObject*)__Pyx_PyCode_New(1, 2, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__136, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_create_functions, 599, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__137)) __PYX_ERR(0, 599, __pyx_L1_error)
+  __pyx_tuple__144 = PyTuple_Pack(10, __pyx_n_s_dictionary, __pyx_n_s_doc_2, __pyx_n_s_append_underscores, __pyx_n_s_functions_2, __pyx_n_s_action, __pyx_n_s_fname, __pyx_n_s_string, __pyx_n_s_w, __pyx_n_s_t, __pyx_n_s_x); if (unlikely(!__pyx_tuple__144)) __PYX_ERR(0, 781, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__144);
+  __Pyx_GIVEREF(__pyx_tuple__144);
+  __pyx_codeobj__145 = (PyObject*)__Pyx_PyCode_New(1, 2, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__144, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_create_functions, 781, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__145)) __PYX_ERR(0, 781, __pyx_L1_error)
 
-  /* "plumed.pyx":674
+  /* "plumed.pyx":856
  * 
  * class _numbered():
  *     def __init__(self,*args):             # <<<<<<<<<<<<<<
  * # this is experimental:
  * # it allows calling _numbered(arg1,arg2,arg3)
  */
-  __pyx_tuple__138 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_args, __pyx_n_s_i, __pyx_n_s_x); if (unlikely(!__pyx_tuple__138)) __PYX_ERR(0, 674, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__138);
-  __Pyx_GIVEREF(__pyx_tuple__138);
-  __pyx_codeobj__139 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__138, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 674, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__139)) __PYX_ERR(0, 674, __pyx_L1_error)
+  __pyx_tuple__146 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_args, __pyx_n_s_i, __pyx_n_s_x); if (unlikely(!__pyx_tuple__146)) __PYX_ERR(0, 856, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__146);
+  __Pyx_GIVEREF(__pyx_tuple__146);
+  __pyx_codeobj__147 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__146, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 856, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__147)) __PYX_ERR(0, 856, __pyx_L1_error)
 
-  /* "plumed.pyx":697
+  /* "plumed.pyx":879
  * 
  * class _replicas():
  *     def __init__(self,*args):             # <<<<<<<<<<<<<<
  * # this is experimental:
  * # it allows calling _replicas(arg1,arg2,arg3)
  */
-  __pyx_tuple__140 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_args); if (unlikely(!__pyx_tuple__140)) __PYX_ERR(0, 697, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__140);
-  __Pyx_GIVEREF(__pyx_tuple__140);
-  __pyx_codeobj__141 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__140, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 697, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__141)) __PYX_ERR(0, 697, __pyx_L1_error)
+  __pyx_tuple__148 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_args); if (unlikely(!__pyx_tuple__148)) __PYX_ERR(0, 879, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__148);
+  __Pyx_GIVEREF(__pyx_tuple__148);
+  __pyx_codeobj__149 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__148, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 879, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__149)) __PYX_ERR(0, 879, __pyx_L1_error)
 
-  /* "plumed.pyx":711
+  /* "plumed.pyx":893
  * ## tool to format at strings (optional)
  * 
  * def _format_at_one_residue(builder,name,residue,chain):             # <<<<<<<<<<<<<<
  *       if isinstance(chain,int):
  *         chain=str(chain)
  */
-  __pyx_tuple__142 = PyTuple_Pack(6, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_residue, __pyx_n_s_chain, __pyx_n_s_digit, __pyx_n_s_i); if (unlikely(!__pyx_tuple__142)) __PYX_ERR(0, 711, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__142);
-  __Pyx_GIVEREF(__pyx_tuple__142);
-  __pyx_codeobj__143 = (PyObject*)__Pyx_PyCode_New(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__142, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_at_one_residue, 711, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__143)) __PYX_ERR(0, 711, __pyx_L1_error)
+  __pyx_tuple__150 = PyTuple_Pack(6, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_residue, __pyx_n_s_chain, __pyx_n_s_digit, __pyx_n_s_i); if (unlikely(!__pyx_tuple__150)) __PYX_ERR(0, 893, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__150);
+  __Pyx_GIVEREF(__pyx_tuple__150);
+  __pyx_codeobj__151 = (PyObject*)__Pyx_PyCode_New(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__150, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_at_one_residue, 893, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__151)) __PYX_ERR(0, 893, __pyx_L1_error)
 
-  /* "plumed.pyx":725
+  /* "plumed.pyx":907
  *         assert False
  * 
  * def _format_at_one_chain(builder,name,residue,chain):             # <<<<<<<<<<<<<<
  *       res=""
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):
  */
-  __pyx_tuple__144 = PyTuple_Pack(6, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_residue, __pyx_n_s_chain, __pyx_n_s_res, __pyx_n_s_x); if (unlikely(!__pyx_tuple__144)) __PYX_ERR(0, 725, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__144);
-  __Pyx_GIVEREF(__pyx_tuple__144);
-  __pyx_codeobj__145 = (PyObject*)__Pyx_PyCode_New(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__144, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_at_one_chain, 725, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__145)) __PYX_ERR(0, 725, __pyx_L1_error)
+  __pyx_tuple__152 = PyTuple_Pack(6, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_residue, __pyx_n_s_chain, __pyx_n_s_res, __pyx_n_s_x); if (unlikely(!__pyx_tuple__152)) __PYX_ERR(0, 907, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__152);
+  __Pyx_GIVEREF(__pyx_tuple__152);
+  __pyx_codeobj__153 = (PyObject*)__Pyx_PyCode_New(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__152, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_at_one_chain, 907, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__153)) __PYX_ERR(0, 907, __pyx_L1_error)
 
-  /* "plumed.pyx":735
+  /* "plumed.pyx":917
  *       return res
  * 
  * def _format_at(builder,name,residue,chain=""):             # <<<<<<<<<<<<<<
  *       res=""
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):
  */
-  __pyx_tuple__146 = PyTuple_Pack(6, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_residue, __pyx_n_s_chain, __pyx_n_s_res, __pyx_n_s_x); if (unlikely(!__pyx_tuple__146)) __PYX_ERR(0, 735, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__146);
-  __Pyx_GIVEREF(__pyx_tuple__146);
-  __pyx_codeobj__147 = (PyObject*)__Pyx_PyCode_New(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__146, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_at, 735, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__147)) __PYX_ERR(0, 735, __pyx_L1_error)
-  __pyx_tuple__148 = PyTuple_Pack(1, ((PyObject*)__pyx_kp_u__32)); if (unlikely(!__pyx_tuple__148)) __PYX_ERR(0, 735, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__148);
-  __Pyx_GIVEREF(__pyx_tuple__148);
+  __pyx_tuple__154 = PyTuple_Pack(6, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_residue, __pyx_n_s_chain, __pyx_n_s_res, __pyx_n_s_x); if (unlikely(!__pyx_tuple__154)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__154);
+  __Pyx_GIVEREF(__pyx_tuple__154);
+  __pyx_codeobj__155 = (PyObject*)__Pyx_PyCode_New(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__154, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_at, 917, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__155)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_tuple__156 = PyTuple_Pack(1, ((PyObject*)__pyx_kp_u__35)); if (unlikely(!__pyx_tuple__156)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__156);
+  __Pyx_GIVEREF(__pyx_tuple__156);
 
-  /* "plumed.pyx":745
+  /* "plumed.pyx":927
  * 
  * class _at():
  *     def __init__(self,builder):             # <<<<<<<<<<<<<<
  *       import weakref
  *       self._builder=weakref.ref(builder)
  */
-  __pyx_tuple__149 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_builder, __pyx_n_s_weakref, __pyx_n_s_at_global, __pyx_n_s_x, __pyx_n_s_at_residue, __pyx_n_s_ldict); if (unlikely(!__pyx_tuple__149)) __PYX_ERR(0, 745, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__149);
-  __Pyx_GIVEREF(__pyx_tuple__149);
-  __pyx_codeobj__150 = (PyObject*)__Pyx_PyCode_New(2, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__149, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 745, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__150)) __PYX_ERR(0, 745, __pyx_L1_error)
+  __pyx_tuple__157 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_builder, __pyx_n_s_weakref, __pyx_n_s_at_global, __pyx_n_s_x, __pyx_n_s_at_residue, __pyx_n_s_ldict); if (unlikely(!__pyx_tuple__157)) __PYX_ERR(0, 927, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__157);
+  __Pyx_GIVEREF(__pyx_tuple__157);
+  __pyx_codeobj__158 = (PyObject*)__Pyx_PyCode_New(2, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__157, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 927, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__158)) __PYX_ERR(0, 927, __pyx_L1_error)
 
-  /* "plumed.pyx":756
+  /* "plumed.pyx":938
  *             exec("def " + x + "(self,residue,chain=\"\"):\n          return _format_at(self._builder(),\"" + x + "\",residue,chain)\n",{"_format_at":_format_at},ldict)
  *             exec("self." + x + " = types.MethodType( ldict['" + x + "'],self)",None,{"self":self, "types":types, "ldict":ldict})
  *     def __call__(self,name,residue,chain=""):             # <<<<<<<<<<<<<<
  *        return _format_at(self._builder(),name,residue,chain)
  * 
  */
-  __pyx_tuple__151 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_name, __pyx_n_s_residue, __pyx_n_s_chain); if (unlikely(!__pyx_tuple__151)) __PYX_ERR(0, 756, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__151);
-  __Pyx_GIVEREF(__pyx_tuple__151);
-  __pyx_codeobj__152 = (PyObject*)__Pyx_PyCode_New(4, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__151, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_call, 756, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__152)) __PYX_ERR(0, 756, __pyx_L1_error)
-  __pyx_tuple__153 = PyTuple_Pack(1, ((PyObject*)__pyx_kp_u__32)); if (unlikely(!__pyx_tuple__153)) __PYX_ERR(0, 756, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__153);
-  __Pyx_GIVEREF(__pyx_tuple__153);
+  __pyx_tuple__159 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_name, __pyx_n_s_residue, __pyx_n_s_chain); if (unlikely(!__pyx_tuple__159)) __PYX_ERR(0, 938, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__159);
+  __Pyx_GIVEREF(__pyx_tuple__159);
+  __pyx_codeobj__160 = (PyObject*)__Pyx_PyCode_New(4, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__159, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_call, 938, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__160)) __PYX_ERR(0, 938, __pyx_L1_error)
+  __pyx_tuple__161 = PyTuple_Pack(1, ((PyObject*)__pyx_kp_u__35)); if (unlikely(!__pyx_tuple__161)) __PYX_ERR(0, 938, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__161);
+  __Pyx_GIVEREF(__pyx_tuple__161);
 
-  /* "plumed.pyx":761
+  /* "plumed.pyx":943
  * ## end of tool to format at strings
  * 
  * def _fix_braces(builder,arg,comma):             # <<<<<<<<<<<<<<
  *     """ Fix braces.
  * 
  */
-  __pyx_tuple__154 = PyTuple_Pack(6, __pyx_n_s_builder, __pyx_n_s_arg, __pyx_n_s_comma, __pyx_n_s_always, __pyx_n_s_tmp, __pyx_n_s_go); if (unlikely(!__pyx_tuple__154)) __PYX_ERR(0, 761, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__154);
-  __Pyx_GIVEREF(__pyx_tuple__154);
-  __pyx_codeobj__155 = (PyObject*)__Pyx_PyCode_New(3, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__154, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_fix_braces, 761, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__155)) __PYX_ERR(0, 761, __pyx_L1_error)
+  __pyx_tuple__162 = PyTuple_Pack(6, __pyx_n_s_builder, __pyx_n_s_arg, __pyx_n_s_comma, __pyx_n_s_always, __pyx_n_s_tmp, __pyx_n_s_go); if (unlikely(!__pyx_tuple__162)) __PYX_ERR(0, 943, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__162);
+  __Pyx_GIVEREF(__pyx_tuple__162);
+  __pyx_codeobj__163 = (PyObject*)__Pyx_PyCode_New(3, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__162, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_fix_braces, 943, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__163)) __PYX_ERR(0, 943, __pyx_L1_error)
 
-  /* "plumed.pyx":782
+  /* "plumed.pyx":964
  *     return arg
  * 
  * def _format_single(builder,arg,level=0):             # <<<<<<<<<<<<<<
  *     """Format a single argument.
  * 
  */
-  __pyx_tuple__156 = PyTuple_Pack(7, __pyx_n_s_builder, __pyx_n_s_arg, __pyx_n_s_level, __pyx_n_s_numbers, __pyx_n_s_MDAnalysis, __pyx_n_s_string, __pyx_n_s_x); if (unlikely(!__pyx_tuple__156)) __PYX_ERR(0, 782, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__156);
-  __Pyx_GIVEREF(__pyx_tuple__156);
-  __pyx_codeobj__157 = (PyObject*)__Pyx_PyCode_New(3, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__156, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_single, 782, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__157)) __PYX_ERR(0, 782, __pyx_L1_error)
-  __pyx_tuple__158 = PyTuple_Pack(1, ((PyObject *)__pyx_int_0)); if (unlikely(!__pyx_tuple__158)) __PYX_ERR(0, 782, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__158);
-  __Pyx_GIVEREF(__pyx_tuple__158);
+  __pyx_tuple__164 = PyTuple_Pack(7, __pyx_n_s_builder, __pyx_n_s_arg, __pyx_n_s_level, __pyx_n_s_numbers, __pyx_n_s_MDAnalysis, __pyx_n_s_string, __pyx_n_s_x); if (unlikely(!__pyx_tuple__164)) __PYX_ERR(0, 964, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__164);
+  __Pyx_GIVEREF(__pyx_tuple__164);
+  __pyx_codeobj__165 = (PyObject*)__Pyx_PyCode_New(3, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__164, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_single, 964, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__165)) __PYX_ERR(0, 964, __pyx_L1_error)
+  __pyx_tuple__166 = PyTuple_Pack(1, ((PyObject *)__pyx_int_0)); if (unlikely(!__pyx_tuple__166)) __PYX_ERR(0, 964, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__166);
+  __Pyx_GIVEREF(__pyx_tuple__166);
 
-  /* "plumed.pyx":813
+  /* "plumed.pyx":995
  *     raise TypeError("options should be string, number or iterable")
  * 
  * def _format_numbered(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format a numbered argument."""
  *     if isinstance(arg,_numbered):
  */
-  __pyx_tuple__159 = PyTuple_Pack(5, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_arg, __pyx_n_s_ret_3, __pyx_n_s_x); if (unlikely(!__pyx_tuple__159)) __PYX_ERR(0, 813, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__159);
-  __Pyx_GIVEREF(__pyx_tuple__159);
-  __pyx_codeobj__160 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__159, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_numbered, 813, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__160)) __PYX_ERR(0, 813, __pyx_L1_error)
+  __pyx_tuple__167 = PyTuple_Pack(5, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_arg, __pyx_n_s_ret_3, __pyx_n_s_x); if (unlikely(!__pyx_tuple__167)) __PYX_ERR(0, 995, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__167);
+  __Pyx_GIVEREF(__pyx_tuple__167);
+  __pyx_codeobj__168 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__167, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_numbered, 995, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__168)) __PYX_ERR(0, 995, __pyx_L1_error)
 
-  /* "plumed.pyx":825
+  /* "plumed.pyx":1007
  *     return _format_opt(builder,name,arg)
  * 
  * def _format_flag(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format a flag."""
  *     if arg is None:
  */
-  __pyx_tuple__161 = PyTuple_Pack(3, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_arg); if (unlikely(!__pyx_tuple__161)) __PYX_ERR(0, 825, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__161);
-  __Pyx_GIVEREF(__pyx_tuple__161);
-  __pyx_codeobj__162 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__161, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_flag, 825, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__162)) __PYX_ERR(0, 825, __pyx_L1_error)
+  __pyx_tuple__169 = PyTuple_Pack(3, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_arg); if (unlikely(!__pyx_tuple__169)) __PYX_ERR(0, 1007, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__169);
+  __Pyx_GIVEREF(__pyx_tuple__169);
+  __pyx_codeobj__170 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__169, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_flag, 1007, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__170)) __PYX_ERR(0, 1007, __pyx_L1_error)
 
-  /* "plumed.pyx":836
+  /* "plumed.pyx":1018
  *     raise TypeError(name + " should be of bool type")
  * 
  * def _format_label(builder,label):             # <<<<<<<<<<<<<<
  *     """Format a label."""
  *     if label is None:
  */
-  __pyx_tuple__163 = PyTuple_Pack(2, __pyx_n_s_builder, __pyx_n_s_label_2); if (unlikely(!__pyx_tuple__163)) __PYX_ERR(0, 836, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__163);
-  __Pyx_GIVEREF(__pyx_tuple__163);
-  __pyx_codeobj__164 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__163, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_label, 836, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__164)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_tuple__171 = PyTuple_Pack(2, __pyx_n_s_builder, __pyx_n_s_label_2); if (unlikely(!__pyx_tuple__171)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__171);
+  __Pyx_GIVEREF(__pyx_tuple__171);
+  __pyx_codeobj__172 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__171, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_label, 1018, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__172)) __PYX_ERR(0, 1018, __pyx_L1_error)
 
-  /* "plumed.pyx":846
+  /* "plumed.pyx":1028
  *     raise TypeError("label should be of str type")
  * 
  * def _format_opt(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format an option."""
  *     if arg is None:
  */
-  __pyx_tuple__165 = PyTuple_Pack(4, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_arg, __pyx_n_s_string); if (unlikely(!__pyx_tuple__165)) __PYX_ERR(0, 846, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__165);
-  __Pyx_GIVEREF(__pyx_tuple__165);
-  __pyx_codeobj__166 = (PyObject*)__Pyx_PyCode_New(3, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__165, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_opt, 846, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__166)) __PYX_ERR(0, 846, __pyx_L1_error)
+  __pyx_tuple__173 = PyTuple_Pack(4, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_arg, __pyx_n_s_string); if (unlikely(!__pyx_tuple__173)) __PYX_ERR(0, 1028, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__173);
+  __Pyx_GIVEREF(__pyx_tuple__173);
+  __pyx_codeobj__174 = (PyObject*)__Pyx_PyCode_New(3, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__173, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_opt, 1028, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__174)) __PYX_ERR(0, 1028, __pyx_L1_error)
 
-  /* "plumed.pyx":856
+  /* "plumed.pyx":1038
  *     return " " + name + "=" + string
  * 
  * def _format_return(builder,ret):             # <<<<<<<<<<<<<<
  *     """Format the return statement"""
  *     if not builder._toplumed is None :
  */
-  __pyx_tuple__167 = PyTuple_Pack(2, __pyx_n_s_builder, __pyx_n_s_ret_3); if (unlikely(!__pyx_tuple__167)) __PYX_ERR(0, 856, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__167);
-  __Pyx_GIVEREF(__pyx_tuple__167);
-  __pyx_codeobj__168 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__167, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_return, 856, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__168)) __PYX_ERR(0, 856, __pyx_L1_error)
+  __pyx_tuple__175 = PyTuple_Pack(2, __pyx_n_s_builder, __pyx_n_s_ret_3); if (unlikely(!__pyx_tuple__175)) __PYX_ERR(0, 1038, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__175);
+  __Pyx_GIVEREF(__pyx_tuple__175);
+  __pyx_codeobj__176 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__175, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_return, 1038, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__176)) __PYX_ERR(0, 1038, __pyx_L1_error)
 
-  /* "plumed.pyx":871
+  /* "plumed.pyx":1053
  *     return ret + "\n"
  * 
  * def _format_verbatim(builder,verbatim):             # <<<<<<<<<<<<<<
  *   if not verbatim is None:
  *     if(len(verbatim)>0):
  */
-  __pyx_tuple__169 = PyTuple_Pack(2, __pyx_n_s_builder, __pyx_n_s_verbatim); if (unlikely(!__pyx_tuple__169)) __PYX_ERR(0, 871, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__169);
-  __Pyx_GIVEREF(__pyx_tuple__169);
-  __pyx_codeobj__170 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__169, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_verbatim, 871, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__170)) __PYX_ERR(0, 871, __pyx_L1_error)
+  __pyx_tuple__177 = PyTuple_Pack(2, __pyx_n_s_builder, __pyx_n_s_verbatim); if (unlikely(!__pyx_tuple__177)) __PYX_ERR(0, 1053, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__177);
+  __Pyx_GIVEREF(__pyx_tuple__177);
+  __pyx_codeobj__178 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__177, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_verbatim, 1053, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__178)) __PYX_ERR(0, 1053, __pyx_L1_error)
 
-  /* "plumed.pyx":877
+  /* "plumed.pyx":1059
  *   return ""
  * 
  * def _format_anything(builder,name,arg):             # <<<<<<<<<<<<<<
  *    """Choose format based on arg type"""
  *    ret=""
  */
-  __pyx_tuple__171 = PyTuple_Pack(4, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_arg, __pyx_n_s_ret_3); if (unlikely(!__pyx_tuple__171)) __PYX_ERR(0, 877, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__171);
-  __Pyx_GIVEREF(__pyx_tuple__171);
-  __pyx_codeobj__172 = (PyObject*)__Pyx_PyCode_New(3, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__171, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_anything, 877, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__172)) __PYX_ERR(0, 877, __pyx_L1_error)
+  __pyx_tuple__179 = PyTuple_Pack(4, __pyx_n_s_builder, __pyx_n_s_name, __pyx_n_s_arg, __pyx_n_s_ret_3); if (unlikely(!__pyx_tuple__179)) __PYX_ERR(0, 1059, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__179);
+  __Pyx_GIVEREF(__pyx_tuple__179);
+  __pyx_codeobj__180 = (PyObject*)__Pyx_PyCode_New(3, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__179, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_format_anything, 1059, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__180)) __PYX_ERR(0, 1059, __pyx_L1_error)
 
-  /* "plumed.pyx":907
+  /* "plumed.pyx":1089
  *        Check the constructor to see all the available options.
  *     """
  *     def __init__(self,             # <<<<<<<<<<<<<<
  *                  *,
  *                  tofile=None,
  */
-  __pyx_tuple__173 = PyTuple_Pack(14, __pyx_n_s_self, __pyx_n_s_tofile_2, __pyx_n_s_toplumed_2, __pyx_n_s_kernel, __pyx_n_s_append_underscores, __pyx_n_s_comma_separator, __pyx_n_s_minimize_braces_2, __pyx_n_s_enable_at, __pyx_n_s_load_dict, __pyx_n_s_enable_mda_groups_2, __pyx_n_s_post_format_2, __pyx_n_s_pre_format_2, __pyx_n_s_action, __pyx_n_s_ldict); if (unlikely(!__pyx_tuple__173)) __PYX_ERR(0, 907, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__173);
-  __Pyx_GIVEREF(__pyx_tuple__173);
-  __pyx_codeobj__174 = (PyObject*)__Pyx_PyCode_New(1, 11, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__173, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 907, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__174)) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_tuple__181 = PyTuple_Pack(14, __pyx_n_s_self, __pyx_n_s_tofile, __pyx_n_s_toplumed_2, __pyx_n_s_kernel, __pyx_n_s_append_underscores, __pyx_n_s_comma_separator, __pyx_n_s_minimize_braces_2, __pyx_n_s_enable_at, __pyx_n_s_load_dict, __pyx_n_s_enable_mda_groups_2, __pyx_n_s_post_format_2, __pyx_n_s_pre_format_2, __pyx_n_s_action, __pyx_n_s_ldict); if (unlikely(!__pyx_tuple__181)) __PYX_ERR(0, 1089, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__181);
+  __Pyx_GIVEREF(__pyx_tuple__181);
+  __pyx_codeobj__182 = (PyObject*)__Pyx_PyCode_New(1, 11, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__181, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_init, 1089, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__182)) __PYX_ERR(0, 1089, __pyx_L1_error)
 
-  /* "plumed.pyx":982
+  /* "plumed.pyx":1164
  *             self.at=_at(self)
  * 
  *     def __call__(self,action,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *         ret=""
  *         ret+=_format_label(self,LABEL)
  */
-  __pyx_tuple__175 = PyTuple_Pack(9, __pyx_n_s_self, __pyx_n_s_action, __pyx_n_s_LABEL, __pyx_n_s_verbatim, __pyx_n_s_kwargs_2, __pyx_n_s_ret_3, __pyx_n_s_retlist_2, __pyx_n_s_arg, __pyx_n_s_x); if (unlikely(!__pyx_tuple__175)) __PYX_ERR(0, 982, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__175);
-  __Pyx_GIVEREF(__pyx_tuple__175);
-  __pyx_codeobj__176 = (PyObject*)__Pyx_PyCode_New(4, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__175, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_call, 982, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__176)) __PYX_ERR(0, 982, __pyx_L1_error)
-  __pyx_tuple__177 = PyTuple_Pack(2, ((PyObject*)__pyx_kp_u__32), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__177)) __PYX_ERR(0, 982, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__177);
-  __Pyx_GIVEREF(__pyx_tuple__177);
+  __pyx_tuple__183 = PyTuple_Pack(9, __pyx_n_s_self, __pyx_n_s_action, __pyx_n_s_LABEL, __pyx_n_s_verbatim, __pyx_n_s_kwargs_2, __pyx_n_s_ret_3, __pyx_n_s_retlist_2, __pyx_n_s_arg, __pyx_n_s_x); if (unlikely(!__pyx_tuple__183)) __PYX_ERR(0, 1164, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__183);
+  __Pyx_GIVEREF(__pyx_tuple__183);
+  __pyx_codeobj__184 = (PyObject*)__Pyx_PyCode_New(4, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__183, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_call, 1164, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__184)) __PYX_ERR(0, 1164, __pyx_L1_error)
+  __pyx_tuple__185 = PyTuple_Pack(2, ((PyObject*)__pyx_kp_u__35), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__185)) __PYX_ERR(0, 1164, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__185);
+  __Pyx_GIVEREF(__pyx_tuple__185);
 
-  /* "plumed.pyx":996
+  /* "plumed.pyx":1178
  *         return _format_return(self,ret)
  * 
  *     def __getattr__(self, name):             # <<<<<<<<<<<<<<
  *        if self._has_dict:
  *            class _callme:
  */
-  __pyx_tuple__178 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_name, __pyx_n_s_callme, __pyx_n_s_name_4); if (unlikely(!__pyx_tuple__178)) __PYX_ERR(0, 996, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__178);
-  __Pyx_GIVEREF(__pyx_tuple__178);
-  __pyx_codeobj__179 = (PyObject*)__Pyx_PyCode_New(2, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__178, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_getattr, 996, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__179)) __PYX_ERR(0, 996, __pyx_L1_error)
+  __pyx_tuple__186 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_name, __pyx_n_s_callme, __pyx_n_s_name_4); if (unlikely(!__pyx_tuple__186)) __PYX_ERR(0, 1178, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__186);
+  __Pyx_GIVEREF(__pyx_tuple__186);
+  __pyx_codeobj__187 = (PyObject*)__Pyx_PyCode_New(2, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__186, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_getattr, 1178, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__187)) __PYX_ERR(0, 1178, __pyx_L1_error)
 
-  /* "plumed.pyx":1027
+  /* "plumed.pyx":1209
  *            return _callme(self,name)
  * 
  *     def verbatim(self,line):             # <<<<<<<<<<<<<<
  *         """Create an arbitrary line."""
  *         return _format_return(self,re.sub("[\n\t]"," ",line))
  */
-  __pyx_tuple__180 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_line); if (unlikely(!__pyx_tuple__180)) __PYX_ERR(0, 1027, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__180);
-  __Pyx_GIVEREF(__pyx_tuple__180);
-  __pyx_codeobj__181 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__180, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_verbatim, 1027, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__181)) __PYX_ERR(0, 1027, __pyx_L1_error)
+  __pyx_tuple__188 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_line); if (unlikely(!__pyx_tuple__188)) __PYX_ERR(0, 1209, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__188);
+  __Pyx_GIVEREF(__pyx_tuple__188);
+  __pyx_codeobj__189 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__188, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_verbatim, 1209, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__189)) __PYX_ERR(0, 1209, __pyx_L1_error)
 
-  /* "plumed.pyx":1031
+  /* "plumed.pyx":1213
  *         return _format_return(self,re.sub("[\n\t]"," ",line))
  * 
  *     def numbered(self,arg):             # <<<<<<<<<<<<<<
  *         """Shortcut for numbered syntax.
  * 
  */
-  __pyx_tuple__182 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_arg); if (unlikely(!__pyx_tuple__182)) __PYX_ERR(0, 1031, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__182);
-  __Pyx_GIVEREF(__pyx_tuple__182);
-  __pyx_codeobj__183 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__182, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_numbered_3, 1031, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__183)) __PYX_ERR(0, 1031, __pyx_L1_error)
+  __pyx_tuple__190 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_arg); if (unlikely(!__pyx_tuple__190)) __PYX_ERR(0, 1213, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__190);
+  __Pyx_GIVEREF(__pyx_tuple__190);
+  __pyx_codeobj__191 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__190, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_numbered_3, 1213, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__191)) __PYX_ERR(0, 1213, __pyx_L1_error)
 
-  /* "plumed.pyx":1038
+  /* "plumed.pyx":1220
  *         return _numbered(arg)
  * 
  *     def replicas(self,arg):             # <<<<<<<<<<<<<<
  *         """Shortcut for replica syntax.
  * 
  */
-  __pyx_tuple__184 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_arg); if (unlikely(!__pyx_tuple__184)) __PYX_ERR(0, 1038, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__184);
-  __Pyx_GIVEREF(__pyx_tuple__184);
-  __pyx_codeobj__185 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__184, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_replicas_3, 1038, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__185)) __PYX_ERR(0, 1038, __pyx_L1_error)
+  __pyx_tuple__192 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_arg); if (unlikely(!__pyx_tuple__192)) __PYX_ERR(0, 1220, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__192);
+  __Pyx_GIVEREF(__pyx_tuple__192);
+  __pyx_codeobj__193 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__192, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_plumed_pyx, __pyx_n_s_replicas_3, 1220, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__193)) __PYX_ERR(0, 1220, __pyx_L1_error)
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
  */
-  __pyx_tuple__186 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct_or_indirect); if (unlikely(!__pyx_tuple__186)) __PYX_ERR(1, 287, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__186);
-  __Pyx_GIVEREF(__pyx_tuple__186);
+  __pyx_tuple__194 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct_or_indirect); if (unlikely(!__pyx_tuple__194)) __PYX_ERR(1, 287, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__194);
+  __Pyx_GIVEREF(__pyx_tuple__194);
 
   /* "View.MemoryView":288
  * 
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default             # <<<<<<<<<<<<<<
  * cdef indirect = Enum("<strided and indirect>")
  * 
  */
-  __pyx_tuple__187 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct); if (unlikely(!__pyx_tuple__187)) __PYX_ERR(1, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__187);
-  __Pyx_GIVEREF(__pyx_tuple__187);
+  __pyx_tuple__195 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct); if (unlikely(!__pyx_tuple__195)) __PYX_ERR(1, 288, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__195);
+  __Pyx_GIVEREF(__pyx_tuple__195);
 
   /* "View.MemoryView":289
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__188 = PyTuple_Pack(1, __pyx_kp_s_strided_and_indirect); if (unlikely(!__pyx_tuple__188)) __PYX_ERR(1, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__188);
-  __Pyx_GIVEREF(__pyx_tuple__188);
+  __pyx_tuple__196 = PyTuple_Pack(1, __pyx_kp_s_strided_and_indirect); if (unlikely(!__pyx_tuple__196)) __PYX_ERR(1, 289, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__196);
+  __Pyx_GIVEREF(__pyx_tuple__196);
 
   /* "View.MemoryView":292
  * 
  * 
  * cdef contiguous = Enum("<contiguous and direct>")             # <<<<<<<<<<<<<<
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")
  * 
  */
-  __pyx_tuple__189 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_direct); if (unlikely(!__pyx_tuple__189)) __PYX_ERR(1, 292, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__189);
-  __Pyx_GIVEREF(__pyx_tuple__189);
+  __pyx_tuple__197 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_direct); if (unlikely(!__pyx_tuple__197)) __PYX_ERR(1, 292, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__197);
+  __Pyx_GIVEREF(__pyx_tuple__197);
 
   /* "View.MemoryView":293
  * 
  * cdef contiguous = Enum("<contiguous and direct>")
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__190 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_indirect); if (unlikely(!__pyx_tuple__190)) __PYX_ERR(1, 293, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__190);
-  __Pyx_GIVEREF(__pyx_tuple__190);
+  __pyx_tuple__198 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_indirect); if (unlikely(!__pyx_tuple__198)) __PYX_ERR(1, 293, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__198);
+  __Pyx_GIVEREF(__pyx_tuple__198);
 
   /* "(tree fragment)":1
  * def __pyx_unpickle_Enum(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_tuple__191 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__191)) __PYX_ERR(1, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__191);
-  __Pyx_GIVEREF(__pyx_tuple__191);
-  __pyx_codeobj__192 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__191, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Enum, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__192)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __pyx_tuple__199 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__199)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__199);
+  __Pyx_GIVEREF(__pyx_tuple__199);
+  __pyx_codeobj__200 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__199, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Enum, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__200)) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_float_0_0 = PyFloat_FromDouble(0.0); if (unlikely(!__pyx_float_0_0)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_float_1_0 = PyFloat_FromDouble(1.0); if (unlikely(!__pyx_float_1_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_3 = PyInt_FromLong(3); if (unlikely(!__pyx_int_3)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_8 = PyInt_FromLong(8); if (unlikely(!__pyx_int_8)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_10 = PyInt_FromLong(10); if (unlikely(!__pyx_int_10)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_112105877 = PyInt_FromLong(112105877L); if (unlikely(!__pyx_int_112105877)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_136983863 = PyInt_FromLong(136983863L); if (unlikely(!__pyx_int_136983863)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_184977713 = PyInt_FromLong(184977713L); if (unlikely(!__pyx_int_184977713)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_neg_2 = PyInt_FromLong(-2); if (unlikely(!__pyx_int_neg_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
@@ -39900,43 +42352,45 @@
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
   /*--- Type init code ---*/
   __pyx_vtabptr_6plumed_Plumed = &__pyx_vtable_6plumed_Plumed;
+  __pyx_vtable_6plumed_Plumed.raise_exception = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, plumed_error))__pyx_f_6plumed_6Plumed_raise_exception;
+  __pyx_vtable_6plumed_Plumed.cmd_low_level = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, char const *, void const *, size_t, size_t *, size_t))__pyx_f_6plumed_6Plumed_cmd_low_level;
   __pyx_vtable_6plumed_Plumed.cmd_ndarray_double = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *))__pyx_f_6plumed_6Plumed_cmd_ndarray_double;
   __pyx_vtable_6plumed_Plumed.cmd_ndarray_int = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *))__pyx_f_6plumed_6Plumed_cmd_ndarray_int;
   __pyx_vtable_6plumed_Plumed.cmd_ndarray_long = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *))__pyx_f_6plumed_6Plumed_cmd_ndarray_long;
   __pyx_vtable_6plumed_Plumed.cmd_array_double = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *))__pyx_f_6plumed_6Plumed_cmd_array_double;
   __pyx_vtable_6plumed_Plumed.cmd_array_int = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *))__pyx_f_6plumed_6Plumed_cmd_array_int;
   __pyx_vtable_6plumed_Plumed.cmd_array_long = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *))__pyx_f_6plumed_6Plumed_cmd_array_long;
   __pyx_vtable_6plumed_Plumed.cmd_float = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, PyObject *, double))__pyx_f_6plumed_6Plumed_cmd_float;
   __pyx_vtable_6plumed_Plumed.cmd_int = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, PyObject *, int))__pyx_f_6plumed_6Plumed_cmd_int;
   __pyx_vtable_6plumed_Plumed.cmd_mpi = (PyObject *(*)(struct __pyx_obj_6plumed_Plumed *, PyObject *, PyObject *))__pyx_f_6plumed_6Plumed_cmd_mpi;
-  if (PyType_Ready(&__pyx_type_6plumed_Plumed) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6plumed_Plumed) < 0) __PYX_ERR(0, 68, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6plumed_Plumed.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6plumed_Plumed.tp_dictoffset && __pyx_type_6plumed_Plumed.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6plumed_Plumed.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_6plumed_Plumed.tp_dict, __pyx_vtabptr_6plumed_Plumed) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Plumed, (PyObject *)&__pyx_type_6plumed_Plumed) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6plumed_Plumed) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_6plumed_Plumed.tp_dict, __pyx_vtabptr_6plumed_Plumed) < 0) __PYX_ERR(0, 68, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Plumed, (PyObject *)&__pyx_type_6plumed_Plumed) < 0) __PYX_ERR(0, 68, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_6plumed_Plumed) < 0) __PYX_ERR(0, 68, __pyx_L1_error)
   __pyx_ptype_6plumed_Plumed = &__pyx_type_6plumed_Plumed;
-  if (PyType_Ready(&__pyx_type_6plumed___pyx_scope_struct___build_convert_function) < 0) __PYX_ERR(0, 198, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6plumed___pyx_scope_struct___build_convert_function) < 0) __PYX_ERR(0, 291, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6plumed___pyx_scope_struct___build_convert_function.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6plumed___pyx_scope_struct___build_convert_function.tp_dictoffset && __pyx_type_6plumed___pyx_scope_struct___build_convert_function.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6plumed___pyx_scope_struct___build_convert_function.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_6plumed___pyx_scope_struct___build_convert_function = &__pyx_type_6plumed___pyx_scope_struct___build_convert_function;
-  if (PyType_Ready(&__pyx_type_6plumed___pyx_scope_struct_1_read_as_pandas) < 0) __PYX_ERR(0, 260, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6plumed___pyx_scope_struct_1_read_as_pandas) < 0) __PYX_ERR(0, 353, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6plumed___pyx_scope_struct_1_read_as_pandas.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6plumed___pyx_scope_struct_1_read_as_pandas.tp_dictoffset && __pyx_type_6plumed___pyx_scope_struct_1_read_as_pandas.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6plumed___pyx_scope_struct_1_read_as_pandas.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_6plumed___pyx_scope_struct_1_read_as_pandas = &__pyx_type_6plumed___pyx_scope_struct_1_read_as_pandas;
@@ -40231,160 +42685,136 @@
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
   /* "plumed.pyx":31
  * cimport cplumed  # This imports information from pxd file - including contents of this file here causes name clashes
  * 
  * import array             # <<<<<<<<<<<<<<
- * import ctypes
  * import re
+ * import gzip
  */
   __pyx_t_1 = __Pyx_Import(__pyx_n_s_array, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 31, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_1) < 0) __PYX_ERR(0, 31, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "plumed.pyx":32
  * 
  * import array
- * import ctypes             # <<<<<<<<<<<<<<
- * import re
- * import gzip
- */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_ctypes, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 32, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ctypes, __pyx_t_1) < 0) __PYX_ERR(0, 32, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "plumed.pyx":33
- * import array
- * import ctypes
  * import re             # <<<<<<<<<<<<<<
  * import gzip
  * import math
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_re, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 33, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_re, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 32, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_re, __pyx_t_1) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_re, __pyx_t_1) < 0) __PYX_ERR(0, 32, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":34
- * import ctypes
+  /* "plumed.pyx":33
+ * import array
  * import re
  * import gzip             # <<<<<<<<<<<<<<
  * import math
  * import sys
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_gzip, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_gzip, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 33, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gzip, __pyx_t_1) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gzip, __pyx_t_1) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":35
+  /* "plumed.pyx":34
  * import re
  * import gzip
  * import math             # <<<<<<<<<<<<<<
  * import sys
  * import warnings
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_math, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 35, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_math, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_math, __pyx_t_1) < 0) __PYX_ERR(0, 35, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_math, __pyx_t_1) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":36
+  /* "plumed.pyx":35
  * import gzip
  * import math
  * import sys             # <<<<<<<<<<<<<<
  * import warnings
- * import re
+ * import types
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_sys, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_sys, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sys, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sys, __pyx_t_1) < 0) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":37
+  /* "plumed.pyx":36
  * import math
  * import sys
  * import warnings             # <<<<<<<<<<<<<<
- * import re
- * import types
- */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_warnings, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 37, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_warnings, __pyx_t_1) < 0) __PYX_ERR(0, 37, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "plumed.pyx":38
- * import sys
- * import warnings
- * import re             # <<<<<<<<<<<<<<
  * import types
  * 
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_re, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_warnings, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_re, __pyx_t_1) < 0) __PYX_ERR(0, 38, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_warnings, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":39
+  /* "plumed.pyx":37
+ * import sys
  * import warnings
- * import re
  * import types             # <<<<<<<<<<<<<<
  * 
- * if sys.version_info < (3,):
+ * from cython.operator import dereference
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_types, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 39, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_types, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_types, __pyx_t_1) < 0) __PYX_ERR(0, 39, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_types, __pyx_t_1) < 0) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "plumed.pyx":41
- * import types
+ * from cython.operator import dereference
  * 
  * if sys.version_info < (3,):             # <<<<<<<<<<<<<<
- *     raise ImportError("PLUMED 2.6 only supports Python 3")
+ *     raise ImportError("PLUMED >=2.6 only supports Python 3")
  * 
  */
   __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_version_info); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, __pyx_tuple__102, Py_LT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, __pyx_tuple__105, Py_LT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (unlikely(__pyx_t_3)) {
 
     /* "plumed.pyx":42
  * 
  * if sys.version_info < (3,):
- *     raise ImportError("PLUMED 2.6 only supports Python 3")             # <<<<<<<<<<<<<<
+ *     raise ImportError("PLUMED >=2.6 only supports Python 3")             # <<<<<<<<<<<<<<
  * 
  * try:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__103, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 42, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__106, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 42, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __PYX_ERR(0, 42, __pyx_L1_error)
 
     /* "plumed.pyx":41
- * import types
+ * from cython.operator import dereference
  * 
  * if sys.version_info < (3,):             # <<<<<<<<<<<<<<
- *     raise ImportError("PLUMED 2.6 only supports Python 3")
+ *     raise ImportError("PLUMED >=2.6 only supports Python 3")
  * 
  */
   }
 
   /* "plumed.pyx":44
- *     raise ImportError("PLUMED 2.6 only supports Python 3")
+ *     raise ImportError("PLUMED >=2.6 only supports Python 3")
  * 
  * try:             # <<<<<<<<<<<<<<
  *      import numpy as np
  *      HAS_NUMPY=True
  */
   {
     __Pyx_PyThreadState_declare
@@ -40413,15 +42843,15 @@
  *      HAS_NUMPY=True             # <<<<<<<<<<<<<<
  * except ImportError:
  *      HAS_NUMPY=False
  */
       if (PyDict_SetItem(__pyx_d, __pyx_n_s_HAS_NUMPY, Py_True) < 0) __PYX_ERR(0, 46, __pyx_L3_error)
 
       /* "plumed.pyx":44
- *     raise ImportError("PLUMED 2.6 only supports Python 3")
+ *     raise ImportError("PLUMED >=2.6 only supports Python 3")
  * 
  * try:             # <<<<<<<<<<<<<<
  *      import numpy as np
  *      HAS_NUMPY=True
  */
     }
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
@@ -40448,27 +42878,27 @@
       __Pyx_GOTREF(__pyx_t_8);
 
       /* "plumed.pyx":48
  *      HAS_NUMPY=True
  * except ImportError:
  *      HAS_NUMPY=False             # <<<<<<<<<<<<<<
  * 
- * cdef class Plumed:
+ * # flags used to pass type information
  */
       if (PyDict_SetItem(__pyx_d, __pyx_n_s_HAS_NUMPY, Py_False) < 0) __PYX_ERR(0, 48, __pyx_L5_except_error)
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
       goto __pyx_L4_exception_handled;
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
     /* "plumed.pyx":44
- *     raise ImportError("PLUMED 2.6 only supports Python 3")
+ *     raise ImportError("PLUMED >=2.6 only supports Python 3")
  * 
  * try:             # <<<<<<<<<<<<<<
  *      import numpy as np
  *      HAS_NUMPY=True
  */
     __Pyx_XGIVEREF(__pyx_t_4);
     __Pyx_XGIVEREF(__pyx_t_5);
@@ -40479,806 +42909,864 @@
     __Pyx_XGIVEREF(__pyx_t_4);
     __Pyx_XGIVEREF(__pyx_t_5);
     __Pyx_XGIVEREF(__pyx_t_6);
     __Pyx_ExceptionReset(__pyx_t_4, __pyx_t_5, __pyx_t_6);
     __pyx_L8_try_end:;
   }
 
-  /* "plumed.pyx":67
- *          cdef int pres = 8
- *          self.c_plumed.cmd_int( "setRealPrecision", pres)
+  /* "plumed.pyx":62
+ * DEF type_nocopy        = 0x10000000
+ * 
+ * class PlumedError(RuntimeError):             # <<<<<<<<<<<<<<
+ *   pass
+ * 
+ */
+  __pyx_t_8 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__107); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 62, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_8, __pyx_tuple__107, __pyx_n_s_PlumedError, __pyx_n_s_PlumedError, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 62, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_Py3ClassCreate(__pyx_t_8, __pyx_n_s_PlumedError, __pyx_tuple__107, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 62, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_PlumedError, __pyx_t_1) < 0) __PYX_ERR(0, 62, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+
+  /* "plumed.pyx":65
+ *   pass
+ * 
+ * class LeptonError(RuntimeError):             # <<<<<<<<<<<<<<
+ *   pass
+ * 
+ */
+  __pyx_t_8 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__108); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_8, __pyx_tuple__108, __pyx_n_s_LeptonError, __pyx_n_s_LeptonError, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_Py3ClassCreate(__pyx_t_8, __pyx_n_s_LeptonError, __pyx_tuple__108, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_LeptonError, __pyx_t_1) < 0) __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+
+  /* "plumed.pyx":100
+ *            self.cmd("setNestedExceptions",1)
+ *          self.cmd( "setRealPrecision", 8)
  *      def finalize(self):             # <<<<<<<<<<<<<<
  *          """ Explicitly finalize a Plumed object.
  * 
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_3finalize, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed_finalize, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__105)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_7finalize, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed_finalize, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__110)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6plumed_Plumed->tp_dict, __pyx_n_s_finalize, __pyx_t_8) < 0) __PYX_ERR(0, 67, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6plumed_Plumed->tp_dict, __pyx_n_s_finalize, __pyx_t_8) < 0) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   PyType_Modified(__pyx_ptype_6plumed_Plumed);
 
-  /* "plumed.pyx":85
- *          """
- *          self.c_plumed=cplumed.Plumed()
+  /* "plumed.pyx":119
+ *          cplumed.plumed_finalize(self.c_plumed)
+ *          self.c_plumed=cplumed.plumed_create_invalid()
  *      def __enter__(self):             # <<<<<<<<<<<<<<
  *          return self
  *      def __exit__(self, type, value, traceback):
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_5__enter__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed___enter, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__107)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_9__enter__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed___enter, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__112)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 119, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6plumed_Plumed->tp_dict, __pyx_n_s_enter, __pyx_t_8) < 0) __PYX_ERR(0, 85, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6plumed_Plumed->tp_dict, __pyx_n_s_enter, __pyx_t_8) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   PyType_Modified(__pyx_ptype_6plumed_Plumed);
 
-  /* "plumed.pyx":87
+  /* "plumed.pyx":121
  *      def __enter__(self):
  *          return self
  *      def __exit__(self, type, value, traceback):             # <<<<<<<<<<<<<<
  *         self.finalize()
- *      cdef cmd_ndarray_double(self, ckey, val):
+ *      cdef raise_exception(self,cplumed.plumed_error error):
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_7__exit__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed___exit, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__109)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 87, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_11__exit__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed___exit, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__114)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 121, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6plumed_Plumed->tp_dict, __pyx_n_s_exit, __pyx_t_8) < 0) __PYX_ERR(0, 87, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6plumed_Plumed->tp_dict, __pyx_n_s_exit, __pyx_t_8) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   PyType_Modified(__pyx_ptype_6plumed_Plumed);
 
-  /* "plumed.pyx":133
+  /* "plumed.pyx":225
  *          cdef size_t comm_addr = MPI._addressof(val)
- *          self.c_plumed.cmd_mpi( ckey, <const void*>comm_addr)
+ *          self.cmd_low_level(ckey,<void*>comm_addr, 0, NULL, type_void +  type_const_pointer)
  *      def cmd( self, key, val=None ):             # <<<<<<<<<<<<<<
  *          cdef bytes py_bytes = key.encode()
  *          cdef char* ckey = py_bytes
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_9cmd, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed_cmd, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__111)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 133, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_13cmd, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed_cmd, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__116)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_6plumed_Plumed->tp_dict, __pyx_n_s_cmd, __pyx_t_8) < 0) __PYX_ERR(0, 133, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_6plumed_Plumed->tp_dict, __pyx_n_s_cmd, __pyx_t_8) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   PyType_Modified(__pyx_ptype_6plumed_Plumed);
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_11__reduce_cython__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed___reduce_cython, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__113)); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_15__reduce_cython__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed___reduce_cython, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__118)); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_reduce_cython, __pyx_t_8) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_13__setstate_cython__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed___setstate_cython, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__115)); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 3, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_6Plumed_17__setstate_cython__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Plumed___setstate_cython, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__120)); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 3, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_setstate_cython, __pyx_t_8) < 0) __PYX_ERR(1, 3, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":179
+  /* "plumed.pyx":272
  *          raise ValueError("Unknown value type ({})".format(str(type(val))))
  * 
  * class FormatError(Exception):             # <<<<<<<<<<<<<<
  *     """Custom error reported by read_as_pandas.
  *     """
  */
-  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 272, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_INCREF(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
   __Pyx_GIVEREF(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
   PyTuple_SET_ITEM(__pyx_t_8, 0, ((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 272, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_8, __pyx_n_s_FormatError, __pyx_n_s_FormatError, (PyObject *) NULL, __pyx_n_s_plumed, __pyx_kp_s_Custom_error_reported_by_read_as); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_8, __pyx_n_s_FormatError, __pyx_n_s_FormatError, (PyObject *) NULL, __pyx_n_s_plumed, __pyx_kp_s_Custom_error_reported_by_read_as); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 272, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_9 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_FormatError, __pyx_t_8, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_FormatError, __pyx_t_8, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 272, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FormatError, __pyx_t_9) < 0) __PYX_ERR(0, 179, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FormatError, __pyx_t_9) < 0) __PYX_ERR(0, 272, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":184
+  /* "plumed.pyx":277
  *     pass
  * 
  * def _fix_file(file,mode):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a file open with mode.
  * 
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_1_fix_file, 0, __pyx_n_s_fix_file, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__117)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_1_fix_file, 0, __pyx_n_s_fix_file, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__122)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 277, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_fix_file, __pyx_t_8) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_fix_file, __pyx_t_8) < 0) __PYX_ERR(0, 277, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":198
+  /* "plumed.pyx":291
  *     return file
  * 
  * def _build_convert_function(kernel=None):             # <<<<<<<<<<<<<<
  *     """Internal utility: returns a function that can be used for conversions.
  * 
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_3_build_convert_function, 0, __pyx_n_s_build_convert_function, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__119)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 198, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_3_build_convert_function, 0, __pyx_n_s_build_convert_function, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__124)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 291, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__120);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_build_convert_function, __pyx_t_8) < 0) __PYX_ERR(0, 198, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__125);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_build_convert_function, __pyx_t_8) < 0) __PYX_ERR(0, 291, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":238
+  /* "plumed.pyx":331
  *         return None
  * 
  * class Constants(list):             # <<<<<<<<<<<<<<
  *    """Custom class used to store plumed constants.
  *    """
  */
-  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 238, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 331, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_INCREF(((PyObject *)(&PyList_Type)));
   __Pyx_GIVEREF(((PyObject *)(&PyList_Type)));
   PyTuple_SET_ITEM(__pyx_t_8, 0, ((PyObject *)(&PyList_Type)));
-  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 238, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CalculateMetaclass(NULL, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 331, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_8, __pyx_n_s_Constants, __pyx_n_s_Constants, (PyObject *) NULL, __pyx_n_s_plumed, __pyx_kp_s_Custom_class_used_to_store_plume); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 238, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Py3MetaclassPrepare(__pyx_t_2, __pyx_t_8, __pyx_n_s_Constants, __pyx_n_s_Constants, (PyObject *) NULL, __pyx_n_s_plumed, __pyx_kp_s_Custom_class_used_to_store_plume); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 331, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
 
-  /* "plumed.pyx":241
+  /* "plumed.pyx":334
  *    """Custom class used to store plumed constants.
  *    """
  *    def __init__(self,l,kernel=None,convert=None):             # <<<<<<<<<<<<<<
  *        if(isinstance(l,dict)):
  *            for k in l:
  */
-  __pyx_t_9 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_9Constants_1__init__, 0, __pyx_n_s_Constants___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__122)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 241, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_9Constants_1__init__, 0, __pyx_n_s_Constants___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__127)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 334, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_9, __pyx_tuple__123);
-  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_init, __pyx_t_9) < 0) __PYX_ERR(0, 241, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_9, __pyx_tuple__128);
+  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_init, __pyx_t_9) < 0) __PYX_ERR(0, 334, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-  /* "plumed.pyx":238
+  /* "plumed.pyx":331
  *         return None
  * 
  * class Constants(list):             # <<<<<<<<<<<<<<
  *    """Custom class used to store plumed constants.
  *    """
  */
-  __pyx_t_9 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_Constants, __pyx_t_8, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 238, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_Py3ClassCreate(__pyx_t_2, __pyx_n_s_Constants, __pyx_t_8, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 331, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Constants, __pyx_t_9) < 0) __PYX_ERR(0, 238, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Constants, __pyx_t_9) < 0) __PYX_ERR(0, 331, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":260
+  /* "plumed.pyx":353
  *                raise ValueError("plumed.Constants should be initialized with a list of 2- or 3-plets")
  * 
  * def read_as_pandas(file_or_path,enable_constants=True,enable_conversion=True,kernel=None,chunksize=None,usecols=None,skiprows=None,nrows=None,index_col=None):             # <<<<<<<<<<<<<<
  *     """Import a plumed data file as a pandas dataset.
  * 
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_5read_as_pandas, 0, __pyx_n_s_read_as_pandas, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__125)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 260, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_5read_as_pandas, 0, __pyx_n_s_read_as_pandas, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__130)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 353, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__126);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_read_as_pandas, __pyx_t_8) < 0) __PYX_ERR(0, 260, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__131);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_read_as_pandas, __pyx_t_8) < 0) __PYX_ERR(0, 353, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":468
+  /* "plumed.pyx":561
  *         return TextFileReader(df,enable_constants,constants,convert_all)
  * 
  * def write_pandas(df,file_or_path=None):             # <<<<<<<<<<<<<<
  *     """Save a pandas dataframe as a PLUMED file.
  * 
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_7write_pandas, 0, __pyx_n_s_write_pandas, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__128)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_7write_pandas, 0, __pyx_n_s_write_pandas, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__133)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 561, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__129);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_write_pandas, __pyx_t_8) < 0) __PYX_ERR(0, 468, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__134);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_write_pandas, __pyx_t_8) < 0) __PYX_ERR(0, 561, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":520
+  /* "plumed.pyx":613
  *         file_or_path.write("\n")
  * 
- * def _guessplumedroot(kernel=None):             # <<<<<<<<<<<<<<
- *     """Guess plumed root.
+ * def hills_time_average(hills, tofile=None, *, t0=None, t1=None, frac0=None, frac1=None, inplace=False):             # <<<<<<<<<<<<<<
+ *     """Compute a time-averaged hills file.
  * 
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_9_guessplumedroot, 0, __pyx_n_s_guessplumedroot, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__131)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 520, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__132);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_guessplumedroot, __pyx_t_8) < 0) __PYX_ERR(0, 520, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_t0, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_t1, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_frac0, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_frac1, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_inplace, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_9hills_time_average, 0, __pyx_n_s_hills_time_average, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__136)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 613, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__137);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_8);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_hills_time_average, __pyx_t_2) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":550
+  /* "plumed.pyx":702
+ *         return hills
+ * 
+ * def _guessplumedroot(kernel=None):             # <<<<<<<<<<<<<<
+ *     """Guess plumed root.
+ * 
+ */
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_11_guessplumedroot, 0, __pyx_n_s_guessplumedroot, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__139)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 702, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__140);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_guessplumedroot, __pyx_t_2) < 0) __PYX_ERR(0, 702, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "plumed.pyx":732
  *     return subprocess.check_output(["plumed","--no-mpi","info","--root"]).decode("utf-8").rstrip()
  * 
  * def _readvimdict(plumedroot=None,kernel=None):             # <<<<<<<<<<<<<<
  *     """Read VIM dictionary given the path to PLUMED root and return (dictionary,doc).
  * 
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_11_readvimdict, 0, __pyx_n_s_readvimdict, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__134)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 550, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__135);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_readvimdict, __pyx_t_8) < 0) __PYX_ERR(0, 550, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_13_readvimdict, 0, __pyx_n_s_readvimdict, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__142)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 732, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__143);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_readvimdict, __pyx_t_2) < 0) __PYX_ERR(0, 732, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":599
+  /* "plumed.pyx":781
  *     return ret,doc
  * 
  * def _create_functions(dictionary,*,doc=None,append_underscores=False):             # <<<<<<<<<<<<<<
  *     """Create functions given dictionary and, optionally, documentation.
  * 
  */
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 599, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_doc_2, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 599, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_append_underscores, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 599, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_13_create_functions, 0, __pyx_n_s_create_functions, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__137)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 599, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 781, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_8);
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_create_functions, __pyx_t_2) < 0) __PYX_ERR(0, 599, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_doc_2, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 781, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_append_underscores, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 781, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_15_create_functions, 0, __pyx_n_s_create_functions, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__145)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 781, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_8, __pyx_t_2);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_create_functions, __pyx_t_8) < 0) __PYX_ERR(0, 781, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":673
+  /* "plumed.pyx":855
  * # formatting tools
  * 
  * class _numbered():             # <<<<<<<<<<<<<<
  *     def __init__(self,*args):
  * # this is experimental:
  */
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_numbered_2, __pyx_n_s_numbered_2, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 673, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_8 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_numbered_2, __pyx_n_s_numbered_2, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 855, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
 
-  /* "plumed.pyx":674
+  /* "plumed.pyx":856
  * 
  * class _numbered():
  *     def __init__(self,*args):             # <<<<<<<<<<<<<<
  * # this is experimental:
  * # it allows calling _numbered(arg1,arg2,arg3)
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_9_numbered_1__init__, 0, __pyx_n_s_numbered___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__139)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 674, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_8) < 0) __PYX_ERR(0, 674, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_9_numbered_1__init__, 0, __pyx_n_s_numbered___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__147)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 856, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_init, __pyx_t_2) < 0) __PYX_ERR(0, 856, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":673
+  /* "plumed.pyx":855
  * # formatting tools
  * 
  * class _numbered():             # <<<<<<<<<<<<<<
  *     def __init__(self,*args):
  * # this is experimental:
  */
-  __pyx_t_8 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_numbered_2, __pyx_empty_tuple, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 673, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_numbered_2, __pyx_t_8) < 0) __PYX_ERR(0, 673, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_t_2 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_numbered_2, __pyx_empty_tuple, __pyx_t_8, NULL, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 855, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_numbered_2, __pyx_t_2) < 0) __PYX_ERR(0, 855, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":696
+  /* "plumed.pyx":878
  *                  i+=1
  * 
  * class _replicas():             # <<<<<<<<<<<<<<
  *     def __init__(self,*args):
  * # this is experimental:
  */
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_replicas_2, __pyx_n_s_replicas_2, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 696, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_8 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_replicas_2, __pyx_n_s_replicas_2, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 878, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
 
-  /* "plumed.pyx":697
+  /* "plumed.pyx":879
  * 
  * class _replicas():
  *     def __init__(self,*args):             # <<<<<<<<<<<<<<
  * # this is experimental:
  * # it allows calling _replicas(arg1,arg2,arg3)
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_9_replicas_1__init__, 0, __pyx_n_s_replicas___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__141)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 697, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_8) < 0) __PYX_ERR(0, 697, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_9_replicas_1__init__, 0, __pyx_n_s_replicas___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__149)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 879, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_init, __pyx_t_2) < 0) __PYX_ERR(0, 879, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":696
+  /* "plumed.pyx":878
  *                  i+=1
  * 
  * class _replicas():             # <<<<<<<<<<<<<<
  *     def __init__(self,*args):
  * # this is experimental:
  */
-  __pyx_t_8 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_replicas_2, __pyx_empty_tuple, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 696, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_replicas_2, __pyx_t_8) < 0) __PYX_ERR(0, 696, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_t_2 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_replicas_2, __pyx_empty_tuple, __pyx_t_8, NULL, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 878, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_replicas_2, __pyx_t_2) < 0) __PYX_ERR(0, 878, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":711
+  /* "plumed.pyx":893
  * ## tool to format at strings (optional)
  * 
  * def _format_at_one_residue(builder,name,residue,chain):             # <<<<<<<<<<<<<<
  *       if isinstance(chain,int):
  *         chain=str(chain)
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_15_format_at_one_residue, 0, __pyx_n_s_format_at_one_residue, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__143)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 711, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_at_one_residue, __pyx_t_2) < 0) __PYX_ERR(0, 711, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_17_format_at_one_residue, 0, __pyx_n_s_format_at_one_residue, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__151)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 893, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_at_one_residue, __pyx_t_8) < 0) __PYX_ERR(0, 893, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":725
+  /* "plumed.pyx":907
  *         assert False
  * 
  * def _format_at_one_chain(builder,name,residue,chain):             # <<<<<<<<<<<<<<
  *       res=""
  *       if hasattr(residue,'__iter__') and not isinstance(residue,str):
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_17_format_at_one_chain, 0, __pyx_n_s_format_at_one_chain, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__145)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 725, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_at_one_chain, __pyx_t_2) < 0) __PYX_ERR(0, 725, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_19_format_at_one_chain, 0, __pyx_n_s_format_at_one_chain, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__153)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 907, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_at_one_chain, __pyx_t_8) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":735
+  /* "plumed.pyx":917
  *       return res
  * 
  * def _format_at(builder,name,residue,chain=""):             # <<<<<<<<<<<<<<
  *       res=""
  *       if hasattr(chain,'__iter__') and not isinstance(chain,str):
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_19_format_at, 0, __pyx_n_s_format_at, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__147)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 735, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__148);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_at, __pyx_t_2) < 0) __PYX_ERR(0, 735, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_21_format_at, 0, __pyx_n_s_format_at, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__155)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__156);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_at, __pyx_t_8) < 0) __PYX_ERR(0, 917, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":744
+  /* "plumed.pyx":926
  *       return res[len(builder._separator):]
  * 
  * class _at():             # <<<<<<<<<<<<<<
  *     def __init__(self,builder):
  *       import weakref
  */
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_at, __pyx_n_s_at, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 744, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_8 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_at, __pyx_n_s_at, (PyObject *) NULL, __pyx_n_s_plumed, (PyObject *) NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 926, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
 
-  /* "plumed.pyx":745
+  /* "plumed.pyx":927
  * 
  * class _at():
  *     def __init__(self,builder):             # <<<<<<<<<<<<<<
  *       import weakref
  *       self._builder=weakref.ref(builder)
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_3_at_1__init__, 0, __pyx_n_s_at___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__150)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 745, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_8) < 0) __PYX_ERR(0, 745, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_3_at_1__init__, 0, __pyx_n_s_at___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__158)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 927, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_init, __pyx_t_2) < 0) __PYX_ERR(0, 927, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":756
+  /* "plumed.pyx":938
  *             exec("def " + x + "(self,residue,chain=\"\"):\n          return _format_at(self._builder(),\"" + x + "\",residue,chain)\n",{"_format_at":_format_at},ldict)
  *             exec("self." + x + " = types.MethodType( ldict['" + x + "'],self)",None,{"self":self, "types":types, "ldict":ldict})
  *     def __call__(self,name,residue,chain=""):             # <<<<<<<<<<<<<<
  *        return _format_at(self._builder(),name,residue,chain)
  * 
  */
-  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_3_at_3__call__, 0, __pyx_n_s_at___call, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__152)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 756, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__153);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_call, __pyx_t_8) < 0) __PYX_ERR(0, 756, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_3_at_3__call__, 0, __pyx_n_s_at___call, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__160)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 938, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__161);
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_call, __pyx_t_2) < 0) __PYX_ERR(0, 938, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":744
+  /* "plumed.pyx":926
  *       return res[len(builder._separator):]
  * 
  * class _at():             # <<<<<<<<<<<<<<
  *     def __init__(self,builder):
  *       import weakref
  */
-  __pyx_t_8 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_at, __pyx_empty_tuple, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 744, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_at, __pyx_t_8) < 0) __PYX_ERR(0, 744, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __pyx_t_2 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_at, __pyx_empty_tuple, __pyx_t_8, NULL, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 926, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_at, __pyx_t_2) < 0) __PYX_ERR(0, 926, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":761
+  /* "plumed.pyx":943
  * ## end of tool to format at strings
  * 
  * def _fix_braces(builder,arg,comma):             # <<<<<<<<<<<<<<
  *     """ Fix braces.
  * 
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_21_fix_braces, 0, __pyx_n_s_fix_braces, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__155)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 761, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_fix_braces, __pyx_t_2) < 0) __PYX_ERR(0, 761, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_23_fix_braces, 0, __pyx_n_s_fix_braces, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__163)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 943, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_fix_braces, __pyx_t_8) < 0) __PYX_ERR(0, 943, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":782
+  /* "plumed.pyx":964
  *     return arg
  * 
  * def _format_single(builder,arg,level=0):             # <<<<<<<<<<<<<<
  *     """Format a single argument.
  * 
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_23_format_single, 0, __pyx_n_s_format_single, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__157)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 782, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__158);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_single, __pyx_t_2) < 0) __PYX_ERR(0, 782, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_25_format_single, 0, __pyx_n_s_format_single, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__165)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 964, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_8, __pyx_tuple__166);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_single, __pyx_t_8) < 0) __PYX_ERR(0, 964, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":813
+  /* "plumed.pyx":995
  *     raise TypeError("options should be string, number or iterable")
  * 
  * def _format_numbered(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format a numbered argument."""
  *     if isinstance(arg,_numbered):
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_25_format_numbered, 0, __pyx_n_s_format_numbered, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__160)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 813, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_numbered, __pyx_t_2) < 0) __PYX_ERR(0, 813, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_27_format_numbered, 0, __pyx_n_s_format_numbered, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__168)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 995, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_numbered, __pyx_t_8) < 0) __PYX_ERR(0, 995, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":825
+  /* "plumed.pyx":1007
  *     return _format_opt(builder,name,arg)
  * 
  * def _format_flag(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format a flag."""
  *     if arg is None:
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_27_format_flag, 0, __pyx_n_s_format_flag, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__162)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 825, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_flag, __pyx_t_2) < 0) __PYX_ERR(0, 825, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_29_format_flag, 0, __pyx_n_s_format_flag, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__170)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1007, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_flag, __pyx_t_8) < 0) __PYX_ERR(0, 1007, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":836
+  /* "plumed.pyx":1018
  *     raise TypeError(name + " should be of bool type")
  * 
  * def _format_label(builder,label):             # <<<<<<<<<<<<<<
  *     """Format a label."""
  *     if label is None:
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_29_format_label, 0, __pyx_n_s_format_label, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__164)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 836, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_label, __pyx_t_2) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_31_format_label, 0, __pyx_n_s_format_label, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__172)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_label, __pyx_t_8) < 0) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":846
+  /* "plumed.pyx":1028
  *     raise TypeError("label should be of str type")
  * 
  * def _format_opt(builder,name,arg):             # <<<<<<<<<<<<<<
  *     """Format an option."""
  *     if arg is None:
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_31_format_opt, 0, __pyx_n_s_format_opt, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__166)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 846, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_opt, __pyx_t_2) < 0) __PYX_ERR(0, 846, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_33_format_opt, 0, __pyx_n_s_format_opt, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__174)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1028, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_opt, __pyx_t_8) < 0) __PYX_ERR(0, 1028, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":856
+  /* "plumed.pyx":1038
  *     return " " + name + "=" + string
  * 
  * def _format_return(builder,ret):             # <<<<<<<<<<<<<<
  *     """Format the return statement"""
  *     if not builder._toplumed is None :
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_33_format_return, 0, __pyx_n_s_format_return, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__168)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 856, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_return, __pyx_t_2) < 0) __PYX_ERR(0, 856, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_35_format_return, 0, __pyx_n_s_format_return, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__176)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1038, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_return, __pyx_t_8) < 0) __PYX_ERR(0, 1038, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":871
+  /* "plumed.pyx":1053
  *     return ret + "\n"
  * 
  * def _format_verbatim(builder,verbatim):             # <<<<<<<<<<<<<<
  *   if not verbatim is None:
  *     if(len(verbatim)>0):
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_35_format_verbatim, 0, __pyx_n_s_format_verbatim, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__170)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 871, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_verbatim, __pyx_t_2) < 0) __PYX_ERR(0, 871, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_37_format_verbatim, 0, __pyx_n_s_format_verbatim, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__178)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1053, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_verbatim, __pyx_t_8) < 0) __PYX_ERR(0, 1053, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":877
+  /* "plumed.pyx":1059
  *   return ""
  * 
  * def _format_anything(builder,name,arg):             # <<<<<<<<<<<<<<
  *    """Choose format based on arg type"""
  *    ret=""
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_37_format_anything, 0, __pyx_n_s_format_anything, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__172)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 877, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_anything, __pyx_t_2) < 0) __PYX_ERR(0, 877, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_39_format_anything, 0, __pyx_n_s_format_anything, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__180)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1059, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_anything, __pyx_t_8) < 0) __PYX_ERR(0, 1059, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":892
+  /* "plumed.pyx":1074
  * # this functions are made available for the exec commands
  * _format_tools={
  *     "_format_numbered":_format_numbered,             # <<<<<<<<<<<<<<
  *     "_format_flag":_format_flag,
  *     "_format_label":_format_label,
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 892, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_numbered); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 892, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1074, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_format_numbered, __pyx_t_8) < 0) __PYX_ERR(0, 892, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_numbered); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1074, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_u_format_numbered, __pyx_t_2) < 0) __PYX_ERR(0, 1074, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":893
+  /* "plumed.pyx":1075
  * _format_tools={
  *     "_format_numbered":_format_numbered,
  *     "_format_flag":_format_flag,             # <<<<<<<<<<<<<<
  *     "_format_label":_format_label,
  *     "_format_opt":_format_opt,
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_flag); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 893, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_format_flag, __pyx_t_8) < 0) __PYX_ERR(0, 892, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_flag); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1075, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_u_format_flag, __pyx_t_2) < 0) __PYX_ERR(0, 1074, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":894
+  /* "plumed.pyx":1076
  *     "_format_numbered":_format_numbered,
  *     "_format_flag":_format_flag,
  *     "_format_label":_format_label,             # <<<<<<<<<<<<<<
  *     "_format_opt":_format_opt,
  *     "_format_return":_format_return,
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_format_label, __pyx_t_8) < 0) __PYX_ERR(0, 892, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_label); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1076, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_u_format_label, __pyx_t_2) < 0) __PYX_ERR(0, 1074, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":895
+  /* "plumed.pyx":1077
  *     "_format_flag":_format_flag,
  *     "_format_label":_format_label,
  *     "_format_opt":_format_opt,             # <<<<<<<<<<<<<<
  *     "_format_return":_format_return,
  *     "_format_verbatim":_format_verbatim,
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_opt); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 895, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_format_opt, __pyx_t_8) < 0) __PYX_ERR(0, 892, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_opt); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1077, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_u_format_opt, __pyx_t_2) < 0) __PYX_ERR(0, 1074, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":896
+  /* "plumed.pyx":1078
  *     "_format_label":_format_label,
  *     "_format_opt":_format_opt,
  *     "_format_return":_format_return,             # <<<<<<<<<<<<<<
  *     "_format_verbatim":_format_verbatim,
  *     "_format_anything":_format_anything,
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_return); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 896, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_format_return, __pyx_t_8) < 0) __PYX_ERR(0, 892, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_return); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1078, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_u_format_return, __pyx_t_2) < 0) __PYX_ERR(0, 1074, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":897
+  /* "plumed.pyx":1079
  *     "_format_opt":_format_opt,
  *     "_format_return":_format_return,
  *     "_format_verbatim":_format_verbatim,             # <<<<<<<<<<<<<<
  *     "_format_anything":_format_anything,
  * }
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_verbatim); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_format_verbatim, __pyx_t_8) < 0) __PYX_ERR(0, 892, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_verbatim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1079, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_u_format_verbatim, __pyx_t_2) < 0) __PYX_ERR(0, 1074, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "plumed.pyx":898
+  /* "plumed.pyx":1080
  *     "_format_return":_format_return,
  *     "_format_verbatim":_format_verbatim,
  *     "_format_anything":_format_anything,             # <<<<<<<<<<<<<<
  * }
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_format_anything); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 898, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_format_anything, __pyx_t_8) < 0) __PYX_ERR(0, 892, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_tools, __pyx_t_2) < 0) __PYX_ERR(0, 891, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_format_anything); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1080, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_u_format_anything, __pyx_t_2) < 0) __PYX_ERR(0, 1074, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_tools, __pyx_t_8) < 0) __PYX_ERR(0, 1073, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "plumed.pyx":901
+  /* "plumed.pyx":1083
  * }
  * 
  * class InputBuilder:             # <<<<<<<<<<<<<<
  *     """Object used to construct plumed input files.
  * 
  */
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_InputBuilder, __pyx_n_s_InputBuilder, (PyObject *) NULL, __pyx_n_s_plumed, __pyx_kp_s_Object_used_to_construct_plumed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 901, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_8 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_InputBuilder, __pyx_n_s_InputBuilder, (PyObject *) NULL, __pyx_n_s_plumed, __pyx_kp_s_Object_used_to_construct_plumed); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1083, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
 
-  /* "plumed.pyx":907
+  /* "plumed.pyx":1089
  *        Check the constructor to see all the available options.
  *     """
  *     def __init__(self,             # <<<<<<<<<<<<<<
  *                  *,
  *                  tofile=None,
  */
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 907, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_tofile_2, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_toplumed_2, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_kernel, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_append_underscores, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_comma_separator, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_minimize_braces_2, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_enable_at, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_load_dict, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_enable_mda_groups_2, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_post_format_2, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_pre_format_2, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_1__init__, 0, __pyx_n_s_InputBuilder___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__174)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1089, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_tofile, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_toplumed_2, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_kernel, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_append_underscores, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_comma_separator, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_minimize_braces_2, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_enable_at, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_load_dict, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_enable_mda_groups_2, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_post_format_2, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_pre_format_2, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_1__init__, 0, __pyx_n_s_InputBuilder___init, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__182)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1089, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_1, __pyx_t_8);
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_1) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_1, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_init, __pyx_t_1) < 0) __PYX_ERR(0, 1089, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":982
+  /* "plumed.pyx":1164
  *             self.at=_at(self)
  * 
  *     def __call__(self,action,LABEL="",verbatim=None,**kwargs):             # <<<<<<<<<<<<<<
  *         ret=""
  *         ret+=_format_label(self,LABEL)
  */
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_3__call__, 0, __pyx_n_s_InputBuilder___call, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__176)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 982, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_3__call__, 0, __pyx_n_s_InputBuilder___call, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__184)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1164, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_tuple__177);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_call, __pyx_t_1) < 0) __PYX_ERR(0, 982, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_tuple__185);
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_call, __pyx_t_1) < 0) __PYX_ERR(0, 1164, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":996
+  /* "plumed.pyx":1178
  *         return _format_return(self,ret)
  * 
  *     def __getattr__(self, name):             # <<<<<<<<<<<<<<
  *        if self._has_dict:
  *            class _callme:
  */
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_5__getattr__, 0, __pyx_n_s_InputBuilder___getattr, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__179)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 996, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_5__getattr__, 0, __pyx_n_s_InputBuilder___getattr, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__187)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_getattr, __pyx_t_1) < 0) __PYX_ERR(0, 996, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_getattr, __pyx_t_1) < 0) __PYX_ERR(0, 1178, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":1027
+  /* "plumed.pyx":1209
  *            return _callme(self,name)
  * 
  *     def verbatim(self,line):             # <<<<<<<<<<<<<<
  *         """Create an arbitrary line."""
  *         return _format_return(self,re.sub("[\n\t]"," ",line))
  */
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_7verbatim, 0, __pyx_n_s_InputBuilder_verbatim, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__181)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1027, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_7verbatim, 0, __pyx_n_s_InputBuilder_verbatim, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__189)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1209, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_verbatim, __pyx_t_1) < 0) __PYX_ERR(0, 1027, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_verbatim, __pyx_t_1) < 0) __PYX_ERR(0, 1209, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":1031
+  /* "plumed.pyx":1213
  *         return _format_return(self,re.sub("[\n\t]"," ",line))
  * 
  *     def numbered(self,arg):             # <<<<<<<<<<<<<<
  *         """Shortcut for numbered syntax.
  * 
  */
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_9numbered, 0, __pyx_n_s_InputBuilder_numbered, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__183)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1031, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_9numbered, 0, __pyx_n_s_InputBuilder_numbered, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__191)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1213, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_numbered_3, __pyx_t_1) < 0) __PYX_ERR(0, 1031, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_numbered_3, __pyx_t_1) < 0) __PYX_ERR(0, 1213, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":1038
+  /* "plumed.pyx":1220
  *         return _numbered(arg)
  * 
  *     def replicas(self,arg):             # <<<<<<<<<<<<<<
  *         """Shortcut for replica syntax.
  * 
  */
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11replicas, 0, __pyx_n_s_InputBuilder_replicas, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__185)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1038, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6plumed_12InputBuilder_11replicas, 0, __pyx_n_s_InputBuilder_replicas, NULL, __pyx_n_s_plumed, __pyx_d, ((PyObject *)__pyx_codeobj__193)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_replicas_3, __pyx_t_1) < 0) __PYX_ERR(0, 1038, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_8, __pyx_n_s_replicas_3, __pyx_t_1) < 0) __PYX_ERR(0, 1220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "plumed.pyx":901
+  /* "plumed.pyx":1083
  * }
  * 
  * class InputBuilder:             # <<<<<<<<<<<<<<
  *     """Object used to construct plumed input files.
  * 
  */
-  __pyx_t_1 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_InputBuilder, __pyx_empty_tuple, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 901, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_InputBuilder, __pyx_empty_tuple, __pyx_t_8, NULL, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1083, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_InputBuilder, __pyx_t_1) < 0) __PYX_ERR(0, 901, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_InputBuilder, __pyx_t_1) < 0) __PYX_ERR(0, 1083, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
   /* "plumed.pyx":1
  * #/[inserted by cython to avoid comment start]* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++             # <<<<<<<<<<<<<<
  * #   Copyright (c) 2011-2016 The plumed team
  * #   (see the PEOPLE file at the root of the distribution for a list of names)
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_8) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
   /* "View.MemoryView":210
  *         info.obj = self
  * 
  *     __pyx_getbuffer = capsule(<void *> &__pyx_array_getbuffer, "getbuffer(obj, view, flags)")             # <<<<<<<<<<<<<<
  * 
  *     def __dealloc__(array self):
  */
-  __pyx_t_2 = __pyx_capsule_create(((void *)(&__pyx_array_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 210, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem((PyObject *)__pyx_array_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_2) < 0) __PYX_ERR(1, 210, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __pyx_capsule_create(((void *)(&__pyx_array_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 210, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem((PyObject *)__pyx_array_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_8) < 0) __PYX_ERR(1, 210, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   PyType_Modified(__pyx_array_type);
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__186, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 287, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_8 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__194, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 287, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
   __Pyx_XGOTREF(generic);
-  __Pyx_DECREF_SET(generic, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(generic, __pyx_t_8);
+  __Pyx_GIVEREF(__pyx_t_8);
+  __pyx_t_8 = 0;
 
   /* "View.MemoryView":288
  * 
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default             # <<<<<<<<<<<<<<
  * cdef indirect = Enum("<strided and indirect>")
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__187, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_8 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__195, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 288, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
   __Pyx_XGOTREF(strided);
-  __Pyx_DECREF_SET(strided, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(strided, __pyx_t_8);
+  __Pyx_GIVEREF(__pyx_t_8);
+  __pyx_t_8 = 0;
 
   /* "View.MemoryView":289
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__188, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_8 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__196, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 289, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
   __Pyx_XGOTREF(indirect);
-  __Pyx_DECREF_SET(indirect, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(indirect, __pyx_t_8);
+  __Pyx_GIVEREF(__pyx_t_8);
+  __pyx_t_8 = 0;
 
   /* "View.MemoryView":292
  * 
  * 
  * cdef contiguous = Enum("<contiguous and direct>")             # <<<<<<<<<<<<<<
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__189, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 292, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_8 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__197, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 292, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
   __Pyx_XGOTREF(contiguous);
-  __Pyx_DECREF_SET(contiguous, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(contiguous, __pyx_t_8);
+  __Pyx_GIVEREF(__pyx_t_8);
+  __pyx_t_8 = 0;
 
   /* "View.MemoryView":293
  * 
  * cdef contiguous = Enum("<contiguous and direct>")
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__190, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 293, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_8 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__198, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 293, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
   __Pyx_XGOTREF(indirect_contiguous);
-  __Pyx_DECREF_SET(indirect_contiguous, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(indirect_contiguous, __pyx_t_8);
+  __Pyx_GIVEREF(__pyx_t_8);
+  __pyx_t_8 = 0;
 
   /* "View.MemoryView":317
  * 
  * DEF THREAD_LOCKS_PREALLOCATED = 8
  * cdef int __pyx_memoryview_thread_locks_used = 0             # <<<<<<<<<<<<<<
  * cdef PyThread_type_lock[THREAD_LOCKS_PREALLOCATED] __pyx_memoryview_thread_locks = [
  *     PyThread_allocate_lock(),
@@ -41305,42 +43793,42 @@
   /* "View.MemoryView":551
  *         info.obj = self
  * 
  *     __pyx_getbuffer = capsule(<void *> &__pyx_memoryview_getbuffer, "getbuffer(obj, view, flags)")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __pyx_capsule_create(((void *)(&__pyx_memoryview_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 551, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem((PyObject *)__pyx_memoryview_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_2) < 0) __PYX_ERR(1, 551, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __pyx_capsule_create(((void *)(&__pyx_memoryview_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 551, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem((PyObject *)__pyx_memoryview_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_8) < 0) __PYX_ERR(1, 551, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   PyType_Modified(__pyx_memoryview_type);
 
   /* "View.MemoryView":997
  *         return self.from_object
  * 
  *     __pyx_getbuffer = capsule(<void *> &__pyx_memoryview_getbuffer, "getbuffer(obj, view, flags)")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __pyx_capsule_create(((void *)(&__pyx_memoryview_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 997, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem((PyObject *)__pyx_memoryviewslice_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_2) < 0) __PYX_ERR(1, 997, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __pyx_capsule_create(((void *)(&__pyx_memoryview_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 997, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem((PyObject *)__pyx_memoryviewslice_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_8) < 0) __PYX_ERR(1, 997, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   PyType_Modified(__pyx_memoryviewslice_type);
 
   /* "(tree fragment)":1
  * def __pyx_unpickle_Enum(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_15View_dot_MemoryView_1__pyx_unpickle_Enum, NULL, __pyx_n_s_View_MemoryView); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Enum, __pyx_t_2) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = PyCFunction_NewEx(&__pyx_mdef_15View_dot_MemoryView_1__pyx_unpickle_Enum, NULL, __pyx_n_s_View_MemoryView); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Enum, __pyx_t_8) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
   /* "(tree fragment)":11
  *         __pyx_unpickle_Enum__set_state(<Enum> __pyx_result, __pyx_state)
  *     return __pyx_result
  * cdef __pyx_unpickle_Enum__set_state(Enum __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
  *     __pyx_result.name = __pyx_state[0]
  *     if len(__pyx_state) > 1 and hasattr(__pyx_result, '__dict__'):
@@ -41415,14 +43903,80 @@
 #else
             "name '%.200s' is not defined", PyString_AS_STRING(name));
 #endif
     }
     return result;
 }
 
+/* RaiseArgTupleInvalid */
+static void __Pyx_RaiseArgtupleInvalid(
+    const char* func_name,
+    int exact,
+    Py_ssize_t num_min,
+    Py_ssize_t num_max,
+    Py_ssize_t num_found)
+{
+    Py_ssize_t num_expected;
+    const char *more_or_less;
+    if (num_found < num_min) {
+        num_expected = num_min;
+        more_or_less = "at least";
+    } else {
+        num_expected = num_max;
+        more_or_less = "at most";
+    }
+    if (exact) {
+        more_or_less = "exactly";
+    }
+    PyErr_Format(PyExc_TypeError,
+                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
+                 func_name, more_or_less, num_expected,
+                 (num_expected == 1) ? "" : "s", num_found);
+}
+
+/* KeywordStringCheck */
+static int __Pyx_CheckKeywordStrings(
+    PyObject *kwdict,
+    const char* function_name,
+    int kw_allowed)
+{
+    PyObject* key = 0;
+    Py_ssize_t pos = 0;
+#if CYTHON_COMPILING_IN_PYPY
+    if (!kw_allowed && PyDict_Next(kwdict, &pos, &key, 0))
+        goto invalid_keyword;
+    return 1;
+#else
+    while (PyDict_Next(kwdict, &pos, &key, 0)) {
+        #if PY_MAJOR_VERSION < 3
+        if (unlikely(!PyString_Check(key)))
+        #endif
+            if (unlikely(!PyUnicode_Check(key)))
+                goto invalid_keyword_type;
+    }
+    if ((!kw_allowed) && unlikely(key))
+        goto invalid_keyword;
+    return 1;
+invalid_keyword_type:
+    PyErr_Format(PyExc_TypeError,
+        "%.200s() keywords must be strings", function_name);
+    return 0;
+#endif
+invalid_keyword:
+    PyErr_Format(PyExc_TypeError,
+    #if PY_MAJOR_VERSION < 3
+        "%.200s() got an unexpected keyword argument '%.200s'",
+        function_name, PyString_AsString(key));
+    #else
+        "%s() got an unexpected keyword argument '%U'",
+        function_name, key);
+    #endif
+    return 0;
+}
+
 /* RaiseDoubleKeywords */
 static void __Pyx_RaiseDoubleKeywordsError(
     const char* func_name,
     PyObject* kw_name)
 {
     PyErr_Format(PyExc_TypeError,
         #if PY_MAJOR_VERSION >= 3
@@ -41531,40 +44085,14 @@
         "%s() got an unexpected keyword argument '%U'",
         function_name, key);
     #endif
 bad:
     return -1;
 }
 
-/* RaiseArgTupleInvalid */
-static void __Pyx_RaiseArgtupleInvalid(
-    const char* func_name,
-    int exact,
-    Py_ssize_t num_min,
-    Py_ssize_t num_max,
-    Py_ssize_t num_found)
-{
-    Py_ssize_t num_expected;
-    const char *more_or_less;
-    if (num_found < num_min) {
-        num_expected = num_min;
-        more_or_less = "at least";
-    } else {
-        num_expected = num_max;
-        more_or_less = "at most";
-    }
-    if (exact) {
-        more_or_less = "exactly";
-    }
-    PyErr_Format(PyExc_TypeError,
-                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
-                 func_name, more_or_less, num_expected,
-                 (num_expected == 1) ? "" : "s", num_found);
-}
-
 /* PyObjectCall */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
     PyObject *result;
     ternaryfunc call = Py_TYPE(func)->tp_call;
     if (unlikely(!call))
         return PyObject_Call(func, arg, kw);
@@ -41738,28 +44266,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -41984,14 +44512,75 @@
     if (unlikely(!args)) return NULL;
     result = __Pyx_PyObject_Call(func, args, NULL);
     Py_DECREF(args);
     return result;
 }
 #endif
 
+/* PyDictVersioning */
+#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
+}
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
+    PyObject **dictptr = NULL;
+    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
+    if (offset) {
+#if CYTHON_COMPILING_IN_CPYTHON
+        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
+#else
+        dictptr = _PyObject_GetDictPtr(obj);
+#endif
+    }
+    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
+}
+static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
+        return 0;
+    return obj_dict_version == __Pyx_get_object_dict_version(obj);
+}
+#endif
+
+/* GetModuleGlobalName */
+#if CYTHON_USE_DICT_VERSIONS
+static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
+#else
+static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
+#endif
+{
+    PyObject *result;
+#if !CYTHON_AVOID_BORROWED_REFS
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
+    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    } else if (unlikely(PyErr_Occurred())) {
+        return NULL;
+    }
+#else
+    result = PyDict_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+#endif
+#else
+    result = PyObject_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+    PyErr_Clear();
+#endif
+    return __Pyx_GetBuiltinName(name);
+}
+
 /* GetItemInt */
 static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
     PyObject *r;
     if (!j) return NULL;
     r = PyObject_GetItem(o, j);
     Py_DECREF(j);
     return r;
@@ -42071,14 +44660,271 @@
     if (is_list || PySequence_Check(o)) {
         return PySequence_GetItem(o, i);
     }
 #endif
     return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
 }
 
+/* GetTopmostException */
+#if CYTHON_USE_EXC_INFO_STACK
+static _PyErr_StackItem *
+__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
+{
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
+           exc_info->previous_item != NULL)
+    {
+        exc_info = exc_info->previous_item;
+    }
+    return exc_info;
+}
+#endif
+
+/* SaveResetException */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
+    *type = exc_info->exc_type;
+    *value = exc_info->exc_value;
+    *tb = exc_info->exc_traceback;
+    #else
+    *type = tstate->exc_type;
+    *value = tstate->exc_value;
+    *tb = tstate->exc_traceback;
+    #endif
+    Py_XINCREF(*type);
+    Py_XINCREF(*value);
+    Py_XINCREF(*tb);
+}
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    tmp_type = exc_info->exc_type;
+    tmp_value = exc_info->exc_value;
+    tmp_tb = exc_info->exc_traceback;
+    exc_info->exc_type = type;
+    exc_info->exc_value = value;
+    exc_info->exc_traceback = tb;
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = type;
+    tstate->exc_value = value;
+    tstate->exc_traceback = tb;
+    #endif
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+}
+#endif
+
+/* PyErrExceptionMatches */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
+    Py_ssize_t i, n;
+    n = PyTuple_GET_SIZE(tuple);
+#if PY_MAJOR_VERSION >= 3
+    for (i=0; i<n; i++) {
+        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
+    }
+#endif
+    for (i=0; i<n; i++) {
+        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    }
+    return 0;
+}
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
+    PyObject *exc_type = tstate->curexc_type;
+    if (exc_type == err) return 1;
+    if (unlikely(!exc_type)) return 0;
+    if (unlikely(PyTuple_Check(err)))
+        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
+    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
+}
+#endif
+
+/* GetException */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
+#endif
+{
+    PyObject *local_type, *local_value, *local_tb;
+#if CYTHON_FAST_THREAD_STATE
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    local_type = tstate->curexc_type;
+    local_value = tstate->curexc_value;
+    local_tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+#else
+    PyErr_Fetch(&local_type, &local_value, &local_tb);
+#endif
+    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
+#if CYTHON_FAST_THREAD_STATE
+    if (unlikely(tstate->curexc_type))
+#else
+    if (unlikely(PyErr_Occurred()))
+#endif
+        goto bad;
+    #if PY_MAJOR_VERSION >= 3
+    if (local_tb) {
+        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
+            goto bad;
+    }
+    #endif
+    Py_XINCREF(local_tb);
+    Py_XINCREF(local_type);
+    Py_XINCREF(local_value);
+    *type = local_type;
+    *value = local_value;
+    *tb = local_tb;
+#if CYTHON_FAST_THREAD_STATE
+    #if CYTHON_USE_EXC_INFO_STACK
+    {
+        _PyErr_StackItem *exc_info = tstate->exc_info;
+        tmp_type = exc_info->exc_type;
+        tmp_value = exc_info->exc_value;
+        tmp_tb = exc_info->exc_traceback;
+        exc_info->exc_type = local_type;
+        exc_info->exc_value = local_value;
+        exc_info->exc_traceback = local_tb;
+    }
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = local_type;
+    tstate->exc_value = local_value;
+    tstate->exc_traceback = local_tb;
+    #endif
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+#else
+    PyErr_SetExcInfo(local_type, local_value, local_tb);
+#endif
+    return 0;
+bad:
+    *type = 0;
+    *value = 0;
+    *tb = 0;
+    Py_XDECREF(local_type);
+    Py_XDECREF(local_value);
+    Py_XDECREF(local_tb);
+    return -1;
+}
+
+/* decode_c_string */
+static CYTHON_INLINE PyObject* __Pyx_decode_c_string(
+         const char* cstring, Py_ssize_t start, Py_ssize_t stop,
+         const char* encoding, const char* errors,
+         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors)) {
+    Py_ssize_t length;
+    if (unlikely((start < 0) | (stop < 0))) {
+        size_t slen = strlen(cstring);
+        if (unlikely(slen > (size_t) PY_SSIZE_T_MAX)) {
+            PyErr_SetString(PyExc_OverflowError,
+                            "c-string too long to convert to Python");
+            return NULL;
+        }
+        length = (Py_ssize_t) slen;
+        if (start < 0) {
+            start += length;
+            if (start < 0)
+                start = 0;
+        }
+        if (stop < 0)
+            stop += length;
+    }
+    if (unlikely(stop <= start))
+        return __Pyx_NewRef(__pyx_empty_unicode);
+    length = stop - start;
+    cstring += start;
+    if (decode_func) {
+        return decode_func(cstring, length, errors);
+    } else {
+        return PyUnicode_Decode(cstring, length, encoding, errors);
+    }
+}
+
+/* None */
+static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname) {
+    PyErr_Format(PyExc_UnboundLocalError, "local variable '%s' referenced before assignment", varname);
+}
+
+/* PyObjectCall2Args */
+static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
+    PyObject *args, *result = NULL;
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(function)) {
+        PyObject *args[2] = {arg1, arg2};
+        return __Pyx_PyFunction_FastCall(function, args, 2);
+    }
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(function)) {
+        PyObject *args[2] = {arg1, arg2};
+        return __Pyx_PyCFunction_FastCall(function, args, 2);
+    }
+    #endif
+    args = PyTuple_New(2);
+    if (unlikely(!args)) goto done;
+    Py_INCREF(arg1);
+    PyTuple_SET_ITEM(args, 0, arg1);
+    Py_INCREF(arg2);
+    PyTuple_SET_ITEM(args, 1, arg2);
+    Py_INCREF(function);
+    result = __Pyx_PyObject_Call(function, args, NULL);
+    Py_DECREF(args);
+    Py_DECREF(function);
+done:
+    return result;
+}
+
+/* SwapException */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    tmp_type = exc_info->exc_type;
+    tmp_value = exc_info->exc_value;
+    tmp_tb = exc_info->exc_traceback;
+    exc_info->exc_type = *type;
+    exc_info->exc_value = *value;
+    exc_info->exc_traceback = *tb;
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = *type;
+    tstate->exc_value = *value;
+    tstate->exc_traceback = *tb;
+    #endif
+    *type = tmp_type;
+    *value = tmp_value;
+    *tb = tmp_tb;
+}
+#else
+static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    PyErr_GetExcInfo(&tmp_type, &tmp_value, &tmp_tb);
+    PyErr_SetExcInfo(*type, *value, *tb);
+    *type = tmp_type;
+    *value = tmp_value;
+    *tb = tmp_tb;
+}
+#endif
+
 /* BufferIndexError */
 static void __Pyx_RaiseBufferIndexError(int axis) {
   PyErr_Format(PyExc_IndexError,
      "Out of bounds on buffer access (axis %d)", axis);
 }
 
 /* MemviewSliceInit */
@@ -42274,104 +45120,14 @@
     Py_XDECREF(py_import);
     #endif
     Py_XDECREF(empty_list);
     Py_XDECREF(empty_dict);
     return module;
 }
 
-/* PyObjectCall2Args */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
-    PyObject *args, *result = NULL;
-    #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyFunction_FastCall(function, args, 2);
-    }
-    #endif
-    #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyCFunction_FastCall(function, args, 2);
-    }
-    #endif
-    args = PyTuple_New(2);
-    if (unlikely(!args)) goto done;
-    Py_INCREF(arg1);
-    PyTuple_SET_ITEM(args, 0, arg1);
-    Py_INCREF(arg2);
-    PyTuple_SET_ITEM(args, 1, arg2);
-    Py_INCREF(function);
-    result = __Pyx_PyObject_Call(function, args, NULL);
-    Py_DECREF(args);
-    Py_DECREF(function);
-done:
-    return result;
-}
-
-/* PyDictVersioning */
-#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
-}
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
-    PyObject **dictptr = NULL;
-    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
-    if (offset) {
-#if CYTHON_COMPILING_IN_CPYTHON
-        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
-#else
-        dictptr = _PyObject_GetDictPtr(obj);
-#endif
-    }
-    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
-}
-static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
-        return 0;
-    return obj_dict_version == __Pyx_get_object_dict_version(obj);
-}
-#endif
-
-/* GetModuleGlobalName */
-#if CYTHON_USE_DICT_VERSIONS
-static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
-#else
-static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
-#endif
-{
-    PyObject *result;
-#if !CYTHON_AVOID_BORROWED_REFS
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
-    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    } else if (unlikely(PyErr_Occurred())) {
-        return NULL;
-    }
-#else
-    result = PyDict_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-#endif
-#else
-    result = PyObject_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-    PyErr_Clear();
-#endif
-    return __Pyx_GetBuiltinName(name);
-}
-
 /* BytesEquals */
 static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
 #if CYTHON_COMPILING_IN_PYPY
     return PyObject_RichCompareBool(s1, s2, equals);
 #else
     if (s1 == s2) {
         return (equals == Py_EQ);
@@ -42585,169 +45341,14 @@
 }
 
 /* None */
 static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname) {
     PyErr_Format(PyExc_NameError, "free variable '%s' referenced before assignment in enclosing scope", varname);
 }
 
-/* GetTopmostException */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem *
-__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
-{
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
-           exc_info->previous_item != NULL)
-    {
-        exc_info = exc_info->previous_item;
-    }
-    return exc_info;
-}
-#endif
-
-/* SaveResetException */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
-    *type = exc_info->exc_type;
-    *value = exc_info->exc_value;
-    *tb = exc_info->exc_traceback;
-    #else
-    *type = tstate->exc_type;
-    *value = tstate->exc_value;
-    *tb = tstate->exc_traceback;
-    #endif
-    Py_XINCREF(*type);
-    Py_XINCREF(*value);
-    Py_XINCREF(*tb);
-}
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    tmp_type = exc_info->exc_type;
-    tmp_value = exc_info->exc_value;
-    tmp_tb = exc_info->exc_traceback;
-    exc_info->exc_type = type;
-    exc_info->exc_value = value;
-    exc_info->exc_traceback = tb;
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = type;
-    tstate->exc_value = value;
-    tstate->exc_traceback = tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-#endif
-
-/* PyErrExceptionMatches */
-#if CYTHON_FAST_THREAD_STATE
-static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
-    Py_ssize_t i, n;
-    n = PyTuple_GET_SIZE(tuple);
-#if PY_MAJOR_VERSION >= 3
-    for (i=0; i<n; i++) {
-        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
-    }
-#endif
-    for (i=0; i<n; i++) {
-        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
-    }
-    return 0;
-}
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
-    PyObject *exc_type = tstate->curexc_type;
-    if (exc_type == err) return 1;
-    if (unlikely(!exc_type)) return 0;
-    if (unlikely(PyTuple_Check(err)))
-        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
-    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
-}
-#endif
-
-/* GetException */
-#if CYTHON_FAST_THREAD_STATE
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
-#else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
-#endif
-{
-    PyObject *local_type, *local_value, *local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    local_type = tstate->curexc_type;
-    local_value = tstate->curexc_value;
-    local_tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-#else
-    PyErr_Fetch(&local_type, &local_value, &local_tb);
-#endif
-    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
-#if CYTHON_FAST_THREAD_STATE
-    if (unlikely(tstate->curexc_type))
-#else
-    if (unlikely(PyErr_Occurred()))
-#endif
-        goto bad;
-    #if PY_MAJOR_VERSION >= 3
-    if (local_tb) {
-        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
-            goto bad;
-    }
-    #endif
-    Py_XINCREF(local_tb);
-    Py_XINCREF(local_type);
-    Py_XINCREF(local_value);
-    *type = local_type;
-    *value = local_value;
-    *tb = local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    #if CYTHON_USE_EXC_INFO_STACK
-    {
-        _PyErr_StackItem *exc_info = tstate->exc_info;
-        tmp_type = exc_info->exc_type;
-        tmp_value = exc_info->exc_value;
-        tmp_tb = exc_info->exc_traceback;
-        exc_info->exc_type = local_type;
-        exc_info->exc_value = local_value;
-        exc_info->exc_traceback = local_tb;
-    }
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = local_type;
-    tstate->exc_value = local_value;
-    tstate->exc_traceback = local_tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-#else
-    PyErr_SetExcInfo(local_type, local_value, local_tb);
-#endif
-    return 0;
-bad:
-    *type = 0;
-    *value = 0;
-    *tb = 0;
-    Py_XDECREF(local_type);
-    Py_XDECREF(local_value);
-    Py_XDECREF(local_tb);
-    return -1;
-}
-
 /* FetchCommonType */
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
     PyObject* fake_module;
     PyTypeObject* cached_type = NULL;
     fake_module = PyImport_AddModule((char*) "_cython_" CYTHON_ABI);
     if (!fake_module) return NULL;
     Py_INCREF(fake_module);
@@ -44365,47 +46966,14 @@
 static CYTHON_INLINE Py_ssize_t __Pyx_div_Py_ssize_t(Py_ssize_t a, Py_ssize_t b) {
     Py_ssize_t q = a / b;
     Py_ssize_t r = a - q*b;
     q -= ((r != 0) & ((r ^ b) < 0));
     return q;
 }
 
-/* decode_c_string */
-static CYTHON_INLINE PyObject* __Pyx_decode_c_string(
-         const char* cstring, Py_ssize_t start, Py_ssize_t stop,
-         const char* encoding, const char* errors,
-         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors)) {
-    Py_ssize_t length;
-    if (unlikely((start < 0) | (stop < 0))) {
-        size_t slen = strlen(cstring);
-        if (unlikely(slen > (size_t) PY_SSIZE_T_MAX)) {
-            PyErr_SetString(PyExc_OverflowError,
-                            "c-string too long to convert to Python");
-            return NULL;
-        }
-        length = (Py_ssize_t) slen;
-        if (start < 0) {
-            start += length;
-            if (start < 0)
-                start = 0;
-        }
-        if (stop < 0)
-            stop += length;
-    }
-    if (unlikely(stop <= start))
-        return __Pyx_NewRef(__pyx_empty_unicode);
-    length = stop - start;
-    cstring += start;
-    if (decode_func) {
-        return decode_func(cstring, length, errors);
-    } else {
-        return PyUnicode_Decode(cstring, length, encoding, errors);
-    }
-}
-
 /* GetAttr3 */
 static PyObject *__Pyx_GetAttr3Default(PyObject *d) {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         return NULL;
     __Pyx_PyErr_Clear();
@@ -44426,49 +46994,14 @@
     if (likely(__Pyx_TypeCheck(obj, type)))
         return 1;
     PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                  Py_TYPE(obj)->tp_name, type->tp_name);
     return 0;
 }
 
-/* SwapException */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    tmp_type = exc_info->exc_type;
-    tmp_value = exc_info->exc_value;
-    tmp_tb = exc_info->exc_traceback;
-    exc_info->exc_type = *type;
-    exc_info->exc_value = *value;
-    exc_info->exc_traceback = *tb;
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = *type;
-    tstate->exc_value = *value;
-    tstate->exc_traceback = *tb;
-    #endif
-    *type = tmp_type;
-    *value = tmp_value;
-    *tb = tmp_tb;
-}
-#else
-static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    PyErr_GetExcInfo(&tmp_type, &tmp_value, &tmp_tb);
-    PyErr_SetExcInfo(*type, *value, *tb);
-    *type = tmp_type;
-    *value = tmp_value;
-    *tb = tmp_tb;
-}
-#endif
-
 /* FastTypeChecks */
 #if CYTHON_COMPILING_IN_CPYTHON
 static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
     while (a) {
         a = a->tp_base;
         if (a == b)
             return 1;
@@ -44561,19 +47094,14 @@
     if (likely(PyExceptionClass_Check(err))) {
         return __Pyx_inner_PyErr_GivenExceptionMatches2(err, exc_type1, exc_type2);
     }
     return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
 }
 #endif
 
-/* None */
-static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname) {
-    PyErr_Format(PyExc_UnboundLocalError, "local variable '%s' referenced before assignment", varname);
-}
-
 /* DivInt[long] */
 static CYTHON_INLINE long __Pyx_div_long(long a, long b) {
     long q = a / b;
     long r = a - q*b;
     q -= ((r != 0) & ((r ^ b) < 0));
     return q;
 }
@@ -46033,14 +48561,52 @@
     __Pyx_XDECREF(shape_tuple);
     __Pyx_XDECREF(temp_int);
     __Pyx_XDECREF(array_obj);
     __Pyx_RefNannyFinishContext();
     return new_mvs;
 }
 
+/* CIntToPy */
+  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const long neg_one = (long) -1, const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(long) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(long) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
+#endif
+        }
+    } else {
+        if (sizeof(long) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
+#endif
+        }
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(long),
+                                     little, !is_unsigned);
+    }
+}
+
 /* CIntFromPy */
   static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const size_t neg_one = (size_t) -1, const_zero = (size_t) 0;
@@ -46463,52 +49029,14 @@
     return (int) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to int");
     return (int) -1;
 }
 
-/* CIntToPy */
-  static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic push
-#pragma GCC diagnostic ignored "-Wconversion"
-#endif
-    const long neg_one = (long) -1, const_zero = (long) 0;
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic pop
-#endif
-    const int is_unsigned = neg_one > const_zero;
-    if (is_unsigned) {
-        if (sizeof(long) < sizeof(long)) {
-            return PyInt_FromLong((long) value);
-        } else if (sizeof(long) <= sizeof(unsigned long)) {
-            return PyLong_FromUnsignedLong((unsigned long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
-            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
-#endif
-        }
-    } else {
-        if (sizeof(long) <= sizeof(long)) {
-            return PyInt_FromLong((long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
-            return PyLong_FromLongLong((PY_LONG_LONG) value);
-#endif
-        }
-    }
-    {
-        int one = 1; int little = (int)*(unsigned char *)&one;
-        unsigned char *bytes = (unsigned char *)&value;
-        return _PyLong_FromByteArray(bytes, sizeof(long),
-                                     little, !is_unsigned);
-    }
-}
-
 /* CIntFromPy */
   static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
```

### Comparing `plumed-2.8.2.2/plumed.egg-info/PKG-INFO` & `plumed-2.9.0/plumed.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: plumed
-Version: 2.8.2.2
+Version: 2.9.0
 Summary: Python interface to PLUMED
 Home-page: http://www.plumed.org
 Author: Gareth A. Tribello
 Author-email: plumed-users@googlegroups.com
 Classifier: Development Status :: 4 - Beta
 Classifier: Intended Audience :: Science/Research
 Classifier: Topic :: Scientific/Engineering :: Bio-Informatics
```

### Comparing `plumed-2.8.2.2/plumed.pyx` & `plumed-2.9.0/plumed.pyx`

 * *Files 14% similar despite different names*

```diff
@@ -25,49 +25,82 @@
 #
 
 # cython: binding=True
 
 cimport cplumed  # This imports information from pxd file - including contents of this file here causes name clashes
 
 import array
-import ctypes
 import re
 import gzip
 import math
 import sys
 import warnings
-import re
 import types
 
+from cython.operator import dereference
+
 if sys.version_info < (3,):
-    raise ImportError("PLUMED 2.6 only supports Python 3")
+    raise ImportError("PLUMED >=2.6 only supports Python 3")
 
 try:
      import numpy as np
      HAS_NUMPY=True
 except ImportError:
      HAS_NUMPY=False
 
+# flags used to pass type information
+DEF type_void          = 0x10000*1
+DEF type_nullptr       = 0x10000*2
+DEF type_integral      = 0x10000*3
+DEF type_real          = 0x10000*4
+
+DEF type_value         = 0x2000000*1
+DEF type_pointer       = 0x2000000*2
+DEF type_const_pointer = 0x2000000*3
+
+DEF type_nocopy        = 0x10000000
+
+class PlumedError(RuntimeError):
+  pass
+
+class LeptonError(RuntimeError):
+  pass
+
 cdef class Plumed:
-     cdef cplumed.Plumed c_plumed
-     def __cinit__(self,kernel=None):
+     cdef cplumed.plumed c_plumed
+     cdef int initialized
+     def __cinit__(self):
+         # this is guaranteed to be called once
+         # we use it to make sure c_plumed is initialized correctly
+         # in all other places we always finalize before resetting
+         self.c_plumed=cplumed.plumed_create_invalid()
+     def __dealloc__(self):
+         # this is guaranteed to be called once
+         # we use it to make sure c_plumed is finalized correctly
+        cplumed.plumed_finalize(self.c_plumed)
+     def __init__(self,kernel=None):
          cdef bytes py_kernel
          cdef char* ckernel
          if kernel is None:
-            self.c_plumed=cplumed.Plumed.makeValid()
-            if not self.c_plumed.valid():
+            cplumed.plumed_finalize(self.c_plumed)
+            self.c_plumed=cplumed.plumed_create()
+            if not cplumed.plumed_valid(self.c_plumed):
                  raise RuntimeError("PLUMED not available, check your PLUMED_KERNEL environment variable")
          else:
             py_kernel= kernel.encode()
             ckernel = py_kernel
-            self.c_plumed=cplumed.Plumed.dlopen(ckernel)
-            if not self.c_plumed.valid():
+            cplumed.plumed_finalize(self.c_plumed)
+            self.c_plumed=cplumed.plumed_create_dlopen(ckernel)
+            if not cplumed.plumed_valid(self.c_plumed):
                  raise RuntimeError("Error loading PLUMED kernel at path " + kernel)
-         cdef int pres = 8
-         self.c_plumed.cmd_int( "setRealPrecision", pres)
+         api=array.array('i',[0])
+         self.cmd( "getApiVersion", api)
+         if(api[0]>=10):
+           self.cmd("setNestedExceptions",1)
+         self.cmd( "setRealPrecision", 8)
      def finalize(self):
          """ Explicitly finalize a Plumed object.
 
              Can be used in cases where one wants to make sure the Plumed object is finalized
              (so that all output files are flushed and all calculations are finalized) but there is
              a dangling reference to that Plumed object. Notice that after this call the self object
              will be invalid so that using cmd will raise an exception.
@@ -77,69 +110,128 @@
              with plumed.Plumed() as p:
                  p.cmd("init")
                  # ETC
 
              # p object will be finalized when exiting from this context
              ````
          """
-         self.c_plumed=cplumed.Plumed()
+         cplumed.plumed_finalize(self.c_plumed)
+         self.c_plumed=cplumed.plumed_create_invalid()
      def __enter__(self):
          return self
      def __exit__(self, type, value, traceback):
         self.finalize()
+     cdef raise_exception(self,cplumed.plumed_error error):
+        if error.nested:
+          try:
+            self.raise_exception(dereference(<cplumed.plumed_error*> error.nested))
+          except Exception as e:
+            raise_from = e
+        else:
+          raise_from = None
+        msg = error.what
+        what = msg.decode("utf-8")
+        # this map is from cython doc
+        if error.code>=20300 and error.code<20400: # PLMD::Plumed::ExceptionTypeError
+           raise TypeError(what) from raise_from
+        elif error.code>=11400 and error.code<11500: # std::bad_alloc
+           raise MemoryError(what) from raise_from
+        elif error.code>=11000 and error.code<11100: # std::bad_typeid
+           raise TypeError(what) from raise_from
+        elif error.code>=11100 and error.code<11200: # std::bad_cast
+           raise TypeError(what) from raise_from
+        elif error.code>=10110 and error.code<10115: # std::domain_error
+           raise ValueError(what) from raise_from
+        elif error.code>=10105 and error.code<10110: # std::invalid_argument
+           raise ValueError(what) from raise_from
+        elif error.code>=10230 and error.code<10240: # std::ios_base::failure
+           # Unfortunately, in standard C++ we have no way of distinguishing EOF
+           # from other errors here; be careful with the exception mask
+           raise IOError(what) from raise_from
+        elif error.code>=10120 and error.code<10125: # std::out_of_range
+           raise IndexError(what) from raise_from
+        elif error.code>=10210 and error.code<10215: # std::overflow_error
+           raise OverflowError(what) from raise_from
+        elif error.code>=10205 and error.code<10210: # std::range_error
+           raise ArithmeticError(what) from raise_from
+        elif error.code>=10215 and error.code<10220: # std::underflow_error
+           raise ArithmeticError(what) from raise_from
+        elif error.code>=19900 and error.code<20000: # Lepton
+           raise LeptonError(what) from raise_from
+        elif error.code>=20000 and error.code<30000: # Plumed
+           raise PlumedError(what) from raise_from
+        else:
+           raise RuntimeError(what) from raise_from
+     cdef cmd_low_level(self,const char* ckey, const void* val,size_t nelem, size_t* shape,size_t flags):
+         cdef cplumed.plumed_safeptr safe
+         cdef cplumed.plumed_nothrow_handler nothrow
+         cdef cplumed.plumed_error error
+         safe.ptr=val
+         safe.nelem=0
+         safe.shape=shape
+         safe.flags=flags
+         cplumed.plumed_error_init(&error)
+         nothrow.ptr=&error
+         nothrow.handler=cplumed.plumed_error_set
+         cplumed.plumed_cmd_safe_nothrow(self.c_plumed,ckey,safe,nothrow)
+         if(error.code):
+           try:
+             self.raise_exception(error)
+           finally:
+             cplumed.plumed_error_finalize(error)
      cdef cmd_ndarray_double(self, ckey, val):
          cdef double [:] abuffer = val.ravel()
          cdef size_t ashape[5]
          shape=val.shape
          assert len(shape)<5
          for i in range(len(shape)):
             ashape[i]=shape[i]
          ashape[len(shape)]=0
-         self.c_plumed.cmd_shaped( ckey, <double*>&abuffer[0], <size_t*> & ashape[0])
+         self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_real +  type_pointer)
      cdef cmd_ndarray_int(self, ckey, val):
          cdef int [:] abuffer = val.ravel()
          cdef size_t ashape[5]
          shape=val.shape
          assert len(shape)<5
          for i in range(len(shape)):
             ashape[i]=shape[i]
          ashape[len(shape)]=0
-         self.c_plumed.cmd_shaped( ckey, <int*>&abuffer[0], <size_t*> & ashape[0])
+         self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
      cdef cmd_ndarray_long(self, ckey, val):
          cdef long [:] abuffer = val.ravel()
          cdef size_t ashape[5]
          shape=val.shape
          assert len(shape)<5
          for i in range(len(shape)):
             ashape[i]=shape[i]
          ashape[len(shape)]=0
-         self.c_plumed.cmd_shaped( ckey, <long*>&abuffer[0], <size_t*> & ashape[0])
+         self.cmd_low_level(ckey,&abuffer[0], 0, & ashape[0], sizeof(abuffer[0]) + type_integral +  type_pointer)
      cdef cmd_array_double(self, ckey, val):
          cdef double [:] abuffer = val
-         self.c_plumed.cmd( ckey, <double*>&abuffer[0], len(abuffer))
+         self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_real +  type_pointer)
      cdef cmd_array_int(self, ckey, val):
          cdef int [:] abuffer = val
-         self.c_plumed.cmd( ckey, <int*>&abuffer[0], len(abuffer))
+         self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
      cdef cmd_array_long(self, ckey, val):
          cdef long [:] abuffer = val
-         self.c_plumed.cmd( ckey, <long*>&abuffer[0], len(abuffer))
+         self.cmd_low_level(ckey,&abuffer[0], len(abuffer), NULL, sizeof(abuffer[0]) + type_integral +  type_pointer)
      cdef cmd_float(self, ckey, double val ):
-         self.c_plumed.cmd_float( ckey, val)
+         self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_real +  type_value)
      cdef cmd_int(self, ckey, int val):
-         self.c_plumed.cmd_int( ckey, val)
+         self.cmd_low_level(ckey,&val, 1, NULL, sizeof(val) + type_integral +  type_value)
      cdef cmd_mpi(self, ckey, val):
          import mpi4py.MPI as MPI
          cdef size_t comm_addr = MPI._addressof(val)
-         self.c_plumed.cmd_mpi( ckey, <const void*>comm_addr)
+         self.cmd_low_level(ckey,<void*>comm_addr, 0, NULL, type_void +  type_const_pointer)
      def cmd( self, key, val=None ):
          cdef bytes py_bytes = key.encode()
          cdef char* ckey = py_bytes
          cdef char* cval
          if val is None :
-            self.c_plumed.cmd( ckey)
+            self.cmd_low_level(ckey,NULL,0,NULL,type_nullptr)
             return
          if isinstance(val, (int,long) ):
             self.cmd_int(ckey, val)
             return
          if isinstance(val, float ) :
             self.cmd_float(ckey, val)
             return
@@ -148,30 +240,31 @@
             if( val.dtype==np.double):
                self.cmd_ndarray_double(ckey, val)
             elif( val.dtype==np.intc ) :
                self.cmd_ndarray_int(ckey, val)
             elif( val.dtype==np.int_ ) :
                self.cmd_ndarray_long(ckey, val)
             else :
-               raise ValueError("ndarrys should be np.double, np.intc, or np.int_")
+               raise ValueError("ndarrays should be type np.double, np.intc, or np.int_")
             return
          if isinstance(val, array.array) :
             if( (val.typecode=="d" or val.typecode=="f") and val.itemsize==8):
                self.cmd_array_double(ckey, val)
             elif( (val.typecode=="i" or val.typecode=="I") ) :
                self.cmd_array_int(ckey, val)
             elif( (val.typecode=="l" or val.typecode=="L") ) :
                self.cmd_array_long(ckey, val)
             else :
-               raise ValueError("ndarrays should be double (size=8), int, or long")
+               raise ValueError("arrays should be type double (size=8), int, or long")
             return
          if isinstance(val, str ) :
             py_bytes = val.encode()
             cval = py_bytes
-            self.c_plumed.cmd( ckey, <const char*>cval )
+            # assume sizeof(char)=1
+            self.cmd_low_level(ckey,cval,0, NULL,1 + type_integral + type_const_pointer + type_nocopy)
             return
          if 'mpi4py' in sys.modules:
             import mpi4py.MPI as MPI
             if isinstance(val, MPI.Comm):
               self.cmd_mpi(ckey, val)
               return
          raise ValueError("Unknown value type ({})".format(str(type(val))))
@@ -513,14 +606,103 @@
     for i in range(df.shape[0]):
         if has_index:
             file_or_path.write(" "+str(df.index[i]))
         for j in df.columns:
             file_or_path.write(" "+str(df[j][i]))
         file_or_path.write("\n")
 
+def hills_time_average(hills, tofile=None, *, t0=None, t1=None, frac0=None, frac1=None, inplace=False):
+    """Compute a time-averaged hills file.
+
+       hills: dataframe containing a hills file, or file, or filename
+
+       tofile: write the resulting dataframe to a file or filename
+
+       t0: initial time for averaging
+
+       t1: final time for averaging
+
+       frac0: initial fraction for averaging
+
+       frac1: final fraction for averaging
+
+       inplace: pass true to avoid copying the dataframe (for very large dataframes)
+
+       Returns
+       -------
+
+       if inplace=False and tofile=None (default): a modified copy of the dataframe
+       if inplace=True or tofile!=None: None
+
+       This tool takes as an input a pandas dataframe read from a HILLS file and
+       returns an equivalent dataframe where Gaussian heights have been scaled
+       with a windowing function so as to effectively result in a time-averaged
+       potential. By default, the average is taken along to entire list based on the
+       value of the time column. The averaging windows can be specified in two ways:
+       - using the time field, from t0 to t1. If t0 (t1) is omitted, its default is
+         to be set to np.min(hills.time) (np.max(hills.time))
+       - using the index of the hill, from frac0 to frac1 specified as a fraction
+         of the entire length; that is, frac0=0.5 implies avering from the mid of the
+         simulation. If frac0 (frac1) is omitted, its default is to be set to 0.0 (1.0)
+
+       If tofile is specified, nothing is returned and the resulting dataframe is written
+       on file.
+
+       Examples
+       --------
+
+       plumed.hills_time_average("HILLS","HILLSOUT") # time average along entire file
+
+       plumed.hills_time_average("HILLS","HILLSOUT1",t0=100,t1=200) # time average between 100 and 200 ps
+
+       plumed.hills_time_average("HILLS","HILLSOUT2",frac0=0.5) # time average in second half of the file
+
+       df=plumed.hills_time_average("HILLS") # time average and return dataframe
+
+       df=plumed.read_as_pandas("HILLS") # first read hills file
+       df=plumed.hills_time_average(df) # then perform time average
+
+
+    """
+    import pandas as pd
+    if not isinstance(hills,pd.DataFrame):
+        hills=read_as_pandas(hills)
+    elif not inplace:
+        hills=hills.copy()
+
+    use_time = (t0 is not None or t1 is not None)
+    use_index = (frac0 is not None or frac1 is not None)
+
+    if use_time and use_index:
+        raise ValueError("cannot use simultaneously time and fraction")
+
+    if not use_index and not use_time:
+        use_time=True
+
+    if use_time:
+        if t0 is None:
+            t0=np.min(hills.time)
+        if t1 is None:
+            t1=np.max(hills.time)
+        w=np.clip((t1-hills.time)/(t1-t0),0.0,1.0)
+    else:
+        if frac0 is None:
+           frac0=0
+        if frac1 is None:
+           frac1=1.0
+        i0=int(len(hills)*frac0)
+        i1=int(len(hills)*frac1)
+        w=np.hstack((np.ones(i0),np.linspace(1.0,0.0,i1-i0),np.zeros(len(hills)-i1)))
+    hills.height*=w
+
+    if tofile is not None:
+        write_pandas(hills,tofile)
+    elif not inplace:
+        return hills
+
 def _guessplumedroot(kernel=None):
     """Guess plumed root.
 
        kernel: path to the plumed kernel
 
        In case the Plumed object cannot be created, try to launch a `plumed` executable and obtain the root
        dir from there.
```

### Comparing `plumed-2.8.2.2/setup.py` & `plumed-2.9.0/setup.py`

 * *Files 6% similar despite different names*

```diff
@@ -54,15 +54,15 @@
 plumedversion = os.getenv("plumed_version")
 if plumedversion is None:
     plumedversion = subprocess.check_output(['grep','-v','#','./PLUMED_VERSION']).decode("utf-8").rstrip()
 
 print( "Module name " + plumedname )
 print( "Version number " + plumedversion )
 
-extra_compile_args=['-D__PLUMED_HAS_DLOPEN','-D__PLUMED_WRAPPER_LINK_RUNTIME=1','-D__PLUMED_WRAPPER_CXX=1','-D__PLUMED_WRAPPER_IMPLEMENTATION=1','-D__PLUMED_WRAPPER_EXTERN=0','-D__PLUMED_WRAPPER_CXX_DEFAULT_INVALID=1'] 
+extra_compile_args=['-D__PLUMED_HAS_DLOPEN','-D__PLUMED_WRAPPER_LINK_RUNTIME=1','-D__PLUMED_WRAPPER_IMPLEMENTATION=1','-D__PLUMED_WRAPPER_EXTERN=0']
 
 defaultkernel=os.getenv("plumed_default_kernel")
 if defaultkernel is not None:
     extra_compile_args.append("-D__PLUMED_DEFAULT_KERNEL=" + os.path.abspath(defaultkernel))
     print( "Hardcoded PLUMED_KERNEL " + os.path.abspath(defaultkernel))
 
 # Fixes problem with compiling the PYTHON interface in Mac OS 10.14 and higher.
@@ -93,37 +93,37 @@
 try:
     if(os.environ["plumed_force_cython"]=="yes"):
         print('plumed_force_cython=yes')
         USE_CYTHON = True
 except KeyError:
     pass
 
-# if plumed.cpp is available, do not need cython
+# if plumed.c is available, do not need cython
 if not USE_CYTHON:
-    if not os.path.isfile("plumed.cpp"):
-        print('plumed.cpp not found, cython is needed')
+    if not os.path.isfile("plumed.c"):
+        print('plumed.c not found, cython is needed')
         USE_CYTHON = True
 
 # try to import cython
 if USE_CYTHON:
     try:
         print('importing cython')
         from Cython.Build import cythonize
         extension="pyx"
     except ImportError:
         print('Error: building ' + plumedname + ' requires cython. Please install it first with pip install cython')
         sys.exit(-1)
 else:
-    print('using available plumed.cpp file')
-    extension="cpp"
+    print('using available plumed.c file')
+    extension="c"
 
 ext_modules=[Extension(
      name=plumedname,
      sources=["plumed." + extension],
-     language="c++",
+     language="c",
      include_dirs=include_dirs,
      extra_compile_args=extra_compile_args
   )]
 
 if USE_CYTHON:
     ext_modules=cythonize(ext_modules,language_level=3)
```

### Comparing `plumed-2.8.2.2/test/test_input_builder.py` & `plumed-2.9.0/test/test_input_builder.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,173 +1,178 @@
 
+import unittest
 import plumed
+
 ib=plumed.InputBuilder()
 
 try:
   import MDAnalysis
   _HAS_MDANALYSIS=True
 except:
   _HAS_MDANALYSIS=False
 
-def check(s1,s2):
-  if s1 != s2:
-    raise RuntimeError (s1,s2)
+class Test(unittest.TestCase):
+
+ def check(self,s1,s2):
+  self.assertEqual(s1,s2)
 
-def checkfiles(f1,f2):
+ def checkfiles(self,f1,f2):
   import filecmp
   import difflib
   import sys
   if not filecmp.cmp(f1,f2):
      s1=[]
      with open(f1,"r") as file1:
        for l in file1:
          s1.append(l)
      s2=[]
      with open(f2,"r") as file2:
        for l in file2:
          s2.append(l)
      for line in difflib.context_diff(s1, s2, fromfile=f1, tofile=f2):
          sys.stdout.write(line)
-     raise RuntimeError("Files are different")
+     self.assertTrue(False)
 
+ def test1(self):
+   self.check(ib.TORSION("phi",ATOMS="5,7,9,15") , 'phi: TORSION ATOMS=5,7,9,15\n')
 
-def test1():
-   check(ib.TORSION("phi",ATOMS="5,7,9,15") , 'phi: TORSION ATOMS=5,7,9,15\n')
+ def test1b(self):
+   self.check(ib.TORSION__("phi",ATOMS="5,7,9,15") , 'phi: TORSION ATOMS=5,7,9,15\n')
 
-def test1b():
-   check(ib.TORSION__("phi",ATOMS="5,7,9,15") , 'phi: TORSION ATOMS=5,7,9,15\n')
+ def test2(self):
+   self.check(ib.TORSION("phi",ATOMS="5 7 9 15") , 'phi: TORSION ATOMS={5 7 9 15}\n')
 
-def test2():
-   check(ib.TORSION("phi",ATOMS="5 7 9 15") , 'phi: TORSION ATOMS={5 7 9 15}\n')
+ def test3(self):
+   self.check(ib.COORDINATION(GROUPA="1-10",GROUPB="11-20",SWITCH="RATIONAL NN=6 R_0=1") , 'COORDINATION GROUPA=1-10 GROUPB=11-20 SWITCH={RATIONAL NN=6 R_0=1}\n')
 
-def test3():
-   check(ib.COORDINATION(GROUPA="1-10",GROUPB="11-20",SWITCH="RATIONAL NN=6 R_0=1") , 'COORDINATION GROUPA=1-10 GROUPB=11-20 SWITCH={RATIONAL NN=6 R_0=1}\n')
-
-def test4():
-   check(ib.COORDINATION(GROUPA="""
+ def test4(self):
+   self.check(ib.COORDINATION(GROUPA="""
   1 2 3 4 5 6 7 8 9 10
   """,GROUPB="""
   11 12 13 14 15 16 17 18 19 20
   """,SWITCH="""
   RATIONAL NN=6 R_0=1
   """) , 'COORDINATION GROUPA={   1 2 3 4 5 6 7 8 9 10   } GROUPB={   11 12 13 14 15 16 17 18 19 20   } SWITCH={   RATIONAL NN=6 R_0=1   }\n')
 
-def test5():
-   check(ib.DISTANCE("d",ATOMS="11 21",NOPBC=True) , 'd: DISTANCE ATOMS={11 21} NOPBC\n')
+ def test5(self):
+   self.check(ib.DISTANCE("d",ATOMS="11 21",NOPBC=True) , 'd: DISTANCE ATOMS={11 21} NOPBC\n')
 
-def test6():
-   check(ib.DISTANCE("d",ATOMS="11 21",NOPBC=False),'d: DISTANCE ATOMS={11 21}\n')
+ def test6(self):
+   self.check(ib.DISTANCE("d",ATOMS="11 21",NOPBC=False),'d: DISTANCE ATOMS={11 21}\n')
 
-def test7():
-   check(ib.METAD(ARG="phi psi",PACE=500,HEIGHT=1.2,SIGMA="0.35 0.35",FILE="HILLS"),'METAD ARG={phi psi} FILE=HILLS HEIGHT=1.2 PACE=500 SIGMA={0.35 0.35}\n')
+ def test7(self):
+   self.check(ib.METAD(ARG="phi psi",PACE=500,HEIGHT=1.2,SIGMA="0.35 0.35",FILE="HILLS"),'METAD ARG={phi psi} FILE=HILLS HEIGHT=1.2 PACE=500 SIGMA={0.35 0.35}\n')
 
-def test8():
-   check(ib.GROUP("g",ATOMS=range(1,101)),'g: GROUP ATOMS={1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100}\n')
+ def test8(self):
+   self.check(ib.GROUP("g",ATOMS=range(1,101)),'g: GROUP ATOMS={1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100}\n')
 
-def test9():
-  check(ib.METAD(ARG=("phi","psi"),PACE=500,HEIGHT=1.2,SIGMA=(0.35,"pi/8"),FILE="HILLS"),'METAD ARG={phi psi} FILE=HILLS HEIGHT=1.2 PACE=500 SIGMA={0.35 pi/8}\n')
+ def test9(self):
+  self.check(ib.METAD(ARG=("phi","psi"),PACE=500,HEIGHT=1.2,SIGMA=(0.35,"pi/8"),FILE="HILLS"),'METAD ARG={phi psi} FILE=HILLS HEIGHT=1.2 PACE=500 SIGMA={0.35 pi/8}\n')
 
-def test10():
-  check(ib.MOVINGRESTRAINT(ARG="d1",KAPPA0=0,KAPPA1=10.0,AT0=20,AT1=20,STEP0=1,STEP1=10000),'MOVINGRESTRAINT ARG=d1 AT0=20 AT1=20 KAPPA0=0 KAPPA1=10.0 STEP0=1 STEP1=10000\n')
+ def test10(self):
+  self.check(ib.MOVINGRESTRAINT(ARG="d1",KAPPA0=0,KAPPA1=10.0,AT0=20,AT1=20,STEP0=1,STEP1=10000),'MOVINGRESTRAINT ARG=d1 AT0=20 AT1=20 KAPPA0=0 KAPPA1=10.0 STEP0=1 STEP1=10000\n')
 
-def test11():
-  check(
+ def test11(self):
+  self.check(
     ib.MOVINGRESTRAINT(ARG="d1",KAPPA=ib.numbered([0,10.0]),AT=ib.numbered([20,20]),STEP=ib.numbered([1,10000]))
   ,
     'MOVINGRESTRAINT ARG=d1 AT0=20 AT1=20 KAPPA0=0 KAPPA1=10.0 STEP0=1 STEP1=10000\n'
   )
 
-def test12():
-  check(
+ def test12(self):
+  self.check(
     ib.MOVINGRESTRAINT(ARG="d1",KAPPA=ib.numbered([100]),AT=ib.numbered({0:0.0,2:10.0}),STEP=ib.numbered((0,10,20,30)))
   ,
     'MOVINGRESTRAINT ARG=d1 AT0=0.0 AT2=10.0 KAPPA0=100 STEP0=0 STEP1=10 STEP2=20 STEP3=30\n'
   )
 
-def test13():
-  check(
+ def test13(self):
+  self.check(
      ib.MOVINGRESTRAINT(ARG="d1,d2",
                      KAPPA=ib.numbered([11]),
                      AT=ib.numbered(((0.0,1.0),(2.0,3.0))),
                      STEP=ib.numbered((0,100)))
   ,
     'MOVINGRESTRAINT ARG=d1,d2 AT0={0.0 1.0} AT1={2.0 3.0} KAPPA0=11 STEP0=0 STEP1=100\n'
   )
 
-def test14():
-  check(
+ def test14(self):
+  self.check(
      ib.MOVINGRESTRAINT(ARG="d1,d2",
                      KAPPA=ib.numbered([100]),AT=ib.numbered(([0.0,"pi"],[2.0,"pi"])),
                      STEP=ib.numbered((0,100)))
   ,
     'MOVINGRESTRAINT ARG=d1,d2 AT0={0.0 pi} AT1={2.0 pi} KAPPA0=100 STEP0=0 STEP1=100\n'
   )
 
-def test15():
-  check(
+ def test15(self):
+  self.check(
     ib.RESTRAINT(ARG="d1",KAPPA=10,AT=ib.replicas((0.0,1.0,2.0,3.0)))
   ,
     'RESTRAINT ARG=d1 AT=@replicas:{0.0 1.0 2.0 3.0} KAPPA=10\n'
   )
 
-def test16():
+ def test16(self):
   try:
     import numpy
   except:
     print("This test requires numpy module installed.")
-  check(
+  self.check(
      ib.RESTRAINT(ARG="d1",KAPPA=10,AT=ib.replicas(numpy.linspace(3.0,5.0,17)))
   ,
      'RESTRAINT ARG=d1 AT=@replicas:{3.0 3.125 3.25 3.375 3.5 3.625 3.75 3.875 4.0 4.125 4.25 4.375 4.5 4.625 4.75 4.875 5.0} KAPPA=10\n'
   )
 
-def test17():
-  check(
+ def test17(self):
+  self.check(
     ib.RESTRAINT(ARG="d1,d2",KAPPA=(10,10),AT=ib.replicas(([0.0,1.0],[10.0,11.0])))
   ,
      'RESTRAINT ARG=d1,d2 AT=@replicas:{{0.0 1.0} {10.0 11.0}} KAPPA={10 10}\n'
   )
 
-def test18():
+ def test18(self):
   ib1=plumed.InputBuilder(comma_separator=True)
-  check(
+  self.check(
     ib1.GROUP("g1",ATOMS=[1,2,3,4,5,6,7,8,9,10])
   ,
     'g1: GROUP ATOMS=1,2,3,4,5,6,7,8,9,10\n'
   )
 
-def test19():
-  check(ib.at.phi(6),'@phi-6')
+ def test19(self):
+  self.check(ib.at.phi(6),'@phi-6')
 
-def test20():
-  check(ib.at.phi(range(1,11),"A"),'@phi-A1 @phi-A2 @phi-A3 @phi-A4 @phi-A5 @phi-A6 @phi-A7 @phi-A8 @phi-A9 @phi-A10')
+ def test20(self):
+  self.check(ib.at.phi(range(1,11),"A"),'@phi-A1 @phi-A2 @phi-A3 @phi-A4 @phi-A5 @phi-A6 @phi-A7 @phi-A8 @phi-A9 @phi-A10')
 
-def test20():
-  check(ib.at.phi(range(1,11),["A","B"]),'@phi-A1 @phi-A2 @phi-A3 @phi-A4 @phi-A5 @phi-A6 @phi-A7 @phi-A8 @phi-A9 @phi-A10 @phi-B1 @phi-B2 @phi-B3 @phi-B4 @phi-B5 @phi-B6 @phi-B7 @phi-B8 @phi-B9 @phi-B10')
+ def test20(self):
+  self.check(ib.at.phi(range(1,11),["A","B"]),'@phi-A1 @phi-A2 @phi-A3 @phi-A4 @phi-A5 @phi-A6 @phi-A7 @phi-A8 @phi-A9 @phi-A10 @phi-B1 @phi-B2 @phi-B3 @phi-B4 @phi-B5 @phi-B6 @phi-B7 @phi-B8 @phi-B9 @phi-B10')
 
-def test21():
-  check(ib.at.phi(4,[1,2]),'@phi-1_4 @phi-2_4')
+ def test21(self):
+  self.check(ib.at.phi(4,[1,2]),'@phi-1_4 @phi-2_4')
 
-def test22():
-  check(ib.at("OW",range(20,40)),'@OW-20 @OW-21 @OW-22 @OW-23 @OW-24 @OW-25 @OW-26 @OW-27 @OW-28 @OW-29 @OW-30 @OW-31 @OW-32 @OW-33 @OW-34 @OW-35 @OW-36 @OW-37 @OW-38 @OW-39')
+ def test22(self):
+  self.check(ib.at("OW",range(20,40)),'@OW-20 @OW-21 @OW-22 @OW-23 @OW-24 @OW-25 @OW-26 @OW-27 @OW-28 @OW-29 @OW-30 @OW-31 @OW-32 @OW-33 @OW-34 @OW-35 @OW-36 @OW-37 @OW-38 @OW-39')
 
-def test23():
-  check(ib.at.mdatoms,'@mdatoms')
+ def test23(self):
+  self.check(ib.at.mdatoms,'@mdatoms')
 
-def test24():
-  check(ib.RESTRAINT(ARG="d1,d2",verbatim="AT={10 20} KAPPA={5 6}"),'RESTRAINT ARG=d1,d2 AT={10 20} KAPPA={5 6}\n')
+ def test24(self):
+  self.check(ib.RESTRAINT(ARG="d1,d2",verbatim="AT={10 20} KAPPA={5 6}"),'RESTRAINT ARG=d1,d2 AT={10 20} KAPPA={5 6}\n')
 
-def test25():
-  check(ib.verbatim("# here is a comment"),'# here is a comment\n')
+ def test25(self):
+  self.check(ib.verbatim("# here is a comment"),'# here is a comment\n')
 
-if _HAS_MDANALYSIS:
-  def test_mdanalysis():
+ if _HAS_MDANALYSIS:
+  def test_mdanalysis(self):
     u=MDAnalysis.Universe("test/ref.pdb")
-    check(
+    self.check(
        ib.GROUP(ATOMS=u.select_atoms("name C2 C4 C6")),
        'GROUP ATOMS={16 20 25 50 54 59 84 88 93 118 122 127 147 151 156 178 182 187 209 213 218 240 244 249}\n'
     )
-    check(
+    self.check(
        ib.GROUP(ATOMS=u.select_atoms("name C2","name C4","name C6")),
        'GROUP ATOMS={20 54 88 122 156 187 218 249 25 59 93 127 151 182 213 244 16 50 84 118 147 178 209 240}\n'
     )
 
+if __name__ == "__main__":
+    unittest.main()
+
```

### Comparing `plumed-2.8.2.2/test/test_pandas.py` & `plumed-2.9.0/test/test_pandas.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,84 +1,85 @@
+import unittest
 import plumed
 import filecmp
 import os
 from contextlib import contextmanager
 
 @contextmanager
 def cd(newdir):
     prevdir = os.getcwd()
     os.chdir(newdir)
     try:
         yield
     finally:
         os.chdir(prevdir)
 
-def test1():
+class Test(unittest.TestCase):
+  def test1(self):
     with cd('test/'):
         d=plumed.read_as_pandas("COLVAR",enable_constants='columns')
-        print(d,file=open("dataframe","wt"))
-        assert filecmp.cmp("dataframe","dataframe.ref")
+        with open("dataframe","wt") as f:
+            print(d,file=f)
+        self.assertTrue(filecmp.cmp("dataframe","dataframe.ref"))
 
-def test2():
+  def test2(self):
     with cd('test/'):
         d=plumed.read_as_pandas("COLVAR_gzipped.gz",enable_constants='columns')
-        print(d,file=open("dataframe","wt"))
-        assert filecmp.cmp("dataframe","dataframe.ref")
+        with open("dataframe","wt") as f:
+            print(d,file=f)
+        self.assertTrue(filecmp.cmp("dataframe","dataframe.ref"))
 
-def test3():
+  def test3(self):
     with cd('test/'):
         i=0
         for d in plumed.read_as_pandas("COLVAR",chunksize=4,enable_constants='columns'):
-            print(d,file=open("dataframe."+str(i),"wt"))
-            assert filecmp.cmp("dataframe."+str(i),"dataframe."+str(i)+".ref")
+            with open("dataframe."+str(i),"wt") as f:
+                print(d,file=f)
+            self.assertTrue(filecmp.cmp("dataframe."+str(i),"dataframe."+str(i)+".ref"))
             i=i+1
 
-def test4():
+  def test4(self):
     with cd('test/'):
         i=0
         for d in plumed.read_as_pandas("COLVAR_gzipped.gz",chunksize=4,enable_constants='columns'):
-            print(d,file=open("dataframe."+str(i),"wt"))
-            assert filecmp.cmp("dataframe."+str(i),"dataframe."+str(i)+".ref")
+            with open("dataframe."+str(i),"wt") as f:
+                print(d,file=f)
+            self.assertTrue(filecmp.cmp("dataframe."+str(i),"dataframe."+str(i)+".ref"))
             i=i+1
 
-def test5():
+  def test5(self):
     with cd('test/'):
         d=plumed.read_as_pandas("COLVAR",enable_constants='metadata')
-        print(d,file=open("dataframe_noconst","wt"))
-        assert filecmp.cmp("dataframe_noconst","dataframe_noconst.ref")
-        assert d.plumed_constants[0][0]=="a"
-        assert d.plumed_constants[0][2]=="pi"
+        with open("dataframe_noconst","wt") as f:
+            print(d,file=f)
+        self.assertTrue(filecmp.cmp("dataframe_noconst","dataframe_noconst.ref"))
+        self.assertEqual(d.plumed_constants[0][0],"a")
+        self.assertEqual(d.plumed_constants[0][2],"pi")
 
-def test6():
+  def test6(self):
     with cd('test/'):
         i=0
         for d in plumed.read_as_pandas("COLVAR",chunksize=4,enable_constants='metadata'):
-            print(d,file=open("dataframe_noconst."+str(i),"wt"))
-            assert filecmp.cmp("dataframe_noconst."+str(i),"dataframe_noconst."+str(i)+".ref")
-            assert d.plumed_constants[0][0]=="a"
-            assert d.plumed_constants[0][2]=="pi"
+            with open("dataframe_noconst."+str(i),"wt") as f:
+                print(d,file=f)
+            self.assertTrue(filecmp.cmp("dataframe_noconst."+str(i),"dataframe_noconst."+str(i)+".ref"))
+            self.assertEqual(d.plumed_constants[0][0],"a")
+            self.assertEqual(d.plumed_constants[0][2],"pi")
             i=i+1
 
-def test7():
+  def test7(self):
     with cd('test/'):
         d=plumed.read_as_pandas("COLVAR")
         plumed.write_pandas(d,"COLVAR_write1")
-        assert filecmp.cmp("COLVAR_write1","COLVAR_write.ref")
+        self.assertTrue(filecmp.cmp("COLVAR_write1","COLVAR_write.ref"))
         d=plumed.read_as_pandas("COLVAR",index_col='time')
         plumed.write_pandas(d,"COLVAR_write2")
-        assert filecmp.cmp("COLVAR_write2","COLVAR_write.ref")
+        self.assertTrue(filecmp.cmp("COLVAR_write2","COLVAR_write.ref"))
         d=plumed.read_as_pandas("COLVAR",index_col=('time','psi'))
         try:
             plumed.write_pandas(d,"COLVAR_write3")
-            assert False
+            self.assertTrue(False)
         except TypeError:
             pass
 
 if __name__ == "__main__":
-    test1()
-    test2()
-    test3()
-    test4()
-    test5()
-    test6()
-    test7()
-
+    unittest.main()
```

### Comparing `plumed-2.8.2.2/test/test_run.py` & `plumed-2.9.0/test/test_run.py`

 * *Files 9% similar despite different names*

```diff
@@ -32,14 +32,15 @@
 # t29: TORSION ATOMS=@phi-16
 # t30: TORSION ATOMS=@psi-16
 # t31: TORSION ATOMS=@phi-17
 # t32: TORSION ATOMS=@psi-17
 #    
 # PRINT ARG=t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19,t20,t21,t22,t23,t24,t25,t26,t27,t28,t29,t30,t31,t32 FILE=colvar.ref FMT=%8.4f
 
+import unittest
 import numpy as np
 import plumed
 import os
 from contextlib import contextmanager
 
 @contextmanager
 def cd(newdir):
@@ -74,15 +75,16 @@
    p.cmd("readInputLine", name + ": " + command )
    shape = np.zeros( 1, dtype=np.int_ )
    p.cmd("getDataRank " + name, shape )
    data = np.zeros((1))
    p.cmd("setMemoryForData " + name, data )
    return data
 
-def runtest():
+class Test(unittest.TestCase):
+  def runtest(self):
     os.system('rm -f bck.*')
     # Output to four decimal places only
     np.set_printoptions(precision=4)
     # Read trajectory
     traj = read_xyz("traj.xyz")
     num_frames = len(traj)
     num_atoms = traj[0].shape[0]
@@ -92,14 +94,19 @@
     virial=np.zeros((3,3),dtype=np.float64)
     masses=np.ones(num_atoms,dtype=np.float64)
     forces=np.random.rand(num_atoms,3)
     charges=np.zeros(num_atoms,dtype=np.float64)
     
     # Create PLUMED object and read input
     p = plumed.Plumed()
+
+    # not really needed, used to check https://github.com/plumed/plumed2/issues/916
+    plumed_version = np.zeros(1, dtype=np.intc)
+    p.cmd( "getApiVersion", plumed_version)
+
     p.cmd("setMDEngine","python")
     p.cmd("setTimestep", 1.)
     p.cmd("setKbT", 1.)
     p.cmd("setNatoms",num_atoms)
     p.cmd("setLogFile","test.log")
     p.cmd("init")
     p.cmd("readInputLine","MOLINFO STRUCTURE=template.pdb")
@@ -153,19 +160,17 @@
         p.cmd("setVirial", virial )
         p.cmd("calc")
         bias = np.zeros((1),dtype=np.float64)
         p.cmd("getBias", bias )
         variables = np.array([t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19,t20,t21,t22,t23,t24,t25,t26,t27,t28,t29,t30,t31,t32]).ravel()
         zeros = variables - correct_torsions[step,1:]
         for data in zeros :
-            if abs(data)>1E-4 : of.write("MISMATCH BETWEEN VALUE FROM PLUMED AND VALUE FROM PYTHON")
-            assert abs(data)<=1E-4
-    
+            self.assertAlmostEqual(data,0.0,places=4)
     of.close()
 
-def test():
+  def test(self):
     with cd('test/'):
-        runtest()
+        self.runtest()
 
 if __name__ == "__main__":
-    test()
+    unittest.main()
```

